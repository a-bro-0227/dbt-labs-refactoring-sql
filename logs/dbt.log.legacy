2022-04-21 01:12:11.942182 (MainThread): Running with dbt=1.0.4
2022-04-21 01:12:12.159779 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-21 01:12:12.174109 (MainThread): Tracking: tracking
2022-04-21 01:12:12.174346 (MainThread): 01:12:12  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6cb271b2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3894f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3890a0>]}
2022-04-21 01:12:12.174628 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-04-21 01:12:12.174857 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-21 01:12:12.175009 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-21 01:12:12.177275 (Thread-12): 01:12:12  Partial parse save file not found. Starting full parse.
2022-04-21 01:12:12.177507 (Thread-12): 01:12:12  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e393040>]}
2022-04-21 01:12:12.204569 (Thread-12): 01:12:12  Parsing macros/adapters.sql
2022-04-21 01:12:12.242666 (Thread-12): 01:12:12  Parsing macros/catalog.sql
2022-04-21 01:12:12.244523 (Thread-12): 01:12:12  Parsing macros/materializations/table.sql
2022-04-21 01:12:12.247531 (Thread-12): 01:12:12  Parsing macros/materializations/seed.sql
2022-04-21 01:12:12.252581 (Thread-12): 01:12:12  Parsing macros/materializations/incremental.sql
2022-04-21 01:12:12.260739 (Thread-12): 01:12:12  Parsing macros/materializations/merge.sql
2022-04-21 01:12:12.264413 (Thread-12): 01:12:12  Parsing macros/materializations/snapshot.sql
2022-04-21 01:12:12.265327 (Thread-12): 01:12:12  Parsing macros/materializations/view.sql
2022-04-21 01:12:12.266610 (Thread-12): 01:12:12  Parsing macros/adapters/metadata.sql
2022-04-21 01:12:12.273483 (Thread-12): 01:12:12  Parsing macros/adapters/columns.sql
2022-04-21 01:12:12.283023 (Thread-12): 01:12:12  Parsing macros/adapters/freshness.sql
2022-04-21 01:12:12.285805 (Thread-12): 01:12:12  Parsing macros/adapters/persist_docs.sql
2022-04-21 01:12:12.290040 (Thread-12): 01:12:12  Parsing macros/adapters/relation.sql
2022-04-21 01:12:12.299364 (Thread-12): 01:12:12  Parsing macros/adapters/schema.sql
2022-04-21 01:12:12.301446 (Thread-12): 01:12:12  Parsing macros/adapters/indexes.sql
2022-04-21 01:12:12.304097 (Thread-12): 01:12:12  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-21 01:12:12.306529 (Thread-12): 01:12:12  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-21 01:12:12.308005 (Thread-12): 01:12:12  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-21 01:12:12.309551 (Thread-12): 01:12:12  Parsing macros/etc/datetime.sql
2022-04-21 01:12:12.317602 (Thread-12): 01:12:12  Parsing macros/etc/statement.sql
2022-04-21 01:12:12.321857 (Thread-12): 01:12:12  Parsing macros/generic_test_sql/unique.sql
2022-04-21 01:12:12.322545 (Thread-12): 01:12:12  Parsing macros/generic_test_sql/not_null.sql
2022-04-21 01:12:12.323125 (Thread-12): 01:12:12  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-21 01:12:12.324458 (Thread-12): 01:12:12  Parsing macros/generic_test_sql/relationships.sql
2022-04-21 01:12:12.325304 (Thread-12): 01:12:12  Parsing macros/materializations/configs.sql
2022-04-21 01:12:12.327557 (Thread-12): 01:12:12  Parsing macros/materializations/hooks.sql
2022-04-21 01:12:12.331304 (Thread-12): 01:12:12  Parsing macros/materializations/models/table/table.sql
2022-04-21 01:12:12.338559 (Thread-12): 01:12:12  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-21 01:12:12.341344 (Thread-12): 01:12:12  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-21 01:12:12.343964 (Thread-12): 01:12:12  Parsing macros/materializations/models/view/helpers.sql
2022-04-21 01:12:12.345232 (Thread-12): 01:12:12  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-21 01:12:12.347482 (Thread-12): 01:12:12  Parsing macros/materializations/models/view/view.sql
2022-04-21 01:12:12.354364 (Thread-12): 01:12:12  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-21 01:12:12.365798 (Thread-12): 01:12:12  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-21 01:12:12.380897 (Thread-12): 01:12:12  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-21 01:12:12.382337 (Thread-12): 01:12:12  Parsing macros/materializations/models/incremental/merge.sql
2022-04-21 01:12:12.393301 (Thread-12): 01:12:12  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-21 01:12:12.397575 (Thread-12): 01:12:12  Parsing macros/materializations/seeds/helpers.sql
2022-04-21 01:12:12.413440 (Thread-12): 01:12:12  Parsing macros/materializations/seeds/seed.sql
2022-04-21 01:12:12.419212 (Thread-12): 01:12:12  Parsing macros/materializations/tests/helpers.sql
2022-04-21 01:12:12.420931 (Thread-12): 01:12:12  Parsing macros/materializations/tests/test.sql
2022-04-21 01:12:12.425200 (Thread-12): 01:12:12  Parsing macros/materializations/tests/where_subquery.sql
2022-04-21 01:12:12.426934 (Thread-12): 01:12:12  Parsing macros/materializations/snapshots/helpers.sql
2022-04-21 01:12:12.437950 (Thread-12): 01:12:12  Parsing macros/materializations/snapshots/strategies.sql
2022-04-21 01:12:12.454207 (Thread-12): 01:12:12  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-21 01:12:12.455831 (Thread-12): 01:12:12  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-21 01:12:12.467002 (Thread-12): 01:12:12  Parsing tests/generic/builtin.sql
2022-04-21 01:12:12.660078 (Thread-12): 01:12:12  1699: static parser successfully parsed example/my_second_dbt_model.sql
2022-04-21 01:12:12.672010 (Thread-12): 01:12:12  1699: static parser successfully parsed example/my_first_dbt_model.sql
2022-04-21 01:12:12.748784 (Thread-12): 01:12:12  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1d4610>]}
2022-04-21 01:12:13.226265 (Thread-13): handling status request
2022-04-21 01:12:13.226600 (Thread-13): 01:12:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6c05b370>]}
2022-04-21 01:12:13.227573 (Thread-13): sending response (<Response 15565 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:12:13.231114 (Thread-14): handling status request
2022-04-21 01:12:13.231331 (Thread-14): 01:12:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3891f0>]}
2022-04-21 01:12:13.232005 (Thread-14): sending response (<Response 15565 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:12:46.043423 (Thread-15): handling status request
2022-04-21 01:12:46.044982 (Thread-15): 01:12:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1d4250>]}
2022-04-21 01:12:46.045809 (Thread-15): sending response (<Response 15565 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:12:48.555483 (Thread-16): 01:12:48  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-21 01:12:48.555663 (Thread-16): 01:12:48  Partial parsing enabled, no changes found, skipping parsing
2022-04-21 01:12:48.560300 (Thread-16): 01:12:48  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f16a550>]}
2022-04-21 01:12:49.249872 (Thread-17): handling status request
2022-04-21 01:12:49.250186 (Thread-17): 01:12:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f15ff70>]}
2022-04-21 01:12:49.250629 (Thread-17): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:12:49.321475 (Thread-18): handling status request
2022-04-21 01:12:49.321693 (Thread-18): 01:12:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f15fe20>]}
2022-04-21 01:12:49.322033 (Thread-18): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:15.622157 (Thread-19): 01:19:15  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-21 01:19:15.623652 (Thread-19): 01:19:15  Partial parsing enabled, no changes found, skipping parsing
2022-04-21 01:19:15.628520 (Thread-19): 01:19:15  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0eb6d0>]}
2022-04-21 01:19:16.390842 (Thread-20): handling status request
2022-04-21 01:19:16.391194 (Thread-20): 01:19:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1ec6a0>]}
2022-04-21 01:19:16.391647 (Thread-20): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:16.412436 (Thread-21): handling status request
2022-04-21 01:19:16.412657 (Thread-21): 01:19:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1ec880>]}
2022-04-21 01:19:16.413030 (Thread-21): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:42.385407 (Thread-22): 01:19:42  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-21 01:19:42.387413 (Thread-22): 01:19:42  Partial parsing enabled, no changes found, skipping parsing
2022-04-21 01:19:42.393202 (Thread-22): 01:19:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1f8190>]}
2022-04-21 01:19:43.145106 (Thread-23): handling status request
2022-04-21 01:19:43.145506 (Thread-23): 01:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0e2640>]}
2022-04-21 01:19:43.145972 (Thread-23): sending response (<Response 1219 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:43.162260 (Thread-24): handling list request
2022-04-21 01:19:43.162482 (Thread-24): 01:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f16bf70>]}
2022-04-21 01:19:43.195535 (Thread-24): 01:19:43  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1d4a00>]}
2022-04-21 01:19:43.195801 (Thread-24): 01:19:43  Found 2 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:19:43.198280 (Thread-24): 01:19:43  The selection criterion '+models/_archive/orginal_query+' does not match any nodes
2022-04-21 01:19:43.198421 (Thread-24): 01:19:43  No nodes selected!
2022-04-21 01:19:43.199915 (Thread-24): sending response (<Response 1942 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:43.293446 (Thread-25): handling status request
2022-04-21 01:19:43.293747 (Thread-25): 01:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d2c1ca0>]}
2022-04-21 01:19:43.294200 (Thread-25): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:43.346730 (Thread-26): handling status request
2022-04-21 01:19:43.347015 (Thread-26): 01:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0e2400>]}
2022-04-21 01:19:43.347403 (Thread-26): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:55.297357 (Thread-27): 01:19:55  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-21 01:19:55.297674 (Thread-27): 01:19:55  Partial parsing: added file: my_new_project://models/_archive/orginal_query.sql
2022-04-21 01:19:55.301423 (Thread-27): 01:19:55  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-21 01:19:55.350152 (Thread-27): 01:19:55  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ae550>]}
2022-04-21 01:19:55.975294 (Thread-28): handling status request
2022-04-21 01:19:55.975616 (Thread-28): 01:19:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ce790>]}
2022-04-21 01:19:55.976071 (Thread-28): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:56.128076 (Thread-29): handling status request
2022-04-21 01:19:56.128392 (Thread-29): 01:19:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ce5b0>]}
2022-04-21 01:19:56.128841 (Thread-29): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:56.201329 (Thread-30): handling status request
2022-04-21 01:19:56.201569 (Thread-30): 01:19:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ce430>]}
2022-04-21 01:19:56.201957 (Thread-30): sending response (<Response 1546 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:56.218702 (Thread-31): handling list request
2022-04-21 01:19:56.218915 (Thread-31): 01:19:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ce220>]}
2022-04-21 01:19:56.248488 (Thread-31): 01:19:56  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f169b20>]}
2022-04-21 01:19:56.248742 (Thread-31): 01:19:56  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:19:56.250996 (Thread-31): 01:19:56  The selection criterion '+models/_archive/orginal_query+' does not match any nodes
2022-04-21 01:19:56.251134 (Thread-31): 01:19:56  No nodes selected!
2022-04-21 01:19:56.252284 (Thread-31): sending response (<Response 1942 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:57.198001 (Thread-32): handling status request
2022-04-21 01:19:57.198368 (Thread-32): 01:19:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f1ece80>]}
2022-04-21 01:19:57.198829 (Thread-32): sending response (<Response 1546 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:19:57.204568 (Thread-33): handling list request
2022-04-21 01:19:57.204773 (Thread-33): 01:19:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ae0a0>]}
2022-04-21 01:19:57.235916 (Thread-33): 01:19:57  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0e2430>]}
2022-04-21 01:19:57.236193 (Thread-33): 01:19:57  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:19:57.236937 (Thread-33): 01:19:57  The selection criterion '+models/_archive/orginal_query.sql+' does not match any nodes
2022-04-21 01:19:57.237059 (Thread-33): 01:19:57  No nodes selected!
2022-04-21 01:19:57.238187 (Thread-33): sending response (<Response 1946 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:20:23.285730 (Thread-34): handling status request
2022-04-21 01:20:23.286082 (Thread-34): 01:20:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ce790>]}
2022-04-21 01:20:23.286537 (Thread-34): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:20:23.695899 (Thread-35): handling run_sql request
2022-04-21 01:20:23.696216 (Thread-35): 01:20:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0af280>]}
2022-04-21 01:20:25.952428 (Thread-35): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:20:25.976144 (MainThread): 01:20:25  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28774b76-3860-43ef-afc8-b1af39d5c2da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa83a6da6d0>]}
2022-04-21 01:20:25.976652 (MainThread): 01:20:25  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:20:25.977314 (Thread-1): 01:20:25  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:20:25.977455 (Thread-1): 01:20:25  Began compiling node rpc.my_new_project.request
2022-04-21 01:20:25.977548 (Thread-1): 01:20:25  Compiling rpc.my_new_project.request
2022-04-21 01:20:25.978612 (Thread-1): 01:20:25  finished collecting timing info
2022-04-21 01:20:25.978743 (Thread-1): 01:20:25  Began executing node rpc.my_new_project.request
2022-04-21 01:20:25.981850 (Thread-1): 01:20:25  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:20:25.981945 (Thread-1): 01:20:25  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)
cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`
    
*/
-- logical cte's
-- final cte's
-- select statement

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `dbt-public.interview_task.orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as int64) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `dbt-public.interview_task.devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `dbt-public.interview_task.orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `dbt-public.interview_task.addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `dbt-public.interview_task.payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:20:25.982026 (Thread-1): 01:20:25  Opening a new connection, currently in state init
2022-04-21 01:20:26.345201 (Thread-36): handling poll request
2022-04-21 01:20:26.345593 (Thread-36): 01:20:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0b4ac0>]}
2022-04-21 01:20:26.374501 (Thread-36): sending response (<Response 7618 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:20:27.159259 (Thread-1): 01:20:27  Snowflake adapter: Snowflake query id: 01a3beb0-0501-6083-0004-7d83048388ce
2022-04-21 01:20:27.159473 (Thread-1): 01:20:27  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'FROM'.
2022-04-21 01:20:27.159671 (Thread-1): 01:20:27  finished collecting timing info
2022-04-21 01:20:27.159858 (Thread-1): 01:20:27  On rpc.my_new_project.request: Close
2022-04-21 01:20:27.365486 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'FROM'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'FROM'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'FROM'.
2022-04-21 01:20:27.366465 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'FROM'.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'FROM'.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 01:20:27.825514 (Thread-37): handling poll request
2022-04-21 01:20:27.825901 (Thread-37): 01:20:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0b4f40>]}
2022-04-21 01:20:27.826649 (Thread-37): sending response (<Response 38127 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:21:29.236789 (Thread-38): handling status request
2022-04-21 01:21:29.239142 (Thread-38): 01:21:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d038340>]}
2022-04-21 01:21:29.239655 (Thread-38): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:21:29.679815 (Thread-39): handling run_sql request
2022-04-21 01:21:29.680081 (Thread-39): 01:21:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d038ca0>]}
2022-04-21 01:21:31.889443 (Thread-39): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:21:31.916339 (MainThread): 01:21:31  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '612d75d3-a4e3-496f-bc73-563519a20940', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe46f79a6a0>]}
2022-04-21 01:21:31.916855 (MainThread): 01:21:31  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:21:31.917527 (Thread-1): 01:21:31  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:21:31.917661 (Thread-1): 01:21:31  Began compiling node rpc.my_new_project.request
2022-04-21 01:21:31.917754 (Thread-1): 01:21:31  Compiling rpc.my_new_project.request
2022-04-21 01:21:31.918839 (Thread-1): 01:21:31  finished collecting timing info
2022-04-21 01:21:31.918996 (Thread-1): 01:21:31  Began executing node rpc.my_new_project.request
2022-04-21 01:21:31.922482 (Thread-1): 01:21:31  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:21:31.922582 (Thread-1): 01:21:31  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)
cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`
    
*/
-- logical cte's
-- final cte's
-- select statement

SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `dbt-public.interview_task.orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as int64) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `dbt-public.interview_task.devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `dbt-public.interview_task.orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `dbt-public.interview_task.addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `dbt-public.interview_task.payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:21:31.922664 (Thread-1): 01:21:31  Opening a new connection, currently in state init
2022-04-21 01:21:32.247354 (Thread-40): handling poll request
2022-04-21 01:21:32.248238 (Thread-40): 01:21:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0b4e50>]}
2022-04-21 01:21:32.249075 (Thread-40): sending response (<Response 7955 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:21:32.914651 (Thread-1): 01:21:32  Snowflake adapter: Snowflake query id: 01a3beb1-0501-602e-0004-7d8304837ef2
2022-04-21 01:21:32.914912 (Thread-1): 01:21:32  Snowflake adapter: Snowflake error: 002040 (42601): SQL compilation error:
Unsupported data type 'INT64'.
2022-04-21 01:21:32.915163 (Thread-1): 01:21:32  finished collecting timing info
2022-04-21 01:21:32.915368 (Thread-1): 01:21:32  On rpc.my_new_project.request: Close
2022-04-21 01:21:33.117179 (Thread-1): Got an exception: Database Error
  002040 (42601): SQL compilation error:
  Unsupported data type 'INT64'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002040 (42601): SQL compilation error:
Unsupported data type 'INT64'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002040 (42601): SQL compilation error:
  Unsupported data type 'INT64'.
2022-04-21 01:21:33.118154 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002040 (42601): SQL compilation error:\n  Unsupported data type 'INT64'.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002040 (42601): SQL compilation error:\n  Unsupported data type 'INT64'.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 01:21:33.656996 (Thread-41): handling poll request
2022-04-21 01:21:33.657327 (Thread-41): 01:21:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d03d160>]}
2022-04-21 01:21:33.658280 (Thread-41): sending response (<Response 40404 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:23:48.949200 (Thread-42): handling status request
2022-04-21 01:23:48.951794 (Thread-42): 01:23:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d03d6a0>]}
2022-04-21 01:23:48.952518 (Thread-42): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:23:49.325790 (Thread-43): handling run_sql request
2022-04-21 01:23:49.326104 (Thread-43): 01:23:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d03d910>]}
2022-04-21 01:23:51.541857 (Thread-43): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:23:51.569112 (MainThread): 01:23:51  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3f22efce-de2b-4fc3-863b-f6e94a50093d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbfe67da6d0>]}
2022-04-21 01:23:51.569616 (MainThread): 01:23:51  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:23:51.570260 (Thread-1): 01:23:51  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:23:51.570405 (Thread-1): 01:23:51  Began compiling node rpc.my_new_project.request
2022-04-21 01:23:51.570500 (Thread-1): 01:23:51  Compiling rpc.my_new_project.request
2022-04-21 01:23:51.571622 (Thread-1): 01:23:51  finished collecting timing info
2022-04-21 01:23:51.571746 (Thread-1): 01:23:51  Began executing node rpc.my_new_project.request
2022-04-21 01:23:51.575260 (Thread-1): 01:23:51  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:23:51.575359 (Thread-1): 01:23:51  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)
cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`
    
*/
-- logical cte's
-- final cte's
-- select statement

SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `dbt-public.interview_task.orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as int64) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `dbt-public.interview_task.devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `dbt-public.interview_task.orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `dbt-public.interview_task.addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `dbt-public.interview_task.payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:23:51.575441 (Thread-1): 01:23:51  Opening a new connection, currently in state init
2022-04-21 01:23:51.881976 (Thread-44): handling poll request
2022-04-21 01:23:51.882361 (Thread-44): 01:23:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d0408e0>]}
2022-04-21 01:23:51.883245 (Thread-44): sending response (<Response 7955 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:23:52.461251 (Thread-1): 01:23:52  Snowflake adapter: Snowflake query id: 01a3beb3-0501-5f4a-0004-7d830483a0c6
2022-04-21 01:23:52.461467 (Thread-1): 01:23:52  Snowflake adapter: Snowflake error: 002040 (42601): SQL compilation error:
Unsupported data type 'INT64'.
2022-04-21 01:23:52.461653 (Thread-1): 01:23:52  finished collecting timing info
2022-04-21 01:23:52.461848 (Thread-1): 01:23:52  On rpc.my_new_project.request: Close
2022-04-21 01:23:52.643510 (Thread-1): Got an exception: Database Error
  002040 (42601): SQL compilation error:
  Unsupported data type 'INT64'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002040 (42601): SQL compilation error:
Unsupported data type 'INT64'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002040 (42601): SQL compilation error:
  Unsupported data type 'INT64'.
2022-04-21 01:23:52.644500 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002040 (42601): SQL compilation error:\n  Unsupported data type 'INT64'.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002040 (42601): SQL compilation error:\n  Unsupported data type 'INT64'.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as int64) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 01:23:53.285006 (Thread-45): handling poll request
2022-04-21 01:23:53.285357 (Thread-45): 01:23:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d040b80>]}
2022-04-21 01:23:53.286059 (Thread-45): sending response (<Response 40404 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:29:24.062461 (Thread-46): handling status request
2022-04-21 01:29:24.064146 (Thread-46): 01:29:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d046370>]}
2022-04-21 01:29:24.064661 (Thread-46): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:29:24.402678 (Thread-47): handling run_sql request
2022-04-21 01:29:24.403075 (Thread-47): 01:29:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d046550>]}
2022-04-21 01:29:26.684706 (Thread-47): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:29:26.711539 (MainThread): 01:29:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '316e1927-d005-4eb4-9101-957bd2cedbfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbdb74246a0>]}
2022-04-21 01:29:26.712091 (MainThread): 01:29:26  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:29:26.712749 (Thread-1): 01:29:26  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:29:26.712894 (Thread-1): 01:29:26  Began compiling node rpc.my_new_project.request
2022-04-21 01:29:26.712988 (Thread-1): 01:29:26  Compiling rpc.my_new_project.request
2022-04-21 01:29:26.714109 (Thread-1): 01:29:26  finished collecting timing info
2022-04-21 01:29:26.714244 (Thread-1): 01:29:26  Began executing node rpc.my_new_project.request
2022-04-21 01:29:26.717787 (Thread-1): 01:29:26  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:29:26.717889 (Thread-1): 01:29:26  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)
cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`
    
*/
-- logical cte's
-- final cte's
-- select statement

SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `dbt-public.interview_task.orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as float) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `dbt-public.interview_task.devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `dbt-public.interview_task.orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `dbt-public.interview_task.addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `dbt-public.interview_task.payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:29:26.717972 (Thread-1): 01:29:26  Opening a new connection, currently in state init
2022-04-21 01:29:27.037820 (Thread-48): handling poll request
2022-04-21 01:29:27.038216 (Thread-48): 01:29:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d04e520>]}
2022-04-21 01:29:27.039089 (Thread-48): sending response (<Response 7955 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:29:27.654005 (Thread-1): 01:29:27  Snowflake adapter: Snowflake query id: 01a3beb9-0501-602e-0004-7d8304837f7e
2022-04-21 01:29:27.654239 (Thread-1): 01:29:27  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object '"`DBT-PUBLIC.INTERVIEW_TASK.ORDERS`"' does not exist or not authorized.
2022-04-21 01:29:27.654430 (Thread-1): 01:29:27  finished collecting timing info
2022-04-21 01:29:27.654624 (Thread-1): 01:29:27  On rpc.my_new_project.request: Close
2022-04-21 01:29:27.850118 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object '"`DBT-PUBLIC.INTERVIEW_TASK.ORDERS`"' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object '"`DBT-PUBLIC.INTERVIEW_TASK.ORDERS`"' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object '"`DBT-PUBLIC.INTERVIEW_TASK.ORDERS`"' does not exist or not authorized.
2022-04-21 01:29:27.851285 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object \'"`DBT-PUBLIC.INTERVIEW_TASK.ORDERS`"\' does not exist or not authorized.', 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object \'"`DBT-PUBLIC.INTERVIEW_TASK.ORDERS`"\' does not exist or not authorized.', 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\ncte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `dbt-public.interview_task.orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `dbt-public.interview_task.devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `dbt-public.interview_task.orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `dbt-public.interview_task.addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `dbt-public.interview_task.payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 01:29:28.378806 (Thread-49): handling poll request
2022-04-21 01:29:28.379184 (Thread-49): 01:29:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d04e820>]}
2022-04-21 01:29:28.380303 (Thread-49): sending response (<Response 40765 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:02.696225 (Thread-50): handling status request
2022-04-21 01:33:02.697981 (Thread-50): 01:33:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d040340>]}
2022-04-21 01:33:02.698468 (Thread-50): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:03.085444 (Thread-51): handling run_sql request
2022-04-21 01:33:03.085804 (Thread-51): 01:33:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d04e790>]}
2022-04-21 01:33:05.301495 (Thread-51): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:05.328026 (MainThread): 01:33:05  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64b36024-7f6f-4a77-8158-fdc38395e148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee541f9400>]}
2022-04-21 01:33:05.328540 (MainThread): 01:33:05  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:33:05.329197 (Thread-1): 01:33:05  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:33:05.329347 (Thread-1): 01:33:05  Began compiling node rpc.my_new_project.request
2022-04-21 01:33:05.329443 (Thread-1): 01:33:05  Compiling rpc.my_new_project.request
2022-04-21 01:33:05.330523 (Thread-1): 01:33:05  finished collecting timing info
2022-04-21 01:33:05.330652 (Thread-1): 01:33:05  Began executing node rpc.my_new_project.request
2022-04-21 01:33:05.334241 (Thread-1): 01:33:05  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:33:05.334342 (Thread-1): 01:33:05  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)

cte's we found in query:
    `raw.interview_sample_data.intreview_orders` o
    `raw.interview_sample_data.intreview_devices` d
    `raw.interview_sample_data.intreview_orders` as fo -- potentially redunant
    `raw.interview_sample_data.intreview_addresses` oa 
    `raw.interview_sample_data.intreview_payments`

a couple of errors that were resolved:
  data type int64 to float
  rename tables to: 
    
*/
-- logical cte's
-- final cte's
-- select statement

SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `raw.interview_sample_data.intreview_orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as float) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `raw.interview_sample_data.intreview_devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `raw.interview_sample_data.intreview_orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `raw.interview_sample_data.intreview_addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `raw.interview_sample_data.intreview_payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:33:05.334425 (Thread-1): 01:33:05  Opening a new connection, currently in state init
2022-04-21 01:33:05.658078 (Thread-52): handling poll request
2022-04-21 01:33:05.658444 (Thread-52): 01:33:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d058790>]}
2022-04-21 01:33:05.659315 (Thread-52): sending response (<Response 8159 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:06.392746 (Thread-1): 01:33:06  Snowflake adapter: Snowflake query id: 01a3bebd-0501-5fd8-0004-7d83048399e2
2022-04-21 01:33:06.392986 (Thread-1): 01:33:06  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object '"`RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS`"' does not exist or not authorized.
2022-04-21 01:33:06.393170 (Thread-1): 01:33:06  finished collecting timing info
2022-04-21 01:33:06.393364 (Thread-1): 01:33:06  On rpc.my_new_project.request: Close
2022-04-21 01:33:06.631592 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object '"`RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS`"' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object '"`RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS`"' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object '"`RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS`"' does not exist or not authorized.
2022-04-21 01:33:06.632552 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object \'"`RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS`"\' does not exist or not authorized.', 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    `raw.interview_sample_data.intreview_orders` o\r\n    `raw.interview_sample_data.intreview_devices` d\r\n    `raw.interview_sample_data.intreview_orders` as fo -- potentially redunant\r\n    `raw.interview_sample_data.intreview_addresses` oa \r\n    `raw.interview_sample_data.intreview_payments`\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `raw.interview_sample_data.intreview_orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `raw.interview_sample_data.intreview_devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `raw.interview_sample_data.intreview_orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `raw.interview_sample_data.intreview_addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `raw.interview_sample_data.intreview_payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    `raw.interview_sample_data.intreview_orders` o\r\n    `raw.interview_sample_data.intreview_devices` d\r\n    `raw.interview_sample_data.intreview_orders` as fo -- potentially redunant\r\n    `raw.interview_sample_data.intreview_addresses` oa \r\n    `raw.interview_sample_data.intreview_payments`\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `raw.interview_sample_data.intreview_orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `raw.interview_sample_data.intreview_devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `raw.interview_sample_data.intreview_orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `raw.interview_sample_data.intreview_addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `raw.interview_sample_data.intreview_payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object \'"`RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS`"\' does not exist or not authorized.', 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    `raw.interview_sample_data.intreview_orders` o\r\n    `raw.interview_sample_data.intreview_devices` d\r\n    `raw.interview_sample_data.intreview_orders` as fo -- potentially redunant\r\n    `raw.interview_sample_data.intreview_addresses` oa \r\n    `raw.interview_sample_data.intreview_payments`\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `raw.interview_sample_data.intreview_orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `raw.interview_sample_data.intreview_devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `raw.interview_sample_data.intreview_orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `raw.interview_sample_data.intreview_addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `raw.interview_sample_data.intreview_payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    `raw.interview_sample_data.intreview_orders` o\r\n    `raw.interview_sample_data.intreview_devices` d\r\n    `raw.interview_sample_data.intreview_orders` as fo -- potentially redunant\r\n    `raw.interview_sample_data.intreview_addresses` oa \r\n    `raw.interview_sample_data.intreview_payments`\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM `raw.interview_sample_data.intreview_orders` o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM `raw.interview_sample_data.intreview_devices` d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM `raw.interview_sample_data.intreview_orders` as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join `raw.interview_sample_data.intreview_addresses` oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM `raw.interview_sample_data.intreview_payments`\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 01:33:07.041684 (Thread-53): handling poll request
2022-04-21 01:33:07.041998 (Thread-53): 01:33:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d058a90>]}
2022-04-21 01:33:07.042714 (Thread-53): sending response (<Response 42303 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:22.583895 (Thread-54): handling status request
2022-04-21 01:33:22.584223 (Thread-54): 01:33:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d058f10>]}
2022-04-21 01:33:22.584722 (Thread-54): sending response (<Response 1568 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:22.952498 (Thread-55): handling run_sql request
2022-04-21 01:33:22.952798 (Thread-55): 01:33:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d0660d0>]}
2022-04-21 01:33:25.167370 (Thread-55): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:25.191246 (MainThread): 01:33:25  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be1fa11d-c25a-4528-aaf9-4188df147145', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb6c73a7e20>]}
2022-04-21 01:33:25.191751 (MainThread): 01:33:25  Found 3 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:33:25.192402 (Thread-1): 01:33:25  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:33:25.192557 (Thread-1): 01:33:25  Began compiling node rpc.my_new_project.request
2022-04-21 01:33:25.192651 (Thread-1): 01:33:25  Compiling rpc.my_new_project.request
2022-04-21 01:33:25.193755 (Thread-1): 01:33:25  finished collecting timing info
2022-04-21 01:33:25.193880 (Thread-1): 01:33:25  Began executing node rpc.my_new_project.request
2022-04-21 01:33:25.197489 (Thread-1): 01:33:25  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:33:25.197589 (Thread-1): 01:33:25  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)

cte's we found in query:
    raw.interview_sample_data.intreview_orders o
    raw.interview_sample_data.intreview_devices d
    raw.interview_sample_data.intreview_orders as fo -- potentially redunant
    raw.interview_sample_data.intreview_addresses oa 
    raw.interview_sample_data.intreview_payments

a couple of errors that were resolved:
  data type int64 to float
  rename tables to: 
    
*/
-- logical cte's
-- final cte's
-- select statement

SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM raw.interview_sample_data.intreview_orders o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as float) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM raw.interview_sample_data.intreview_devices d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM raw.interview_sample_data.intreview_orders as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join raw.interview_sample_data.intreview_addresses oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM raw.interview_sample_data.intreview_payments
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:33:25.197671 (Thread-1): 01:33:25  Opening a new connection, currently in state init
2022-04-21 01:33:25.519146 (Thread-56): handling poll request
2022-04-21 01:33:25.519560 (Thread-56): 01:33:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d06c100>]}
2022-04-21 01:33:25.520394 (Thread-56): sending response (<Response 8139 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:33:26.103914 (Thread-1): 01:33:26  Snowflake adapter: Snowflake query id: 01a3bebd-0501-6083-0004-7d8304838a72
2022-04-21 01:33:26.104160 (Thread-1): 01:33:26  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS' does not exist or not authorized.
2022-04-21 01:33:26.104385 (Thread-1): 01:33:26  finished collecting timing info
2022-04-21 01:33:26.104613 (Thread-1): 01:33:26  On rpc.my_new_project.request: Close
2022-04-21 01:33:26.315277 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS' does not exist or not authorized.
2022-04-21 01:33:26.316262 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS' does not exist or not authorized.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    raw.interview_sample_data.intreview_orders o\r\n    raw.interview_sample_data.intreview_devices d\r\n    raw.interview_sample_data.intreview_orders as fo -- potentially redunant\r\n    raw.interview_sample_data.intreview_addresses oa \r\n    raw.interview_sample_data.intreview_payments\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM raw.interview_sample_data.intreview_orders o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM raw.interview_sample_data.intreview_devices d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM raw.interview_sample_data.intreview_orders as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join raw.interview_sample_data.intreview_addresses oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM raw.interview_sample_data.intreview_payments\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    raw.interview_sample_data.intreview_orders o\r\n    raw.interview_sample_data.intreview_devices d\r\n    raw.interview_sample_data.intreview_orders as fo -- potentially redunant\r\n    raw.interview_sample_data.intreview_addresses oa \r\n    raw.interview_sample_data.intreview_payments\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM raw.interview_sample_data.intreview_orders o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM raw.interview_sample_data.intreview_devices d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM raw.interview_sample_data.intreview_orders as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join raw.interview_sample_data.intreview_addresses oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM raw.interview_sample_data.intreview_payments\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'RAW.INTERVIEW_SAMPLE_DATA.INTREVIEW_ORDERS' does not exist or not authorized.", 'raw_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    raw.interview_sample_data.intreview_orders o\r\n    raw.interview_sample_data.intreview_devices d\r\n    raw.interview_sample_data.intreview_orders as fo -- potentially redunant\r\n    raw.interview_sample_data.intreview_addresses oa \r\n    raw.interview_sample_data.intreview_payments\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM raw.interview_sample_data.intreview_orders o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM raw.interview_sample_data.intreview_devices d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM raw.interview_sample_data.intreview_orders as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join raw.interview_sample_data.intreview_addresses oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM raw.interview_sample_data.intreview_payments\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\r\n/*\r\nFirst it is best to pull out your source tables into CTE's\r\nThen we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)\r\n\r\ncte's we found in query:\r\n    raw.interview_sample_data.intreview_orders o\r\n    raw.interview_sample_data.intreview_devices d\r\n    raw.interview_sample_data.intreview_orders as fo -- potentially redunant\r\n    raw.interview_sample_data.intreview_addresses oa \r\n    raw.interview_sample_data.intreview_payments\r\n\r\na couple of errors that were resolved:\r\n  data type int64 to float\r\n  rename tables to: \r\n    \r\n*/\r\n-- logical cte's\r\n-- final cte's\r\n-- select statement\r\n\r\nSELECT\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nFROM (\r\n    \r\n    SELECT\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status AS order_status,\r\n      CASE\r\n        WHEN o.status IN (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) THEN 'completed'\r\n        ELSE o.status\r\n      END AS order_status_category,\r\n      CASE\r\n        WHEN oa.country_code IS NULL THEN 'Null country'\r\n        WHEN oa.country_code = 'US' THEN 'US'\r\n        WHEN oa.country_code != 'US' THEN 'International'\r\n      END AS country_type,\r\n      o.shipping_method,\r\n      CASE\r\n        WHEN d.device = 'web' THEN 'desktop'\r\n        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'\r\n        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'\r\n        when NULLIF(d.device, '') IS NULL THEN 'unknown'\r\n        ELSE 'ERROR'\r\n      END AS purchase_device_type,\r\n      d.device AS purchase_device,\r\n      CASE\r\n        WHEN fo.first_order_id = o.order_id THEN 'new'\r\n        ELSE 'repeat'\r\n      END AS user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      CASE\r\n        WHEN o.currency = 'USD' then o.amount_total_cents\r\n        ELSE pa.gross_total_amount_cents\r\n      END AS total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    FROM raw.interview_sample_data.intreview_orders o\r\n    LEFT JOIN (\r\n        SELECT\r\n          DISTINCT cast(d.type_id as float) as order_id,\r\n          FIRST_VALUE(d.device) OVER (\r\n            PARTITION BY d.type_id\r\n            ORDER BY\r\n              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING\r\n              AND UNBOUNDED FOLLOWING\r\n          ) AS device\r\n        FROM raw.interview_sample_data.intreview_devices d\r\n        WHERE d.type = 'order'\r\n    ) d ON d.order_id = o.order_id\r\n    LEFT JOIN (\r\n        SELECT\r\n          fo.user_id,\r\n          MIN(fo.order_id) as first_order_id\r\n        FROM raw.interview_sample_data.intreview_orders as fo\r\n        WHERE\r\n          fo.status != 'cancelled'\r\n        GROUP BY\r\n          fo.user_id\r\n      ) fo ON o.user_id = fo.user_id\r\n    left join raw.interview_sample_data.intreview_addresses oa \r\n      ON oa.order_id = o.order_id\r\n    LEFT JOIN (\r\n        select\r\n          order_id,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_tax_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n        ) as gross_shipping_amount_cents,\r\n          sum(\r\n            CASE\r\n              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents\r\n              ELSE 0\r\n            END\r\n          ) as gross_total_amount_cents\r\n        FROM raw.interview_sample_data.intreview_payments\r\n        GROUP BY order_id\r\n    ) pa ON pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 01:33:26.819548 (Thread-57): handling poll request
2022-04-21 01:33:26.819858 (Thread-57): 01:33:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d06c400>]}
2022-04-21 01:33:26.820601 (Thread-57): sending response (<Response 42117 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:06.047364 (Thread-58): 01:37:06  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-21 01:37:06.049273 (Thread-58): 01:37:06  Partial parsing: added file: my_new_project://models/_archive/test.sql
2022-04-21 01:37:06.053288 (Thread-58): 01:37:06  1699: static parser successfully parsed _archive/test.sql
2022-04-21 01:37:06.096218 (Thread-58): 01:37:06  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfb3f70>]}
2022-04-21 01:37:06.889770 (Thread-59): handling status request
2022-04-21 01:37:06.890104 (Thread-59): 01:37:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf9ad00>]}
2022-04-21 01:37:06.890595 (Thread-59): sending response (<Response 1550 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:06.929046 (Thread-60): handling status request
2022-04-21 01:37:06.929361 (Thread-60): 01:37:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf9abe0>]}
2022-04-21 01:37:06.929815 (Thread-60): sending response (<Response 1550 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:53.670170 (Thread-61): handling status request
2022-04-21 01:37:53.670527 (Thread-61): 01:37:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf9aa90>]}
2022-04-21 01:37:53.671047 (Thread-61): sending response (<Response 1550 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:53.993975 (Thread-62): handling run_sql request
2022-04-21 01:37:53.994309 (Thread-62): 01:37:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf9a670>]}
2022-04-21 01:37:56.243784 (Thread-62): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:56.267658 (MainThread): 01:37:56  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e14148f2-1cd4-4846-b1a8-10a8cea9b224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8805c56dc0>]}
2022-04-21 01:37:56.268203 (MainThread): 01:37:56  Found 4 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:37:56.268873 (Thread-1): 01:37:56  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:37:56.269004 (Thread-1): 01:37:56  Began compiling node rpc.my_new_project.request
2022-04-21 01:37:56.269097 (Thread-1): 01:37:56  Compiling rpc.my_new_project.request
2022-04-21 01:37:56.270143 (Thread-1): 01:37:56  finished collecting timing info
2022-04-21 01:37:56.270275 (Thread-1): 01:37:56  Began executing node rpc.my_new_project.request
2022-04-21 01:37:56.270812 (Thread-1): 01:37:56  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:37:56.270908 (Thread-1): 01:37:56  On rpc.my_new_project.request: select * from raw.interview_sample_data.interview_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:37:56.271020 (Thread-1): 01:37:56  Opening a new connection, currently in state init
2022-04-21 01:37:56.601501 (Thread-63): handling poll request
2022-04-21 01:37:56.601902 (Thread-63): 01:37:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d066bb0>]}
2022-04-21 01:37:56.602798 (Thread-63): sending response (<Response 3763 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:57.931418 (Thread-64): handling poll request
2022-04-21 01:37:57.931775 (Thread-64): 01:37:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d06c250>]}
2022-04-21 01:37:57.932278 (Thread-64): sending response (<Response 386 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:37:58.165255 (Thread-1): 01:37:58  SQL status: SUCCESS 500 in 1.89 seconds
2022-04-21 01:37:58.190293 (Thread-1): 01:37:58  finished collecting timing info
2022-04-21 01:37:58.190674 (Thread-1): 01:37:58  On rpc.my_new_project.request: Close
2022-04-21 01:37:59.248118 (Thread-65): handling poll request
2022-04-21 01:37:59.248470 (Thread-65): 01:37:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf96f70>]}
2022-04-21 01:37:59.251609 (Thread-65): sending response (<Response 62875 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:38:48.030585 (Thread-66): handling status request
2022-04-21 01:38:48.030929 (Thread-66): 01:38:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d06ce80>]}
2022-04-21 01:38:48.054242 (Thread-66): sending response (<Response 1550 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:38:48.387586 (Thread-67): handling run_sql request
2022-04-21 01:38:48.387946 (Thread-67): 01:38:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3d06ce50>]}
2022-04-21 01:38:50.651110 (Thread-67): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:38:50.676442 (MainThread): 01:38:50  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1eb09f38-2567-4efa-9413-1efcfa94c1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faebeaed760>]}
2022-04-21 01:38:50.676985 (MainThread): 01:38:50  Found 4 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 01:38:50.677654 (Thread-1): 01:38:50  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 01:38:50.677789 (Thread-1): 01:38:50  Began compiling node rpc.my_new_project.request
2022-04-21 01:38:50.677880 (Thread-1): 01:38:50  Compiling rpc.my_new_project.request
2022-04-21 01:38:50.679017 (Thread-1): 01:38:50  finished collecting timing info
2022-04-21 01:38:50.679151 (Thread-1): 01:38:50  Began executing node rpc.my_new_project.request
2022-04-21 01:38:50.682729 (Thread-1): 01:38:50  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 01:38:50.682840 (Thread-1): 01:38:50  On rpc.my_new_project.request: -- import cte's
/*
First it is best to pull out your source tables into CTE's
Then we create a _source.yml file in order to source those (which makes a pretty, more inuitive DAG)

cte's we found in query:
    raw.interview_sample_data.interview_orders o
    raw.interview_sample_data.interview_devices d
    raw.interview_sample_data.interview_orders as fo -- potentially redunant
    raw.interview_sample_data.interview_addresses oa 
    raw.interview_sample_data.interview_payments

a couple of errors that were resolved:
  data type int64 to float
  rename tables to: 
    
*/
-- logical cte's
-- final cte's
-- select statement

SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM raw.interview_sample_data.interview_orders o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as float) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM raw.interview_sample_data.interview_devices d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM raw.interview_sample_data.interview_orders as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join raw.interview_sample_data.interview_addresses oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM raw.interview_sample_data.interview_payments
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 01:38:50.682923 (Thread-1): 01:38:50  Opening a new connection, currently in state init
2022-04-21 01:38:50.990797 (Thread-68): handling poll request
2022-04-21 01:38:50.991228 (Thread-68): 01:38:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfb0160>]}
2022-04-21 01:38:50.992144 (Thread-68): sending response (<Response 8139 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:38:52.334602 (Thread-69): handling poll request
2022-04-21 01:38:52.334932 (Thread-69): 01:38:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfb00d0>]}
2022-04-21 01:38:52.335449 (Thread-69): sending response (<Response 395 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:38:53.123405 (Thread-1): 01:38:53  SQL status: SUCCESS 500 in 2.44 seconds
2022-04-21 01:38:53.657283 (Thread-70): handling poll request
2022-04-21 01:38:53.658000 (Thread-70): 01:38:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfb0550>]}
2022-04-21 01:38:53.658700 (Thread-70): sending response (<Response 1094 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:38:53.655991 (Thread-1): 01:38:53  finished collecting timing info
2022-04-21 01:38:53.656266 (Thread-1): 01:38:53  On rpc.my_new_project.request: Close
2022-04-21 01:38:55.001138 (Thread-71): handling poll request
2022-04-21 01:38:55.001484 (Thread-71): 01:38:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0ebaf0>]}
2022-04-21 01:38:55.010705 (Thread-71): sending response (<Response 149494 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:45:59.850439 (Thread-72): 01:45:59  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-21 01:45:59.852126 (Thread-72): 01:45:59  Partial parsing enabled, no changes found, skipping parsing
2022-04-21 01:45:59.857139 (Thread-72): 01:45:59  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd1f850>]}
2022-04-21 01:46:00.729968 (Thread-73): handling status request
2022-04-21 01:46:00.730295 (Thread-73): 01:46:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ce135b0>]}
2022-04-21 01:46:00.730794 (Thread-73): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:46:00.863050 (Thread-74): handling status request
2022-04-21 01:46:00.863320 (Thread-74): 01:46:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ce133a0>]}
2022-04-21 01:46:00.863742 (Thread-74): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:46:10.210707 (Thread-75): 01:46:10  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-21 01:46:10.211044 (Thread-75): 01:46:10  Partial parsing: added file: my_new_project://models/_archive/stg_query.sql
2022-04-21 01:46:10.214643 (Thread-75): 01:46:10  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 01:46:10.261751 (Thread-75): 01:46:10  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ccb5730>]}
2022-04-21 01:46:10.888639 (Thread-76): handling status request
2022-04-21 01:46:10.888960 (Thread-76): 01:46:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd06c70>]}
2022-04-21 01:46:10.889424 (Thread-76): sending response (<Response 1560 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:46:10.937278 (Thread-77): handling status request
2022-04-21 01:46:10.937489 (Thread-77): 01:46:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd06a90>]}
2022-04-21 01:46:10.937837 (Thread-77): sending response (<Response 1560 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:47:57.952546 (Thread-78): 01:47:57  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 01:47:57.953382 (Thread-78): 01:47:57  Partial parsing: updated file: my_new_project://models/_archive/orginal_query.sql
2022-04-21 01:47:57.957067 (Thread-78): 01:47:57  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-21 01:47:58.002051 (Thread-78): 01:47:58  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc973a0>]}
2022-04-21 01:47:58.792011 (Thread-79): handling status request
2022-04-21 01:47:58.792344 (Thread-79): 01:47:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc88880>]}
2022-04-21 01:47:58.792829 (Thread-79): sending response (<Response 1570 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:47:58.849951 (Thread-80): handling status request
2022-04-21 01:47:58.851999 (Thread-80): 01:47:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc886a0>]}
2022-04-21 01:47:58.852487 (Thread-80): sending response (<Response 1570 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:00.735752 (Thread-81): 01:48:00  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 01:48:00.736099 (Thread-81): 01:48:00  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 01:48:00.870934 (Thread-81): 01:48:00  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 01:48:00.910117 (Thread-81): 01:48:00  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e307070>]}
2022-04-21 01:48:01.526018 (Thread-82): handling status request
2022-04-21 01:48:01.526371 (Thread-82): 01:48:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc6f820>]}
2022-04-21 01:48:01.526860 (Thread-82): sending response (<Response 1562 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:01.662502 (Thread-83): handling status request
2022-04-21 01:48:01.662845 (Thread-83): 01:48:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc6f640>]}
2022-04-21 01:48:01.663351 (Thread-83): sending response (<Response 1562 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:06.162436 (Thread-84): 01:48:06  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 01:48:06.162789 (Thread-84): 01:48:06  Partial parsing: updated file: my_new_project://models/_archive/test.sql
2022-04-21 01:48:06.166280 (Thread-84): 01:48:06  1699: static parser successfully parsed _archive/test.sql
2022-04-21 01:48:06.209110 (Thread-84): 01:48:06  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3756a0>]}
2022-04-21 01:48:06.879416 (Thread-85): handling status request
2022-04-21 01:48:06.879761 (Thread-85): 01:48:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfa7070>]}
2022-04-21 01:48:06.880254 (Thread-85): sending response (<Response 1552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:06.883265 (Thread-86): handling status request
2022-04-21 01:48:06.883478 (Thread-86): 01:48:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfa7460>]}
2022-04-21 01:48:06.883831 (Thread-86): sending response (<Response 1552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:44.504513 (Thread-87): handling status request
2022-04-21 01:48:44.504849 (Thread-87): 01:48:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cfa7850>]}
2022-04-21 01:48:44.505318 (Thread-87): sending response (<Response 1552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:47.063338 (Thread-88): 01:48:47  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-21 01:48:47.063522 (Thread-88): 01:48:47  Partial parsing enabled, no changes found, skipping parsing
2022-04-21 01:48:47.068421 (Thread-88): 01:48:47  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e334f70>]}
2022-04-21 01:48:47.778276 (Thread-89): handling status request
2022-04-21 01:48:47.778664 (Thread-89): 01:48:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc03e20>]}
2022-04-21 01:48:47.779182 (Thread-89): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:48:47.850822 (Thread-90): handling status request
2022-04-21 01:48:47.851150 (Thread-90): 01:48:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc03790>]}
2022-04-21 01:48:47.851599 (Thread-90): sending response (<Response 1241 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:56:20.386841 (Thread-91): 01:56:20  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-21 01:56:20.387698 (Thread-91): 01:56:20  Partial parsing: added file: my_new_project://models/_archive/conn_test.sql
2022-04-21 01:56:20.387829 (Thread-91): 01:56:20  Partial parsing: deleted file: my_new_project://models/_archive/test.sql
2022-04-21 01:56:20.392148 (Thread-91): 01:56:20  1699: static parser successfully parsed _archive/conn_test.sql
2022-04-21 01:56:20.433038 (Thread-91): 01:56:20  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc2f8e0>]}
2022-04-21 01:56:21.106122 (Thread-92): handling status request
2022-04-21 01:56:21.106462 (Thread-92): 01:56:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0eae20>]}
2022-04-21 01:56:21.106957 (Thread-92): sending response (<Response 1873 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:56:21.410533 (Thread-93): handling status request
2022-04-21 01:56:21.410925 (Thread-93): 01:56:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0eaa60>]}
2022-04-21 01:56:21.411450 (Thread-93): sending response (<Response 1873 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:56:44.051128 (Thread-94): 01:56:44  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-21 01:56:44.051423 (Thread-94): 01:56:44  Partial parsing: added file: my_new_project://models/_archive/test_loop.sql
2022-04-21 01:56:44.054840 (Thread-94): 01:56:44  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-21 01:56:44.105407 (Thread-94): 01:56:44  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3f0dc0>]}
2022-04-21 01:56:44.944149 (Thread-95): handling status request
2022-04-21 01:56:44.944480 (Thread-95): 01:56:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0a74c0>]}
2022-04-21 01:56:44.944954 (Thread-95): sending response (<Response 1560 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:56:44.993028 (Thread-96): handling status request
2022-04-21 01:56:44.993267 (Thread-96): 01:56:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0a7c70>]}
2022-04-21 01:56:45.014311 (Thread-96): sending response (<Response 1560 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:56:57.836546 (Thread-97): 01:56:57  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-21 01:56:57.836836 (Thread-97): 01:56:57  Partial parsing: added file: my_new_project://models/_archive/test_conn.sql
2022-04-21 01:56:57.836940 (Thread-97): 01:56:57  Partial parsing: deleted file: my_new_project://models/_archive/conn_test.sql
2022-04-21 01:56:57.840433 (Thread-97): 01:56:57  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 01:56:57.885641 (Thread-97): 01:56:57  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cbf1e20>]}
2022-04-21 01:56:58.582161 (Thread-98): handling status request
2022-04-21 01:56:58.582481 (Thread-98): 01:56:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ccff9d0>]}
2022-04-21 01:56:58.583004 (Thread-98): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 01:56:58.659724 (Thread-99): handling status request
2022-04-21 01:56:58.660006 (Thread-99): 01:56:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ccff970>]}
2022-04-21 01:56:58.660457 (Thread-99): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:19.973810 (Thread-100): handling status request
2022-04-21 02:01:19.975926 (Thread-100): 02:01:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc6feb0>]}
2022-04-21 02:01:19.976426 (Thread-100): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:20.396317 (Thread-101): handling compile_sql request
2022-04-21 02:01:20.396648 (Thread-101): 02:01:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc6f940>]}
2022-04-21 02:01:22.641950 (Thread-101): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:22.668438 (MainThread): 02:01:22  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f072dd1c-f397-4123-836f-f1b94ef90996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc51d7bfd0>]}
2022-04-21 02:01:22.669684 (MainThread): 02:01:22  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 02:01:22.670282 (Thread-1): 02:01:22  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:01:22.670417 (Thread-1): 02:01:22  Began compiling node rpc.my_new_project.request
2022-04-21 02:01:22.670508 (Thread-1): 02:01:22  Compiling rpc.my_new_project.request
2022-04-21 02:01:22.672953 (Thread-1): 02:01:22  finished collecting timing info
2022-04-21 02:01:22.673082 (Thread-1): 02:01:22  Began executing node rpc.my_new_project.request
2022-04-21 02:01:22.673180 (Thread-1): 02:01:22  finished collecting timing info
2022-04-21 02:01:23.022486 (Thread-102): handling poll request
2022-04-21 02:01:23.022889 (Thread-102): 02:01:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cbfedc0>]}
2022-04-21 02:01:23.024098 (Thread-102): sending response (<Response 6192 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:44.376838 (Thread-103): handling status request
2022-04-21 02:01:44.377184 (Thread-103): 02:01:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cbfe8b0>]}
2022-04-21 02:01:44.377722 (Thread-103): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:44.702081 (Thread-104): handling compile_sql request
2022-04-21 02:01:44.702420 (Thread-104): 02:01:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc93820>]}
2022-04-21 02:01:46.967176 (Thread-104): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:46.992977 (MainThread): 02:01:46  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '644e3b02-da66-4cd4-a073-4ab052d16ce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd169a7eeb0>]}
2022-04-21 02:01:46.994296 (MainThread): 02:01:46  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 02:01:46.994909 (Thread-1): 02:01:46  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:01:46.995066 (Thread-1): 02:01:46  Began compiling node rpc.my_new_project.request
2022-04-21 02:01:46.995161 (Thread-1): 02:01:46  Compiling rpc.my_new_project.request
2022-04-21 02:01:46.997565 (Thread-1): 02:01:46  finished collecting timing info
2022-04-21 02:01:46.997698 (Thread-1): 02:01:46  Began executing node rpc.my_new_project.request
2022-04-21 02:01:46.997799 (Thread-1): 02:01:46  finished collecting timing info
2022-04-21 02:01:47.283389 (Thread-105): handling poll request
2022-04-21 02:01:47.283805 (Thread-105): 02:01:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd0aee0>]}
2022-04-21 02:01:47.285004 (Thread-105): sending response (<Response 5705 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:57.156816 (Thread-106): handling status request
2022-04-21 02:01:57.157161 (Thread-106): 02:01:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd0aa90>]}
2022-04-21 02:01:57.157696 (Thread-106): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:57.476661 (Thread-107): handling compile_sql request
2022-04-21 02:01:57.477010 (Thread-107): 02:01:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d284b80>]}
2022-04-21 02:01:59.771992 (Thread-107): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:01:59.797431 (MainThread): 02:01:59  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6fac08b-4805-45ed-8885-4dc688b80c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe2ff3bfd0>]}
2022-04-21 02:01:59.798713 (MainThread): 02:01:59  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 02:01:59.799336 (Thread-1): 02:01:59  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:01:59.799469 (Thread-1): 02:01:59  Began compiling node rpc.my_new_project.request
2022-04-21 02:01:59.799559 (Thread-1): 02:01:59  Compiling rpc.my_new_project.request
2022-04-21 02:01:59.801907 (Thread-1): 02:01:59  finished collecting timing info
2022-04-21 02:01:59.802039 (Thread-1): 02:01:59  Began executing node rpc.my_new_project.request
2022-04-21 02:01:59.802140 (Thread-1): 02:01:59  finished collecting timing info
2022-04-21 02:02:00.106206 (Thread-108): handling poll request
2022-04-21 02:02:00.106600 (Thread-108): 02:02:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cbd7760>]}
2022-04-21 02:02:00.108367 (Thread-108): sending response (<Response 6137 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:04:59.334343 (Thread-109): handling status request
2022-04-21 02:04:59.336377 (Thread-109): 02:04:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cbd7f10>]}
2022-04-21 02:04:59.337020 (Thread-109): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:04:59.704928 (Thread-110): handling compile_sql request
2022-04-21 02:04:59.705245 (Thread-110): 02:04:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cbd78b0>]}
2022-04-21 02:05:01.924909 (Thread-110): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:01.950899 (MainThread): 02:05:01  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcd083ee-c129-4118-934e-be3a21ed39fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5afbf4f40>]}
2022-04-21 02:05:01.952107 (MainThread): 02:05:01  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 02:05:01.952701 (Thread-1): 02:05:01  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:05:01.952835 (Thread-1): 02:05:01  Began compiling node rpc.my_new_project.request
2022-04-21 02:05:01.952929 (Thread-1): 02:05:01  Compiling rpc.my_new_project.request
2022-04-21 02:05:01.955438 (Thread-1): 02:05:01  finished collecting timing info
2022-04-21 02:05:01.955569 (Thread-1): 02:05:01  Began executing node rpc.my_new_project.request
2022-04-21 02:05:01.955670 (Thread-1): 02:05:01  finished collecting timing info
2022-04-21 02:05:02.276871 (Thread-111): handling poll request
2022-04-21 02:05:02.277264 (Thread-111): 02:05:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc1cdf0>]}
2022-04-21 02:05:02.278418 (Thread-111): sending response (<Response 6556 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:24.306236 (Thread-112): handling status request
2022-04-21 02:05:24.306607 (Thread-112): 02:05:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc1c6d0>]}
2022-04-21 02:05:24.307180 (Thread-112): sending response (<Response 1878 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:24.682104 (Thread-113): handling compile_sql request
2022-04-21 02:05:24.682365 (Thread-113): 02:05:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3e4f10>]}
2022-04-21 02:05:26.887478 (Thread-113): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:26.912097 (MainThread): 02:05:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd2a5ab3-d0f8-4fde-97b9-b149f39d4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e79cfbc40>]}
2022-04-21 02:05:26.913201 (MainThread): 02:05:26  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
2022-04-21 02:05:26.913783 (Thread-1): 02:05:26  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:05:26.913915 (Thread-1): 02:05:26  Began compiling node rpc.my_new_project.request
2022-04-21 02:05:26.914005 (Thread-1): 02:05:26  Compiling rpc.my_new_project.request
2022-04-21 02:05:26.916471 (Thread-1): 02:05:26  finished collecting timing info
2022-04-21 02:05:26.916597 (Thread-1): 02:05:26  Began executing node rpc.my_new_project.request
2022-04-21 02:05:26.916694 (Thread-1): 02:05:26  finished collecting timing info
2022-04-21 02:05:27.247888 (Thread-114): handling poll request
2022-04-21 02:05:27.248274 (Thread-114): 02:05:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb8a460>]}
2022-04-21 02:05:27.249363 (Thread-114): sending response (<Response 6570 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:46.856678 (Thread-115): 02:05:46  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:05:46.857040 (Thread-115): 02:05:46  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-21 02:05:46.860875 (Thread-115): 02:05:46  1603: static parser failed on _archive/test_loop.sql
2022-04-21 02:05:46.864463 (Thread-115): 02:05:46  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-21 02:05:46.912044 (Thread-115): 02:05:46  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc40d30>]}
2022-04-21 02:05:47.672695 (Thread-116): handling status request
2022-04-21 02:05:47.673012 (Thread-116): 02:05:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb68a30>]}
2022-04-21 02:05:47.673512 (Thread-116): sending response (<Response 1864 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:47.742090 (Thread-117): handling status request
2022-04-21 02:05:47.742308 (Thread-117): 02:05:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb68970>]}
2022-04-21 02:05:47.742694 (Thread-117): sending response (<Response 1864 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:49.340493 (Thread-118): 02:05:49  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:05:49.340829 (Thread-118): 02:05:49  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:05:49.345293 (Thread-118): 02:05:49  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:05:50.148317 (Thread-119): handling status request
2022-04-21 02:05:50.148649 (Thread-119): 02:05:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ca8eb50>]}
2022-04-21 02:05:50.149113 (Thread-119): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:05:50.166245 (Thread-120): handling status request
2022-04-21 02:05:50.166453 (Thread-120): 02:05:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ca8edf0>]}
2022-04-21 02:05:50.166793 (Thread-120): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:06:14.453127 (Thread-121): handling status request
2022-04-21 02:06:14.453506 (Thread-121): 02:06:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ca8ef70>]}
2022-04-21 02:06:14.453974 (Thread-121): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:06:16.961965 (Thread-122): 02:06:16  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:06:16.962300 (Thread-122): 02:06:16  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:06:16.966862 (Thread-122): 02:06:16  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:06:17.729677 (Thread-123): handling status request
2022-04-21 02:06:17.730007 (Thread-123): 02:06:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ca8bfa0>]}
2022-04-21 02:06:17.730471 (Thread-123): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:06:17.796118 (Thread-124): handling status request
2022-04-21 02:06:17.796369 (Thread-124): 02:06:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ca8b820>]}
2022-04-21 02:06:17.796770 (Thread-124): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:09:47.752708 (Thread-125): 02:09:47  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:09:47.754680 (Thread-125): 02:09:47  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:09:47.759364 (Thread-125): 02:09:47  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:09:48.717865 (Thread-126): handling status request
2022-04-21 02:09:48.718191 (Thread-126): 02:09:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c962370>]}
2022-04-21 02:09:48.718651 (Thread-126): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:09:48.749734 (Thread-127): handling status request
2022-04-21 02:09:48.749956 (Thread-127): 02:09:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c962550>]}
2022-04-21 02:09:48.750294 (Thread-127): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:09:58.192361 (Thread-128): 02:09:58  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:09:58.192749 (Thread-128): 02:09:58  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:09:58.197339 (Thread-128): 02:09:58  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:09:58.894065 (Thread-129): handling status request
2022-04-21 02:09:58.894402 (Thread-129): 02:09:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c9fa2b0>]}
2022-04-21 02:09:58.894884 (Thread-129): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:09:59.223254 (Thread-130): handling status request
2022-04-21 02:09:59.223578 (Thread-130): 02:09:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c9fa040>]}
2022-04-21 02:09:59.245019 (Thread-130): sending response (<Response 1298 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:11:12.325745 (Thread-131): 02:11:12  Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
2022-04-21 02:11:12.328086 (Thread-131): 02:11:12  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:11:12.328320 (Thread-131): 02:11:12  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:11:12.332992 (Thread-131): 02:11:12  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:11:13.338265 (Thread-132): handling status request
2022-04-21 02:11:13.338627 (Thread-132): 02:11:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c9deb80>]}
2022-04-21 02:11:13.339140 (Thread-132): sending response (<Response 1611 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:11:13.380022 (Thread-133): handling status request
2022-04-21 02:11:13.380231 (Thread-133): 02:11:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c9de4c0>]}
2022-04-21 02:11:13.380583 (Thread-133): sending response (<Response 1611 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:11:29.765977 (Thread-134): 02:11:29  Partial parsing enabled: 0 files deleted, 2 files added, 1 files changed.
2022-04-21 02:11:29.766273 (Thread-134): 02:11:29  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:11:29.766440 (Thread-134): 02:11:29  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:11:29.766635 (Thread-134): 02:11:29  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:11:29.771245 (Thread-134): 02:11:29  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:11:30.731781 (Thread-135): handling status request
2022-04-21 02:11:30.732125 (Thread-135): 02:11:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c96d850>]}
2022-04-21 02:11:30.732687 (Thread-135): sending response (<Response 1926 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:11:30.780654 (Thread-136): handling status request
2022-04-21 02:11:30.780878 (Thread-136): 02:11:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79e160>]}
2022-04-21 02:11:30.781269 (Thread-136): sending response (<Response 1926 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:21:49.828908 (Thread-137): handling status request
2022-04-21 02:21:49.830707 (Thread-137): 02:21:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79e6a0>]}
2022-04-21 02:21:49.831207 (Thread-137): sending response (<Response 1926 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:21:50.185726 (Thread-138): handling run_sql request
2022-04-21 02:21:50.186035 (Thread-138): 02:21:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79e7f0>]}
2022-04-21 02:21:50.186426 (Thread-138): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:22:13.944242 (Thread-139): handling status request
2022-04-21 02:22:13.944581 (Thread-139): 02:22:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79e730>]}
2022-04-21 02:22:13.945599 (Thread-139): sending response (<Response 1926 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:22:14.280491 (Thread-140): handling run_sql request
2022-04-21 02:22:14.280819 (Thread-140): 02:22:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c7c25e0>]}
2022-04-21 02:22:14.281193 (Thread-140): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:22:43.011492 (Thread-141): 02:22:43  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:22:43.011817 (Thread-141): 02:22:43  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:22:43.011980 (Thread-141): 02:22:43  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:22:43.012186 (Thread-141): 02:22:43  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:22:43.012367 (Thread-141): 02:22:43  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:22:43.016765 (Thread-141): 02:22:43  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:22:43.019327 (Thread-141): 02:22:43  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:22:43.766752 (Thread-142): handling status request
2022-04-21 02:22:43.767138 (Thread-142): 02:22:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c734430>]}
2022-04-21 02:22:43.767682 (Thread-142): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:22:43.849741 (Thread-143): handling status request
2022-04-21 02:22:43.850075 (Thread-143): 02:22:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c734c40>]}
2022-04-21 02:22:43.850573 (Thread-143): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:22:48.142848 (Thread-144): handling status request
2022-04-21 02:22:48.143214 (Thread-144): 02:22:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c9de790>]}
2022-04-21 02:22:48.143714 (Thread-144): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:22:48.457292 (Thread-145): handling run_sql request
2022-04-21 02:22:48.457649 (Thread-145): 02:22:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c734cd0>]}
2022-04-21 02:22:48.458059 (Thread-145): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:26:29.812930 (Thread-146): 02:26:29  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:26:29.814951 (Thread-146): 02:26:29  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:26:29.815223 (Thread-146): 02:26:29  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:26:29.815426 (Thread-146): 02:26:29  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:26:29.815606 (Thread-146): 02:26:29  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:26:29.820205 (Thread-146): 02:26:29  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:26:29.822746 (Thread-146): 02:26:29  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:26:30.534087 (Thread-147): handling status request
2022-04-21 02:26:30.534423 (Thread-147): 02:26:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c6c66d0>]}
2022-04-21 02:26:30.534938 (Thread-147): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:26:30.558168 (Thread-148): handling status request
2022-04-21 02:26:30.558458 (Thread-148): 02:26:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c6c6250>]}
2022-04-21 02:26:30.558955 (Thread-148): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:27:15.249448 (Thread-149): 02:27:15  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:27:15.249774 (Thread-149): 02:27:15  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:27:15.249959 (Thread-149): 02:27:15  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:27:15.250155 (Thread-149): 02:27:15  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:27:15.250406 (Thread-149): 02:27:15  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:27:15.254442 (Thread-149): 02:27:15  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:27:15.256941 (Thread-149): 02:27:15  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:27:15.928438 (Thread-150): handling status request
2022-04-21 02:27:15.928767 (Thread-150): 02:27:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c6b5910>]}
2022-04-21 02:27:15.929265 (Thread-150): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:27:15.995904 (Thread-151): handling status request
2022-04-21 02:27:15.996162 (Thread-151): 02:27:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c6e78b0>]}
2022-04-21 02:27:15.996566 (Thread-151): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:27:27.050355 (Thread-152): handling status request
2022-04-21 02:27:27.050713 (Thread-152): 02:27:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c6b5e20>]}
2022-04-21 02:27:27.051276 (Thread-152): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:27:27.450588 (Thread-153): handling run_sql request
2022-04-21 02:27:27.450856 (Thread-153): 02:27:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c6b5d90>]}
2022-04-21 02:27:27.451241 (Thread-153): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:24.418025 (Thread-154): handling status request
2022-04-21 02:28:24.418366 (Thread-154): 02:28:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e2700>]}
2022-04-21 02:28:24.418865 (Thread-154): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:24.791039 (Thread-155): handling run_sql request
2022-04-21 02:28:24.791317 (Thread-155): 02:28:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e2a90>]}
2022-04-21 02:28:24.791647 (Thread-155): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:30.535404 (Thread-156): handling status request
2022-04-21 02:28:30.535742 (Thread-156): 02:28:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e2b80>]}
2022-04-21 02:28:30.536257 (Thread-156): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:30.911490 (Thread-157): handling run_sql request
2022-04-21 02:28:30.911803 (Thread-157): 02:28:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e2e80>]}
2022-04-21 02:28:30.912162 (Thread-157): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:33.784150 (Thread-158): handling status request
2022-04-21 02:28:33.784479 (Thread-158): 02:28:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e9220>]}
2022-04-21 02:28:33.784975 (Thread-158): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:34.137842 (Thread-159): handling compile_sql request
2022-04-21 02:28:34.138139 (Thread-159): 02:28:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e9400>]}
2022-04-21 02:28:34.138479 (Thread-159): sending response (<Response 703 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:52.771654 (Thread-160): 02:28:52  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:28:52.771973 (Thread-160): 02:28:52  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:28:52.772156 (Thread-160): 02:28:52  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:28:52.772350 (Thread-160): 02:28:52  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:28:52.772623 (Thread-160): 02:28:52  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:28:52.776674 (Thread-160): 02:28:52  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:28:52.779169 (Thread-160): 02:28:52  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:28:53.485455 (Thread-161): handling status request
2022-04-21 02:28:53.485790 (Thread-161): 02:28:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c647130>]}
2022-04-21 02:28:53.486292 (Thread-161): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:28:53.637906 (Thread-162): handling status request
2022-04-21 02:28:53.638227 (Thread-162): 02:28:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c647730>]}
2022-04-21 02:28:53.638753 (Thread-162): sending response (<Response 2549 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:29:42.943880 (Thread-163): 02:29:42  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:29:42.944211 (Thread-163): 02:29:42  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:29:42.944398 (Thread-163): 02:29:42  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:29:42.944599 (Thread-163): 02:29:42  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:29:42.944850 (Thread-163): 02:29:42  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:29:42.949023 (Thread-163): 02:29:42  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:29:42.951779 (Thread-163): 02:29:42  1603: static parser failed on _archive/stg_query.sql
2022-04-21 02:29:43.718125 (Thread-164): handling status request
2022-04-21 02:29:43.718466 (Thread-164): 02:29:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4fc5e0>]}
2022-04-21 02:29:43.719005 (Thread-164): sending response (<Response 2552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:29:43.821769 (Thread-165): handling status request
2022-04-21 02:29:43.822009 (Thread-165): 02:29:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4fc820>]}
2022-04-21 02:29:43.822447 (Thread-165): sending response (<Response 2552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:29:49.542144 (Thread-166): handling status request
2022-04-21 02:29:49.542473 (Thread-166): 02:29:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4fc1c0>]}
2022-04-21 02:29:49.543006 (Thread-166): sending response (<Response 2552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:29:49.914855 (Thread-167): handling run_sql request
2022-04-21 02:29:49.915205 (Thread-167): 02:29:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c498bb0>]}
2022-04-21 02:29:49.939854 (Thread-167): sending response (<Response 709 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:30:29.754642 (Thread-168): handling status request
2022-04-21 02:30:29.755017 (Thread-168): 02:30:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c498d90>]}
2022-04-21 02:30:29.755544 (Thread-168): sending response (<Response 2552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:30:30.091580 (Thread-169): handling run_sql request
2022-04-21 02:30:30.091920 (Thread-169): 02:30:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c49c1f0>]}
2022-04-21 02:30:30.092295 (Thread-169): sending response (<Response 709 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:31:08.142186 (Thread-170): handling status request
2022-04-21 02:31:08.142521 (Thread-170): 02:31:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c49cdc0>]}
2022-04-21 02:31:08.143072 (Thread-170): sending response (<Response 2552 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:31:08.478591 (Thread-171): handling run_sql request
2022-04-21 02:31:08.478925 (Thread-171): 02:31:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c49c0d0>]}
2022-04-21 02:31:08.479349 (Thread-171): sending response (<Response 709 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:31:31.140923 (Thread-172): 02:31:31  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:31:31.141248 (Thread-172): 02:31:31  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:31:31.141435 (Thread-172): 02:31:31  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:31:31.141639 (Thread-172): 02:31:31  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:31:31.141891 (Thread-172): 02:31:31  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:31:31.280146 (Thread-172): 02:31:31  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:31:31.282153 (Thread-172): 02:31:31  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 02:31:31.820117 (Thread-173): handling status request
2022-04-21 02:31:31.820452 (Thread-173): 02:31:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c458790>]}
2022-04-21 02:31:31.820951 (Thread-173): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:31:32.035431 (Thread-174): handling status request
2022-04-21 02:31:32.035777 (Thread-174): 02:31:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5ddd90>]}
2022-04-21 02:31:32.036259 (Thread-174): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:31:33.458290 (Thread-175): handling status request
2022-04-21 02:31:33.458601 (Thread-175): 02:31:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c458370>]}
2022-04-21 02:31:33.459130 (Thread-175): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:31:33.854226 (Thread-176): handling run_sql request
2022-04-21 02:31:33.854531 (Thread-176): 02:31:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c458040>]}
2022-04-21 02:31:33.854900 (Thread-176): sending response (<Response 1375 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:32:28.190637 (Thread-177): 02:32:28  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:32:28.191168 (Thread-177): 02:32:28  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:32:28.191481 (Thread-177): 02:32:28  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:32:28.191782 (Thread-177): 02:32:28  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:32:28.192179 (Thread-177): 02:32:28  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:32:28.196491 (Thread-177): 02:32:28  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:32:28.198628 (Thread-177): 02:32:28  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 02:32:28.951114 (Thread-178): handling status request
2022-04-21 02:32:28.951442 (Thread-178): 02:32:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f9880>]}
2022-04-21 02:32:28.951933 (Thread-178): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:32:28.976455 (Thread-179): handling status request
2022-04-21 02:32:28.976688 (Thread-179): 02:32:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f9b80>]}
2022-04-21 02:32:28.977091 (Thread-179): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:32:48.740986 (Thread-180): handling status request
2022-04-21 02:32:48.741319 (Thread-180): 02:32:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f91c0>]}
2022-04-21 02:32:48.741811 (Thread-180): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:32:49.097572 (Thread-181): handling run_sql request
2022-04-21 02:32:49.097916 (Thread-181): 02:32:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f9a60>]}
2022-04-21 02:32:49.098269 (Thread-181): sending response (<Response 1375 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:32:58.698889 (Thread-182): handling status request
2022-04-21 02:32:58.699231 (Thread-182): 02:32:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f9550>]}
2022-04-21 02:32:58.699715 (Thread-182): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:32:59.048586 (Thread-183): handling run_sql request
2022-04-21 02:32:59.048854 (Thread-183): 02:32:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5ec070>]}
2022-04-21 02:32:59.049194 (Thread-183): sending response (<Response 1375 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:25.663415 (Thread-184): 02:33:25  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:33:25.663730 (Thread-184): 02:33:25  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:33:25.663917 (Thread-184): 02:33:25  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:33:25.664114 (Thread-184): 02:33:25  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:33:25.664364 (Thread-184): 02:33:25  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:33:25.667705 (Thread-184): 02:33:25  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:33:25.669559 (Thread-184): 02:33:25  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 02:33:26.383773 (Thread-185): handling status request
2022-04-21 02:33:26.384106 (Thread-185): 02:33:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c8e8580>]}
2022-04-21 02:33:26.384630 (Thread-185): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:26.428928 (Thread-186): handling status request
2022-04-21 02:33:26.429202 (Thread-186): 02:33:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f9bb0>]}
2022-04-21 02:33:26.429612 (Thread-186): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:28.033194 (Thread-187): 02:33:28  Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
2022-04-21 02:33:28.033509 (Thread-187): 02:33:28  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:33:28.033694 (Thread-187): 02:33:28  Partial parsing: added file: my_new_project://models/marts/_sources.yml
2022-04-21 02:33:28.033888 (Thread-187): 02:33:28  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:33:28.034135 (Thread-187): 02:33:28  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:33:28.037511 (Thread-187): 02:33:28  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:33:28.039398 (Thread-187): 02:33:28  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 02:33:28.729046 (Thread-188): handling status request
2022-04-21 02:33:28.729387 (Thread-188): 02:33:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c725370>]}
2022-04-21 02:33:28.729907 (Thread-188): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:28.763933 (Thread-189): handling status request
2022-04-21 02:33:28.764151 (Thread-189): 02:33:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c725df0>]}
2022-04-21 02:33:28.764549 (Thread-189): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:33.528287 (Thread-190): handling status request
2022-04-21 02:33:33.528605 (Thread-190): 02:33:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4f7d30>]}
2022-04-21 02:33:33.529093 (Thread-190): sending response (<Response 2895 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:33.902017 (Thread-191): handling run_sql request
2022-04-21 02:33:33.902374 (Thread-191): 02:33:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c648970>]}
2022-04-21 02:33:33.902757 (Thread-191): sending response (<Response 1375 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:57.516043 (Thread-192): 02:33:57  Partial parsing enabled: 0 files deleted, 1 files added, 2 files changed.
2022-04-21 02:33:57.516364 (Thread-192): 02:33:57  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:33:57.516578 (Thread-192): 02:33:57  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:33:57.516759 (Thread-192): 02:33:57  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:33:57.520185 (Thread-192): 02:33:57  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:33:57.522047 (Thread-192): 02:33:57  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 02:33:58.236254 (Thread-193): handling status request
2022-04-21 02:33:58.236595 (Thread-193): 02:33:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c87c1f0>]}
2022-04-21 02:33:58.237091 (Thread-193): sending response (<Response 2582 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:33:58.283528 (Thread-194): handling status request
2022-04-21 02:33:58.283824 (Thread-194): 02:33:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c87cc40>]}
2022-04-21 02:33:58.284294 (Thread-194): sending response (<Response 2582 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:05.081835 (Thread-195): handling status request
2022-04-21 02:34:05.082168 (Thread-195): 02:34:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c87ca60>]}
2022-04-21 02:34:05.082674 (Thread-195): sending response (<Response 2582 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:05.425470 (Thread-196): handling run_sql request
2022-04-21 02:34:05.425767 (Thread-196): 02:34:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c87c190>]}
2022-04-21 02:34:05.426130 (Thread-196): sending response (<Response 1375 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:28.515271 (Thread-197): 02:34:28  Partial parsing enabled: 0 files deleted, 1 files added, 2 files changed.
2022-04-21 02:34:28.515586 (Thread-197): 02:34:28  Partial parsing: added file: my_new_project://models/staging/_sources.yml
2022-04-21 02:34:28.515801 (Thread-197): 02:34:28  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:34:28.515982 (Thread-197): 02:34:28  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 02:34:28.519493 (Thread-197): 02:34:28  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:34:28.521396 (Thread-197): 02:34:28  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 02:34:28.572832 (Thread-197): 02:34:28  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c4fc400>]}
2022-04-21 02:34:29.305945 (Thread-198): handling status request
2022-04-21 02:34:29.306268 (Thread-198): 02:34:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb65a00>]}
2022-04-21 02:34:29.306764 (Thread-198): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:29.338196 (Thread-199): handling status request
2022-04-21 02:34:29.338409 (Thread-199): 02:34:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb65820>]}
2022-04-21 02:34:29.338784 (Thread-199): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:31.972957 (Thread-200): handling status request
2022-04-21 02:34:31.973282 (Thread-200): 02:34:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb65670>]}
2022-04-21 02:34:31.973769 (Thread-200): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:32.332110 (Thread-201): handling run_sql request
2022-04-21 02:34:32.332381 (Thread-201): 02:34:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb654c0>]}
2022-04-21 02:34:34.543686 (Thread-201): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:34.567087 (MainThread): 02:34:34  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '46b3fb4e-30e3-4468-98e2-4a35f0009db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2449ba56d0>]}
2022-04-21 02:34:34.567571 (MainThread): 02:34:34  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 02:34:34.568741 (Thread-1): 02:34:34  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:34:34.568870 (Thread-1): 02:34:34  Began compiling node rpc.my_new_project.request
2022-04-21 02:34:34.568957 (Thread-1): 02:34:34  Compiling rpc.my_new_project.request
2022-04-21 02:34:34.569968 (Thread-1): 02:34:34  finished collecting timing info
2022-04-21 02:34:34.570102 (Thread-1): 02:34:34  Began executing node rpc.my_new_project.request
2022-04-21 02:34:34.570639 (Thread-1): 02:34:34  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 02:34:34.570729 (Thread-1): 02:34:34  On rpc.my_new_project.request: select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_devices;
-- select * from raw.interview_sample_data.interview_orders;
-- select * from raw.interview_sample_data.interview_addresses;
-- select * from raw.interview_sample_data.interview_payments
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 02:34:34.570811 (Thread-1): 02:34:34  Opening a new connection, currently in state init
2022-04-21 02:34:34.925685 (Thread-202): handling poll request
2022-04-21 02:34:34.926058 (Thread-202): 02:34:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cb7d9a0>]}
2022-04-21 02:34:34.951072 (Thread-202): sending response (<Response 4039 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:34:35.632276 (Thread-1): 02:34:35  SQL status: SUCCESS 500 in 1.06 seconds
2022-04-21 02:34:35.646647 (Thread-1): 02:34:35  finished collecting timing info
2022-04-21 02:34:35.646880 (Thread-1): 02:34:35  On rpc.my_new_project.request: Close
2022-04-21 02:34:36.329836 (Thread-203): handling poll request
2022-04-21 02:34:36.330162 (Thread-203): 02:34:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0b3760>]}
2022-04-21 02:34:36.333585 (Thread-203): sending response (<Response 63928 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:00.342404 (Thread-204): handling status request
2022-04-21 02:35:00.342728 (Thread-204): 02:35:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0b34f0>]}
2022-04-21 02:35:00.343283 (Thread-204): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:00.737041 (Thread-205): handling run_sql request
2022-04-21 02:35:00.737353 (Thread-205): 02:35:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0b3b20>]}
2022-04-21 02:35:02.947831 (Thread-205): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:02.971892 (MainThread): 02:35:02  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd0dd3730-4ff4-44b9-8f4d-81de05a12350', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65faf73cd0>]}
2022-04-21 02:35:02.972404 (MainThread): 02:35:02  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 02:35:02.973638 (Thread-1): 02:35:02  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:35:02.973773 (Thread-1): 02:35:02  Began compiling node rpc.my_new_project.request
2022-04-21 02:35:02.973865 (Thread-1): 02:35:02  Compiling rpc.my_new_project.request
2022-04-21 02:35:02.974919 (Thread-1): 02:35:02  finished collecting timing info
2022-04-21 02:35:02.975079 (Thread-1): 02:35:02  Began executing node rpc.my_new_project.request
2022-04-21 02:35:02.975628 (Thread-1): 02:35:02  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 02:35:02.975719 (Thread-1): 02:35:02  On rpc.my_new_project.request: -- select * from raw.interview_sample_data.interview_orders
select * from raw.interview_sample_data.interview_devices;
2022-04-21 02:35:02.975800 (Thread-1): 02:35:02  Opening a new connection, currently in state init
2022-04-21 02:35:03.275938 (Thread-206): handling poll request
2022-04-21 02:35:03.276333 (Thread-206): 02:35:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd0d040>]}
2022-04-21 02:35:03.277242 (Thread-206): sending response (<Response 3786 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:05.049814 (Thread-207): handling poll request
2022-04-21 02:35:05.050150 (Thread-207): 02:35:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd0d610>]}
2022-04-21 02:35:05.050634 (Thread-207): sending response (<Response 391 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:05.059697 (Thread-1): 02:35:05  SQL status: SUCCESS 4499 in 2.08 seconds
2022-04-21 02:35:05.060008 (Thread-1): 02:35:05  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 02:35:05.060102 (Thread-1): 02:35:05  On rpc.my_new_project.request: -- select * from raw.interview_sample_data.interview_orders;
-- select * from raw.interview_sample_data.interview_addresses;
-- select * from raw.interview_sample_data.interview_payments
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 02:35:05.228274 (Thread-1): 02:35:05  Snowflake adapter: Snowflake query id: 01a3befb-0501-6083-0004-7d830483ca3e
2022-04-21 02:35:05.228419 (Thread-1): 02:35:05  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'limit'.
2022-04-21 02:35:05.228599 (Thread-1): 02:35:05  finished collecting timing info
2022-04-21 02:35:05.228766 (Thread-1): 02:35:05  On rpc.my_new_project.request: Close
2022-04-21 02:35:05.442848 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'limit'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'limit'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'limit'.
2022-04-21 02:35:05.443811 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'limit'.", 'raw_sql': '-- select * from raw.interview_sample_data.interview_orders\r\nselect * from raw.interview_sample_data.interview_devices;\r\n-- select * from raw.interview_sample_data.interview_orders;\r\n-- select * from raw.interview_sample_data.interview_addresses;\r\n-- select * from raw.interview_sample_data.interview_payments\nlimit 500\n/* limit added automatically by dbt cloud */', 'compiled_sql': '-- select * from raw.interview_sample_data.interview_orders\r\nselect * from raw.interview_sample_data.interview_devices;\r\n-- select * from raw.interview_sample_data.interview_orders;\r\n-- select * from raw.interview_sample_data.interview_addresses;\r\n-- select * from raw.interview_sample_data.interview_payments\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'limit'.", 'raw_sql': '-- select * from raw.interview_sample_data.interview_orders\r\nselect * from raw.interview_sample_data.interview_devices;\r\n-- select * from raw.interview_sample_data.interview_orders;\r\n-- select * from raw.interview_sample_data.interview_addresses;\r\n-- select * from raw.interview_sample_data.interview_payments\nlimit 500\n/* limit added automatically by dbt cloud */', 'compiled_sql': '-- select * from raw.interview_sample_data.interview_orders\r\nselect * from raw.interview_sample_data.interview_devices;\r\n-- select * from raw.interview_sample_data.interview_orders;\r\n-- select * from raw.interview_sample_data.interview_addresses;\r\n-- select * from raw.interview_sample_data.interview_payments\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-21 02:35:06.425008 (Thread-208): handling poll request
2022-04-21 02:35:06.425366 (Thread-208): 02:35:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd0a580>]}
2022-04-21 02:35:06.426046 (Thread-208): sending response (<Response 12946 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:18.309632 (Thread-209): handling status request
2022-04-21 02:35:18.309959 (Thread-209): 02:35:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ccff9d0>]}
2022-04-21 02:35:18.310767 (Thread-209): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:18.727338 (Thread-210): handling run_sql request
2022-04-21 02:35:18.727666 (Thread-210): 02:35:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd0da30>]}
2022-04-21 02:35:20.994383 (Thread-210): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:21.018233 (MainThread): 02:35:21  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bf5f4af1-b825-4b82-8bb2-13f239e25587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6556a6d280>]}
2022-04-21 02:35:21.018753 (MainThread): 02:35:21  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 02:35:21.019997 (Thread-1): 02:35:21  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:35:21.020128 (Thread-1): 02:35:21  Began compiling node rpc.my_new_project.request
2022-04-21 02:35:21.020231 (Thread-1): 02:35:21  Compiling rpc.my_new_project.request
2022-04-21 02:35:21.021284 (Thread-1): 02:35:21  finished collecting timing info
2022-04-21 02:35:21.021413 (Thread-1): 02:35:21  Began executing node rpc.my_new_project.request
2022-04-21 02:35:21.021958 (Thread-1): 02:35:21  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 02:35:21.022046 (Thread-1): 02:35:21  On rpc.my_new_project.request: -- select * from raw.interview_sample_data.interview_orders
select * from raw.interview_sample_data.interview_devices
-- select * from raw.interview_sample_data.interview_orders;
-- select * from raw.interview_sample_data.interview_addresses;
-- select * from raw.interview_sample_data.interview_payments
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 02:35:21.022125 (Thread-1): 02:35:21  Opening a new connection, currently in state init
2022-04-21 02:35:21.320668 (Thread-211): handling poll request
2022-04-21 02:35:21.321072 (Thread-211): 02:35:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e31dca0>]}
2022-04-21 02:35:21.321966 (Thread-211): sending response (<Response 4038 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:35:22.208335 (Thread-1): 02:35:22  SQL status: SUCCESS 500 in 1.19 seconds
2022-04-21 02:35:22.220196 (Thread-1): 02:35:22  finished collecting timing info
2022-04-21 02:35:22.220429 (Thread-1): 02:35:22  On rpc.my_new_project.request: Close
2022-04-21 02:35:22.651602 (Thread-212): handling poll request
2022-04-21 02:35:22.651940 (Thread-212): 02:35:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e389220>]}
2022-04-21 02:35:22.654679 (Thread-212): sending response (<Response 31637 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:19.354940 (Thread-213): handling status request
2022-04-21 02:36:19.355340 (Thread-213): 02:36:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e389b80>]}
2022-04-21 02:36:19.355893 (Thread-213): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:19.733108 (Thread-214): handling run_sql request
2022-04-21 02:36:19.733423 (Thread-214): 02:36:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c9476d220>]}
2022-04-21 02:36:21.939618 (Thread-214): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:21.963604 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1275, in process_node
    _process_sources_for_node(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1243, in _process_sources_for_node
    invalid_source_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 924, in invalid_source_fail_unless_test
    source_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 651, in source_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a source named 'interview_sample_data.orders' which was not found
2022-04-21 02:36:22.332226 (Thread-215): handling poll request
2022-04-21 02:36:22.332652 (Thread-215): 02:36:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf9e5b0>]}
2022-04-21 02:36:22.333382 (Thread-215): sending response (<Response 2869 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:37.023044 (Thread-216): handling status request
2022-04-21 02:36:37.023397 (Thread-216): 02:36:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cf9e070>]}
2022-04-21 02:36:37.024019 (Thread-216): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:37.379852 (Thread-217): handling run_sql request
2022-04-21 02:36:37.380127 (Thread-217): 02:36:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3f0a7610>]}
2022-04-21 02:36:39.634111 (Thread-217): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:39.658174 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1275, in process_node
    _process_sources_for_node(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1243, in _process_sources_for_node
    invalid_source_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 924, in invalid_source_fail_unless_test
    source_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 651, in source_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a source named 'interview_sample_data.intrview_orders' which was not found
2022-04-21 02:36:39.988355 (Thread-218): handling poll request
2022-04-21 02:36:39.988746 (Thread-218): 02:36:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3a79d0>]}
2022-04-21 02:36:39.989440 (Thread-218): sending response (<Response 2896 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:50.644980 (Thread-219): handling status request
2022-04-21 02:36:50.645319 (Thread-219): 02:36:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3a7820>]}
2022-04-21 02:36:50.645914 (Thread-219): sending response (<Response 2504 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:51.007969 (Thread-220): handling run_sql request
2022-04-21 02:36:51.008242 (Thread-220): 02:36:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3a7e80>]}
2022-04-21 02:36:53.231557 (Thread-220): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:53.256944 (MainThread): 02:36:53  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a24544ca-347b-4c1b-b860-b2217c1f521b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd3937e2e0>]}
2022-04-21 02:36:53.258093 (MainThread): 02:36:53  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 02:36:53.258666 (Thread-1): 02:36:53  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 02:36:53.258798 (Thread-1): 02:36:53  Began compiling node rpc.my_new_project.request
2022-04-21 02:36:53.258890 (Thread-1): 02:36:53  Compiling rpc.my_new_project.request
2022-04-21 02:36:53.260959 (Thread-1): 02:36:53  finished collecting timing info
2022-04-21 02:36:53.261097 (Thread-1): 02:36:53  Began executing node rpc.my_new_project.request
2022-04-21 02:36:53.261643 (Thread-1): 02:36:53  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 02:36:53.261732 (Thread-1): 02:36:53  On rpc.my_new_project.request: -- select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_devices
-- select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_addresses
-- select * from raw.interview_sample_data.interview_payments

select * from raw.interview_sample_data.interview_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 02:36:53.261813 (Thread-1): 02:36:53  Opening a new connection, currently in state init
2022-04-21 02:36:53.569121 (Thread-221): handling poll request
2022-04-21 02:36:53.569541 (Thread-221): 02:36:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d2ca280>]}
2022-04-21 02:36:53.570501 (Thread-221): sending response (<Response 4091 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:36:54.292674 (Thread-1): 02:36:54  SQL status: SUCCESS 500 in 1.03 seconds
2022-04-21 02:36:54.308446 (Thread-1): 02:36:54  finished collecting timing info
2022-04-21 02:36:54.308766 (Thread-1): 02:36:54  On rpc.my_new_project.request: Close
2022-04-21 02:36:54.972832 (Thread-222): handling poll request
2022-04-21 02:36:54.973150 (Thread-222): 02:36:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d2f0640>]}
2022-04-21 02:36:54.976514 (Thread-222): sending response (<Response 64293 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:37:39.343495 (Thread-223): 02:37:39  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:37:39.343923 (Thread-223): 02:37:39  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:37:39.348009 (Thread-223): 02:37:39  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:37:39.389309 (Thread-223): 02:37:39  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cd1dc70>]}
2022-04-21 02:37:40.122140 (Thread-224): handling status request
2022-04-21 02:37:40.122479 (Thread-224): 02:37:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e306bb0>]}
2022-04-21 02:37:40.123029 (Thread-224): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:37:40.192056 (Thread-225): handling status request
2022-04-21 02:37:40.192386 (Thread-225): 02:37:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e306dc0>]}
2022-04-21 02:37:40.192879 (Thread-225): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:39:35.038775 (Thread-226): handling status request
2022-04-21 02:39:35.039665 (Thread-226): 02:39:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e306a30>]}
2022-04-21 02:39:35.040160 (Thread-226): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:39:35.370456 (Thread-227): handling compile_sql request
2022-04-21 02:39:35.370788 (Thread-227): 02:39:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e306a60>]}
2022-04-21 02:39:37.706141 (Thread-227): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:39:37.721180 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as ( select * from {{source('interview_sample_data', 'interview_'{{t}} ),

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as ( select * from {{source('interview_sample_data', 'interview_'{{t}} ),
2022-04-21 02:39:38.047086 (Thread-228): handling poll request
2022-04-21 02:39:38.047498 (Thread-228): 02:39:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3fc400>]}
2022-04-21 02:39:38.048245 (Thread-228): sending response (<Response 4511 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:40:06.279999 (Thread-229): handling status request
2022-04-21 02:40:06.280371 (Thread-229): 02:40:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3fcb50>]}
2022-04-21 02:40:06.280922 (Thread-229): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:40:06.616815 (Thread-230): handling compile_sql request
2022-04-21 02:40:06.617175 (Thread-230): 02:40:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3fcbb0>]}
2022-04-21 02:40:08.872309 (Thread-230): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:40:08.887165 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}} }} ),

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}} }} ),
2022-04-21 02:40:09.193409 (Thread-231): handling poll request
2022-04-21 02:40:09.193833 (Thread-231): 02:40:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e320850>]}
2022-04-21 02:40:09.194599 (Thread-231): sending response (<Response 4454 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:41:07.463026 (Thread-232): handling status request
2022-04-21 02:41:07.463365 (Thread-232): 02:41:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e377430>]}
2022-04-21 02:41:07.487693 (Thread-232): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:41:07.823226 (Thread-233): handling compile_sql request
2022-04-21 02:41:07.823573 (Thread-233): 02:41:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc03eb0>]}
2022-04-21 02:41:10.066288 (Thread-233): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:41:10.081174 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} ),

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} ),
2022-04-21 02:41:10.378375 (Thread-234): handling poll request
2022-04-21 02:41:10.378769 (Thread-234): 02:41:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c656fd0>]}
2022-04-21 02:41:10.379543 (Thread-234): sending response (<Response 4458 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:41:36.547705 (Thread-235): handling status request
2022-04-21 02:41:36.548050 (Thread-235): 02:41:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d2ce6a0>]}
2022-04-21 02:41:36.548579 (Thread-235): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:41:36.889959 (Thread-236): handling compile_sql request
2022-04-21 02:41:36.890316 (Thread-236): 02:41:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d2ced60>]}
2022-04-21 02:41:39.133848 (Thread-236): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:41:39.159321 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1275, in process_node
    _process_sources_for_node(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1243, in _process_sources_for_node
    invalid_source_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 924, in invalid_source_fail_unless_test
    source_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 651, in source_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a source named 'interview_sample_data.interview_{{t}}' which was not found
2022-04-21 02:41:39.455366 (Thread-237): handling poll request
2022-04-21 02:41:39.455790 (Thread-237): 02:41:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e3208e0>]}
2022-04-21 02:41:39.456531 (Thread-237): sending response (<Response 3030 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:16.331745 (Thread-238): handling status request
2022-04-21 02:42:16.332106 (Thread-238): 02:42:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e306940>]}
2022-04-21 02:42:16.332689 (Thread-238): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:16.712732 (Thread-239): handling compile_sql request
2022-04-21 02:42:16.713000 (Thread-239): 02:42:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e306130>]}
2022-04-21 02:42:18.929860 (Thread-239): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:18.944242 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} ),

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} ),
2022-04-21 02:42:19.257640 (Thread-240): handling poll request
2022-04-21 02:42:19.258085 (Thread-240): 02:42:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc6fc40>]}
2022-04-21 02:42:19.258832 (Thread-240): sending response (<Response 4458 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:32.028756 (Thread-241): handling status request
2022-04-21 02:42:32.029109 (Thread-241): 02:42:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc9fe80>]}
2022-04-21 02:42:32.029649 (Thread-241): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:32.388791 (Thread-242): handling compile_sql request
2022-04-21 02:42:32.389084 (Thread-242): 02:42:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc9f550>]}
2022-04-21 02:42:34.648961 (Thread-242): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:34.663545 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} )

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} )
2022-04-21 02:42:34.969776 (Thread-243): handling poll request
2022-04-21 02:42:34.970189 (Thread-243): 02:42:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e307880>]}
2022-04-21 02:42:34.970914 (Thread-243): sending response (<Response 4454 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:42:59.827191 (Thread-244): handling status request
2022-04-21 02:42:59.827547 (Thread-244): 02:42:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6e307850>]}
2022-04-21 02:42:59.828099 (Thread-244): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:00.205881 (Thread-245): handling compile_sql request
2022-04-21 02:43:00.206164 (Thread-245): 02:43:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc97e50>]}
2022-04-21 02:43:02.437716 (Thread-245): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:02.452119 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} ,)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as ( select * from {{ source('interview_sample_data', 'interview_'{{t}}) }} ,)
2022-04-21 02:43:02.785333 (Thread-246): handling poll request
2022-04-21 02:43:02.785754 (Thread-246): 02:43:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cc97f10>]}
2022-04-21 02:43:02.786514 (Thread-246): sending response (<Response 4458 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:21.769334 (Thread-247): 02:43:21  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:43:21.769705 (Thread-247): 02:43:21  Partial parsing: updated file: my_new_project://models/_archive/test_conn.sql
2022-04-21 02:43:21.774458 (Thread-247): 02:43:21  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 02:43:21.816605 (Thread-247): 02:43:21  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c9052b0>]}
2022-04-21 02:43:22.490313 (Thread-248): handling status request
2022-04-21 02:43:22.490640 (Thread-248): 02:43:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79e2b0>]}
2022-04-21 02:43:22.491150 (Thread-248): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:22.596782 (Thread-249): handling status request
2022-04-21 02:43:22.597065 (Thread-249): 02:43:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79ee50>]}
2022-04-21 02:43:22.604373 (Thread-249): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:26.528859 (Thread-250): handling status request
2022-04-21 02:43:26.529226 (Thread-250): 02:43:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c532fd0>]}
2022-04-21 02:43:26.529686 (Thread-250): sending response (<Response 1566 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:26.843280 (Thread-251): handling compile_sql request
2022-04-21 02:43:26.843599 (Thread-251): 02:43:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c79e790>]}
2022-04-21 02:43:29.085570 (Thread-251): sending response (<Response 138 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:43:29.100014 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as select * from {{ source('interview_sample_data', 'interview_'{{t}}) }}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as select * from {{ source('interview_sample_data', 'interview_'{{t}}) }}
2022-04-21 02:43:29.446450 (Thread-252): handling poll request
2022-04-21 02:43:29.446824 (Thread-252): 02:43:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c5e2700>]}
2022-04-21 02:43:29.447559 (Thread-252): sending response (<Response 4438 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:45:06.677166 (Thread-253): 02:45:06  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:45:06.679416 (Thread-253): 02:45:06  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-21 02:45:06.683248 (Thread-253): 02:45:06  1603: static parser failed on _archive/test_loop.sql
2022-04-21 02:45:07.392038 (Thread-254): handling status request
2022-04-21 02:45:07.392378 (Thread-254): 02:45:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c65e100>]}
2022-04-21 02:45:07.392862 (Thread-254): sending response (<Response 1317 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:45:07.420001 (Thread-255): handling status request
2022-04-21 02:45:07.420250 (Thread-255): 02:45:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c6d2ca3a0>]}
2022-04-21 02:45:07.420594 (Thread-255): sending response (<Response 1317 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:45:32.929445 (Thread-256): handling status request
2022-04-21 02:45:32.929780 (Thread-256): 02:45:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3c65e1f0>]}
2022-04-21 02:45:32.930247 (Thread-256): sending response (<Response 1317 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:45:35.711384 (Thread-257): 02:45:35  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 02:45:35.711742 (Thread-257): 02:45:35  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-21 02:45:35.715347 (Thread-257): 02:45:35  1603: static parser failed on _archive/test_loop.sql
2022-04-21 02:45:36.523791 (Thread-258): handling status request
2022-04-21 02:45:36.524128 (Thread-258): 02:45:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3cce4ee0>]}
2022-04-21 02:45:36.524597 (Thread-258): sending response (<Response 1317 bytes [200 OK]>) to 10.0.26.132
2022-04-21 02:45:36.589418 (Thread-259): handling status request
2022-04-21 02:45:36.589679 (Thread-259): 02:45:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e198575e-6fe8-469d-99f7-f2625cd635f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c3ccbf040>]}
2022-04-21 02:45:36.590084 (Thread-259): sending response (<Response 1317 bytes [200 OK]>) to 10.0.26.132
2022-04-21 23:07:31.062993 (MainThread): Running with dbt=1.0.5
2022-04-21 23:07:31.645791 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-21 23:07:31.655353 (MainThread): Tracking: tracking
2022-04-21 23:07:31.655686 (MainThread): 23:07:31  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ad1b16670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d5a790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d65d60>]}
2022-04-21 23:07:31.656819 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-04-21 23:07:31.661791 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-21 23:07:31.662027 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-21 23:07:31.683342 (Thread-12): 23:07:31  Unable to do partial parsing because of a dbt version mismatch. Saved manifest version: 1.0.4. Current version: 1.0.5.
2022-04-21 23:07:31.683648 (Thread-12): 23:07:31  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d2ed60>]}
2022-04-21 23:07:31.786132 (Thread-12): 23:07:31  Parsing macros/adapters.sql
2022-04-21 23:07:31.824450 (Thread-12): 23:07:31  Parsing macros/catalog.sql
2022-04-21 23:07:31.826382 (Thread-12): 23:07:31  Parsing macros/materializations/table.sql
2022-04-21 23:07:31.829389 (Thread-12): 23:07:31  Parsing macros/materializations/seed.sql
2022-04-21 23:07:31.834340 (Thread-12): 23:07:31  Parsing macros/materializations/incremental.sql
2022-04-21 23:07:31.842576 (Thread-12): 23:07:31  Parsing macros/materializations/merge.sql
2022-04-21 23:07:31.846193 (Thread-12): 23:07:31  Parsing macros/materializations/snapshot.sql
2022-04-21 23:07:31.847147 (Thread-12): 23:07:31  Parsing macros/materializations/view.sql
2022-04-21 23:07:31.848452 (Thread-12): 23:07:31  Parsing macros/adapters/metadata.sql
2022-04-21 23:07:31.855521 (Thread-12): 23:07:31  Parsing macros/adapters/columns.sql
2022-04-21 23:07:31.865118 (Thread-12): 23:07:31  Parsing macros/adapters/freshness.sql
2022-04-21 23:07:31.867928 (Thread-12): 23:07:31  Parsing macros/adapters/persist_docs.sql
2022-04-21 23:07:31.872155 (Thread-12): 23:07:31  Parsing macros/adapters/relation.sql
2022-04-21 23:07:31.881239 (Thread-12): 23:07:31  Parsing macros/adapters/schema.sql
2022-04-21 23:07:31.883344 (Thread-12): 23:07:31  Parsing macros/adapters/indexes.sql
2022-04-21 23:07:31.885915 (Thread-12): 23:07:31  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-21 23:07:31.888284 (Thread-12): 23:07:31  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-21 23:07:31.889732 (Thread-12): 23:07:31  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-21 23:07:31.891257 (Thread-12): 23:07:31  Parsing macros/etc/datetime.sql
2022-04-21 23:07:31.899350 (Thread-12): 23:07:31  Parsing macros/etc/statement.sql
2022-04-21 23:07:31.903603 (Thread-12): 23:07:31  Parsing macros/generic_test_sql/unique.sql
2022-04-21 23:07:31.904309 (Thread-12): 23:07:31  Parsing macros/generic_test_sql/not_null.sql
2022-04-21 23:07:31.904864 (Thread-12): 23:07:31  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-21 23:07:31.906181 (Thread-12): 23:07:31  Parsing macros/generic_test_sql/relationships.sql
2022-04-21 23:07:31.907071 (Thread-12): 23:07:31  Parsing macros/materializations/configs.sql
2022-04-21 23:07:31.909296 (Thread-12): 23:07:31  Parsing macros/materializations/hooks.sql
2022-04-21 23:07:31.912969 (Thread-12): 23:07:31  Parsing macros/materializations/models/table/table.sql
2022-04-21 23:07:31.920197 (Thread-12): 23:07:31  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-21 23:07:31.922945 (Thread-12): 23:07:31  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-21 23:07:31.925524 (Thread-12): 23:07:31  Parsing macros/materializations/models/view/helpers.sql
2022-04-21 23:07:31.926818 (Thread-12): 23:07:31  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-21 23:07:31.929043 (Thread-12): 23:07:31  Parsing macros/materializations/models/view/view.sql
2022-04-21 23:07:31.935890 (Thread-12): 23:07:31  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-21 23:07:31.945466 (Thread-12): 23:07:31  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-21 23:07:31.960663 (Thread-12): 23:07:31  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-21 23:07:31.962178 (Thread-12): 23:07:31  Parsing macros/materializations/models/incremental/merge.sql
2022-04-21 23:07:31.973025 (Thread-12): 23:07:31  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-21 23:07:31.977365 (Thread-12): 23:07:31  Parsing macros/materializations/seeds/helpers.sql
2022-04-21 23:07:31.993005 (Thread-12): 23:07:31  Parsing macros/materializations/seeds/seed.sql
2022-04-21 23:07:31.998744 (Thread-12): 23:07:31  Parsing macros/materializations/tests/helpers.sql
2022-04-21 23:07:32.000579 (Thread-12): 23:07:32  Parsing macros/materializations/tests/test.sql
2022-04-21 23:07:32.004796 (Thread-12): 23:07:32  Parsing macros/materializations/tests/where_subquery.sql
2022-04-21 23:07:32.006557 (Thread-12): 23:07:32  Parsing macros/materializations/snapshots/helpers.sql
2022-04-21 23:07:32.017951 (Thread-12): 23:07:32  Parsing macros/materializations/snapshots/strategies.sql
2022-04-21 23:07:32.033891 (Thread-12): 23:07:32  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-21 23:07:32.035534 (Thread-12): 23:07:32  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-21 23:07:32.046719 (Thread-12): 23:07:32  Parsing tests/generic/builtin.sql
2022-04-21 23:07:32.237655 (Thread-12): 23:07:32  1699: static parser successfully parsed example/my_second_dbt_model.sql
2022-04-21 23:07:32.249440 (Thread-12): 23:07:32  1699: static parser successfully parsed example/my_first_dbt_model.sql
2022-04-21 23:07:32.251536 (Thread-12): 23:07:32  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 23:07:32.253418 (Thread-12): 23:07:32  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 23:07:32.255360 (Thread-12): 23:07:32  1603: static parser failed on _archive/test_loop.sql
2022-04-21 23:07:34.751009 (Thread-13): handling status request
2022-04-21 23:07:34.751420 (Thread-13): 23:07:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4617160>]}
2022-04-21 23:07:34.752466 (Thread-13): sending response (<Response 16289 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:34.760560 (Thread-14): handling status request
2022-04-21 23:07:34.760890 (Thread-14): 23:07:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab45f14c0>]}
2022-04-21 23:07:34.761703 (Thread-14): sending response (<Response 16289 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:35.119757 (Thread-15): handling status request
2022-04-21 23:07:35.120149 (Thread-15): 23:07:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4617820>]}
2022-04-21 23:07:35.120991 (Thread-15): sending response (<Response 16289 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:35.154433 (Thread-16): handling ps request
2022-04-21 23:07:35.154833 (Thread-16): 23:07:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d03bb0>]}
2022-04-21 23:07:35.155309 (Thread-16): sending response (<Response 105 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:36.920966 (Thread-17): handling status request
2022-04-21 23:07:36.921389 (Thread-17): 23:07:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d028b0>]}
2022-04-21 23:07:36.922220 (Thread-17): sending response (<Response 16289 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:46.969657 (Thread-18): handling status request
2022-04-21 23:07:46.971283 (Thread-18): 23:07:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab460d7c0>]}
2022-04-21 23:07:46.972125 (Thread-18): sending response (<Response 16267 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:48.244281 (Thread-19): handling status request
2022-04-21 23:07:48.244668 (Thread-19): 23:07:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab460df10>]}
2022-04-21 23:07:48.245528 (Thread-19): sending response (<Response 16267 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:50.510061 (Thread-20): handling status request
2022-04-21 23:07:50.510514 (Thread-20): 23:07:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d03c10>]}
2022-04-21 23:07:50.511355 (Thread-20): sending response (<Response 16267 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:07:54.796011 (Thread-21): handling status request
2022-04-21 23:07:54.796366 (Thread-21): 23:07:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d65580>]}
2022-04-21 23:07:54.797169 (Thread-21): sending response (<Response 16267 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:10.830993 (Thread-22): handling status request
2022-04-21 23:08:10.832649 (Thread-22): 23:08:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4617160>]}
2022-04-21 23:08:10.833506 (Thread-22): sending response (<Response 16289 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:11.157724 (Thread-23): handling run_sql request
2022-04-21 23:08:11.158118 (Thread-23): 23:08:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4617610>]}
2022-04-21 23:08:11.158587 (Thread-23): sending response (<Response 741 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:28.772124 (Thread-24): 23:08:28  Unable to do partial parsing because of a dbt version mismatch. Saved manifest version: 1.0.4. Current version: 1.0.5.
2022-04-21 23:08:28.772444 (Thread-24): 23:08:28  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cbf310>]}
2022-04-21 23:08:28.838587 (Thread-24): 23:08:28  Parsing macros/adapters.sql
2022-04-21 23:08:28.875726 (Thread-24): 23:08:28  Parsing macros/catalog.sql
2022-04-21 23:08:28.877608 (Thread-24): 23:08:28  Parsing macros/materializations/table.sql
2022-04-21 23:08:28.881185 (Thread-24): 23:08:28  Parsing macros/materializations/seed.sql
2022-04-21 23:08:28.886163 (Thread-24): 23:08:28  Parsing macros/materializations/incremental.sql
2022-04-21 23:08:28.894380 (Thread-24): 23:08:28  Parsing macros/materializations/merge.sql
2022-04-21 23:08:28.898017 (Thread-24): 23:08:28  Parsing macros/materializations/snapshot.sql
2022-04-21 23:08:28.898992 (Thread-24): 23:08:28  Parsing macros/materializations/view.sql
2022-04-21 23:08:28.900305 (Thread-24): 23:08:28  Parsing macros/adapters/metadata.sql
2022-04-21 23:08:28.907097 (Thread-24): 23:08:28  Parsing macros/adapters/columns.sql
2022-04-21 23:08:28.916542 (Thread-24): 23:08:28  Parsing macros/adapters/freshness.sql
2022-04-21 23:08:28.919349 (Thread-24): 23:08:28  Parsing macros/adapters/persist_docs.sql
2022-04-21 23:08:28.923532 (Thread-24): 23:08:28  Parsing macros/adapters/relation.sql
2022-04-21 23:08:28.932596 (Thread-24): 23:08:28  Parsing macros/adapters/schema.sql
2022-04-21 23:08:28.934705 (Thread-24): 23:08:28  Parsing macros/adapters/indexes.sql
2022-04-21 23:08:28.937271 (Thread-24): 23:08:28  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-21 23:08:28.939664 (Thread-24): 23:08:28  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-21 23:08:28.941095 (Thread-24): 23:08:28  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-21 23:08:28.942628 (Thread-24): 23:08:28  Parsing macros/etc/datetime.sql
2022-04-21 23:08:28.950576 (Thread-24): 23:08:28  Parsing macros/etc/statement.sql
2022-04-21 23:08:28.954793 (Thread-24): 23:08:28  Parsing macros/generic_test_sql/unique.sql
2022-04-21 23:08:28.955497 (Thread-24): 23:08:28  Parsing macros/generic_test_sql/not_null.sql
2022-04-21 23:08:28.956095 (Thread-24): 23:08:28  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-21 23:08:28.957424 (Thread-24): 23:08:28  Parsing macros/generic_test_sql/relationships.sql
2022-04-21 23:08:28.958301 (Thread-24): 23:08:28  Parsing macros/materializations/configs.sql
2022-04-21 23:08:28.960536 (Thread-24): 23:08:28  Parsing macros/materializations/hooks.sql
2022-04-21 23:08:28.964257 (Thread-24): 23:08:28  Parsing macros/materializations/models/table/table.sql
2022-04-21 23:08:28.971435 (Thread-24): 23:08:28  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-21 23:08:28.974159 (Thread-24): 23:08:28  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-21 23:08:28.976719 (Thread-24): 23:08:28  Parsing macros/materializations/models/view/helpers.sql
2022-04-21 23:08:28.977990 (Thread-24): 23:08:28  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-21 23:08:28.980244 (Thread-24): 23:08:28  Parsing macros/materializations/models/view/view.sql
2022-04-21 23:08:28.987104 (Thread-24): 23:08:28  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-21 23:08:28.997013 (Thread-24): 23:08:28  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-21 23:08:29.012221 (Thread-24): 23:08:29  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-21 23:08:29.013695 (Thread-24): 23:08:29  Parsing macros/materializations/models/incremental/merge.sql
2022-04-21 23:08:29.024657 (Thread-24): 23:08:29  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-21 23:08:29.028937 (Thread-24): 23:08:29  Parsing macros/materializations/seeds/helpers.sql
2022-04-21 23:08:29.044558 (Thread-24): 23:08:29  Parsing macros/materializations/seeds/seed.sql
2022-04-21 23:08:29.050261 (Thread-24): 23:08:29  Parsing macros/materializations/tests/helpers.sql
2022-04-21 23:08:29.051998 (Thread-24): 23:08:29  Parsing macros/materializations/tests/test.sql
2022-04-21 23:08:29.056254 (Thread-24): 23:08:29  Parsing macros/materializations/tests/where_subquery.sql
2022-04-21 23:08:29.058003 (Thread-24): 23:08:29  Parsing macros/materializations/snapshots/helpers.sql
2022-04-21 23:08:29.068972 (Thread-24): 23:08:29  Parsing macros/materializations/snapshots/strategies.sql
2022-04-21 23:08:29.085177 (Thread-24): 23:08:29  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-21 23:08:29.086968 (Thread-24): 23:08:29  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-21 23:08:29.098210 (Thread-24): 23:08:29  Parsing tests/generic/builtin.sql
2022-04-21 23:08:29.309228 (Thread-24): 23:08:29  1699: static parser successfully parsed example/my_second_dbt_model.sql
2022-04-21 23:08:29.312624 (Thread-24): 23:08:29  1699: static parser successfully parsed example/my_first_dbt_model.sql
2022-04-21 23:08:29.315340 (Thread-24): 23:08:29  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 23:08:29.318341 (Thread-24): 23:08:29  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-21 23:08:29.321561 (Thread-24): 23:08:29  1603: static parser failed on _archive/test_loop.sql
2022-04-21 23:08:29.325868 (Thread-24): 23:08:29  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-21 23:08:29.327413 (Thread-24): 23:08:29  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-21 23:08:29.461253 (Thread-24): 23:08:29  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab45e4400>]}
2022-04-21 23:08:29.502996 (Thread-25): handling status request
2022-04-21 23:08:29.503413 (Thread-25): 23:08:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab45310d0>]}
2022-04-21 23:08:29.504287 (Thread-25): sending response (<Response 17141 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:29.523423 (Thread-26): handling status request
2022-04-21 23:08:29.523757 (Thread-26): 23:08:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4531dc0>]}
2022-04-21 23:08:29.524575 (Thread-26): sending response (<Response 17141 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:31.673576 (Thread-27): handling status request
2022-04-21 23:08:31.673975 (Thread-27): 23:08:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4617340>]}
2022-04-21 23:08:31.674900 (Thread-27): sending response (<Response 17141 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:31.979619 (Thread-28): handling run_sql request
2022-04-21 23:08:31.980007 (Thread-28): 23:08:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab46174f0>]}
2022-04-21 23:08:34.487878 (Thread-28): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:34.511822 (MainThread): 23:08:34  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '595be687-5662-44f7-982f-1f2451ea1475', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9abea424f0>]}
2022-04-21 23:08:34.512373 (MainThread): 23:08:34  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:08:34.512961 (Thread-1): 23:08:34  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:08:34.513099 (Thread-1): 23:08:34  Began compiling node rpc.my_new_project.request
2022-04-21 23:08:34.513192 (Thread-1): 23:08:34  Compiling rpc.my_new_project.request
2022-04-21 23:08:34.514464 (Thread-1): 23:08:34  finished collecting timing info
2022-04-21 23:08:34.514592 (Thread-1): 23:08:34  Began executing node rpc.my_new_project.request
2022-04-21 23:08:34.518222 (Thread-1): 23:08:34  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 23:08:34.518348 (Thread-1): 23:08:34  On rpc.my_new_project.request: -- import cte's
/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
    
*/

-- logical cte's
-- final cte's
-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

from (
    
    select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when oa.country_code is null then 'null country'
        when oa.country_code = 'us' then 'us'
        when oa.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type,
      d.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from raw.interview_sample_data.interview_orders o
    left join (
        select
          distinct cast(d.type_id as float) as order_id,
          first_value(d.device) over (
            partition by d.type_id
            order by
              d.created_at rows between unbounded preceding
              and unbounded following
          ) as device
        from raw.interview_sample_data.interview_devices d
        where d.type = 'order'
    ) d on d.order_id = o.order_id
    left join (
        select
          fo.user_id,
          min(fo.order_id) as first_order_id
        from raw.interview_sample_data.interview_orders as fo
        where
          fo.status != 'cancelled'
        group by
          fo.user_id
      ) fo on o.user_id = fo.user_id
    left join raw.interview_sample_data.interview_addresses oa 
      on oa.order_id = o.order_id
    left join (
        select
          order_id,
          sum(
            case
              when status = 'completed' then tax_amount_cents
              else 0
            end
          ) as gross_tax_amount_cents,
          sum(
            case
              when status = 'completed' then amount_cents
              else 0
            end
          ) as gross_amount_cents,
          sum(
            case
              when status = 'completed' then amount_shipping_cents
              else 0
            end
        ) as gross_shipping_amount_cents,
          sum(
            case
              when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents
              else 0
            end
          ) as gross_total_amount_cents
        from raw.interview_sample_data.interview_payments
        group by order_id
    ) pa on pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 23:08:34.518443 (Thread-1): 23:08:34  Opening a new connection, currently in state init
2022-04-21 23:08:34.828042 (Thread-29): handling poll request
2022-04-21 23:08:34.828492 (Thread-29): 23:08:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4533c70>]}
2022-04-21 23:08:34.829412 (Thread-29): sending response (<Response 8257 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:36.129006 (Thread-30): handling poll request
2022-04-21 23:08:36.129439 (Thread-30): 23:08:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4533880>]}
2022-04-21 23:08:36.129901 (Thread-30): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:37.438818 (Thread-31): handling poll request
2022-04-21 23:08:37.439305 (Thread-31): 23:08:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4533220>]}
2022-04-21 23:08:37.439830 (Thread-31): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:38.016187 (Thread-1): 23:08:38  SQL status: SUCCESS 500 in 3.5 seconds
2022-04-21 23:08:38.574387 (Thread-1): 23:08:38  finished collecting timing info
2022-04-21 23:08:38.574666 (Thread-1): 23:08:38  On rpc.my_new_project.request: Close
2022-04-21 23:08:38.748603 (Thread-32): handling poll request
2022-04-21 23:08:38.748989 (Thread-32): 23:08:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4533a90>]}
2022-04-21 23:08:38.749494 (Thread-32): sending response (<Response 1367 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:08:40.048512 (Thread-33): handling poll request
2022-04-21 23:08:40.048914 (Thread-33): 23:08:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4653460>]}
2022-04-21 23:08:40.057786 (Thread-33): sending response (<Response 152628 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:10:00.799065 (Thread-34): handling status request
2022-04-21 23:10:00.801022 (Thread-34): 23:10:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4653f10>]}
2022-04-21 23:10:00.801932 (Thread-34): sending response (<Response 17141 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:10:01.120626 (Thread-35): handling compile_sql request
2022-04-21 23:10:01.121016 (Thread-35): 23:10:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4617580>]}
2022-04-21 23:10:03.716329 (Thread-35): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:10:03.743626 (MainThread): 23:10:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c4d08e11-3a7d-495a-96d4-7c5268d8a0ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5ffe7695e0>]}
2022-04-21 23:10:03.744157 (MainThread): 23:10:03  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:10:03.744742 (Thread-1): 23:10:03  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:10:03.744880 (Thread-1): 23:10:03  Began compiling node rpc.my_new_project.request
2022-04-21 23:10:03.744976 (Thread-1): 23:10:03  Compiling rpc.my_new_project.request
2022-04-21 23:10:03.747515 (Thread-1): 23:10:03  finished collecting timing info
2022-04-21 23:10:03.747644 (Thread-1): 23:10:03  Began executing node rpc.my_new_project.request
2022-04-21 23:10:03.747741 (Thread-1): 23:10:03  finished collecting timing info
2022-04-21 23:10:04.026094 (Thread-36): handling poll request
2022-04-21 23:10:04.026573 (Thread-36): 23:10:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cb4160>]}
2022-04-21 23:10:04.027702 (Thread-36): sending response (<Response 7044 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:11:55.175339 (Thread-37): handling status request
2022-04-21 23:11:55.177156 (Thread-37): 23:11:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d12340>]}
2022-04-21 23:11:55.178224 (Thread-37): sending response (<Response 17141 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:11:55.505439 (Thread-38): handling compile_sql request
2022-04-21 23:11:55.505832 (Thread-38): 23:11:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d5adc0>]}
2022-04-21 23:11:57.972226 (Thread-38): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:11:57.986308 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 516, in catch_jinja
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.8/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got '{'
  line 19
    {{t}} as select * from {{ source('interview_sample_data', 'interview_'{{t}}) }}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 124, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/parser/rpc.py", line 47, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 401, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 376, in render_update
    context = self.render_with_context(node, config)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/base.py", line 267, in render_with_context
    get_rendered(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 590, in get_rendered
    template = get_template(
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 543, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 519, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token ',', got '{'
    line 19
      {{t}} as select * from {{ source('interview_sample_data', 'interview_'{{t}}) }}
2022-04-21 23:11:58.336736 (Thread-39): handling poll request
2022-04-21 23:11:58.337183 (Thread-39): 23:11:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d2ea30>]}
2022-04-21 23:11:58.360583 (Thread-39): sending response (<Response 4437 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:12:22.801213 (Thread-40): 23:12:22  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 23:12:22.801673 (Thread-40): 23:12:22  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-21 23:12:22.805878 (Thread-40): 23:12:22  1603: static parser failed on _archive/test_loop.sql
2022-04-21 23:12:22.810053 (Thread-40): 23:12:22  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-21 23:12:22.851627 (Thread-40): 23:12:22  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1d0f400>]}
2022-04-21 23:12:23.578768 (Thread-41): handling status request
2022-04-21 23:12:23.579149 (Thread-41): 23:12:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d02700>]}
2022-04-21 23:12:23.579634 (Thread-41): sending response (<Response 1859 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:12:23.820343 (Thread-42): handling status request
2022-04-21 23:12:23.820732 (Thread-42): 23:12:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d02df0>]}
2022-04-21 23:12:23.821192 (Thread-42): sending response (<Response 1859 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:13:29.203091 (Thread-43): 23:13:29  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 23:13:29.204736 (Thread-43): 23:13:29  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-21 23:13:29.209086 (Thread-43): 23:13:29  1603: static parser failed on _archive/test_loop.sql
2022-04-21 23:13:29.212539 (Thread-43): 23:13:29  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-21 23:13:29.254123 (Thread-43): 23:13:29  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf61d3a0>]}
2022-04-21 23:13:29.881429 (Thread-44): handling status request
2022-04-21 23:13:29.881830 (Thread-44): 23:13:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4648370>]}
2022-04-21 23:13:29.882358 (Thread-44): sending response (<Response 1859 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:13:29.957323 (Thread-45): handling status request
2022-04-21 23:13:29.957705 (Thread-45): 23:13:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab46485e0>]}
2022-04-21 23:13:29.958193 (Thread-45): sending response (<Response 1859 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:36:53.385181 (Thread-46): 23:36:53  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 23:36:53.387059 (Thread-46): 23:36:53  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 23:36:53.391208 (Thread-46): 23:36:53  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 23:36:53.436242 (Thread-46): 23:36:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf5fadf0>]}
2022-04-21 23:36:54.230210 (Thread-47): handling status request
2022-04-21 23:36:54.230631 (Thread-47): 23:36:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9cf27a60>]}
2022-04-21 23:36:54.231114 (Thread-47): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:36:54.518331 (Thread-48): handling status request
2022-04-21 23:36:54.518738 (Thread-48): 23:36:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9cf278b0>]}
2022-04-21 23:36:54.519215 (Thread-48): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:37:00.993415 (Thread-49): handling status request
2022-04-21 23:37:00.993811 (Thread-49): 23:37:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4659400>]}
2022-04-21 23:37:00.994300 (Thread-49): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:37:01.310014 (Thread-50): handling run_sql request
2022-04-21 23:37:01.310476 (Thread-50): 23:37:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab4607b50>]}
2022-04-21 23:37:03.824083 (Thread-50): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:37:03.851241 (MainThread): 23:37:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6f7ecb4-23c9-4cdb-9cb7-14ba417c1b1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41cb0a8ca0>]}
2022-04-21 23:37:03.851816 (MainThread): 23:37:03  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:37:03.852424 (Thread-1): 23:37:03  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:37:03.852559 (Thread-1): 23:37:03  Began compiling node rpc.my_new_project.request
2022-04-21 23:37:03.852650 (Thread-1): 23:37:03  Compiling rpc.my_new_project.request
2022-04-21 23:37:03.856202 (Thread-1): 23:37:03  finished collecting timing info
2022-04-21 23:37:03.856335 (Thread-1): 23:37:03  Began executing node rpc.my_new_project.request
2022-04-21 23:37:03.859886 (Thread-1): 23:37:03  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 23:37:03.859986 (Thread-1): 23:37:03  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with 
o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those

*/

d as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
)





-- final cte's
-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

from (
    
    select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type,
      d.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join d
      on d.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 23:37:03.860066 (Thread-1): 23:37:03  Opening a new connection, currently in state init
2022-04-21 23:37:04.148073 (Thread-51): handling poll request
2022-04-21 23:37:04.148516 (Thread-51): 23:37:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cb8f10>]}
2022-04-21 23:37:04.149452 (Thread-51): sending response (<Response 7896 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:37:04.919144 (Thread-1): 23:37:04  Snowflake adapter: Snowflake query id: 01a3c3e9-0501-5fd8-0004-7d8304880916
2022-04-21 23:37:04.919376 (Thread-1): 23:37:04  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 125 at position 9
invalid identifier 'D.ORDER_ID'
2022-04-21 23:37:04.919568 (Thread-1): 23:37:04  finished collecting timing info
2022-04-21 23:37:04.919771 (Thread-1): 23:37:04  On rpc.my_new_project.request: Close
2022-04-21 23:37:05.103428 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 125 at position 9
  invalid identifier 'D.ORDER_ID'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 125 at position 9
invalid identifier 'D.ORDER_ID'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 125 at position 9
  invalid identifier 'D.ORDER_ID'
2022-04-21 23:37:05.104513 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 125 at position 9\n  invalid identifier 'D.ORDER_ID'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith \r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\n\r\n*/\r\n\r\nd as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n)\r\n\r\n\r\n\r\n\r\n\r\n-- final cte's\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nfrom (\r\n    \r\n    select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type,\r\n      d.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join d\r\n      on d.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith \no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\n\n*/\n\nd as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n)\n\n\n\n\n\n-- final cte's\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \n\nfrom (\n    \n    select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type,\n      d.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join d\n      on d.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 125 at position 9\n  invalid identifier 'D.ORDER_ID'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith \r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\n\r\n*/\r\n\r\nd as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n)\r\n\r\n\r\n\r\n\r\n\r\n-- final cte's\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nfrom (\r\n    \r\n    select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type,\r\n      d.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join d\r\n      on d.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith \no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\n\n*/\n\nd as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n)\n\n\n\n\n\n-- final cte's\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \n\nfrom (\n    \n    select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type,\n      d.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join d\n      on d.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 23:37:05.453768 (Thread-52): handling poll request
2022-04-21 23:37:05.454160 (Thread-52): 23:37:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cb86a0>]}
2022-04-21 23:37:05.454956 (Thread-52): sending response (<Response 41283 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:38:35.127374 (Thread-53): handling status request
2022-04-21 23:38:35.129171 (Thread-53): 23:38:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cbf6d0>]}
2022-04-21 23:38:35.129699 (Thread-53): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:38:35.487135 (Thread-54): handling compile_sql request
2022-04-21 23:38:35.487549 (Thread-54): 23:38:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cbfc70>]}
2022-04-21 23:38:37.997187 (Thread-54): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:38:38.026612 (MainThread): 23:38:38  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71f22049-adf9-4ea4-a3c0-6f58af78ac40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c009abc40>]}
2022-04-21 23:38:38.027138 (MainThread): 23:38:38  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:38:38.027712 (Thread-1): 23:38:38  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:38:38.027843 (Thread-1): 23:38:38  Began compiling node rpc.my_new_project.request
2022-04-21 23:38:38.027933 (Thread-1): 23:38:38  Compiling rpc.my_new_project.request
2022-04-21 23:38:38.031347 (Thread-1): 23:38:38  finished collecting timing info
2022-04-21 23:38:38.031493 (Thread-1): 23:38:38  Began executing node rpc.my_new_project.request
2022-04-21 23:38:38.031595 (Thread-1): 23:38:38  finished collecting timing info
2022-04-21 23:38:38.360759 (Thread-55): handling poll request
2022-04-21 23:38:38.361230 (Thread-55): 23:38:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cefaf0>]}
2022-04-21 23:38:38.362517 (Thread-55): sending response (<Response 23032 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:57:42.640597 (Thread-56): 23:57:42  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-21 23:57:42.642543 (Thread-56): 23:57:42  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-21 23:57:42.646919 (Thread-56): 23:57:42  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-21 23:57:42.693653 (Thread-56): 23:57:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55d670>]}
2022-04-21 23:57:43.290161 (Thread-57): handling status request
2022-04-21 23:57:43.290597 (Thread-57): 23:57:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf532c70>]}
2022-04-21 23:57:43.291098 (Thread-57): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:57:43.480137 (Thread-58): handling status request
2022-04-21 23:57:43.480524 (Thread-58): 23:57:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf532f40>]}
2022-04-21 23:57:43.480976 (Thread-58): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:57:44.856139 (Thread-59): handling status request
2022-04-21 23:57:44.856574 (Thread-59): 23:57:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cbf940>]}
2022-04-21 23:57:44.857028 (Thread-59): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:57:45.205225 (Thread-60): handling run_sql request
2022-04-21 23:57:45.205622 (Thread-60): 23:57:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf532af0>]}
2022-04-21 23:57:47.688048 (Thread-60): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:57:47.714800 (MainThread): 23:57:47  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8146f5ea-f0de-4981-a0a1-c086316ebdf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16534a4d30>]}
2022-04-21 23:57:47.715341 (MainThread): 23:57:47  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:57:47.715928 (Thread-1): 23:57:47  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:57:47.716060 (Thread-1): 23:57:47  Began compiling node rpc.my_new_project.request
2022-04-21 23:57:47.716152 (Thread-1): 23:57:47  Compiling rpc.my_new_project.request
2022-04-21 23:57:47.719595 (Thread-1): 23:57:47  finished collecting timing info
2022-04-21 23:57:47.719724 (Thread-1): 23:57:47  Began executing node rpc.my_new_project.request
2022-04-21 23:57:47.723236 (Thread-1): 23:57:47  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 23:57:47.723334 (Thread-1): 23:57:47  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with 
o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
)





-- final cte's
-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

from (
    
    select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type,
      d.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join d
      on d.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 23:57:47.723415 (Thread-1): 23:57:47  Opening a new connection, currently in state init
2022-04-21 23:57:48.022239 (Thread-61): handling poll request
2022-04-21 23:57:48.022722 (Thread-61): 23:57:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf5ad3d0>]}
2022-04-21 23:57:48.023845 (Thread-61): sending response (<Response 7897 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:57:48.684092 (Thread-1): 23:57:48  Snowflake adapter: Snowflake query id: 01a3c3fd-0501-6083-0004-7d8304883686
2022-04-21 23:57:48.684317 (Thread-1): 23:57:48  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 125 at position 9
invalid identifier 'D.ORDER_ID'
2022-04-21 23:57:48.684514 (Thread-1): 23:57:48  finished collecting timing info
2022-04-21 23:57:48.684713 (Thread-1): 23:57:48  On rpc.my_new_project.request: Close
2022-04-21 23:57:48.878098 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 125 at position 9
  invalid identifier 'D.ORDER_ID'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 125 at position 9
invalid identifier 'D.ORDER_ID'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 125 at position 9
  invalid identifier 'D.ORDER_ID'
2022-04-21 23:57:48.879214 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 125 at position 9\n  invalid identifier 'D.ORDER_ID'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith \r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n)\r\n\r\n\r\n\r\n\r\n\r\n-- final cte's\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nfrom (\r\n    \r\n    select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type,\r\n      d.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join d\r\n      on d.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith \no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n)\n\n\n\n\n\n-- final cte's\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \n\nfrom (\n    \n    select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type,\n      d.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join d\n      on d.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 125 at position 9\n  invalid identifier 'D.ORDER_ID'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith \r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n)\r\n\r\n\r\n\r\n\r\n\r\n-- final cte's\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nfrom (\r\n    \r\n    select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type,\r\n      d.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join d\r\n      on d.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith \no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n)\n\n\n\n\n\n-- final cte's\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \n\nfrom (\n    \n    select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type,\n      d.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join d\n      on d.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 23:57:49.337686 (Thread-62): handling poll request
2022-04-21 23:57:49.338104 (Thread-62): 23:57:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cb6cd0>]}
2022-04-21 23:57:49.338877 (Thread-62): sending response (<Response 41290 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:20.818012 (Thread-63): handling status request
2022-04-21 23:59:20.820038 (Thread-63): 23:59:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab453fc70>]}
2022-04-21 23:59:20.820539 (Thread-63): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:21.137025 (Thread-64): handling run_sql request
2022-04-21 23:59:21.137419 (Thread-64): 23:59:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab453f250>]}
2022-04-21 23:59:23.598250 (Thread-64): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:23.626949 (MainThread): 23:59:23  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e12f91b-c8ac-4a11-811b-9da8899fe9c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950e0e0ca0>]}
2022-04-21 23:59:23.627667 (MainThread): 23:59:23  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:59:23.628112 (Thread-1): 23:59:23  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:59:23.628243 (Thread-1): 23:59:23  Began compiling node rpc.my_new_project.request
2022-04-21 23:59:23.628350 (Thread-1): 23:59:23  Compiling rpc.my_new_project.request
2022-04-21 23:59:23.630943 (Thread-1): 23:59:23  finished collecting timing info
2022-04-21 23:59:23.631072 (Thread-1): 23:59:23  Began executing node rpc.my_new_project.request
2022-04-21 23:59:23.631885 (Thread-1): 23:59:23  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 23:59:23.631973 (Thread-1): 23:59:23  On rpc.my_new_project.request: -- list tables




d as (select * from raw.interview_sample_data.interview_devices),


do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
)

select * from do
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 23:59:23.632053 (Thread-1): 23:59:23  Opening a new connection, currently in state init
2022-04-21 23:59:23.922000 (Thread-65): handling poll request
2022-04-21 23:59:23.922472 (Thread-65): 23:59:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55a6a0>]}
2022-04-21 23:59:23.923340 (Thread-65): sending response (<Response 4118 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:24.532477 (Thread-1): 23:59:24  Snowflake adapter: Snowflake query id: 01a3c3ff-0501-5fd8-0004-7d8304880d06
2022-04-21 23:59:24.532724 (Thread-1): 23:59:24  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'd'.
2022-04-21 23:59:24.532930 (Thread-1): 23:59:24  finished collecting timing info
2022-04-21 23:59:24.533128 (Thread-1): 23:59:24  On rpc.my_new_project.request: Close
2022-04-21 23:59:24.724096 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'd'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'd'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'd'.
2022-04-21 23:59:24.725104 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'd'.", 'raw_sql': "-- list tables\r\n{% set tables = ['orders', 'devices', 'orders', 'addresses', 'payments'] %}\r\n\r\n{#\r\n\r\n-- basic test\r\n{% for t in tables %}\r\n    table name is: raw.interview_sample_data.interview_{{t}}\r\n{% endfor %}\r\n\r\n-- testing tables\r\n{%- for t in tables %}\r\n    {{t}} as ( select * from raw.interview_sample_data.interview_{{t}} ),\r\n{%- endfor %}\r\n\r\n\r\n\r\n{%- for t in tables %}\r\n    {{t}} as select * from { source('interview_sample_data', 'interview_'{{t}}) }\r\n{%- endfor %}\r\n\r\n#}\r\n\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n)\r\n\r\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- list tables\n\n\n\n\nd as (select * from raw.interview_sample_data.interview_devices),\n\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n)\n\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'd'.", 'raw_sql': "-- list tables\r\n{% set tables = ['orders', 'devices', 'orders', 'addresses', 'payments'] %}\r\n\r\n{#\r\n\r\n-- basic test\r\n{% for t in tables %}\r\n    table name is: raw.interview_sample_data.interview_{{t}}\r\n{% endfor %}\r\n\r\n-- testing tables\r\n{%- for t in tables %}\r\n    {{t}} as ( select * from raw.interview_sample_data.interview_{{t}} ),\r\n{%- endfor %}\r\n\r\n\r\n\r\n{%- for t in tables %}\r\n    {{t}} as select * from { source('interview_sample_data', 'interview_'{{t}}) }\r\n{%- endfor %}\r\n\r\n#}\r\n\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n)\r\n\r\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- list tables\n\n\n\n\nd as (select * from raw.interview_sample_data.interview_devices),\n\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n)\n\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-21 23:59:25.274434 (Thread-66): handling poll request
2022-04-21 23:59:25.274838 (Thread-66): 23:59:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55a7c0>]}
2022-04-21 23:59:25.275465 (Thread-66): sending response (<Response 14565 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:32.602590 (Thread-67): handling status request
2022-04-21 23:59:32.603000 (Thread-67): 23:59:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55ad60>]}
2022-04-21 23:59:32.603516 (Thread-67): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:33.101581 (Thread-68): handling run_sql request
2022-04-21 23:59:33.101977 (Thread-68): 23:59:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55af40>]}
2022-04-21 23:59:35.599776 (Thread-68): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:35.626048 (MainThread): 23:59:35  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b022402b-a109-4041-8e79-fd09abf0b47a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd6a29c70>]}
2022-04-21 23:59:35.626707 (MainThread): 23:59:35  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-21 23:59:35.627342 (Thread-1): 23:59:35  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-21 23:59:35.627471 (Thread-1): 23:59:35  Began compiling node rpc.my_new_project.request
2022-04-21 23:59:35.627620 (Thread-1): 23:59:35  Compiling rpc.my_new_project.request
2022-04-21 23:59:35.630241 (Thread-1): 23:59:35  finished collecting timing info
2022-04-21 23:59:35.630396 (Thread-1): 23:59:35  Began executing node rpc.my_new_project.request
2022-04-21 23:59:35.631272 (Thread-1): 23:59:35  Using snowflake connection "rpc.my_new_project.request"
2022-04-21 23:59:35.631364 (Thread-1): 23:59:35  On rpc.my_new_project.request: -- list tables



with 
d as (select * from raw.interview_sample_data.interview_devices),


do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
)

select * from do
limit 500
/* limit added automatically by dbt cloud */
2022-04-21 23:59:35.631444 (Thread-1): 23:59:35  Opening a new connection, currently in state init
2022-04-21 23:59:35.903266 (Thread-69): handling poll request
2022-04-21 23:59:35.903746 (Thread-69): 23:59:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55d8e0>]}
2022-04-21 23:59:35.928406 (Thread-69): sending response (<Response 4123 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:37.235279 (Thread-70): handling poll request
2022-04-21 23:59:37.235667 (Thread-70): 23:59:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf55dd00>]}
2022-04-21 23:59:37.236131 (Thread-70): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-21 23:59:37.316883 (Thread-1): 23:59:37  SQL status: SUCCESS 500 in 1.69 seconds
2022-04-21 23:59:37.323810 (Thread-1): 23:59:37  finished collecting timing info
2022-04-21 23:59:37.324070 (Thread-1): 23:59:37  On rpc.my_new_project.request: Close
2022-04-21 23:59:38.560162 (Thread-71): handling poll request
2022-04-21 23:59:38.560587 (Thread-71): 23:59:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf5ad190>]}
2022-04-21 23:59:38.562114 (Thread-71): sending response (<Response 16296 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:00:37.596411 (Thread-72): handling status request
2022-04-22 00:00:37.596817 (Thread-72): 00:00:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf4fcf10>]}
2022-04-22 00:00:37.597328 (Thread-72): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:00:37.934612 (Thread-73): handling run_sql request
2022-04-22 00:00:37.935024 (Thread-73): 00:00:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf501130>]}
2022-04-22 00:00:40.487216 (Thread-73): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:00:40.515591 (MainThread): 00:00:40  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9412c393-02bb-4880-b47f-9b0977f8bb4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6311ad60>]}
2022-04-22 00:00:40.516130 (MainThread): 00:00:40  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 00:00:40.516735 (Thread-1): 00:00:40  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 00:00:40.516869 (Thread-1): 00:00:40  Began compiling node rpc.my_new_project.request
2022-04-22 00:00:40.516963 (Thread-1): 00:00:40  Compiling rpc.my_new_project.request
2022-04-22 00:00:40.520419 (Thread-1): 00:00:40  finished collecting timing info
2022-04-22 00:00:40.520553 (Thread-1): 00:00:40  Began executing node rpc.my_new_project.request
2022-04-22 00:00:40.524195 (Thread-1): 00:00:40  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 00:00:40.524297 (Thread-1): 00:00:40  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with 
o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
)





-- final cte's
-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

from (
    
    select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      case
        when do.device = 'web' then 'desktop'
        when do.device in ('ios-app', 'android-app') then 'mobile-app'
        when do.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type,
      do.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join do
      on do.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 00:00:40.524377 (Thread-1): 00:00:40  Opening a new connection, currently in state init
2022-04-22 00:00:40.800440 (Thread-74): handling poll request
2022-04-22 00:00:40.800906 (Thread-74): 00:00:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf540520>]}
2022-04-22 00:00:40.801790 (Thread-74): sending response (<Response 7902 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:00:41.610235 (Thread-1): 00:00:41  Snowflake adapter: Snowflake query id: 01a3c400-0501-6083-0004-7d83048836c2
2022-04-22 00:00:41.610509 (Thread-1): 00:00:41  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 105 at position 20
invalid identifier 'D.DEVICE'
2022-04-22 00:00:41.610703 (Thread-1): 00:00:41  finished collecting timing info
2022-04-22 00:00:41.610903 (Thread-1): 00:00:41  On rpc.my_new_project.request: Close
2022-04-22 00:00:41.847899 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 105 at position 20
  invalid identifier 'D.DEVICE'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 105 at position 20
invalid identifier 'D.DEVICE'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 105 at position 20
  invalid identifier 'D.DEVICE'
2022-04-22 00:00:41.848948 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 105 at position 20\n  invalid identifier 'D.DEVICE'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith \r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n)\r\n\r\n\r\n\r\n\r\n\r\n-- final cte's\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nfrom (\r\n    \r\n    select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      case\r\n        when do.device = 'web' then 'desktop'\r\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type,\r\n      do.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join do\r\n      on do.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith \no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n)\n\n\n\n\n\n-- final cte's\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \n\nfrom (\n    \n    select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      case\n        when do.device = 'web' then 'desktop'\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type,\n      do.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join do\n      on do.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 105 at position 20\n  invalid identifier 'D.DEVICE'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith \r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n)\r\n\r\n\r\n\r\n\r\n\r\n-- final cte's\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \r\n\r\nfrom (\r\n    \r\n    select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      case\r\n        when do.device = 'web' then 'desktop'\r\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type,\r\n      do.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join do\r\n      on do.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith \no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n)\n\n\n\n\n\n-- final cte's\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount \n\nfrom (\n    \n    select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      case\n        when do.device = 'web' then 'desktop'\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type,\n      do.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join do\n      on do.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n  )\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 00:00:42.130940 (Thread-75): handling poll request
2022-04-22 00:00:42.131357 (Thread-75): 00:00:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf540700>]}
2022-04-22 00:00:42.132099 (Thread-75): sending response (<Response 41325 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:27.917691 (Thread-76): handling status request
2022-04-22 00:01:27.918115 (Thread-76): 00:01:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf53bb80>]}
2022-04-22 00:01:27.918675 (Thread-76): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:28.263894 (Thread-77): handling run_sql request
2022-04-22 00:01:28.264283 (Thread-77): 00:01:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf53b040>]}
2022-04-22 00:01:30.769536 (Thread-77): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:30.796455 (MainThread): 00:01:30  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c9b542c0-2e8b-4431-93b9-b8270a85d3c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e74096d00>]}
2022-04-22 00:01:30.796991 (MainThread): 00:01:30  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 00:01:30.797584 (Thread-1): 00:01:30  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 00:01:30.797731 (Thread-1): 00:01:30  Began compiling node rpc.my_new_project.request
2022-04-22 00:01:30.797824 (Thread-1): 00:01:30  Compiling rpc.my_new_project.request
2022-04-22 00:01:30.801312 (Thread-1): 00:01:30  finished collecting timing info
2022-04-22 00:01:30.801445 (Thread-1): 00:01:30  Began executing node rpc.my_new_project.request
2022-04-22 00:01:30.804935 (Thread-1): 00:01:30  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 00:01:30.805057 (Thread-1): 00:01:30  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with 
o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
)





-- final cte's
-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

from (
    
    select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      case
        when do.device = 'web' then 'desktop'
        when do.device in ('ios-app', 'android-app') then 'mobile-app'
        when do.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(do.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type,
      do.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join do
      on do.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
  )
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 00:01:30.805160 (Thread-1): 00:01:30  Opening a new connection, currently in state init
2022-04-22 00:01:31.188940 (Thread-78): handling poll request
2022-04-22 00:01:31.189459 (Thread-78): 00:01:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf5365b0>]}
2022-04-22 00:01:31.190388 (Thread-78): sending response (<Response 7904 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:32.661348 (Thread-79): handling poll request
2022-04-22 00:01:32.661732 (Thread-79): 00:01:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf536160>]}
2022-04-22 00:01:32.662186 (Thread-79): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:33.396596 (Thread-1): 00:01:33  SQL status: SUCCESS 500 in 2.59 seconds
2022-04-22 00:01:33.961517 (Thread-80): handling poll request
2022-04-22 00:01:33.961950 (Thread-80): 00:01:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf536ca0>]}
2022-04-22 00:01:33.962467 (Thread-80): sending response (<Response 670 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:33.964315 (Thread-1): 00:01:33  finished collecting timing info
2022-04-22 00:01:33.964596 (Thread-1): 00:01:33  On rpc.my_new_project.request: Close
2022-04-22 00:01:35.256522 (Thread-81): handling poll request
2022-04-22 00:01:35.256951 (Thread-81): 00:01:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf5fb730>]}
2022-04-22 00:01:35.265888 (Thread-81): sending response (<Response 154383 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:40.441298 (Thread-82): 00:01:40  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 00:01:40.441768 (Thread-82): 00:01:40  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 00:01:40.446470 (Thread-82): 00:01:40  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 00:01:40.489008 (Thread-82): 00:01:40  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aacce2490>]}
2022-04-22 00:01:41.337202 (Thread-83): handling status request
2022-04-22 00:01:41.337795 (Thread-83): 00:01:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaccd0a00>]}
2022-04-22 00:01:41.338253 (Thread-84): handling status request
2022-04-22 00:01:41.338864 (Thread-83): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:01:41.339169 (Thread-84): 00:01:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf540190>]}
2022-04-22 00:01:41.339886 (Thread-84): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:32.916725 (Thread-85): handling status request
2022-04-22 00:29:32.918419 (Thread-85): 00:29:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaccd0fa0>]}
2022-04-22 00:29:32.918908 (Thread-85): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:33.301865 (Thread-86): handling run_sql request
2022-04-22 00:29:33.302244 (Thread-86): 00:29:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaccd0b80>]}
2022-04-22 00:29:35.789685 (Thread-86): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:35.819314 (MainThread): 00:29:35  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '525a3076-7fb3-47db-bcf0-00e8cd7e8178', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a48bdcd60>]}
2022-04-22 00:29:35.819825 (MainThread): 00:29:35  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 00:29:35.820398 (Thread-1): 00:29:35  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 00:29:35.820583 (Thread-1): 00:29:35  Began compiling node rpc.my_new_project.request
2022-04-22 00:29:35.820683 (Thread-1): 00:29:35  Compiling rpc.my_new_project.request
2022-04-22 00:29:35.824117 (Thread-1): 00:29:35  finished collecting timing info
2022-04-22 00:29:35.824245 (Thread-1): 00:29:35  Began executing node rpc.my_new_project.request
2022-04-22 00:29:35.827726 (Thread-1): 00:29:35  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 00:29:35.827825 (Thread-1): 00:29:35  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with 
o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
),

-- final cte's

final as (

  select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,

      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      case
        when do.device = 'web' then 'desktop'
        when do.device in ('ios-app', 'android-app') then 'mobile-app'
        when do.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(do.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type,
      do.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join do
      on do.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
)

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 00:29:35.827907 (Thread-1): 00:29:35  Opening a new connection, currently in state init
2022-04-22 00:29:36.135547 (Thread-87): handling poll request
2022-04-22 00:29:36.136017 (Thread-87): 00:29:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1de1e50>]}
2022-04-22 00:29:36.136967 (Thread-87): sending response (<Response 7911 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:37.440787 (Thread-88): handling poll request
2022-04-22 00:29:37.441213 (Thread-88): 00:29:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1de1910>]}
2022-04-22 00:29:37.441707 (Thread-88): sending response (<Response 390 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:38.792410 (Thread-89): handling poll request
2022-04-22 00:29:38.792846 (Thread-89): 00:29:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1de1eb0>]}
2022-04-22 00:29:38.793364 (Thread-89): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:38.867715 (Thread-1): 00:29:38  SQL status: SUCCESS 500 in 3.04 seconds
2022-04-22 00:29:39.404786 (Thread-1): 00:29:39  finished collecting timing info
2022-04-22 00:29:39.405076 (Thread-1): 00:29:39  On rpc.my_new_project.request: Close
2022-04-22 00:29:40.185709 (Thread-90): handling poll request
2022-04-22 00:29:40.186096 (Thread-90): 00:29:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aacca6460>]}
2022-04-22 00:29:40.195102 (Thread-90): sending response (<Response 153907 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:44.815759 (Thread-91): 00:29:44  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 00:29:44.816200 (Thread-91): 00:29:44  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 00:29:44.820601 (Thread-91): 00:29:44  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 00:29:44.861030 (Thread-91): 00:29:44  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9409bac0>]}
2022-04-22 00:29:45.869694 (Thread-92): handling status request
2022-04-22 00:29:45.870079 (Thread-92): 00:29:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9408a760>]}
2022-04-22 00:29:45.870613 (Thread-92): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:46.275665 (Thread-93): handling status request
2022-04-22 00:29:46.276055 (Thread-93): 00:29:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cefd90>]}
2022-04-22 00:29:46.276512 (Thread-93): sending response (<Response 1562 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:55.114261 (Thread-94): 00:29:55  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 00:29:55.114685 (Thread-94): 00:29:55  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-22 00:29:55.118350 (Thread-94): 00:29:55  1603: static parser failed on _archive/test_loop.sql
2022-04-22 00:29:55.121629 (Thread-94): 00:29:55  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 00:29:55.168207 (Thread-94): 00:29:55  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a741907c0>]}
2022-04-22 00:29:55.814094 (Thread-95): handling status request
2022-04-22 00:29:55.814508 (Thread-95): 00:29:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9408a430>]}
2022-04-22 00:29:55.814997 (Thread-95): sending response (<Response 1859 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:29:56.171432 (Thread-96): handling status request
2022-04-22 00:29:56.171856 (Thread-96): 00:29:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9408a070>]}
2022-04-22 00:29:56.172355 (Thread-96): sending response (<Response 1859 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:30:45.506883 (Thread-97): 00:30:45  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 00:30:45.507103 (Thread-97): 00:30:45  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 00:30:45.512196 (Thread-97): 00:30:45  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d88b0>]}
2022-04-22 00:30:46.286894 (Thread-98): handling status request
2022-04-22 00:30:46.287338 (Thread-98): 00:30:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74169220>]}
2022-04-22 00:30:46.287816 (Thread-98): sending response (<Response 1241 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:30:46.523301 (Thread-99): handling status request
2022-04-22 00:30:46.523692 (Thread-99): 00:30:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7415ed60>]}
2022-04-22 00:30:46.547753 (Thread-99): sending response (<Response 1241 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:32:54.013343 (Thread-100): handling status request
2022-04-22 00:32:54.015138 (Thread-100): 00:32:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7415ec70>]}
2022-04-22 00:32:54.015633 (Thread-100): sending response (<Response 1219 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:32:54.022244 (Thread-101): handling list request
2022-04-22 00:32:54.022543 (Thread-101): 00:32:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7415e9a0>]}
2022-04-22 00:32:54.025893 (Thread-102): handling status request
2022-04-22 00:32:54.026613 (Thread-102): 00:32:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9408d640>]}
2022-04-22 00:32:54.027810 (Thread-102): sending response (<Response 1219 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:32:54.062512 (Thread-101): 00:32:54  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9408de50>]}
2022-04-22 00:32:54.035901 (Thread-103): handling list request
2022-04-22 00:32:54.062808 (Thread-101): 00:32:54  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 00:32:54.036067 (Thread-103): 00:32:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7417f100>]}
2022-04-22 00:32:54.063670 (Thread-103): 00:32:54  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a94091bb0>]}
2022-04-22 00:32:54.074368 (Thread-101): sending response (<Response 4003 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:32:54.063928 (Thread-103): 00:32:54  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 00:32:54.075278 (Thread-103): sending response (<Response 2952 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:33:44.131920 (Thread-104): 00:33:44  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 00:33:44.132165 (Thread-104): 00:33:44  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 00:33:44.138030 (Thread-104): 00:33:44  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7406d7f0>]}
2022-04-22 00:33:44.905512 (Thread-105): handling status request
2022-04-22 00:33:44.905916 (Thread-105): 00:33:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740a9310>]}
2022-04-22 00:33:44.906416 (Thread-105): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:33:45.344054 (Thread-106): handling status request
2022-04-22 00:33:45.344440 (Thread-106): 00:33:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740a9460>]}
2022-04-22 00:33:45.344910 (Thread-106): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:34:06.086198 (Thread-107): handling status request
2022-04-22 00:34:06.086613 (Thread-107): 00:34:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740a9040>]}
2022-04-22 00:34:06.087055 (Thread-107): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:34:09.173988 (Thread-108): 00:34:09  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 00:34:09.174203 (Thread-108): 00:34:09  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 00:34:09.179660 (Thread-108): 00:34:09  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aecfa0>]}
2022-04-22 00:34:10.193065 (Thread-109): handling status request
2022-04-22 00:34:10.193472 (Thread-109): 00:34:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74066700>]}
2022-04-22 00:34:10.193938 (Thread-109): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:34:10.343503 (Thread-110): handling status request
2022-04-22 00:34:10.343911 (Thread-110): 00:34:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74066520>]}
2022-04-22 00:34:10.344378 (Thread-110): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:36:03.298351 (Thread-111): handling status request
2022-04-22 00:36:03.300164 (Thread-111): 00:36:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74066460>]}
2022-04-22 00:36:03.300662 (Thread-111): sending response (<Response 1222 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:36:03.322141 (Thread-112): handling list request
2022-04-22 00:36:03.322512 (Thread-112): 00:36:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740662b0>]}
2022-04-22 00:36:03.359697 (Thread-112): 00:36:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740dc6a0>]}
2022-04-22 00:36:03.360134 (Thread-112): 00:36:03  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 00:36:03.365827 (Thread-112): sending response (<Response 1690 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:45:35.547621 (Thread-113): 00:45:35  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 00:45:35.549189 (Thread-113): 00:45:35  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 00:45:35.553882 (Thread-113): 00:45:35  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 00:45:35.601819 (Thread-113): 00:45:35  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aafd90>]}
2022-04-22 00:45:36.325115 (Thread-114): handling status request
2022-04-22 00:45:36.325513 (Thread-114): 00:45:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740c6040>]}
2022-04-22 00:45:36.325990 (Thread-114): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 00:45:36.410026 (Thread-115): handling status request
2022-04-22 00:45:36.410468 (Thread-115): 00:45:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a8eb20>]}
2022-04-22 00:45:36.410951 (Thread-115): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:14:59.575183 (Thread-116): 01:14:59  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:14:59.577292 (Thread-116): 01:14:59  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 01:14:59.581538 (Thread-116): 01:14:59  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 01:14:59.636314 (Thread-116): 01:14:59  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a48e20>]}
2022-04-22 01:15:00.323024 (Thread-117): handling status request
2022-04-22 01:15:00.323451 (Thread-117): 01:15:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d1ac0>]}
2022-04-22 01:15:00.323955 (Thread-117): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:15:00.373928 (Thread-118): handling status request
2022-04-22 01:15:00.374370 (Thread-118): 01:15:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d18e0>]}
2022-04-22 01:15:00.374859 (Thread-118): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:19:37.648299 (Thread-119): handling status request
2022-04-22 01:19:37.649986 (Thread-119): 01:19:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d17f0>]}
2022-04-22 01:19:37.650530 (Thread-119): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:19:37.977892 (Thread-120): handling run_sql request
2022-04-22 01:19:37.978309 (Thread-120): 01:19:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d14c0>]}
2022-04-22 01:19:40.489965 (Thread-120): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:19:40.520444 (MainThread): 01:19:40  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '083c69b7-8299-4cfe-b0c1-2c474f4cf82f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f210a2be0>]}
2022-04-22 01:19:40.521015 (MainThread): 01:19:40  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:19:40.521605 (Thread-1): 01:19:40  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:19:40.521750 (Thread-1): 01:19:40  Began compiling node rpc.my_new_project.request
2022-04-22 01:19:40.521846 (Thread-1): 01:19:40  Compiling rpc.my_new_project.request
2022-04-22 01:19:40.525395 (Thread-1): 01:19:40  finished collecting timing info
2022-04-22 01:19:40.525527 (Thread-1): 01:19:40  Began executing node rpc.my_new_project.request
2022-04-22 01:19:40.529185 (Thread-1): 01:19:40  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:19:40.529284 (Thread-1): 01:19:40  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those
renamed `d` to `do` for standarization

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device,
      case
        when do.device = 'web' then 'desktop'
        when do.device in ('ios-app', 'android-app') then 'mobile-app'
        when do.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(do.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
),

-- final cte's

final as (

  select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      do.purchase_device_type,
      do.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join do
      on do.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
)

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:19:40.529365 (Thread-1): 01:19:40  Opening a new connection, currently in state init
2022-04-22 01:19:40.793533 (Thread-121): handling poll request
2022-04-22 01:19:40.794043 (Thread-121): 01:19:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aaff70>]}
2022-04-22 01:19:40.795017 (Thread-121): sending response (<Response 7990 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:19:41.759511 (Thread-1): 01:19:41  Snowflake adapter: Snowflake query id: 01a3c44f-0501-5f4a-0004-7d830488a14e
2022-04-22 01:19:41.759743 (Thread-1): 01:19:41  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 27 at position 13
invalid identifier 'DO.DEVICE'
2022-04-22 01:19:41.759936 (Thread-1): 01:19:41  finished collecting timing info
2022-04-22 01:19:41.760141 (Thread-1): 01:19:41  On rpc.my_new_project.request: Close
2022-04-22 01:19:41.923601 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 27 at position 13
  invalid identifier 'DO.DEVICE'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 27 at position 13
invalid identifier 'DO.DEVICE'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 27 at position 13
  invalid identifier 'DO.DEVICE'
2022-04-22 01:19:41.924658 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 27 at position 13\n  invalid identifier 'DO.DEVICE'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\nrenamed `d` to `do` for standarization\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when do.device = 'web' then 'desktop'\r\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(do.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n),\r\n\r\n-- final cte's\r\n\r\nfinal as (\r\n\r\n  select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      do.purchase_device_type,\r\n      do.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join do\r\n      on do.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n)\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\nrenamed `d` to `do` for standarization\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when do.device = 'web' then 'desktop'\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(do.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n),\n\n-- final cte's\n\nfinal as (\n\n  select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      do.purchase_device_type,\n      do.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join do\n      on do.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n)\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 27 at position 13\n  invalid identifier 'DO.DEVICE'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\nrenamed `d` to `do` for standarization\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when do.device = 'web' then 'desktop'\r\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(do.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n),\r\n\r\n-- final cte's\r\n\r\nfinal as (\r\n\r\n  select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      do.purchase_device_type,\r\n      do.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join do\r\n      on do.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n)\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\nrenamed `d` to `do` for standarization\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when do.device = 'web' then 'desktop'\n        when do.device in ('ios-app', 'android-app') then 'mobile-app'\n        when do.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(do.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n),\n\n-- final cte's\n\nfinal as (\n\n  select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      do.purchase_device_type,\n      do.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join do\n      on do.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n)\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:19:42.103427 (Thread-122): handling poll request
2022-04-22 01:19:42.103815 (Thread-122): 01:19:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74020310>]}
2022-04-22 01:19:42.104481 (Thread-122): sending response (<Response 25340 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:19:43.419052 (Thread-123): handling poll request
2022-04-22 01:19:43.419449 (Thread-123): 01:19:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740201f0>]}
2022-04-22 01:19:43.420234 (Thread-123): sending response (<Response 41911 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:32.078142 (Thread-124): handling status request
2022-04-22 01:20:32.078570 (Thread-124): 01:20:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740209d0>]}
2022-04-22 01:20:32.079059 (Thread-124): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:32.411076 (Thread-125): handling run_sql request
2022-04-22 01:20:32.411496 (Thread-125): 01:20:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74020cd0>]}
2022-04-22 01:20:34.910878 (Thread-125): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:34.937924 (MainThread): 01:20:34  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8dedd9a2-2cf2-4611-80dd-ce861b8d96db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabc58edd00>]}
2022-04-22 01:20:34.938632 (MainThread): 01:20:34  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:20:34.939085 (Thread-1): 01:20:34  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:20:34.939217 (Thread-1): 01:20:34  Began compiling node rpc.my_new_project.request
2022-04-22 01:20:34.939309 (Thread-1): 01:20:34  Compiling rpc.my_new_project.request
2022-04-22 01:20:34.942714 (Thread-1): 01:20:34  finished collecting timing info
2022-04-22 01:20:34.942844 (Thread-1): 01:20:34  Began executing node rpc.my_new_project.request
2022-04-22 01:20:34.946366 (Thread-1): 01:20:34  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:20:34.946462 (Thread-1): 01:20:34  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those
renamed `d` to `do` for standarization

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(do.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
),

-- final cte's

final as (

  select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      do.purchase_device_type,
      do.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join do
      on do.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
)

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:20:34.946542 (Thread-1): 01:20:34  Opening a new connection, currently in state init
2022-04-22 01:20:35.202519 (Thread-126): handling poll request
2022-04-22 01:20:35.202993 (Thread-126): 01:20:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740c69a0>]}
2022-04-22 01:20:35.226146 (Thread-126): sending response (<Response 7988 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:35.938351 (Thread-1): 01:20:35  Snowflake adapter: Snowflake query id: 01a3c450-0501-6163-0004-7d8304887db6
2022-04-22 01:20:35.938589 (Thread-1): 01:20:35  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 20
invalid identifier 'DO.DEVICE'
2022-04-22 01:20:35.938790 (Thread-1): 01:20:35  finished collecting timing info
2022-04-22 01:20:35.938980 (Thread-1): 01:20:35  On rpc.my_new_project.request: Close
2022-04-22 01:20:36.113103 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 30 at position 20
  invalid identifier 'DO.DEVICE'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 30 at position 20
invalid identifier 'DO.DEVICE'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 30 at position 20
  invalid identifier 'DO.DEVICE'
2022-04-22 01:20:36.114227 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 30 at position 20\n  invalid identifier 'DO.DEVICE'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\nrenamed `d` to `do` for standarization\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(do.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n),\r\n\r\n-- final cte's\r\n\r\nfinal as (\r\n\r\n  select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      do.purchase_device_type,\r\n      do.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join do\r\n      on do.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n)\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\nrenamed `d` to `do` for standarization\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(do.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n),\n\n-- final cte's\n\nfinal as (\n\n  select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      do.purchase_device_type,\n      do.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join do\n      on do.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n)\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 30 at position 20\n  invalid identifier 'DO.DEVICE'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n-- logical cte's\r\n\r\n/*\r\n\r\nthere are a lot of left join sub-queries, here is where we will try to simplify those\r\nrenamed `d` to `do` for standarization\r\n\r\n*/\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(do.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n),\r\n\r\nfo as (\r\n  select\r\n    fo.user_id,\r\n    min(fo.order_id) as first_order_id\r\n  from o as fo\r\n  where fo.status != 'cancelled'\r\n  group by fo.user_id\r\n),\r\n\r\npa as (\r\n  select\r\n    order_id,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents else 0\r\n      end\r\n    ) as gross_tax_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_cents else 0\r\n      end\r\n    ) as gross_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then amount_shipping_cents else 0\r\n      end\r\n    ) as gross_shipping_amount_cents,\r\n  sum(case\r\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n      end\r\n    ) as gross_total_amount_cents\r\n  from p\r\n  group by order_id\r\n),\r\n\r\n-- final cte's\r\n\r\nfinal as (\r\n\r\n  select\r\n      o.order_id,\r\n      o.user_id,\r\n      o.created_at,\r\n      o.updated_at,\r\n      o.shipped_at,\r\n      o.currency,\r\n      o.status as order_status,\r\n      case\r\n        when o.status in (\r\n          'paid',\r\n          'completed',\r\n          'shipped'\r\n        ) then 'completed'\r\n        else o.status\r\n      end as order_status_category,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type,\r\n      o.shipping_method,\r\n      do.purchase_device_type,\r\n      do.device as purchase_device,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n      o.amount_total_cents,\r\n      pa.gross_total_amount_cents,\r\n      case\r\n        when o.currency = 'usd' then o.amount_total_cents\r\n        else pa.gross_total_amount_cents\r\n      end as total_amount_cents,\r\n      pa.gross_tax_amount_cents,\r\n      pa.gross_amount_cents,\r\n      pa.gross_shipping_amount_cents\r\n    from o\r\n\r\n    left join do\r\n      on do.order_id = o.order_id\r\n\r\n    left join fo\r\n      on o.user_id = fo.user_id\r\n\r\n    left join a \r\n      on a.order_id = o.order_id\r\n\r\n    left join pa\r\n      on pa.order_id = o.order_id\r\n)\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments),\n\n-- logical cte's\n\n/*\n\nthere are a lot of left join sub-queries, here is where we will try to simplify those\nrenamed `d` to `do` for standarization\n\n*/\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(do.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n),\n\nfo as (\n  select\n    fo.user_id,\n    min(fo.order_id) as first_order_id\n  from o as fo\n  where fo.status != 'cancelled'\n  group by fo.user_id\n),\n\npa as (\n  select\n    order_id,\n  sum(case\n        when status = 'completed' then tax_amount_cents else 0\n      end\n    ) as gross_tax_amount_cents,\n  sum(case\n        when status = 'completed' then amount_cents else 0\n      end\n    ) as gross_amount_cents,\n  sum(case\n        when status = 'completed' then amount_shipping_cents else 0\n      end\n    ) as gross_shipping_amount_cents,\n  sum(case\n        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n      end\n    ) as gross_total_amount_cents\n  from p\n  group by order_id\n),\n\n-- final cte's\n\nfinal as (\n\n  select\n      o.order_id,\n      o.user_id,\n      o.created_at,\n      o.updated_at,\n      o.shipped_at,\n      o.currency,\n      o.status as order_status,\n      case\n        when o.status in (\n          'paid',\n          'completed',\n          'shipped'\n        ) then 'completed'\n        else o.status\n      end as order_status_category,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type,\n      o.shipping_method,\n      do.purchase_device_type,\n      do.device as purchase_device,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n      o.amount_total_cents,\n      pa.gross_total_amount_cents,\n      case\n        when o.currency = 'usd' then o.amount_total_cents\n        else pa.gross_total_amount_cents\n      end as total_amount_cents,\n      pa.gross_tax_amount_cents,\n      pa.gross_amount_cents,\n      pa.gross_shipping_amount_cents\n    from o\n\n    left join do\n      on do.order_id = o.order_id\n\n    left join fo\n      on o.user_id = fo.user_id\n\n    left join a \n      on a.order_id = o.order_id\n\n    left join pa\n      on pa.order_id = o.order_id\n)\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:20:36.529078 (Thread-127): handling poll request
2022-04-22 01:20:36.529467 (Thread-127): 01:20:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740c6d90>]}
2022-04-22 01:20:36.530229 (Thread-127): sending response (<Response 41890 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:45.171986 (Thread-128): handling status request
2022-04-22 01:20:45.172369 (Thread-128): 01:20:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740c6fd0>]}
2022-04-22 01:20:45.172863 (Thread-128): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:45.493930 (Thread-129): handling run_sql request
2022-04-22 01:20:45.494340 (Thread-129): 01:20:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74020e20>]}
2022-04-22 01:20:48.024466 (Thread-129): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:48.055253 (MainThread): 01:20:48  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '302d7022-598c-4d97-903e-b45faeb0fd28', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99ffae0ca0>]}
2022-04-22 01:20:48.055759 (MainThread): 01:20:48  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:20:48.056331 (Thread-1): 01:20:48  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:20:48.056461 (Thread-1): 01:20:48  Began compiling node rpc.my_new_project.request
2022-04-22 01:20:48.056552 (Thread-1): 01:20:48  Compiling rpc.my_new_project.request
2022-04-22 01:20:48.059996 (Thread-1): 01:20:48  finished collecting timing info
2022-04-22 01:20:48.060124 (Thread-1): 01:20:48  Began executing node rpc.my_new_project.request
2022-04-22 01:20:48.063655 (Thread-1): 01:20:48  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:20:48.063750 (Thread-1): 01:20:48  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments),

-- logical cte's

/*

there are a lot of left join sub-queries, here is where we will try to simplify those
renamed `d` to `do` for standarization

*/

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type
  from d
  where d.type = 'order'
),

fo as (
  select
    fo.user_id,
    min(fo.order_id) as first_order_id
  from o as fo
  where fo.status != 'cancelled'
  group by fo.user_id
),

pa as (
  select
    order_id,
  sum(case
        when status = 'completed' then tax_amount_cents else 0
      end
    ) as gross_tax_amount_cents,
  sum(case
        when status = 'completed' then amount_cents else 0
      end
    ) as gross_amount_cents,
  sum(case
        when status = 'completed' then amount_shipping_cents else 0
      end
    ) as gross_shipping_amount_cents,
  sum(case
        when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
      end
    ) as gross_total_amount_cents
  from p
  group by order_id
),

-- final cte's

final as (

  select
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status as order_status,
      case
        when o.status in (
          'paid',
          'completed',
          'shipped'
        ) then 'completed'
        else o.status
      end as order_status_category,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type,
      o.shipping_method,
      do.purchase_device_type,
      do.device as purchase_device,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      case
        when o.currency = 'usd' then o.amount_total_cents
        else pa.gross_total_amount_cents
      end as total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    from o

    left join do
      on do.order_id = o.order_id

    left join fo
      on o.user_id = fo.user_id

    left join a 
      on a.order_id = o.order_id

    left join pa
      on pa.order_id = o.order_id
)

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:20:48.063831 (Thread-1): 01:20:48  Opening a new connection, currently in state init
2022-04-22 01:20:48.322056 (Thread-130): handling poll request
2022-04-22 01:20:48.322545 (Thread-130): 01:20:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a25fa0>]}
2022-04-22 01:20:48.323469 (Thread-130): sending response (<Response 7987 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:49.644571 (Thread-131): handling poll request
2022-04-22 01:20:49.644962 (Thread-131): 01:20:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a25af0>]}
2022-04-22 01:20:49.645443 (Thread-131): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:50.807419 (Thread-1): 01:20:50  SQL status: SUCCESS 500 in 2.74 seconds
2022-04-22 01:20:50.934162 (Thread-132): handling poll request
2022-04-22 01:20:50.934581 (Thread-132): 01:20:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a25190>]}
2022-04-22 01:20:50.935075 (Thread-132): sending response (<Response 670 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:20:51.321020 (Thread-1): 01:20:51  finished collecting timing info
2022-04-22 01:20:51.321301 (Thread-1): 01:20:51  On rpc.my_new_project.request: Close
2022-04-22 01:20:52.230098 (Thread-133): handling poll request
2022-04-22 01:20:52.230499 (Thread-133): 01:20:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a94154b20>]}
2022-04-22 01:20:52.239500 (Thread-133): sending response (<Response 153759 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:23:31.956780 (Thread-134): 01:23:31  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:23:31.958527 (Thread-134): 01:23:31  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 01:23:31.963143 (Thread-134): 01:23:31  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 01:23:32.009412 (Thread-134): 01:23:32  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fccc70>]}
2022-04-22 01:23:32.629780 (Thread-135): handling status request
2022-04-22 01:23:32.630172 (Thread-135): 01:23:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a64166d30>]}
2022-04-22 01:23:32.630695 (Thread-135): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:23:32.784916 (Thread-136): handling status request
2022-04-22 01:23:32.785293 (Thread-136): 01:23:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a64166ac0>]}
2022-04-22 01:23:32.785767 (Thread-136): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:24:44.846976 (Thread-137): handling status request
2022-04-22 01:24:44.848950 (Thread-137): 01:24:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a641669d0>]}
2022-04-22 01:24:44.849435 (Thread-137): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:24:45.190735 (Thread-138): handling run_sql request
2022-04-22 01:24:45.191154 (Thread-138): 01:24:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a64166820>]}
2022-04-22 01:24:47.692790 (Thread-138): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:24:47.720155 (MainThread): 01:24:47  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8b91fab-c141-4205-8486-9aab86d9a214', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f325dbf4bb0>]}
2022-04-22 01:24:47.720714 (MainThread): 01:24:47  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:24:47.721305 (Thread-1): 01:24:47  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:24:47.721441 (Thread-1): 01:24:47  Began compiling node rpc.my_new_project.request
2022-04-22 01:24:47.721533 (Thread-1): 01:24:47  Compiling rpc.my_new_project.request
2022-04-22 01:24:47.724095 (Thread-1): 01:24:47  finished collecting timing info
2022-04-22 01:24:47.724227 (Thread-1): 01:24:47  Began executing node rpc.my_new_project.request
2022-04-22 01:24:47.724776 (Thread-1): 01:24:47  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:24:47.724862 (Thread-1): 01:24:47  On rpc.my_new_project.request: -- list tables




d as (select * from raw.interview_sample_data.interview_devices)
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:24:47.724943 (Thread-1): 01:24:47  Opening a new connection, currently in state init
2022-04-22 01:24:48.024684 (Thread-139): handling poll request
2022-04-22 01:24:48.025144 (Thread-139): 01:24:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a20250>]}
2022-04-22 01:24:48.026098 (Thread-139): sending response (<Response 3810 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:24:48.863347 (Thread-1): 01:24:48  Snowflake adapter: Snowflake query id: 01a3c454-0501-6163-0004-7d8304887e7e
2022-04-22 01:24:48.863582 (Thread-1): 01:24:48  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'd'.
2022-04-22 01:24:48.863781 (Thread-1): 01:24:48  finished collecting timing info
2022-04-22 01:24:48.863980 (Thread-1): 01:24:48  On rpc.my_new_project.request: Close
2022-04-22 01:24:49.065558 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'd'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 1 at position 0 unexpected 'd'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 0 unexpected 'd'.
2022-04-22 01:24:49.066629 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'd'.", 'raw_sql': "-- list tables\r\n{% set tables = ['orders', 'devices', 'orders', 'addresses', 'payments'] %}\r\n\r\n{#\r\n\r\n-- basic test\r\n{% for t in tables %}\r\n    table name is: raw.interview_sample_data.interview_{{t}}\r\n{% endfor %}\r\n\r\n-- testing tables\r\n{%- for t in tables %}\r\n    {{t}} as ( select * from raw.interview_sample_data.interview_{{t}} ),\r\n{%- endfor %}\r\n\r\n\r\n\r\n{%- for t in tables %}\r\n    {{t}} as select * from { source('interview_sample_data', 'interview_'{{t}}) }\r\n{%- endfor %}\r\n\r\n#}\r\n\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }})\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': '-- list tables\n\n\n\n\nd as (select * from raw.interview_sample_data.interview_devices)\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 1 at position 0 unexpected 'd'.", 'raw_sql': "-- list tables\r\n{% set tables = ['orders', 'devices', 'orders', 'addresses', 'payments'] %}\r\n\r\n{#\r\n\r\n-- basic test\r\n{% for t in tables %}\r\n    table name is: raw.interview_sample_data.interview_{{t}}\r\n{% endfor %}\r\n\r\n-- testing tables\r\n{%- for t in tables %}\r\n    {{t}} as ( select * from raw.interview_sample_data.interview_{{t}} ),\r\n{%- endfor %}\r\n\r\n\r\n\r\n{%- for t in tables %}\r\n    {{t}} as select * from { source('interview_sample_data', 'interview_'{{t}}) }\r\n{%- endfor %}\r\n\r\n#}\r\n\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }})\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': '-- list tables\n\n\n\n\nd as (select * from raw.interview_sample_data.interview_devices)\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 01:24:49.331112 (Thread-140): handling poll request
2022-04-22 01:24:49.331508 (Thread-140): 01:24:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf5f6880>]}
2022-04-22 01:24:49.332109 (Thread-140): sending response (<Response 7994 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:24:50.624369 (Thread-141): handling poll request
2022-04-22 01:24:50.624789 (Thread-141): 01:24:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a940f4100>]}
2022-04-22 01:24:50.625450 (Thread-141): sending response (<Response 12159 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:25:02.175758 (Thread-142): handling status request
2022-04-22 01:25:02.176178 (Thread-142): 01:25:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a940e6610>]}
2022-04-22 01:25:02.176680 (Thread-142): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:25:02.495314 (Thread-143): handling run_sql request
2022-04-22 01:25:02.495735 (Thread-143): 01:25:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fccdc0>]}
2022-04-22 01:25:05.029591 (Thread-143): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:25:05.054673 (MainThread): 01:25:05  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '271973ff-8f46-41a2-98fa-9fd4512abc26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb991d22d30>]}
2022-04-22 01:25:05.055233 (MainThread): 01:25:05  Found 6 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:25:05.055832 (Thread-1): 01:25:05  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:25:05.055965 (Thread-1): 01:25:05  Began compiling node rpc.my_new_project.request
2022-04-22 01:25:05.056058 (Thread-1): 01:25:05  Compiling rpc.my_new_project.request
2022-04-22 01:25:05.058634 (Thread-1): 01:25:05  finished collecting timing info
2022-04-22 01:25:05.058764 (Thread-1): 01:25:05  Began executing node rpc.my_new_project.request
2022-04-22 01:25:05.059311 (Thread-1): 01:25:05  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:25:05.059399 (Thread-1): 01:25:05  On rpc.my_new_project.request: -- list tables




select * from raw.interview_sample_data.interview_devices
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:25:05.059480 (Thread-1): 01:25:05  Opening a new connection, currently in state init
2022-04-22 01:25:05.512454 (Thread-144): handling poll request
2022-04-22 01:25:05.512901 (Thread-144): 01:25:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fcbc70>]}
2022-04-22 01:25:05.513795 (Thread-144): sending response (<Response 3803 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:25:06.069269 (Thread-1): 01:25:06  SQL status: SUCCESS 500 in 1.01 seconds
2022-04-22 01:25:06.080434 (Thread-1): 01:25:06  finished collecting timing info
2022-04-22 01:25:06.080673 (Thread-1): 01:25:06  On rpc.my_new_project.request: Close
2022-04-22 01:25:06.823636 (Thread-145): handling poll request
2022-04-22 01:25:06.824024 (Thread-145): 01:25:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fccd90>]}
2022-04-22 01:25:06.826644 (Thread-145): sending response (<Response 31852 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:26:07.222831 (Thread-146): 01:26:07  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:26:07.223288 (Thread-146): 01:26:07  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-22 01:26:07.227384 (Thread-146): 01:26:07  1603: static parser failed on _archive/test_loop.sql
2022-04-22 01:26:07.231999 (Thread-146): 01:26:07  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 01:26:07.455173 (Thread-146): 01:26:07  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a940f4610>]}
2022-04-22 01:26:07.903263 (Thread-147): handling status request
2022-04-22 01:26:07.903659 (Thread-147): 01:26:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f85100>]}
2022-04-22 01:26:07.904151 (Thread-147): sending response (<Response 1864 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:26:07.938970 (Thread-148): handling status request
2022-04-22 01:26:07.939335 (Thread-148): 01:26:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fba670>]}
2022-04-22 01:26:07.939810 (Thread-148): sending response (<Response 1864 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:28:14.051364 (Thread-149): 01:28:14  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 01:28:14.053023 (Thread-149): 01:28:14  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 01:28:14.059462 (Thread-149): 01:28:14  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cc13d0>]}
2022-04-22 01:28:14.758423 (Thread-150): handling status request
2022-04-22 01:28:14.758812 (Thread-150): 01:28:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f04070>]}
2022-04-22 01:28:14.759270 (Thread-150): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:28:14.846377 (Thread-151): handling status request
2022-04-22 01:28:14.846781 (Thread-151): 01:28:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38efae80>]}
2022-04-22 01:28:14.847244 (Thread-151): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:33:53.948322 (Thread-152): 01:33:53  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 01:33:53.950012 (Thread-152): 01:33:53  Partial parsing: added file: my_new_project://models/staging/sources.sql
2022-04-22 01:33:53.953995 (Thread-152): 01:33:53  1699: static parser successfully parsed staging/sources.sql
2022-04-22 01:33:53.999628 (Thread-152): 01:33:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cb6340>]}
2022-04-22 01:33:54.896024 (Thread-153): handling status request
2022-04-22 01:33:54.896438 (Thread-153): 01:33:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a94096a60>]}
2022-04-22 01:33:54.896930 (Thread-153): sending response (<Response 1558 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:33:54.902834 (Thread-154): handling status request
2022-04-22 01:33:54.903103 (Thread-154): 01:33:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a940966a0>]}
2022-04-22 01:33:54.903503 (Thread-154): sending response (<Response 1558 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:34:30.593824 (Thread-155): handling status request
2022-04-22 01:34:30.594240 (Thread-155): 01:34:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a94096b20>]}
2022-04-22 01:34:30.594746 (Thread-155): sending response (<Response 1558 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:34:30.891153 (Thread-156): handling run_sql request
2022-04-22 01:34:30.891537 (Thread-156): 01:34:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a94096250>]}
2022-04-22 01:34:33.382868 (Thread-156): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:34:33.408194 (MainThread): 01:34:33  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b90a9fd-aad2-4d55-8da2-533666f52233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f238ab6fdf0>]}
2022-04-22 01:34:33.431164 (MainThread): 01:34:33  Found 7 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:34:33.431823 (Thread-1): 01:34:33  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:34:33.431954 (Thread-1): 01:34:33  Began compiling node rpc.my_new_project.request
2022-04-22 01:34:33.432061 (Thread-1): 01:34:33  Compiling rpc.my_new_project.request
2022-04-22 01:34:33.434995 (Thread-1): 01:34:33  finished collecting timing info
2022-04-22 01:34:33.435127 (Thread-1): 01:34:33  Began executing node rpc.my_new_project.request
2022-04-22 01:34:33.435868 (Thread-1): 01:34:33  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:34:33.435957 (Thread-1): 01:34:33  On rpc.my_new_project.request: with

o as (select * from raw.interview_sample_data.interview_orders),
d as (select * from raw.interview_sample_data.interview_devices),
a as (select * from raw.interview_sample_data.interview_addresses),
p as (select * from raw.interview_sample_data.interview_payments)
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:34:33.436038 (Thread-1): 01:34:33  Opening a new connection, currently in state init
2022-04-22 01:34:33.716211 (Thread-157): handling poll request
2022-04-22 01:34:33.716667 (Thread-157): 01:34:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9409b0a0>]}
2022-04-22 01:34:33.717529 (Thread-157): sending response (<Response 3994 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:34:34.476108 (Thread-1): 01:34:34  Snowflake adapter: Snowflake query id: 01a3c45e-0501-6083-0004-7d8304888f66
2022-04-22 01:34:34.476342 (Thread-1): 01:34:34  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 7 at position 0 unexpected 'limit'.
2022-04-22 01:34:34.476538 (Thread-1): 01:34:34  finished collecting timing info
2022-04-22 01:34:34.476735 (Thread-1): 01:34:34  On rpc.my_new_project.request: Close
2022-04-22 01:34:34.767133 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 7 at position 0 unexpected 'limit'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 7 at position 0 unexpected 'limit'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 7 at position 0 unexpected 'limit'.
2022-04-22 01:34:34.768141 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 7 at position 0 unexpected 'limit'.", 'raw_sql': "with\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}})\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'with\n\no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments)\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 7 at position 0 unexpected 'limit'.", 'raw_sql': "with\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\na as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\np as (select * from {{ source('interview_sample_data', 'interview_payments')}})\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'with\n\no as (select * from raw.interview_sample_data.interview_orders),\nd as (select * from raw.interview_sample_data.interview_devices),\na as (select * from raw.interview_sample_data.interview_addresses),\np as (select * from raw.interview_sample_data.interview_payments)\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 01:34:35.025945 (Thread-158): handling poll request
2022-04-22 01:34:35.026362 (Thread-158): 01:34:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9409b610>]}
2022-04-22 01:34:35.027031 (Thread-158): sending response (<Response 12056 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:34:51.771091 (Thread-159): 01:34:51  Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
2022-04-22 01:34:51.771432 (Thread-159): 01:34:51  Partial parsing: deleted file: my_new_project://models/staging/sources.sql
2022-04-22 01:34:51.816745 (Thread-159): 01:34:51  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a641669a0>]}
2022-04-22 01:34:52.456932 (Thread-160): handling status request
2022-04-22 01:34:52.457326 (Thread-160): 01:34:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cef040>]}
2022-04-22 01:34:52.457827 (Thread-160): sending response (<Response 1259 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:34:52.535201 (Thread-161): handling status request
2022-04-22 01:34:52.535547 (Thread-161): 01:34:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a940ed760>]}
2022-04-22 01:34:52.535978 (Thread-161): sending response (<Response 1259 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:35:19.875569 (Thread-162): 01:35:19  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 01:35:19.875805 (Thread-162): 01:35:19  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 01:35:19.881994 (Thread-162): 01:35:19  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cd3e80>]}
2022-04-22 01:35:20.606205 (Thread-163): handling status request
2022-04-22 01:35:20.606654 (Thread-163): 01:35:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d02e0>]}
2022-04-22 01:35:20.607131 (Thread-163): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:35:20.609016 (Thread-164): handling status request
2022-04-22 01:35:20.609274 (Thread-164): 01:35:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d0100>]}
2022-04-22 01:35:20.609621 (Thread-164): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:36:15.134843 (Thread-165): 01:36:15  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 01:36:15.135073 (Thread-165): 01:36:15  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 01:36:15.140680 (Thread-165): 01:36:15  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65b09bb0>]}
2022-04-22 01:36:16.214815 (Thread-166): handling status request
2022-04-22 01:36:16.215205 (Thread-166): 01:36:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cce460>]}
2022-04-22 01:36:16.215664 (Thread-166): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:36:16.230105 (Thread-167): handling status request
2022-04-22 01:36:16.230417 (Thread-167): 01:36:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cce280>]}
2022-04-22 01:36:16.230833 (Thread-167): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:36:45.560648 (Thread-168): 01:36:45  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 01:36:45.561014 (Thread-168): 01:36:45  Partial parsing: added file: my_new_project://models/staging/stg_orders.sql
2022-04-22 01:36:45.565009 (Thread-168): 01:36:45  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 01:36:45.612132 (Thread-168): 01:36:45  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf635fd0>]}
2022-04-22 01:36:46.239513 (Thread-169): handling status request
2022-04-22 01:36:46.239907 (Thread-169): 01:36:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fb5700>]}
2022-04-22 01:36:46.240386 (Thread-169): sending response (<Response 1564 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:36:46.287319 (Thread-170): handling status request
2022-04-22 01:36:46.287680 (Thread-170): 01:36:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74066610>]}
2022-04-22 01:36:46.288132 (Thread-170): sending response (<Response 1564 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:37:49.948230 (Thread-171): handling status request
2022-04-22 01:37:49.949915 (Thread-171): 01:37:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7406b190>]}
2022-04-22 01:37:49.950436 (Thread-171): sending response (<Response 1564 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:37:50.276295 (Thread-172): handling run_sql request
2022-04-22 01:37:50.276676 (Thread-172): 01:37:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab45535e0>]}
2022-04-22 01:37:52.755728 (Thread-172): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:37:52.782861 (MainThread): 01:37:52  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '120c8c29-8218-4359-bb04-faba1ba87a40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f349403e490>]}
2022-04-22 01:37:52.783378 (MainThread): 01:37:52  Found 7 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:37:52.783937 (Thread-1): 01:37:52  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:37:52.784071 (Thread-1): 01:37:52  Began compiling node rpc.my_new_project.request
2022-04-22 01:37:52.784176 (Thread-1): 01:37:52  Compiling rpc.my_new_project.request
2022-04-22 01:37:52.786216 (Thread-1): 01:37:52  finished collecting timing info
2022-04-22 01:37:52.786377 (Thread-1): 01:37:52  Began executing node rpc.my_new_project.request
2022-04-22 01:37:52.786919 (Thread-1): 01:37:52  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:37:52.787009 (Thread-1): 01:37:52  On rpc.my_new_project.request: with o as (select * from raw.interview_sample_data.interview_orders),

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:37:52.787090 (Thread-1): 01:37:52  Opening a new connection, currently in state init
2022-04-22 01:37:53.078299 (Thread-173): handling poll request
2022-04-22 01:37:53.078765 (Thread-173): 01:37:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a64166e20>]}
2022-04-22 01:37:53.079667 (Thread-173): sending response (<Response 3810 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:37:53.736472 (Thread-1): 01:37:53  Snowflake adapter: Snowflake query id: 01a3c461-0501-6163-0004-7d830488b236
2022-04-22 01:37:53.736706 (Thread-1): 01:37:53  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 3 at position 0 unexpected 'select'.
2022-04-22 01:37:53.736897 (Thread-1): 01:37:53  finished collecting timing info
2022-04-22 01:37:53.737094 (Thread-1): 01:37:53  On rpc.my_new_project.request: Close
2022-04-22 01:37:53.923368 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 3 at position 0 unexpected 'select'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 3 at position 0 unexpected 'select'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 3 at position 0 unexpected 'select'.
2022-04-22 01:37:53.924358 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 3 at position 0 unexpected 'select'.", 'raw_sql': "with o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n\r\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'with o as (select * from raw.interview_sample_data.interview_orders),\n\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 3 at position 0 unexpected 'select'.", 'raw_sql': "with o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n\r\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'with o as (select * from raw.interview_sample_data.interview_orders),\n\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 01:37:54.388920 (Thread-174): handling poll request
2022-04-22 01:37:54.389314 (Thread-174): 01:37:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aeff40>]}
2022-04-22 01:37:54.389968 (Thread-174): sending response (<Response 10592 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:00.601226 (Thread-175): handling status request
2022-04-22 01:38:00.601620 (Thread-175): 01:38:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aefdf0>]}
2022-04-22 01:38:00.602145 (Thread-175): sending response (<Response 1564 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:00.917761 (Thread-176): handling run_sql request
2022-04-22 01:38:00.918153 (Thread-176): 01:38:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aef970>]}
2022-04-22 01:38:03.394686 (Thread-176): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:03.419584 (MainThread): 01:38:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '150b1aab-4402-416a-8f85-08396c412372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3841f3bf40>]}
2022-04-22 01:38:03.427007 (MainThread): 01:38:03  Found 7 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:38:03.427678 (Thread-1): 01:38:03  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:38:03.427813 (Thread-1): 01:38:03  Began compiling node rpc.my_new_project.request
2022-04-22 01:38:03.427906 (Thread-1): 01:38:03  Compiling rpc.my_new_project.request
2022-04-22 01:38:03.430014 (Thread-1): 01:38:03  finished collecting timing info
2022-04-22 01:38:03.430149 (Thread-1): 01:38:03  Began executing node rpc.my_new_project.request
2022-04-22 01:38:03.430739 (Thread-1): 01:38:03  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:38:03.430831 (Thread-1): 01:38:03  On rpc.my_new_project.request: with o as (select * from raw.interview_sample_data.interview_orders)

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:38:03.430913 (Thread-1): 01:38:03  Opening a new connection, currently in state init
2022-04-22 01:38:03.699933 (Thread-177): handling poll request
2022-04-22 01:38:03.700379 (Thread-177): 01:38:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a940e6760>]}
2022-04-22 01:38:03.701302 (Thread-177): sending response (<Response 3809 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:04.932181 (Thread-1): 01:38:04  SQL status: SUCCESS 500 in 1.5 seconds
2022-04-22 01:38:04.945968 (Thread-1): 01:38:04  finished collecting timing info
2022-04-22 01:38:04.946216 (Thread-1): 01:38:04  On rpc.my_new_project.request: Close
2022-04-22 01:38:05.059517 (Thread-178): handling poll request
2022-04-22 01:38:05.059918 (Thread-178): 01:38:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cd9100>]}
2022-04-22 01:38:05.060461 (Thread-178): sending response (<Response 1370 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:06.368682 (Thread-179): handling poll request
2022-04-22 01:38:06.369070 (Thread-179): 01:38:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf635c70>]}
2022-04-22 01:38:06.372292 (Thread-179): sending response (<Response 62173 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:15.893843 (Thread-180): 01:38:15  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 01:38:15.894074 (Thread-180): 01:38:15  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 01:38:15.900217 (Thread-180): 01:38:15  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38edaf40>]}
2022-04-22 01:38:16.654606 (Thread-181): handling status request
2022-04-22 01:38:16.655012 (Thread-181): 01:38:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f024f0>]}
2022-04-22 01:38:16.655500 (Thread-181): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:38:16.672963 (Thread-182): handling status request
2022-04-22 01:38:16.673224 (Thread-182): 01:38:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f022b0>]}
2022-04-22 01:38:16.673599 (Thread-182): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:01.407913 (Thread-183): 01:39:01  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 01:39:01.408319 (Thread-183): 01:39:01  Partial parsing: added file: my_new_project://models/staging/stg_devices.sql
2022-04-22 01:39:01.412386 (Thread-183): 01:39:01  1699: static parser successfully parsed staging/stg_devices.sql
2022-04-22 01:39:01.453157 (Thread-183): 01:39:01  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38e00670>]}
2022-04-22 01:39:02.168507 (Thread-184): handling status request
2022-04-22 01:39:02.168899 (Thread-184): 01:39:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed1790>]}
2022-04-22 01:39:02.169371 (Thread-184): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:02.284009 (Thread-185): handling status request
2022-04-22 01:39:02.284404 (Thread-185): 01:39:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed15b0>]}
2022-04-22 01:39:02.284875 (Thread-185): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:23.874804 (Thread-186): handling status request
2022-04-22 01:39:23.875236 (Thread-186): 01:39:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed1400>]}
2022-04-22 01:39:23.898543 (Thread-186): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:24.231280 (Thread-187): handling run_sql request
2022-04-22 01:39:24.231663 (Thread-187): 01:39:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed10a0>]}
2022-04-22 01:39:26.711916 (Thread-187): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:26.736497 (MainThread): 01:39:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3c12b419-de30-4f71-bd66-933bc4504677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9009f0e50>]}
2022-04-22 01:39:26.737011 (MainThread): 01:39:26  Found 8 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:39:26.737583 (Thread-1): 01:39:26  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:39:26.737715 (Thread-1): 01:39:26  Began compiling node rpc.my_new_project.request
2022-04-22 01:39:26.737823 (Thread-1): 01:39:26  Compiling rpc.my_new_project.request
2022-04-22 01:39:26.739962 (Thread-1): 01:39:26  finished collecting timing info
2022-04-22 01:39:26.740086 (Thread-1): 01:39:26  Began executing node rpc.my_new_project.request
2022-04-22 01:39:26.741073 (Thread-1): 01:39:26  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:39:26.741162 (Thread-1): 01:39:26  On rpc.my_new_project.request: with

o as (select * from raw.interview_sample_data.interview_orders)

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type
  from d
  where d.type = 'order'
)

select * from do
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:39:26.741243 (Thread-1): 01:39:26  Opening a new connection, currently in state init
2022-04-22 01:39:27.046059 (Thread-188): handling poll request
2022-04-22 01:39:27.046572 (Thread-188): 01:39:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9406b3a0>]}
2022-04-22 01:39:27.047513 (Thread-188): sending response (<Response 4419 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:27.896286 (Thread-1): 01:39:27  Snowflake adapter: Snowflake query id: 01a3c463-0501-6163-0004-7d830488b23e
2022-04-22 01:39:27.896519 (Thread-1): 01:39:27  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 0 unexpected 'do'.
syntax error line 11 at position 19 unexpected 'rows'.
2022-04-22 01:39:27.896708 (Thread-1): 01:39:27  finished collecting timing info
2022-04-22 01:39:27.896903 (Thread-1): 01:39:27  On rpc.my_new_project.request: Close
2022-04-22 01:39:28.090937 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 0 unexpected 'do'.
  syntax error line 11 at position 19 unexpected 'rows'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 5 at position 0 unexpected 'do'.
syntax error line 11 at position 19 unexpected 'rows'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 0 unexpected 'do'.
  syntax error line 11 at position 19 unexpected 'rows'.
2022-04-22 01:39:28.092010 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 5 at position 0 unexpected 'do'.\n  syntax error line 11 at position 19 unexpected 'rows'.", 'raw_sql': "with\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }})\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n)\r\n\r\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n\no as (select * from raw.interview_sample_data.interview_orders)\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n)\n\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 5 at position 0 unexpected 'do'.\n  syntax error line 11 at position 19 unexpected 'rows'.", 'raw_sql': "with\r\n\r\no as (select * from {{ source('interview_sample_data', 'interview_orders') }})\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n)\r\n\r\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n\no as (select * from raw.interview_sample_data.interview_orders)\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n)\n\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:39:28.371351 (Thread-189): handling poll request
2022-04-22 01:39:28.371942 (Thread-189): 01:39:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a94058220>]}
2022-04-22 01:39:28.372844 (Thread-189): sending response (<Response 15493 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:58.177003 (Thread-190): handling status request
2022-04-22 01:39:58.177399 (Thread-190): 01:39:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38e6ef10>]}
2022-04-22 01:39:58.177910 (Thread-190): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:39:58.500974 (Thread-191): handling run_sql request
2022-04-22 01:39:58.501363 (Thread-191): 01:39:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38e6e460>]}
2022-04-22 01:40:00.990583 (Thread-191): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:01.015313 (MainThread): 01:40:01  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1392cb2a-dfa0-4578-b613-00f93355ee6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f90cbc74be0>]}
2022-04-22 01:40:01.015868 (MainThread): 01:40:01  Found 8 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:40:01.016463 (Thread-1): 01:40:01  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:40:01.016607 (Thread-1): 01:40:01  Began compiling node rpc.my_new_project.request
2022-04-22 01:40:01.016706 (Thread-1): 01:40:01  Compiling rpc.my_new_project.request
2022-04-22 01:40:01.018914 (Thread-1): 01:40:01  finished collecting timing info
2022-04-22 01:40:01.019045 (Thread-1): 01:40:01  Began executing node rpc.my_new_project.request
2022-04-22 01:40:01.020065 (Thread-1): 01:40:01  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:40:01.020155 (Thread-1): 01:40:01  On rpc.my_new_project.request: with

d as (select * from raw.interview_sample_data.interview_devices)

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type
  from d
  where d.type = 'order'
)

select * from do
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:40:01.020236 (Thread-1): 01:40:01  Opening a new connection, currently in state init
2022-04-22 01:40:01.323732 (Thread-192): handling poll request
2022-04-22 01:40:01.324200 (Thread-192): 01:40:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf6455e0>]}
2022-04-22 01:40:01.325116 (Thread-192): sending response (<Response 4420 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:01.978867 (Thread-1): 01:40:01  Snowflake adapter: Snowflake query id: 01a3c464-0501-6163-0004-7d830488b242
2022-04-22 01:40:01.979099 (Thread-1): 01:40:01  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 0 unexpected 'do'.
syntax error line 11 at position 19 unexpected 'rows'.
2022-04-22 01:40:01.979292 (Thread-1): 01:40:01  finished collecting timing info
2022-04-22 01:40:01.979491 (Thread-1): 01:40:01  On rpc.my_new_project.request: Close
2022-04-22 01:40:02.179808 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 0 unexpected 'do'.
  syntax error line 11 at position 19 unexpected 'rows'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 5 at position 0 unexpected 'do'.
syntax error line 11 at position 19 unexpected 'rows'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 0 unexpected 'do'.
  syntax error line 11 at position 19 unexpected 'rows'.
2022-04-22 01:40:02.180820 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 5 at position 0 unexpected 'do'.\n  syntax error line 11 at position 19 unexpected 'rows'.", 'raw_sql': "with\r\n\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }})\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n)\r\n\r\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n\nd as (select * from raw.interview_sample_data.interview_devices)\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n)\n\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 5 at position 0 unexpected 'do'.\n  syntax error line 11 at position 19 unexpected 'rows'.", 'raw_sql': "with\r\n\r\nd as (select * from {{ source('interview_sample_data', 'interview_devices') }})\r\n\r\ndo as (\r\n  select distinct\r\n    cast(d.type_id as float) as order_id,\r\n    first_value(d.device) over (\r\n      partition by d.type_id\r\n      order by\r\n      d.created_at rows between unbounded preceding\r\n      and unbounded following\r\n      ) as device,\r\n      case\r\n        when d.device = 'web' then 'desktop'\r\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n        when nullif(d.device, '') is null then 'unknown'\r\n        else 'error'\r\n      end as purchase_device_type\r\n  from d\r\n  where d.type = 'order'\r\n)\r\n\r\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n\nd as (select * from raw.interview_sample_data.interview_devices)\n\ndo as (\n  select distinct\n    cast(d.type_id as float) as order_id,\n    first_value(d.device) over (\n      partition by d.type_id\n      order by\n      d.created_at rows between unbounded preceding\n      and unbounded following\n      ) as device,\n      case\n        when d.device = 'web' then 'desktop'\n        when d.device in ('ios-app', 'android-app') then 'mobile-app'\n        when d.device in ('mobile', 'tablet') then 'mobile-web'\n        when nullif(d.device, '') is null then 'unknown'\n        else 'error'\n      end as purchase_device_type\n  from d\n  where d.type = 'order'\n)\n\nselect * from do\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:40:02.650672 (Thread-193): handling poll request
2022-04-22 01:40:02.651055 (Thread-193): 01:40:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38fb5c40>]}
2022-04-22 01:40:02.651741 (Thread-193): sending response (<Response 15500 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:24.161035 (Thread-194): handling status request
2022-04-22 01:40:24.161438 (Thread-194): 01:40:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf635eb0>]}
2022-04-22 01:40:24.161999 (Thread-194): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:24.477577 (Thread-195): handling run_sql request
2022-04-22 01:40:24.478006 (Thread-195): 01:40:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f02850>]}
2022-04-22 01:40:26.974372 (Thread-195): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:27.002038 (MainThread): 01:40:27  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f596016f-2f22-4496-8193-006c50161709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf64d73be0>]}
2022-04-22 01:40:27.002623 (MainThread): 01:40:27  Found 8 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:40:27.003232 (Thread-1): 01:40:27  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:40:27.003364 (Thread-1): 01:40:27  Began compiling node rpc.my_new_project.request
2022-04-22 01:40:27.003474 (Thread-1): 01:40:27  Compiling rpc.my_new_project.request
2022-04-22 01:40:27.005678 (Thread-1): 01:40:27  finished collecting timing info
2022-04-22 01:40:27.005806 (Thread-1): 01:40:27  Began executing node rpc.my_new_project.request
2022-04-22 01:40:27.006881 (Thread-1): 01:40:27  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:40:27.006972 (Thread-1): 01:40:27  On rpc.my_new_project.request: with

d as (select * from raw.interview_sample_data.interview_devices),

do as (
  select distinct
    cast(d.type_id as float) as order_id,
    first_value(d.device) over (
      partition by d.type_id
      order by
      d.created_at rows between unbounded preceding
      and unbounded following
      ) as device,
      case
        when d.device = 'web' then 'desktop'
        when d.device in ('ios-app', 'android-app') then 'mobile-app'
        when d.device in ('mobile', 'tablet') then 'mobile-web'
        when nullif(d.device, '') is null then 'unknown'
        else 'error'
      end as purchase_device_type
  from d
  where d.type = 'order'
)

select * from do
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:40:27.007054 (Thread-1): 01:40:27  Opening a new connection, currently in state init
2022-04-22 01:40:27.284403 (Thread-196): handling poll request
2022-04-22 01:40:27.284872 (Thread-196): 01:40:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed1880>]}
2022-04-22 01:40:27.285839 (Thread-196): sending response (<Response 4421 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:28.592086 (Thread-197): handling poll request
2022-04-22 01:40:28.592484 (Thread-197): 01:40:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f71670>]}
2022-04-22 01:40:28.592953 (Thread-197): sending response (<Response 392 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:28.626007 (Thread-1): 01:40:28  SQL status: SUCCESS 500 in 1.62 seconds
2022-04-22 01:40:28.633564 (Thread-1): 01:40:28  finished collecting timing info
2022-04-22 01:40:28.633788 (Thread-1): 01:40:28  On rpc.my_new_project.request: Close
2022-04-22 01:40:29.886374 (Thread-198): handling poll request
2022-04-22 01:40:29.886800 (Thread-198): 01:40:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f658e0>]}
2022-04-22 01:40:29.888569 (Thread-198): sending response (<Response 22251 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:47.801844 (Thread-199): 01:40:47  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:40:47.802347 (Thread-199): 01:40:47  Partial parsing: updated file: my_new_project://models/staging/stg_devices.sql
2022-04-22 01:40:47.806446 (Thread-199): 01:40:47  1699: static parser successfully parsed staging/stg_devices.sql
2022-04-22 01:40:47.851497 (Thread-199): 01:40:47  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38df3e80>]}
2022-04-22 01:40:48.604503 (Thread-200): handling status request
2022-04-22 01:40:48.604895 (Thread-200): 01:40:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dff3a0>]}
2022-04-22 01:40:48.605393 (Thread-200): sending response (<Response 1568 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:40:48.633983 (Thread-201): handling status request
2022-04-22 01:40:48.634323 (Thread-201): 01:40:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dffa60>]}
2022-04-22 01:40:48.634758 (Thread-201): sending response (<Response 1568 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:41:08.122014 (Thread-202): 01:41:08  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:41:08.122474 (Thread-202): 01:41:08  Partial parsing: updated file: my_new_project://models/staging/stg_devices.sql
2022-04-22 01:41:08.126215 (Thread-202): 01:41:08  1699: static parser successfully parsed staging/stg_devices.sql
2022-04-22 01:41:08.167923 (Thread-202): 01:41:08  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38d11fa0>]}
2022-04-22 01:41:08.796742 (Thread-203): handling status request
2022-04-22 01:41:08.797174 (Thread-203): 01:41:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f71be0>]}
2022-04-22 01:41:08.797651 (Thread-203): sending response (<Response 1568 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:41:08.849882 (Thread-204): handling status request
2022-04-22 01:41:08.850193 (Thread-204): 01:41:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38e87bb0>]}
2022-04-22 01:41:08.850643 (Thread-204): sending response (<Response 1568 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:41:12.107537 (Thread-205): 01:41:12  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:41:12.107935 (Thread-205): 01:41:12  Partial parsing: updated file: my_new_project://models/staging/stg_orders.sql
2022-04-22 01:41:12.111540 (Thread-205): 01:41:12  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 01:41:12.152039 (Thread-205): 01:41:12  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ceffd0>]}
2022-04-22 01:41:12.754644 (Thread-206): handling status request
2022-04-22 01:41:12.755027 (Thread-206): 01:41:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dc5310>]}
2022-04-22 01:41:12.755515 (Thread-206): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:41:12.801415 (Thread-207): handling status request
2022-04-22 01:41:12.801701 (Thread-207): 01:41:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dc5c10>]}
2022-04-22 01:41:12.802115 (Thread-207): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:42:03.009768 (Thread-208): 01:42:03  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 01:42:03.010180 (Thread-208): 01:42:03  Partial parsing: added file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 01:42:03.014008 (Thread-208): 01:42:03  1699: static parser successfully parsed staging/stg_addresses.sql
2022-04-22 01:42:03.055271 (Thread-208): 01:42:03  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c3c5e0>]}
2022-04-22 01:42:03.968066 (Thread-209): handling status request
2022-04-22 01:42:03.968455 (Thread-209): 01:42:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cc5a00>]}
2022-04-22 01:42:03.968929 (Thread-209): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:42:03.983226 (Thread-210): handling status request
2022-04-22 01:42:03.983567 (Thread-210): 01:42:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cb5eb0>]}
2022-04-22 01:42:03.984007 (Thread-210): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:42:50.521210 (Thread-211): 01:42:50  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:42:50.521620 (Thread-211): 01:42:50  Partial parsing: updated file: my_new_project://models/staging/stg_devices.sql
2022-04-22 01:42:50.525314 (Thread-211): 01:42:50  1699: static parser successfully parsed staging/stg_devices.sql
2022-04-22 01:42:50.567110 (Thread-211): 01:42:50  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c1d700>]}
2022-04-22 01:42:51.268044 (Thread-212): handling status request
2022-04-22 01:42:51.268431 (Thread-212): 01:42:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c9ccd0>]}
2022-04-22 01:42:51.268906 (Thread-212): sending response (<Response 1568 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:42:51.295358 (Thread-213): handling status request
2022-04-22 01:42:51.300550 (Thread-213): 01:42:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c9caf0>]}
2022-04-22 01:42:51.301057 (Thread-213): sending response (<Response 1568 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:42:56.282951 (Thread-214): 01:42:56  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:42:56.283365 (Thread-214): 01:42:56  Partial parsing: updated file: my_new_project://models/staging/stg_orders.sql
2022-04-22 01:42:56.287611 (Thread-214): 01:42:56  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 01:42:56.332194 (Thread-214): 01:42:56  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b9e2b0>]}
2022-04-22 01:42:56.997635 (Thread-215): handling status request
2022-04-22 01:42:56.998044 (Thread-215): 01:42:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c59340>]}
2022-04-22 01:42:56.998570 (Thread-215): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:42:57.214060 (Thread-216): handling status request
2022-04-22 01:42:57.214487 (Thread-216): 01:42:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c59790>]}
2022-04-22 01:42:57.238212 (Thread-216): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:43:23.332247 (Thread-217): 01:43:23  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:43:23.332660 (Thread-217): 01:43:23  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 01:43:23.336800 (Thread-217): 01:43:23  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 01:43:23.377629 (Thread-217): 01:43:23  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b4a1c0>]}
2022-04-22 01:43:24.302812 (Thread-218): handling status request
2022-04-22 01:43:24.303209 (Thread-218): 01:43:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b954f0>]}
2022-04-22 01:43:24.303683 (Thread-218): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:43:24.332365 (Thread-219): handling status request
2022-04-22 01:43:24.332733 (Thread-219): 01:43:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b953a0>]}
2022-04-22 01:43:24.333176 (Thread-219): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:44:09.534018 (Thread-220): handling status request
2022-04-22 01:44:09.534512 (Thread-220): 01:44:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b95670>]}
2022-04-22 01:44:09.534994 (Thread-220): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:44:09.849109 (Thread-221): handling run_sql request
2022-04-22 01:44:09.849507 (Thread-221): 01:44:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b95190>]}
2022-04-22 01:44:12.360248 (Thread-221): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:44:12.385244 (MainThread): 01:44:12  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b759c2cf-1c5e-46f1-9016-3d0ba2ae344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f574aef4970>]}
2022-04-22 01:44:12.406718 (MainThread): 01:44:12  Found 9 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:44:12.407365 (Thread-1): 01:44:12  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:44:12.407541 (Thread-1): 01:44:12  Began compiling node rpc.my_new_project.request
2022-04-22 01:44:12.407647 (Thread-1): 01:44:12  Compiling rpc.my_new_project.request
2022-04-22 01:44:12.410076 (Thread-1): 01:44:12  finished collecting timing info
2022-04-22 01:44:12.410220 (Thread-1): 01:44:12  Began executing node rpc.my_new_project.request
2022-04-22 01:44:12.411394 (Thread-1): 01:44:12  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:44:12.411502 (Thread-1): 01:44:12  On rpc.my_new_project.request: with
    a as (select * from raw.interview_sample_data.interview_addresses),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from po
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:44:12.411584 (Thread-1): 01:44:12  Opening a new connection, currently in state init
2022-04-22 01:44:12.676868 (Thread-222): handling poll request
2022-04-22 01:44:12.677302 (Thread-222): 01:44:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b4a3d0>]}
2022-04-22 01:44:12.678215 (Thread-222): sending response (<Response 4484 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:44:13.390240 (Thread-1): 01:44:13  Snowflake adapter: Snowflake query id: 01a3c468-0501-6083-0004-7d830488c1a2
2022-04-22 01:44:13.390515 (Thread-1): 01:44:13  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'P' does not exist or not authorized.
2022-04-22 01:44:13.390713 (Thread-1): 01:44:13  finished collecting timing info
2022-04-22 01:44:13.390912 (Thread-1): 01:44:13  On rpc.my_new_project.request: Close
2022-04-22 01:44:13.593464 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'P' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'P' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'P' does not exist or not authorized.
2022-04-22 01:44:13.594510 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'P' does not exist or not authorized.", 'raw_sql': "with\r\n    a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n\r\n    pa as (\r\n    select\r\n        order_id,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n        ) as gross_tax_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_cents else 0\r\n        end\r\n        ) as gross_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n        ) as gross_shipping_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n        ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    )\r\n\r\nselect * from po\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    a as (select * from raw.interview_sample_data.interview_addresses),\n\n    pa as (\n    select\n        order_id,\n    sum(case\n            when status = 'completed' then tax_amount_cents else 0\n        end\n        ) as gross_tax_amount_cents,\n    sum(case\n            when status = 'completed' then amount_cents else 0\n        end\n        ) as gross_amount_cents,\n    sum(case\n            when status = 'completed' then amount_shipping_cents else 0\n        end\n        ) as gross_shipping_amount_cents,\n    sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n        ) as gross_total_amount_cents\n    from p\n    group by order_id\n    )\n\nselect * from po\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'P' does not exist or not authorized.", 'raw_sql': "with\r\n    a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n\r\n    pa as (\r\n    select\r\n        order_id,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n        ) as gross_tax_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_cents else 0\r\n        end\r\n        ) as gross_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n        ) as gross_shipping_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n        ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    )\r\n\r\nselect * from po\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    a as (select * from raw.interview_sample_data.interview_addresses),\n\n    pa as (\n    select\n        order_id,\n    sum(case\n            when status = 'completed' then tax_amount_cents else 0\n        end\n        ) as gross_tax_amount_cents,\n    sum(case\n            when status = 'completed' then amount_cents else 0\n        end\n        ) as gross_amount_cents,\n    sum(case\n            when status = 'completed' then amount_shipping_cents else 0\n        end\n        ) as gross_shipping_amount_cents,\n    sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n        ) as gross_total_amount_cents\n    from p\n    group by order_id\n    )\n\nselect * from po\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:44:13.989956 (Thread-223): handling poll request
2022-04-22 01:44:13.990427 (Thread-223): 01:44:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b4aeb0>]}
2022-04-22 01:44:13.991101 (Thread-223): sending response (<Response 15511 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:44:18.385565 (Thread-224): 01:44:18  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:44:18.386044 (Thread-224): 01:44:18  Partial parsing: updated file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 01:44:18.390332 (Thread-224): 01:44:18  1699: static parser successfully parsed staging/stg_addresses.sql
2022-04-22 01:44:18.431399 (Thread-224): 01:44:18  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38af1fd0>]}
2022-04-22 01:44:19.014380 (Thread-225): handling status request
2022-04-22 01:44:19.014771 (Thread-225): 01:44:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ac4f10>]}
2022-04-22 01:44:19.015304 (Thread-225): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:44:19.071275 (Thread-226): handling status request
2022-04-22 01:44:19.071689 (Thread-226): 01:44:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dc1a60>]}
2022-04-22 01:44:19.072143 (Thread-226): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:16.307484 (Thread-227): handling status request
2022-04-22 01:45:16.307880 (Thread-227): 01:45:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c39c40>]}
2022-04-22 01:45:16.308337 (Thread-227): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:16.620684 (Thread-228): handling run_sql request
2022-04-22 01:45:16.621070 (Thread-228): 01:45:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b11520>]}
2022-04-22 01:45:19.184539 (Thread-228): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:19.209102 (MainThread): 01:45:19  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0f53351b-0bd3-400c-a257-8e05d87ff936', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f200ddb3730>]}
2022-04-22 01:45:19.209634 (MainThread): 01:45:19  Found 9 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:45:19.210231 (Thread-1): 01:45:19  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:45:19.210397 (Thread-1): 01:45:19  Began compiling node rpc.my_new_project.request
2022-04-22 01:45:19.210495 (Thread-1): 01:45:19  Compiling rpc.my_new_project.request
2022-04-22 01:45:19.212636 (Thread-1): 01:45:19  finished collecting timing info
2022-04-22 01:45:19.212764 (Thread-1): 01:45:19  Began executing node rpc.my_new_project.request
2022-04-22 01:45:19.213846 (Thread-1): 01:45:19  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:45:19.213934 (Thread-1): 01:45:19  On rpc.my_new_project.request: with
    p as (select * from raw.interview_sample_data.interview_payments)

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:45:19.214017 (Thread-1): 01:45:19  Opening a new connection, currently in state init
2022-04-22 01:45:19.532180 (Thread-229): handling poll request
2022-04-22 01:45:19.532646 (Thread-229): 01:45:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38aed490>]}
2022-04-22 01:45:19.533576 (Thread-229): sending response (<Response 4482 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:20.225718 (Thread-1): 01:45:20  Snowflake adapter: Snowflake query id: 01a3c469-0501-6083-0004-7d830488c1a6
2022-04-22 01:45:20.225949 (Thread-1): 01:45:20  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 4 at position 4 unexpected 'pa'.
2022-04-22 01:45:20.226156 (Thread-1): 01:45:20  finished collecting timing info
2022-04-22 01:45:20.226398 (Thread-1): 01:45:20  On rpc.my_new_project.request: Close
2022-04-22 01:45:20.416909 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 4 unexpected 'pa'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 4 at position 4 unexpected 'pa'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 4 unexpected 'pa'.
2022-04-22 01:45:20.417922 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 4 unexpected 'pa'.", 'raw_sql': "with\r\n    p as (select * from {{ source('interview_sample_data', 'interview_payments')}})\r\n\r\n    pa as (\r\n    select\r\n        order_id,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n        ) as gross_tax_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_cents else 0\r\n        end\r\n        ) as gross_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n        ) as gross_shipping_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n        ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    )\r\n\r\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    p as (select * from raw.interview_sample_data.interview_payments)\n\n    pa as (\n    select\n        order_id,\n    sum(case\n            when status = 'completed' then tax_amount_cents else 0\n        end\n        ) as gross_tax_amount_cents,\n    sum(case\n            when status = 'completed' then amount_cents else 0\n        end\n        ) as gross_amount_cents,\n    sum(case\n            when status = 'completed' then amount_shipping_cents else 0\n        end\n        ) as gross_shipping_amount_cents,\n    sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n        ) as gross_total_amount_cents\n    from p\n    group by order_id\n    )\n\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 4 unexpected 'pa'.", 'raw_sql': "with\r\n    p as (select * from {{ source('interview_sample_data', 'interview_payments')}})\r\n\r\n    pa as (\r\n    select\r\n        order_id,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n        ) as gross_tax_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_cents else 0\r\n        end\r\n        ) as gross_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n        ) as gross_shipping_amount_cents,\r\n    sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n        ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    )\r\n\r\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    p as (select * from raw.interview_sample_data.interview_payments)\n\n    pa as (\n    select\n        order_id,\n    sum(case\n            when status = 'completed' then tax_amount_cents else 0\n        end\n        ) as gross_tax_amount_cents,\n    sum(case\n            when status = 'completed' then amount_cents else 0\n        end\n        ) as gross_amount_cents,\n    sum(case\n            when status = 'completed' then amount_shipping_cents else 0\n        end\n        ) as gross_shipping_amount_cents,\n    sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n        ) as gross_total_amount_cents\n    from p\n    group by order_id\n    )\n\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:45:20.850217 (Thread-230): handling poll request
2022-04-22 01:45:20.850657 (Thread-230): 01:45:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b4a070>]}
2022-04-22 01:45:20.851274 (Thread-230): sending response (<Response 15539 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:23.192429 (Thread-231): handling status request
2022-04-22 01:45:23.192808 (Thread-231): 01:45:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38aed940>]}
2022-04-22 01:45:23.193288 (Thread-231): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:23.512910 (Thread-232): handling run_sql request
2022-04-22 01:45:23.513308 (Thread-232): 01:45:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38aed670>]}
2022-04-22 01:45:25.998191 (Thread-232): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:26.023563 (MainThread): 01:45:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aaebdd6f-ecf2-414b-8b32-1eb4b78b8be8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4356aa7fd0>]}
2022-04-22 01:45:26.024100 (MainThread): 01:45:26  Found 9 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:45:26.024680 (Thread-1): 01:45:26  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:45:26.024816 (Thread-1): 01:45:26  Began compiling node rpc.my_new_project.request
2022-04-22 01:45:26.024907 (Thread-1): 01:45:26  Compiling rpc.my_new_project.request
2022-04-22 01:45:26.027072 (Thread-1): 01:45:26  finished collecting timing info
2022-04-22 01:45:26.027202 (Thread-1): 01:45:26  Began executing node rpc.my_new_project.request
2022-04-22 01:45:26.028270 (Thread-1): 01:45:26  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:45:26.028360 (Thread-1): 01:45:26  On rpc.my_new_project.request: with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:45:26.028442 (Thread-1): 01:45:26  Opening a new connection, currently in state init
2022-04-22 01:45:26.337186 (Thread-233): handling poll request
2022-04-22 01:45:26.337623 (Thread-233): 01:45:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38aeebe0>]}
2022-04-22 01:45:26.338580 (Thread-233): sending response (<Response 4483 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:27.659747 (Thread-234): handling poll request
2022-04-22 01:45:27.660120 (Thread-234): 01:45:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38aeedc0>]}
2022-04-22 01:45:27.660579 (Thread-234): sending response (<Response 394 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:27.774958 (Thread-1): 01:45:27  SQL status: SUCCESS 500 in 1.75 seconds
2022-04-22 01:45:27.788748 (Thread-1): 01:45:27  finished collecting timing info
2022-04-22 01:45:27.788986 (Thread-1): 01:45:27  On rpc.my_new_project.request: Close
2022-04-22 01:45:28.966843 (Thread-235): handling poll request
2022-04-22 01:45:28.967267 (Thread-235): 01:45:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38aee6d0>]}
2022-04-22 01:45:28.970670 (Thread-235): sending response (<Response 24749 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:44.811866 (Thread-236): 01:45:44  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 01:45:44.812273 (Thread-236): 01:45:44  Partial parsing: added file: my_new_project://models/staging/stg_payments.sql
2022-04-22 01:45:44.812416 (Thread-236): 01:45:44  Partial parsing: deleted file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 01:45:44.816572 (Thread-236): 01:45:44  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 01:45:44.857726 (Thread-236): 01:45:44  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389f0f10>]}
2022-04-22 01:45:45.535300 (Thread-237): handling status request
2022-04-22 01:45:45.535701 (Thread-237): 01:45:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf635dc0>]}
2022-04-22 01:45:45.536215 (Thread-237): sending response (<Response 1890 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:45:45.544693 (Thread-238): handling status request
2022-04-22 01:45:45.544977 (Thread-238): 01:45:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6cb4880>]}
2022-04-22 01:45:45.545385 (Thread-238): sending response (<Response 1890 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:46:33.190443 (Thread-239): 01:46:33  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 01:46:33.190817 (Thread-239): 01:46:33  Partial parsing: added file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 01:46:33.194555 (Thread-239): 01:46:33  1699: static parser successfully parsed staging/stg_addresses.sql
2022-04-22 01:46:33.236061 (Thread-239): 01:46:33  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388fdfa0>]}
2022-04-22 01:46:34.029394 (Thread-240): handling status request
2022-04-22 01:46:34.029780 (Thread-240): 01:46:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389ca6d0>]}
2022-04-22 01:46:34.030306 (Thread-240): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:46:34.063208 (Thread-241): handling status request
2022-04-22 01:46:34.063565 (Thread-241): 01:46:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389ca4f0>]}
2022-04-22 01:46:34.064011 (Thread-241): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:44.770886 (Thread-242): handling status request
2022-04-22 01:48:44.771971 (Thread-242): 01:48:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389ca3d0>]}
2022-04-22 01:48:44.772462 (Thread-242): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:45.085961 (Thread-243): handling run_sql request
2022-04-22 01:48:45.086390 (Thread-243): 01:48:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389ca190>]}
2022-04-22 01:48:47.602864 (Thread-243): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:47.631241 (MainThread): 01:48:47  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b785b47-ee37-4dc4-bfd9-4f81b1f43f19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f574d7b58b0>]}
2022-04-22 01:48:47.631831 (MainThread): 01:48:47  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:48:47.632461 (Thread-1): 01:48:47  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:48:47.632600 (Thread-1): 01:48:47  Began compiling node rpc.my_new_project.request
2022-04-22 01:48:47.632701 (Thread-1): 01:48:47  Compiling rpc.my_new_project.request
2022-04-22 01:48:47.634881 (Thread-1): 01:48:47  finished collecting timing info
2022-04-22 01:48:47.635008 (Thread-1): 01:48:47  Began executing node rpc.my_new_project.request
2022-04-22 01:48:47.635592 (Thread-1): 01:48:47  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:48:47.635681 (Thread-1): 01:48:47  On rpc.my_new_project.request: with
    a as (select * from raw.interview_sample_data.interview_addresses)

select * from a
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:48:47.635762 (Thread-1): 01:48:47  Opening a new connection, currently in state init
2022-04-22 01:48:47.963376 (Thread-244): handling poll request
2022-04-22 01:48:47.963847 (Thread-244): 01:48:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dff190>]}
2022-04-22 01:48:47.964761 (Thread-244): sending response (<Response 3821 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:49.218225 (Thread-1): 01:48:49  SQL status: SUCCESS 500 in 1.58 seconds
2022-04-22 01:48:49.228240 (Thread-1): 01:48:49  finished collecting timing info
2022-04-22 01:48:49.228487 (Thread-1): 01:48:49  On rpc.my_new_project.request: Close
2022-04-22 01:48:49.270155 (Thread-245): handling poll request
2022-04-22 01:48:49.270565 (Thread-245): 01:48:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38d855b0>]}
2022-04-22 01:48:49.271081 (Thread-245): sending response (<Response 1374 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:50.570934 (Thread-246): handling poll request
2022-04-22 01:48:50.571315 (Thread-246): 01:48:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389c0d00>]}
2022-04-22 01:48:50.596587 (Thread-246): sending response (<Response 44536 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:53.288223 (Thread-247): 01:48:53  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:48:53.288684 (Thread-247): 01:48:53  Partial parsing: updated file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 01:48:53.293486 (Thread-247): 01:48:53  1699: static parser successfully parsed staging/stg_addresses.sql
2022-04-22 01:48:53.335791 (Thread-247): 01:48:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38855f10>]}
2022-04-22 01:48:54.040344 (Thread-248): handling status request
2022-04-22 01:48:54.040776 (Thread-248): 01:48:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38977220>]}
2022-04-22 01:48:54.041259 (Thread-248): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:48:54.089445 (Thread-249): handling status request
2022-04-22 01:48:54.089827 (Thread-249): 01:48:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388afe80>]}
2022-04-22 01:48:54.090340 (Thread-249): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:50:37.041477 (Thread-250): 01:50:37  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:50:37.042475 (Thread-250): 01:50:37  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 01:50:37.046840 (Thread-250): 01:50:37  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 01:50:37.090144 (Thread-250): 01:50:37  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387f04f0>]}
2022-04-22 01:50:37.796364 (Thread-251): handling status request
2022-04-22 01:50:37.796793 (Thread-251): 01:50:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d4b20>]}
2022-04-22 01:50:37.797292 (Thread-251): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:50:37.838577 (Thread-252): handling status request
2022-04-22 01:50:37.838960 (Thread-252): 01:50:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d4a90>]}
2022-04-22 01:50:37.839409 (Thread-252): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:31.407061 (Thread-253): 01:54:31  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:54:31.407917 (Thread-253): 01:54:31  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 01:54:31.412129 (Thread-253): 01:54:31  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 01:54:31.452555 (Thread-253): 01:54:31  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b88b50>]}
2022-04-22 01:54:31.953535 (Thread-254): handling status request
2022-04-22 01:54:31.953924 (Thread-254): 01:54:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d1370>]}
2022-04-22 01:54:31.954452 (Thread-254): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:32.040557 (Thread-255): handling status request
2022-04-22 01:54:32.040911 (Thread-255): 01:54:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d1190>]}
2022-04-22 01:54:32.041355 (Thread-255): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:35.712939 (Thread-256): handling status request
2022-04-22 01:54:35.713327 (Thread-256): 01:54:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d10d0>]}
2022-04-22 01:54:35.713785 (Thread-256): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:36.032851 (Thread-257): handling run_sql request
2022-04-22 01:54:36.033238 (Thread-257): 01:54:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388fc070>]}
2022-04-22 01:54:38.592770 (Thread-257): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:38.619957 (MainThread): 01:54:38  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64d3ad74-26bb-4f37-b89b-f31891e18e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad88a36790>]}
2022-04-22 01:54:38.620479 (MainThread): 01:54:38  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:54:38.621061 (Thread-1): 01:54:38  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:54:38.621198 (Thread-1): 01:54:38  Began compiling node rpc.my_new_project.request
2022-04-22 01:54:38.621304 (Thread-1): 01:54:38  Compiling rpc.my_new_project.request
2022-04-22 01:54:38.624658 (Thread-1): 01:54:38  finished collecting timing info
2022-04-22 01:54:38.624786 (Thread-1): 01:54:38  Began executing node rpc.my_new_project.request
2022-04-22 01:54:38.628651 (Thread-1): 01:54:38  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:54:38.628751 (Thread-1): 01:54:38  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a

  )


  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:54:38.628834 (Thread-1): 01:54:38  Opening a new connection, currently in state init
2022-04-22 01:54:38.935767 (Thread-258): handling poll request
2022-04-22 01:54:38.936209 (Thread-258): 01:54:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3884ba00>]}
2022-04-22 01:54:38.937148 (Thread-258): sending response (<Response 8449 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:39.600833 (Thread-1): 01:54:39  Snowflake adapter: Snowflake query id: 01a3c472-0501-6163-0004-7d830488b56a
2022-04-22 01:54:39.601072 (Thread-1): 01:54:39  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.
syntax error line 90 at position 2 unexpected 'final'.
2022-04-22 01:54:39.601270 (Thread-1): 01:54:39  finished collecting timing info
2022-04-22 01:54:39.601471 (Thread-1): 01:54:39  On rpc.my_new_project.request: Close
2022-04-22 01:54:39.781561 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
  syntax error line 90 at position 2 unexpected 'final'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.
syntax error line 90 at position 2 unexpected 'final'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
  syntax error line 90 at position 2 unexpected 'final'.
2022-04-22 01:54:39.782695 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.\n  syntax error line 90 at position 2 unexpected 'final'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n\r\n  )\r\n\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n\n  )\n\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.\n  syntax error line 90 at position 2 unexpected 'final'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n\r\n  )\r\n\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n\n  )\n\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:54:40.236198 (Thread-259): handling poll request
2022-04-22 01:54:40.236582 (Thread-259): 01:54:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3884bb20>]}
2022-04-22 01:54:40.237341 (Thread-259): sending response (<Response 45653 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:48.319153 (Thread-260): handling status request
2022-04-22 01:54:48.319546 (Thread-260): 01:54:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38850280>]}
2022-04-22 01:54:48.320057 (Thread-260): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:48.624272 (Thread-261): handling run_sql request
2022-04-22 01:54:48.624679 (Thread-261): 01:54:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38850670>]}
2022-04-22 01:54:51.110579 (Thread-261): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:51.139368 (MainThread): 01:54:51  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8b254a0-9ee4-4b1b-8d56-cf1edb18b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd734a1790>]}
2022-04-22 01:54:51.139970 (MainThread): 01:54:51  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:54:51.140586 (Thread-1): 01:54:51  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:54:51.140726 (Thread-1): 01:54:51  Began compiling node rpc.my_new_project.request
2022-04-22 01:54:51.140827 (Thread-1): 01:54:51  Compiling rpc.my_new_project.request
2022-04-22 01:54:51.144349 (Thread-1): 01:54:51  finished collecting timing info
2022-04-22 01:54:51.144483 (Thread-1): 01:54:51  Began executing node rpc.my_new_project.request
2022-04-22 01:54:51.148369 (Thread-1): 01:54:51  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:54:51.148469 (Thread-1): 01:54:51  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a

  ),


  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:54:51.148550 (Thread-1): 01:54:51  Opening a new connection, currently in state init
2022-04-22 01:54:51.411704 (Thread-262): handling poll request
2022-04-22 01:54:51.412180 (Thread-262): 01:54:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38855e20>]}
2022-04-22 01:54:51.413103 (Thread-262): sending response (<Response 8450 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:54:52.066991 (Thread-1): 01:54:52  Snowflake adapter: Snowflake query id: 01a3c472-0501-6083-0004-7d830488c3ea
2022-04-22 01:54:52.067223 (Thread-1): 01:54:52  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 01:54:52.067419 (Thread-1): 01:54:52  finished collecting timing info
2022-04-22 01:54:52.067612 (Thread-1): 01:54:52  On rpc.my_new_project.request: Close
2022-04-22 01:54:52.236656 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 01:54:52.237793 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n\r\n  ),\r\n\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n\n  ),\n\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n\r\n  ),\r\n\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n\n  ),\n\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:54:52.725239 (Thread-263): handling poll request
2022-04-22 01:54:52.725635 (Thread-263): 01:54:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab6d3cb20>]}
2022-04-22 01:54:52.726492 (Thread-263): sending response (<Response 45256 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:55:50.592289 (Thread-264): handling status request
2022-04-22 01:55:50.593152 (Thread-264): 01:55:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a389ce070>]}
2022-04-22 01:55:50.593667 (Thread-264): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:55:50.907746 (Thread-265): handling run_sql request
2022-04-22 01:55:50.908160 (Thread-265): 01:55:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3884be50>]}
2022-04-22 01:55:53.427315 (Thread-265): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:55:53.450059 (MainThread): 01:55:53  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa552615-edd4-439b-954d-e093aeec6023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe10aeaa6a0>]}
2022-04-22 01:55:53.450613 (MainThread): 01:55:53  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:55:53.451228 (Thread-1): 01:55:53  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:55:53.451365 (Thread-1): 01:55:53  Began compiling node rpc.my_new_project.request
2022-04-22 01:55:53.451458 (Thread-1): 01:55:53  Compiling rpc.my_new_project.request
2022-04-22 01:55:53.454848 (Thread-1): 01:55:53  finished collecting timing info
2022-04-22 01:55:53.454976 (Thread-1): 01:55:53  Began executing node rpc.my_new_project.request
2022-04-22 01:55:53.458868 (Thread-1): 01:55:53  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:55:53.458967 (Thread-1): 01:55:53  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:55:53.459049 (Thread-1): 01:55:53  Opening a new connection, currently in state init
2022-04-22 01:55:53.754150 (Thread-266): handling poll request
2022-04-22 01:55:53.754645 (Thread-266): 01:55:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a64057070>]}
2022-04-22 01:55:53.755570 (Thread-266): sending response (<Response 8446 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:55:54.501517 (Thread-1): 01:55:54  Snowflake adapter: Snowflake query id: 01a3c473-0501-6163-0004-7d830488b666
2022-04-22 01:55:54.501753 (Thread-1): 01:55:54  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 01:55:54.501941 (Thread-1): 01:55:54  finished collecting timing info
2022-04-22 01:55:54.502138 (Thread-1): 01:55:54  On rpc.my_new_project.request: Close
2022-04-22 01:55:54.714295 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 01:55:54.715407 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:55:55.079509 (Thread-267): handling poll request
2022-04-22 01:55:55.079895 (Thread-267): 01:55:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388f8d00>]}
2022-04-22 01:55:55.080656 (Thread-267): sending response (<Response 45204 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:56:01.144935 (Thread-268): handling status request
2022-04-22 01:56:01.145342 (Thread-268): 01:56:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388f8d90>]}
2022-04-22 01:56:01.145873 (Thread-268): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:56:01.466888 (Thread-269): handling compile_sql request
2022-04-22 01:56:01.467281 (Thread-269): 01:56:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388f8e20>]}
2022-04-22 01:56:03.975883 (Thread-269): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:56:04.003708 (MainThread): 01:56:04  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a692ecdc-cf46-4393-9e38-f01ba9a48648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5c7da8be0>]}
2022-04-22 01:56:04.004270 (MainThread): 01:56:04  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:56:04.004892 (Thread-1): 01:56:04  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:56:04.005030 (Thread-1): 01:56:04  Began compiling node rpc.my_new_project.request
2022-04-22 01:56:04.005128 (Thread-1): 01:56:04  Compiling rpc.my_new_project.request
2022-04-22 01:56:04.008678 (Thread-1): 01:56:04  finished collecting timing info
2022-04-22 01:56:04.008807 (Thread-1): 01:56:04  Began executing node rpc.my_new_project.request
2022-04-22 01:56:04.008904 (Thread-1): 01:56:04  finished collecting timing info
2022-04-22 01:56:04.278827 (Thread-270): handling poll request
2022-04-22 01:56:04.279268 (Thread-270): 01:56:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387ef160>]}
2022-04-22 01:56:04.280612 (Thread-270): sending response (<Response 25255 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:57:17.101707 (Thread-271): handling status request
2022-04-22 01:57:17.102150 (Thread-271): 01:57:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388530d0>]}
2022-04-22 01:57:17.102727 (Thread-271): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:57:17.424977 (Thread-272): handling run_sql request
2022-04-22 01:57:17.425371 (Thread-272): 01:57:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387ef730>]}
2022-04-22 01:57:19.936052 (Thread-272): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:57:19.964965 (MainThread): 01:57:19  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6676b81-58ab-4986-a3e7-0dbde25f2529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38818496d0>]}
2022-04-22 01:57:19.965506 (MainThread): 01:57:19  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:57:19.966109 (Thread-1): 01:57:19  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:57:19.966239 (Thread-1): 01:57:19  Began compiling node rpc.my_new_project.request
2022-04-22 01:57:19.966369 (Thread-1): 01:57:19  Compiling rpc.my_new_project.request
2022-04-22 01:57:19.969704 (Thread-1): 01:57:19  finished collecting timing info
2022-04-22 01:57:19.969831 (Thread-1): 01:57:19  Began executing node rpc.my_new_project.request
2022-04-22 01:57:19.973632 (Thread-1): 01:57:19  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:57:19.973731 (Thread-1): 01:57:19  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:57:19.973814 (Thread-1): 01:57:19  Opening a new connection, currently in state init
2022-04-22 01:57:20.262196 (Thread-273): handling poll request
2022-04-22 01:57:20.262688 (Thread-273): 01:57:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d40d0>]}
2022-04-22 01:57:20.263640 (Thread-273): sending response (<Response 8446 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:57:20.881453 (Thread-1): 01:57:20  Snowflake adapter: Snowflake query id: 01a3c475-0501-6083-0004-7d830488c506
2022-04-22 01:57:20.881684 (Thread-1): 01:57:20  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 01:57:20.881871 (Thread-1): 01:57:20  finished collecting timing info
2022-04-22 01:57:20.882070 (Thread-1): 01:57:20  On rpc.my_new_project.request: Close
2022-04-22 01:57:21.075233 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 01:57:21.076302 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 01:57:21.606679 (Thread-274): handling poll request
2022-04-22 01:57:21.607066 (Thread-274): 01:57:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387d4610>]}
2022-04-22 01:57:21.607841 (Thread-274): sending response (<Response 45204 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:58:46.882214 (Thread-275): handling status request
2022-04-22 01:58:46.882682 (Thread-275): 01:58:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388fdb80>]}
2022-04-22 01:58:46.883207 (Thread-275): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:58:47.194994 (Thread-276): handling run_sql request
2022-04-22 01:58:47.195421 (Thread-276): 01:58:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388fdaf0>]}
2022-04-22 01:58:49.720341 (Thread-276): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:58:49.746436 (MainThread): 01:58:49  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1edfda3-7981-44b0-b5de-ede419fb6968', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1370e7b700>]}
2022-04-22 01:58:49.747007 (MainThread): 01:58:49  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 01:58:49.747624 (Thread-1): 01:58:49  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 01:58:49.747762 (Thread-1): 01:58:49  Began compiling node rpc.my_new_project.request
2022-04-22 01:58:49.747857 (Thread-1): 01:58:49  Compiling rpc.my_new_project.request
2022-04-22 01:58:49.750011 (Thread-1): 01:58:49  finished collecting timing info
2022-04-22 01:58:49.750139 (Thread-1): 01:58:49  Began executing node rpc.my_new_project.request
2022-04-22 01:58:49.750957 (Thread-1): 01:58:49  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 01:58:49.751047 (Thread-1): 01:58:49  On rpc.my_new_project.request: with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 01:58:49.751127 (Thread-1): 01:58:49  Opening a new connection, currently in state init
2022-04-22 01:58:50.023957 (Thread-277): handling poll request
2022-04-22 01:58:50.024411 (Thread-277): 01:58:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c29070>]}
2022-04-22 01:58:50.025279 (Thread-277): sending response (<Response 4083 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:58:51.329925 (Thread-278): handling poll request
2022-04-22 01:58:51.330357 (Thread-278): 01:58:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b8ad30>]}
2022-04-22 01:58:51.330857 (Thread-278): sending response (<Response 394 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:58:51.349570 (Thread-1): 01:58:51  SQL status: SUCCESS 500 in 1.6 seconds
2022-04-22 01:58:51.355973 (Thread-1): 01:58:51  finished collecting timing info
2022-04-22 01:58:51.356225 (Thread-1): 01:58:51  On rpc.my_new_project.request: Close
2022-04-22 01:58:52.652343 (Thread-279): handling poll request
2022-04-22 01:58:52.652729 (Thread-279): 01:58:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dc5b20>]}
2022-04-22 01:58:52.656104 (Thread-279): sending response (<Response 18948 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:59:00.173378 (Thread-280): 01:59:00  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 01:59:00.173861 (Thread-280): 01:59:00  Partial parsing: updated file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 01:59:00.179093 (Thread-280): 01:59:00  1699: static parser successfully parsed staging/stg_addresses.sql
2022-04-22 01:59:00.224098 (Thread-280): 01:59:00  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740a9b50>]}
2022-04-22 01:59:00.851892 (Thread-281): handling status request
2022-04-22 01:59:00.852286 (Thread-281): 01:59:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dff040>]}
2022-04-22 01:59:00.852783 (Thread-281): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 01:59:00.921741 (Thread-282): handling status request
2022-04-22 01:59:00.922044 (Thread-282): 01:59:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dff4c0>]}
2022-04-22 01:59:00.922483 (Thread-282): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:01:07.266360 (Thread-283): handling status request
2022-04-22 02:01:07.267227 (Thread-283): 02:01:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dffc70>]}
2022-04-22 02:01:07.267699 (Thread-283): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:01:07.720168 (Thread-284): handling run_sql request
2022-04-22 02:01:07.720557 (Thread-284): 02:01:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dff9d0>]}
2022-04-22 02:01:10.252721 (Thread-284): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:01:10.281043 (MainThread): 02:01:10  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c837e1a2-96d5-4168-95d9-959d60e78598', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd1584a6d0>]}
2022-04-22 02:01:10.281617 (MainThread): 02:01:10  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:01:10.282233 (Thread-1): 02:01:10  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:01:10.282398 (Thread-1): 02:01:10  Began compiling node rpc.my_new_project.request
2022-04-22 02:01:10.282501 (Thread-1): 02:01:10  Compiling rpc.my_new_project.request
2022-04-22 02:01:10.285908 (Thread-1): 02:01:10  finished collecting timing info
2022-04-22 02:01:10.286040 (Thread-1): 02:01:10  Began executing node rpc.my_new_project.request
2022-04-22 02:01:10.289746 (Thread-1): 02:01:10  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:01:10.289846 (Thread-1): 02:01:10  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type,
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),
/*
  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),
*/
  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:01:10.289928 (Thread-1): 02:01:10  Opening a new connection, currently in state init
2022-04-22 02:01:10.568876 (Thread-285): handling poll request
2022-04-22 02:01:10.569370 (Thread-285): 02:01:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38df1670>]}
2022-04-22 02:01:10.570359 (Thread-285): sending response (<Response 8450 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:01:11.792493 (Thread-1): 02:01:11  Snowflake adapter: Snowflake query id: 01a3c479-0501-6163-0004-7d830488b9ca
2022-04-22 02:01:11.792724 (Thread-1): 02:01:11  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 02:01:11.792917 (Thread-1): 02:01:11  finished collecting timing info
2022-04-22 02:01:11.793110 (Thread-1): 02:01:11  On rpc.my_new_project.request: Close
2022-04-22 02:01:11.907193 (Thread-286): handling poll request
2022-04-22 02:01:11.907593 (Thread-286): 02:01:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38df1490>]}
2022-04-22 02:01:11.908163 (Thread-286): sending response (<Response 1779 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:01:12.200828 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 46 at position 4 unexpected 'from'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 4 unexpected 'from'.
2022-04-22 02:01:12.201900 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n/*\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n*/\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n/*\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n*/\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 46 at position 4 unexpected 'from'.", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type,\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n/*\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n*/\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type,\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n/*\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n*/\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:01:13.232637 (Thread-287): handling poll request
2022-04-22 02:01:13.233055 (Thread-287): 02:01:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38df1610>]}
2022-04-22 02:01:13.233823 (Thread-287): sending response (<Response 45232 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:03:09.322872 (Thread-288): handling status request
2022-04-22 02:03:09.324703 (Thread-288): 02:03:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed44f0>]}
2022-04-22 02:03:09.325221 (Thread-288): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:03:09.688475 (Thread-289): handling run_sql request
2022-04-22 02:03:09.688866 (Thread-289): 02:03:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cc5250>]}
2022-04-22 02:03:12.197006 (Thread-289): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:03:12.225460 (MainThread): 02:03:12  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db1df363-8021-49cd-90d0-0699b5005180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0933ee9790>]}
2022-04-22 02:03:12.225996 (MainThread): 02:03:12  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:03:12.226606 (Thread-1): 02:03:12  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:03:12.226747 (Thread-1): 02:03:12  Began compiling node rpc.my_new_project.request
2022-04-22 02:03:12.226866 (Thread-1): 02:03:12  Compiling rpc.my_new_project.request
2022-04-22 02:03:12.230206 (Thread-1): 02:03:12  finished collecting timing info
2022-04-22 02:03:12.230365 (Thread-1): 02:03:12  Began executing node rpc.my_new_project.request
2022-04-22 02:03:12.234110 (Thread-1): 02:03:12  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:03:12.234210 (Thread-1): 02:03:12  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id,
      case
        when fo.first_order_id = o.order_id then 'new'
        else 'repeat'
      end as user_type
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),
  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:03:12.234318 (Thread-1): 02:03:12  Opening a new connection, currently in state init
2022-04-22 02:03:12.541110 (Thread-290): handling poll request
2022-04-22 02:03:12.541580 (Thread-290): 02:03:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38d6b1c0>]}
2022-04-22 02:03:12.542542 (Thread-290): sending response (<Response 8443 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:03:13.867355 (Thread-291): handling poll request
2022-04-22 02:03:13.867746 (Thread-291): 02:03:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38d6b160>]}
2022-04-22 02:03:13.868206 (Thread-291): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:03:14.018461 (Thread-1): 02:03:14  Snowflake adapter: Snowflake query id: 01a3c47b-0501-6083-0004-7d830488e096
2022-04-22 02:03:14.018710 (Thread-1): 02:03:14  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 43 at position 13
invalid identifier 'FO.FIRST_ORDER_ID'
2022-04-22 02:03:14.018904 (Thread-1): 02:03:14  finished collecting timing info
2022-04-22 02:03:14.019101 (Thread-1): 02:03:14  On rpc.my_new_project.request: Close
2022-04-22 02:03:14.380628 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 43 at position 13
  invalid identifier 'FO.FIRST_ORDER_ID'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 43 at position 13
invalid identifier 'FO.FIRST_ORDER_ID'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 43 at position 13
  invalid identifier 'FO.FIRST_ORDER_ID'
2022-04-22 02:03:14.381751 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 43 at position 13\n  invalid identifier 'FO.FIRST_ORDER_ID'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 43 at position 13\n  invalid identifier 'FO.FIRST_ORDER_ID'", 'raw_sql': "-- import cte's\r\n\r\n/*\r\n\r\nstep notes:\r\n\r\npull out source tables into cte's\r\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\r\nextract cte's we found in query:\r\n    `dbt-public.interview_task.orders` o\r\n    `dbt-public.interview_task.devices` d\r\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\r\n    `dbt-public.interview_task.addresses` oa \r\n    `dbt-public.interview_task.payments`\r\n\r\na couple of errors that were resolved in the set up:\r\n  data type `int64` to `float`\r\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\r\n  transform to lower case (using command pallet -- F1)\r\n  changed `oa` to `a` for standarization\r\n    \r\n*/\r\n\r\nwith\r\n\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  d as (select * from {{ source('interview_sample_data', 'interview_devices') }}),\r\n  a as (select * from {{ source('interview_sample_data', 'interview_addresses')}}),\r\n  p as (select * from {{ source('interview_sample_data', 'interview_payments')}}),\r\n\r\n  -- logical cte's\r\n\r\n  /*\r\n\r\n  there are a lot of left join sub-queries, here is where we will try to simplify those\r\n  renamed `d` to `do` for standarization\r\n  added case statements into marts\r\n\r\n  */\r\n\r\n  do as (\r\n    select distinct\r\n      cast(d.type_id as float) as order_id,\r\n      first_value(d.device) over (\r\n        partition by d.type_id\r\n        order by\r\n        d.created_at rows between unbounded preceding\r\n        and unbounded following\r\n        ) as device,\r\n        case\r\n          when d.device = 'web' then 'desktop'\r\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\r\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\r\n          when nullif(d.device, '') is null then 'unknown'\r\n          else 'error'\r\n        end as purchase_device_type\r\n    from d\r\n    where d.type = 'order'\r\n  ),\r\n\r\n  fo as (\r\n    select\r\n      fo.user_id,\r\n      min(fo.order_id) as first_order_id,\r\n      case\r\n        when fo.first_order_id = o.order_id then 'new'\r\n        else 'repeat'\r\n      end as user_type\r\n    from o as fo\r\n    where fo.status != 'cancelled'\r\n    group by fo.user_id\r\n  ),\r\n\r\n  pa as (\r\n    select\r\n      order_id,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents else 0\r\n        end\r\n      ) as gross_tax_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_cents else 0\r\n        end\r\n      ) as gross_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then amount_shipping_cents else 0\r\n        end\r\n      ) as gross_shipping_amount_cents,\r\n    sum(case\r\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n        end\r\n      ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n  ),\r\n  -- marts\r\n  ct as (\r\n    select\r\n      a.order_id,\r\n      case\r\n        when a.country_code is null then 'null country'\r\n        when a.country_code = 'us' then 'us'\r\n        when a.country_code != 'us' then 'international'\r\n      end as country_type\r\n    from a\r\n  ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "-- import cte's\n\n/*\n\nstep notes:\n\npull out source tables into cte's\ncreate a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)\nextract cte's we found in query:\n    `dbt-public.interview_task.orders` o\n    `dbt-public.interview_task.devices` d\n    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order\n    `dbt-public.interview_task.addresses` oa \n    `dbt-public.interview_task.payments`\n\na couple of errors that were resolved in the set up:\n  data type `int64` to `float`\n  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`\n  transform to lower case (using command pallet -- F1)\n  changed `oa` to `a` for standarization\n    \n*/\n\nwith\n\n  o as (select * from raw.interview_sample_data.interview_orders),\n  d as (select * from raw.interview_sample_data.interview_devices),\n  a as (select * from raw.interview_sample_data.interview_addresses),\n  p as (select * from raw.interview_sample_data.interview_payments),\n\n  -- logical cte's\n\n  /*\n\n  there are a lot of left join sub-queries, here is where we will try to simplify those\n  renamed `d` to `do` for standarization\n  added case statements into marts\n\n  */\n\n  do as (\n    select distinct\n      cast(d.type_id as float) as order_id,\n      first_value(d.device) over (\n        partition by d.type_id\n        order by\n        d.created_at rows between unbounded preceding\n        and unbounded following\n        ) as device,\n        case\n          when d.device = 'web' then 'desktop'\n          when d.device in ('ios-app', 'android-app') then 'mobile-app'\n          when d.device in ('mobile', 'tablet') then 'mobile-web'\n          when nullif(d.device, '') is null then 'unknown'\n          else 'error'\n        end as purchase_device_type\n    from d\n    where d.type = 'order'\n  ),\n\n  fo as (\n    select\n      fo.user_id,\n      min(fo.order_id) as first_order_id,\n      case\n        when fo.first_order_id = o.order_id then 'new'\n        else 'repeat'\n      end as user_type\n    from o as fo\n    where fo.status != 'cancelled'\n    group by fo.user_id\n  ),\n\n  pa as (\n    select\n      order_id,\n    sum(case\n          when status = 'completed' then tax_amount_cents else 0\n        end\n      ) as gross_tax_amount_cents,\n    sum(case\n          when status = 'completed' then amount_cents else 0\n        end\n      ) as gross_amount_cents,\n    sum(case\n          when status = 'completed' then amount_shipping_cents else 0\n        end\n      ) as gross_shipping_amount_cents,\n    sum(case\n          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n        end\n      ) as gross_total_amount_cents\n    from p\n    group by order_id\n  ),\n  -- marts\n  ct as (\n    select\n      a.order_id,\n      case\n        when a.country_code is null then 'null country'\n        when a.country_code = 'us' then 'us'\n        when a.country_code != 'us' then 'international'\n      end as country_type\n    from a\n  ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:03:15.168497 (Thread-292): handling poll request
2022-04-22 02:03:15.168934 (Thread-292): 02:03:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38d6be80>]}
2022-04-22 02:03:15.169804 (Thread-292): sending response (<Response 45269 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:04:45.771235 (Thread-293): handling status request
2022-04-22 02:04:45.772971 (Thread-293): 02:04:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f02460>]}
2022-04-22 02:04:45.773519 (Thread-293): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:04:46.097869 (Thread-294): handling run_sql request
2022-04-22 02:04:46.098257 (Thread-294): 02:04:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38af1730>]}
2022-04-22 02:04:48.630848 (Thread-294): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:04:48.659155 (MainThread): 02:04:48  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '290c357b-2c06-4951-889a-c5161027661c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62a5aa6a0>]}
2022-04-22 02:04:48.659691 (MainThread): 02:04:48  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:04:48.660308 (Thread-1): 02:04:48  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:04:48.660444 (Thread-1): 02:04:48  Began compiling node rpc.my_new_project.request
2022-04-22 02:04:48.660544 (Thread-1): 02:04:48  Compiling rpc.my_new_project.request
2022-04-22 02:04:48.663963 (Thread-1): 02:04:48  finished collecting timing info
2022-04-22 02:04:48.664094 (Thread-1): 02:04:48  Began executing node rpc.my_new_project.request
2022-04-22 02:04:48.667824 (Thread-1): 02:04:48  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:04:48.667925 (Thread-1): 02:04:48  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),
  -- marts
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:04:48.668007 (Thread-1): 02:04:48  Opening a new connection, currently in state init
2022-04-22 02:04:48.952815 (Thread-295): handling poll request
2022-04-22 02:04:48.953266 (Thread-295): 02:04:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b11e20>]}
2022-04-22 02:04:48.954196 (Thread-295): sending response (<Response 8327 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:04:50.258668 (Thread-296): handling poll request
2022-04-22 02:04:50.259057 (Thread-296): 02:04:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38b11880>]}
2022-04-22 02:04:50.259529 (Thread-296): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:04:51.576563 (Thread-297): handling poll request
2022-04-22 02:04:51.576981 (Thread-297): 02:04:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740a92e0>]}
2022-04-22 02:04:51.577458 (Thread-297): sending response (<Response 390 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:04:51.771090 (Thread-1): 02:04:51  SQL status: SUCCESS 500 in 3.1 seconds
2022-04-22 02:04:52.292231 (Thread-1): 02:04:52  finished collecting timing info
2022-04-22 02:04:52.292505 (Thread-1): 02:04:52  On rpc.my_new_project.request: Close
2022-04-22 02:04:52.903694 (Thread-298): handling poll request
2022-04-22 02:04:52.904080 (Thread-298): 02:04:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38af1820>]}
2022-04-22 02:04:52.913670 (Thread-298): sending response (<Response 155831 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:08:05.475951 (Thread-299): handling status request
2022-04-22 02:08:05.477761 (Thread-299): 02:08:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3897ee20>]}
2022-04-22 02:08:05.478324 (Thread-299): sending response (<Response 1572 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:08:05.846897 (Thread-300): handling run_sql request
2022-04-22 02:08:05.847274 (Thread-300): 02:08:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38caac70>]}
2022-04-22 02:08:08.337768 (Thread-300): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:08:08.366544 (MainThread): 02:08:08  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05b52d35-8f29-418d-a0d8-636446999dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f04ce87c0>]}
2022-04-22 02:08:08.367085 (MainThread): 02:08:08  Found 10 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:08:08.367656 (Thread-1): 02:08:08  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:08:08.367795 (Thread-1): 02:08:08  Began compiling node rpc.my_new_project.request
2022-04-22 02:08:08.367899 (Thread-1): 02:08:08  Compiling rpc.my_new_project.request
2022-04-22 02:08:08.371393 (Thread-1): 02:08:08  finished collecting timing info
2022-04-22 02:08:08.371523 (Thread-1): 02:08:08  Began executing node rpc.my_new_project.request
2022-04-22 02:08:08.375307 (Thread-1): 02:08:08  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:08:08.375406 (Thread-1): 02:08:08  On rpc.my_new_project.request: -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:08:08.375487 (Thread-1): 02:08:08  Opening a new connection, currently in state init
2022-04-22 02:08:08.703187 (Thread-301): handling poll request
2022-04-22 02:08:08.703632 (Thread-301): 02:08:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38c59190>]}
2022-04-22 02:08:08.704577 (Thread-301): sending response (<Response 8333 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:08:10.021791 (Thread-302): handling poll request
2022-04-22 02:08:10.022198 (Thread-302): 02:08:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cd1be0>]}
2022-04-22 02:08:10.022730 (Thread-302): sending response (<Response 391 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:08:11.065862 (Thread-1): 02:08:11  SQL status: SUCCESS 500 in 2.69 seconds
2022-04-22 02:08:11.336395 (Thread-303): handling poll request
2022-04-22 02:08:11.336784 (Thread-303): 02:08:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cd1250>]}
2022-04-22 02:08:11.337288 (Thread-303): sending response (<Response 671 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:08:11.599510 (Thread-1): 02:08:11  finished collecting timing info
2022-04-22 02:08:11.599802 (Thread-1): 02:08:11  On rpc.my_new_project.request: Close
2022-04-22 02:08:12.647708 (Thread-304): handling poll request
2022-04-22 02:08:12.648144 (Thread-304): 02:08:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a388190a0>]}
2022-04-22 02:08:12.657796 (Thread-304): sending response (<Response 156381 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:09:14.836313 (Thread-305): 02:09:14  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:09:14.836767 (Thread-305): 02:09:14  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 02:09:14.841312 (Thread-305): 02:09:14  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 02:09:14.884270 (Thread-305): 02:09:14  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386ccf40>]}
2022-04-22 02:09:15.578936 (Thread-306): handling status request
2022-04-22 02:09:15.579364 (Thread-306): 02:09:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ced400>]}
2022-04-22 02:09:15.606514 (Thread-306): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:09:15.782727 (Thread-307): handling status request
2022-04-22 02:09:15.783182 (Thread-307): 02:09:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ed4100>]}
2022-04-22 02:09:15.783667 (Thread-307): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:09:17.062701 (Thread-308): 02:09:17  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:09:17.063137 (Thread-308): 02:09:17  Partial parsing: updated file: my_new_project://models/staging/stg_payments.sql
2022-04-22 02:09:17.067100 (Thread-308): 02:09:17  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 02:09:17.111402 (Thread-308): 02:09:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38d55cd0>]}
2022-04-22 02:09:17.752911 (Thread-309): handling status request
2022-04-22 02:09:17.753339 (Thread-309): 02:09:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cc1bb0>]}
2022-04-22 02:09:17.753846 (Thread-309): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:09:17.939766 (Thread-310): handling status request
2022-04-22 02:09:17.940154 (Thread-310): 02:09:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ab1cc1af0>]}
2022-04-22 02:09:17.940617 (Thread-310): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:12:05.698084 (Thread-311): handling status request
2022-04-22 02:12:05.700023 (Thread-311): 02:12:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65aaf310>]}
2022-04-22 02:12:05.700523 (Thread-311): sending response (<Response 1570 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:12:08.504390 (Thread-312): 02:12:08  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:12:08.504611 (Thread-312): 02:12:08  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:12:08.510557 (Thread-312): 02:12:08  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386bf340>]}
2022-04-22 02:12:09.239037 (Thread-313): handling status request
2022-04-22 02:12:09.239444 (Thread-313): 02:12:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f67d60>]}
2022-04-22 02:12:09.239936 (Thread-313): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:12:09.304202 (Thread-314): handling status request
2022-04-22 02:12:09.304634 (Thread-314): 02:12:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386a43a0>]}
2022-04-22 02:12:09.305091 (Thread-314): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:12:53.400221 (Thread-315): 02:12:53  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 02:12:53.400605 (Thread-315): 02:12:53  Partial parsing: added file: my_new_project://models/marts/fct_final.sql
2022-04-22 02:12:53.404302 (Thread-315): 02:12:53  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 02:12:53.446334 (Thread-315): 02:12:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38a32610>]}
2022-04-22 02:12:54.502980 (Thread-316): handling status request
2022-04-22 02:12:54.503373 (Thread-316): 02:12:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385f4610>]}
2022-04-22 02:12:54.503868 (Thread-316): sending response (<Response 1558 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:12:54.538690 (Thread-317): handling status request
2022-04-22 02:12:54.539006 (Thread-317): 02:12:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385f4430>]}
2022-04-22 02:12:54.539456 (Thread-317): sending response (<Response 1558 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:17:39.385591 (Thread-318): 02:17:39  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 02:17:39.387765 (Thread-318): 02:17:39  Partial parsing: added file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 02:17:39.387932 (Thread-318): 02:17:39  Partial parsing: deleted file: my_new_project://models/staging/stg_orders.sql
2022-04-22 02:17:39.392647 (Thread-318): 02:17:39  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 02:17:39.436207 (Thread-318): 02:17:39  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385f0fa0>]}
2022-04-22 02:17:40.254099 (Thread-319): handling status request
2022-04-22 02:17:40.254549 (Thread-319): 02:17:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386c5880>]}
2022-04-22 02:17:40.255086 (Thread-319): sending response (<Response 1893 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:17:40.289138 (Thread-320): handling status request
2022-04-22 02:17:40.289540 (Thread-320): 02:17:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386c5af0>]}
2022-04-22 02:17:40.290028 (Thread-320): sending response (<Response 1893 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:18:19.384348 (Thread-321): 02:18:19  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:18:19.384788 (Thread-321): 02:18:19  Partial parsing: updated file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 02:18:19.388574 (Thread-321): 02:18:19  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 02:18:19.430663 (Thread-321): 02:18:19  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385a76a0>]}
2022-04-22 02:18:20.031407 (Thread-322): handling status request
2022-04-22 02:18:20.031811 (Thread-322): 02:18:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3866aaf0>]}
2022-04-22 02:18:20.032311 (Thread-322): sending response (<Response 1576 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:18:20.221409 (Thread-323): handling status request
2022-04-22 02:18:20.221809 (Thread-323): 02:18:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3866afd0>]}
2022-04-22 02:18:20.222315 (Thread-323): sending response (<Response 1576 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:20:02.982170 (Thread-324): 02:20:02  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 02:20:02.984055 (Thread-324): 02:20:02  Partial parsing: added file: my_new_project://models/staging/stg_device_orders.sql
2022-04-22 02:20:02.984234 (Thread-324): 02:20:02  Partial parsing: deleted file: my_new_project://models/staging/stg_devices.sql
2022-04-22 02:20:02.988033 (Thread-324): 02:20:02  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 02:20:03.034298 (Thread-324): 02:20:03  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38531f40>]}
2022-04-22 02:20:03.624355 (Thread-325): handling status request
2022-04-22 02:20:03.624746 (Thread-325): 02:20:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38607ca0>]}
2022-04-22 02:20:03.625233 (Thread-325): sending response (<Response 1898 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:20:03.767650 (Thread-326): handling status request
2022-04-22 02:20:03.768039 (Thread-326): 02:20:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38607c40>]}
2022-04-22 02:20:03.768504 (Thread-326): sending response (<Response 1898 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:20:25.911965 (Thread-327): 02:20:25  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 02:20:25.912381 (Thread-327): 02:20:25  Partial parsing: added file: my_new_project://models/staging/stg_ctry_type.sql
2022-04-22 02:20:25.912530 (Thread-327): 02:20:25  Partial parsing: deleted file: my_new_project://models/staging/stg_addresses.sql
2022-04-22 02:20:25.916438 (Thread-327): 02:20:25  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 02:20:25.959953 (Thread-327): 02:20:25  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384a0580>]}
2022-04-22 02:20:26.482176 (Thread-328): handling status request
2022-04-22 02:20:26.482636 (Thread-328): 02:20:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38510400>]}
2022-04-22 02:20:26.483159 (Thread-328): sending response (<Response 1892 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:20:26.708483 (Thread-329): handling status request
2022-04-22 02:20:26.708908 (Thread-329): 02:20:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38510220>]}
2022-04-22 02:20:26.709419 (Thread-329): sending response (<Response 1892 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:20:28.393362 (Thread-330): 02:20:28  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:20:28.393567 (Thread-330): 02:20:28  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:20:28.398850 (Thread-330): 02:20:28  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38459550>]}
2022-04-22 02:20:29.152260 (Thread-331): handling status request
2022-04-22 02:20:29.152665 (Thread-331): 02:20:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384eae20>]}
2022-04-22 02:20:29.153171 (Thread-331): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:20:29.194252 (Thread-332): handling status request
2022-04-22 02:20:29.194680 (Thread-332): 02:20:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384eab20>]}
2022-04-22 02:20:29.195161 (Thread-332): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:21:45.328910 (Thread-333): handling status request
2022-04-22 02:21:45.330095 (Thread-333): 02:21:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384eafd0>]}
2022-04-22 02:21:45.330629 (Thread-333): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:21:45.667887 (Thread-334): handling run_sql request
2022-04-22 02:21:45.668278 (Thread-334): 02:21:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384eab50>]}
2022-04-22 02:21:48.155721 (Thread-334): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:21:48.182207 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1278, in process_node
    _process_refs_for_node(manifest, config.project_name, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1163, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 901, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 620, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a node named 'stg_ctry_types' which was not found
2022-04-22 02:21:48.460164 (Thread-335): handling poll request
2022-04-22 02:21:48.460622 (Thread-335): 02:21:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384e1d60>]}
2022-04-22 02:21:48.461370 (Thread-335): sending response (<Response 4399 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:22:18.982060 (Thread-336): 02:22:18  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:22:18.982594 (Thread-336): 02:22:18  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 02:22:18.987326 (Thread-336): 02:22:18  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 02:22:19.031905 (Thread-336): 02:22:19  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383daa60>]}
2022-04-22 02:22:19.659310 (Thread-337): handling status request
2022-04-22 02:22:19.659722 (Thread-337): 02:22:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38429e20>]}
2022-04-22 02:22:19.660217 (Thread-337): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:22:19.680207 (Thread-338): handling status request
2022-04-22 02:22:19.680492 (Thread-338): 02:22:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38429d00>]}
2022-04-22 02:22:19.680907 (Thread-338): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:22:20.471277 (Thread-339): handling status request
2022-04-22 02:22:20.471670 (Thread-339): 02:22:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a384291c0>]}
2022-04-22 02:22:20.472142 (Thread-339): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:22:20.827338 (Thread-340): handling run_sql request
2022-04-22 02:22:20.827730 (Thread-340): 02:22:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38429b20>]}
2022-04-22 02:22:23.403584 (Thread-340): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:22:23.429941 (MainThread): 02:22:23  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e5ce713e-e0d1-40a8-b71d-f3f8c4e16d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff5551f6d60>]}
2022-04-22 02:22:23.430552 (MainThread): 02:22:23  Found 11 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:22:23.431169 (Thread-1): 02:22:23  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:22:23.431307 (Thread-1): 02:22:23  Began compiling node rpc.my_new_project.request
2022-04-22 02:22:23.431408 (Thread-1): 02:22:23  Compiling rpc.my_new_project.request
2022-04-22 02:22:23.434182 (Thread-1): 02:22:23  finished collecting timing info
2022-04-22 02:22:23.434359 (Thread-1): 02:22:23  Began executing node rpc.my_new_project.request
2022-04-22 02:22:23.436531 (Thread-1): 02:22:23  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:22:23.436629 (Thread-1): 02:22:23  On rpc.my_new_project.request: with
  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:22:23.436711 (Thread-1): 02:22:23  Opening a new connection, currently in state init
2022-04-22 02:22:23.715472 (Thread-341): handling poll request
2022-04-22 02:22:23.715914 (Thread-341): 02:22:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383daf70>]}
2022-04-22 02:22:23.716835 (Thread-341): sending response (<Response 5602 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:22:24.522791 (Thread-1): 02:22:24  Snowflake adapter: Snowflake query id: 01a3c48e-0501-5f4a-0004-7d830488a39a
2022-04-22 02:22:24.523034 (Thread-1): 02:22:24  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:22:24.523229 (Thread-1): 02:22:24  finished collecting timing info
2022-04-22 02:22:24.523435 (Thread-1): 02:22:24  On rpc.my_new_project.request: Close
2022-04-22 02:22:24.714315 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:22:24.715367 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }}),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }}),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:22:25.072716 (Thread-342): handling poll request
2022-04-22 02:22:25.073108 (Thread-342): 02:22:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383dabe0>]}
2022-04-22 02:22:25.073849 (Thread-342): sending response (<Response 23577 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:23:17.625429 (Thread-343): 02:23:17  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 02:23:17.625909 (Thread-343): 02:23:17  Partial parsing: added file: my_new_project://models/staging/stg_orders.sql
2022-04-22 02:23:17.630029 (Thread-343): 02:23:17  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 02:23:17.669881 (Thread-343): 02:23:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383be910>]}
2022-04-22 02:23:18.460869 (Thread-344): handling status request
2022-04-22 02:23:18.461256 (Thread-344): 02:23:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38358f40>]}
2022-04-22 02:23:18.461746 (Thread-344): sending response (<Response 1564 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:23:18.556065 (Thread-345): handling status request
2022-04-22 02:23:18.563540 (Thread-345): 02:23:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38358dc0>]}
2022-04-22 02:23:18.564015 (Thread-345): sending response (<Response 1564 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:23:56.826839 (Thread-346): 02:23:56  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:23:56.827280 (Thread-346): 02:23:56  Partial parsing: updated file: my_new_project://models/staging/stg_orders.sql
2022-04-22 02:23:56.831309 (Thread-346): 02:23:56  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 02:23:56.875470 (Thread-346): 02:23:56  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a382aa310>]}
2022-04-22 02:23:57.519716 (Thread-347): handling status request
2022-04-22 02:23:57.520111 (Thread-347): 02:23:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383584f0>]}
2022-04-22 02:23:57.520592 (Thread-347): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:23:57.602877 (Thread-348): handling status request
2022-04-22 02:23:57.603261 (Thread-348): 02:23:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38358310>]}
2022-04-22 02:23:57.603713 (Thread-348): sending response (<Response 1566 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:27.018776 (Thread-349): 02:24:27  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:24:27.019251 (Thread-349): 02:24:27  Partial parsing: updated file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 02:24:27.023305 (Thread-349): 02:24:27  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 02:24:27.066319 (Thread-349): 02:24:27  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3833bd60>]}
2022-04-22 02:24:27.641803 (Thread-350): handling status request
2022-04-22 02:24:27.642216 (Thread-350): 02:24:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38353fa0>]}
2022-04-22 02:24:27.642718 (Thread-350): sending response (<Response 1576 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:27.792099 (Thread-351): handling status request
2022-04-22 02:24:27.792495 (Thread-351): 02:24:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38353ee0>]}
2022-04-22 02:24:27.792958 (Thread-351): sending response (<Response 1576 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:30.319656 (Thread-352): 02:24:30  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:24:30.319876 (Thread-352): 02:24:30  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:24:30.325085 (Thread-352): 02:24:30  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a381c0b50>]}
2022-04-22 02:24:31.197368 (Thread-353): handling status request
2022-04-22 02:24:31.197756 (Thread-353): 02:24:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38356af0>]}
2022-04-22 02:24:31.198227 (Thread-353): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:31.208028 (Thread-354): handling status request
2022-04-22 02:24:31.208297 (Thread-354): 02:24:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38356910>]}
2022-04-22 02:24:31.208674 (Thread-354): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:35.867547 (Thread-355): handling status request
2022-04-22 02:24:35.867947 (Thread-355): 02:24:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38356310>]}
2022-04-22 02:24:35.868396 (Thread-355): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:36.176044 (Thread-356): handling run_sql request
2022-04-22 02:24:36.176435 (Thread-356): 02:24:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38356130>]}
2022-04-22 02:24:38.684256 (Thread-356): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:38.710593 (MainThread): 02:24:38  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bffdf697-9ff5-43f9-aca9-a072990070c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faacb328dc0>]}
2022-04-22 02:24:38.711165 (MainThread): 02:24:38  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:24:38.711759 (Thread-1): 02:24:38  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:24:38.711898 (Thread-1): 02:24:38  Began compiling node rpc.my_new_project.request
2022-04-22 02:24:38.711994 (Thread-1): 02:24:38  Compiling rpc.my_new_project.request
2022-04-22 02:24:38.714808 (Thread-1): 02:24:38  finished collecting timing info
2022-04-22 02:24:38.714953 (Thread-1): 02:24:38  Began executing node rpc.my_new_project.request
2022-04-22 02:24:38.717161 (Thread-1): 02:24:38  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:24:38.717258 (Thread-1): 02:24:38  On rpc.my_new_project.request: with
  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:24:38.717342 (Thread-1): 02:24:38  Opening a new connection, currently in state init
2022-04-22 02:24:38.997653 (Thread-357): handling poll request
2022-04-22 02:24:38.998110 (Thread-357): 02:24:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ad5c10>]}
2022-04-22 02:24:38.999118 (Thread-357): sending response (<Response 5602 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:39.616961 (Thread-1): 02:24:39  Snowflake adapter: Snowflake query id: 01a3c490-0501-6083-0004-7d830488e47e
2022-04-22 02:24:39.617190 (Thread-1): 02:24:39  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:24:39.617382 (Thread-1): 02:24:39  finished collecting timing info
2022-04-22 02:24:39.617572 (Thread-1): 02:24:39  On rpc.my_new_project.request: Close
2022-04-22 02:24:39.820480 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:24:39.821537 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }}),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }}),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:24:40.391535 (Thread-358): handling poll request
2022-04-22 02:24:40.391941 (Thread-358): 02:24:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38578700>]}
2022-04-22 02:24:40.392635 (Thread-358): sending response (<Response 23577 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:59.272265 (Thread-359): handling status request
2022-04-22 02:24:59.272651 (Thread-359): 02:24:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383d85e0>]}
2022-04-22 02:24:59.273128 (Thread-359): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:24:59.587742 (Thread-360): handling run_sql request
2022-04-22 02:24:59.588138 (Thread-360): 02:24:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383d8160>]}
2022-04-22 02:25:02.119170 (Thread-360): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:02.144024 (MainThread): 02:25:02  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aeeb7ed3-6f53-41e4-8f47-e160471727d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e12be9dc0>]}
2022-04-22 02:25:02.144570 (MainThread): 02:25:02  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:25:02.145169 (Thread-1): 02:25:02  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:25:02.145304 (Thread-1): 02:25:02  Began compiling node rpc.my_new_project.request
2022-04-22 02:25:02.145399 (Thread-1): 02:25:02  Compiling rpc.my_new_project.request
2022-04-22 02:25:02.147430 (Thread-1): 02:25:02  finished collecting timing info
2022-04-22 02:25:02.147558 (Thread-1): 02:25:02  Began executing node rpc.my_new_project.request
2022-04-22 02:25:02.148271 (Thread-1): 02:25:02  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:25:02.148359 (Thread-1): 02:25:02  On rpc.my_new_project.request: with
    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:25:02.148440 (Thread-1): 02:25:02  Opening a new connection, currently in state init
2022-04-22 02:25:02.457695 (Thread-361): handling poll request
2022-04-22 02:25:02.458145 (Thread-361): 02:25:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3826b220>]}
2022-04-22 02:25:02.459074 (Thread-361): sending response (<Response 4014 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:03.083631 (Thread-1): 02:25:03  Snowflake adapter: Snowflake query id: 01a3c491-0501-6083-0004-7d830488e482
2022-04-22 02:25:03.083861 (Thread-1): 02:25:03  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:25:03.084050 (Thread-1): 02:25:03  finished collecting timing info
2022-04-22 02:25:03.084252 (Thread-1): 02:25:03  On rpc.my_new_project.request: Close
2022-04-22 02:25:03.288968 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:25:03.289963 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:25:03.783067 (Thread-362): handling poll request
2022-04-22 02:25:03.783464 (Thread-362): 02:25:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383b79d0>]}
2022-04-22 02:25:03.784132 (Thread-362): sending response (<Response 11924 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:15.437125 (Thread-363): 02:25:15  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:25:15.437354 (Thread-363): 02:25:15  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:25:15.443313 (Thread-363): 02:25:15  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38139850>]}
2022-04-22 02:25:16.217926 (Thread-364): handling status request
2022-04-22 02:25:16.218361 (Thread-364): 02:25:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a381d8280>]}
2022-04-22 02:25:16.218860 (Thread-364): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:16.298505 (Thread-365): handling status request
2022-04-22 02:25:16.298940 (Thread-365): 02:25:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a381d80d0>]}
2022-04-22 02:25:16.299382 (Thread-365): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:26.747343 (Thread-366): handling status request
2022-04-22 02:25:26.747731 (Thread-366): 02:25:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a381d8460>]}
2022-04-22 02:25:26.771436 (Thread-366): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:27.068728 (Thread-367): handling run_sql request
2022-04-22 02:25:27.069116 (Thread-367): 02:25:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a381d8310>]}
2022-04-22 02:25:29.571918 (Thread-367): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:29.596568 (MainThread): 02:25:29  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f379930-21e7-454a-aee6-4e51c1c8ca8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8561451dc0>]}
2022-04-22 02:25:29.597111 (MainThread): 02:25:29  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:25:29.597710 (Thread-1): 02:25:29  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:25:29.597853 (Thread-1): 02:25:29  Began compiling node rpc.my_new_project.request
2022-04-22 02:25:29.597952 (Thread-1): 02:25:29  Compiling rpc.my_new_project.request
2022-04-22 02:25:29.599936 (Thread-1): 02:25:29  finished collecting timing info
2022-04-22 02:25:29.600067 (Thread-1): 02:25:29  Began executing node rpc.my_new_project.request
2022-04-22 02:25:29.600764 (Thread-1): 02:25:29  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:25:29.600855 (Thread-1): 02:25:29  On rpc.my_new_project.request: with
    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:25:29.600935 (Thread-1): 02:25:29  Opening a new connection, currently in state init
2022-04-22 02:25:29.877077 (Thread-368): handling poll request
2022-04-22 02:25:29.877510 (Thread-368): 02:25:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38139670>]}
2022-04-22 02:25:29.878483 (Thread-368): sending response (<Response 4014 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:30.450054 (Thread-1): 02:25:30  Snowflake adapter: Snowflake query id: 01a3c491-0501-5f4a-0004-7d830488a3fa
2022-04-22 02:25:30.450327 (Thread-1): 02:25:30  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:25:30.450541 (Thread-1): 02:25:30  finished collecting timing info
2022-04-22 02:25:30.450749 (Thread-1): 02:25:30  On rpc.my_new_project.request: Close
2022-04-22 02:25:30.622210 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:25:30.623263 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:25:31.186758 (Thread-369): handling poll request
2022-04-22 02:25:31.187190 (Thread-369): 02:25:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3813c130>]}
2022-04-22 02:25:31.187843 (Thread-369): sending response (<Response 11924 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:25:58.923822 (Thread-370): handling status request
2022-04-22 02:25:58.924186 (Thread-370): 02:25:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3813c6d0>]}
2022-04-22 02:25:58.924651 (Thread-370): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:02.963865 (Thread-371): 02:26:02  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:26:02.964096 (Thread-371): 02:26:02  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:26:02.969998 (Thread-371): 02:26:02  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d8f10>]}
2022-04-22 02:26:03.759581 (Thread-372): handling status request
2022-04-22 02:26:03.759991 (Thread-372): 02:26:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d7640>]}
2022-04-22 02:26:03.760458 (Thread-372): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:03.772345 (Thread-373): handling status request
2022-04-22 02:26:03.772631 (Thread-373): 02:26:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d7550>]}
2022-04-22 02:26:03.773028 (Thread-373): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:08.178525 (Thread-374): handling status request
2022-04-22 02:26:08.178943 (Thread-374): 02:26:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d7a60>]}
2022-04-22 02:26:08.179403 (Thread-374): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:08.540974 (Thread-375): handling run_sql request
2022-04-22 02:26:08.541353 (Thread-375): 02:26:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d7970>]}
2022-04-22 02:26:11.132905 (Thread-375): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:11.158646 (MainThread): 02:26:11  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0f2205b3-b66b-445f-8b94-1e805d9e7fe3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f72ff073fd0>]}
2022-04-22 02:26:11.159226 (MainThread): 02:26:11  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:26:11.159835 (Thread-1): 02:26:11  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:26:11.159974 (Thread-1): 02:26:11  Began compiling node rpc.my_new_project.request
2022-04-22 02:26:11.160067 (Thread-1): 02:26:11  Compiling rpc.my_new_project.request
2022-04-22 02:26:11.162146 (Thread-1): 02:26:11  finished collecting timing info
2022-04-22 02:26:11.162328 (Thread-1): 02:26:11  Began executing node rpc.my_new_project.request
2022-04-22 02:26:11.163090 (Thread-1): 02:26:11  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:26:11.163183 (Thread-1): 02:26:11  On rpc.my_new_project.request: with
    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:26:11.163265 (Thread-1): 02:26:11  Opening a new connection, currently in state init
2022-04-22 02:26:11.440376 (Thread-376): handling poll request
2022-04-22 02:26:11.440829 (Thread-376): 02:26:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d95e0>]}
2022-04-22 02:26:11.441724 (Thread-376): sending response (<Response 4014 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:12.107563 (Thread-1): 02:26:12  Snowflake adapter: Snowflake query id: 01a3c492-0501-6083-0004-7d830488e532
2022-04-22 02:26:12.107794 (Thread-1): 02:26:12  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:26:12.107989 (Thread-1): 02:26:12  finished collecting timing info
2022-04-22 02:26:12.108191 (Thread-1): 02:26:12  On rpc.my_new_project.request: Close
2022-04-22 02:26:12.308956 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:26:12.309973 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:26:12.766884 (Thread-377): handling poll request
2022-04-22 02:26:12.767289 (Thread-377): 02:26:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d97f0>]}
2022-04-22 02:26:12.767924 (Thread-377): sending response (<Response 11924 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:24.283316 (Thread-378): handling status request
2022-04-22 02:26:24.283733 (Thread-378): 02:26:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d9940>]}
2022-04-22 02:26:24.284254 (Thread-378): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:24.583318 (Thread-379): handling run_sql request
2022-04-22 02:26:24.583704 (Thread-379): 02:26:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d99a0>]}
2022-04-22 02:26:27.109273 (Thread-379): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:27.133851 (MainThread): 02:26:27  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8028d3cf-bdcd-4d7e-b7b8-dda5faacdd58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8276b8f40>]}
2022-04-22 02:26:27.134459 (MainThread): 02:26:27  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:26:27.135065 (Thread-1): 02:26:27  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:26:27.135198 (Thread-1): 02:26:27  Began compiling node rpc.my_new_project.request
2022-04-22 02:26:27.135292 (Thread-1): 02:26:27  Compiling rpc.my_new_project.request
2022-04-22 02:26:27.137340 (Thread-1): 02:26:27  finished collecting timing info
2022-04-22 02:26:27.137467 (Thread-1): 02:26:27  Began executing node rpc.my_new_project.request
2022-04-22 02:26:27.138011 (Thread-1): 02:26:27  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:26:27.138097 (Thread-1): 02:26:27  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_orders)

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:26:27.138175 (Thread-1): 02:26:27  Opening a new connection, currently in state init
2022-04-22 02:26:27.427416 (Thread-380): handling poll request
2022-04-22 02:26:27.427878 (Thread-380): 02:26:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380dabb0>]}
2022-04-22 02:26:27.428797 (Thread-380): sending response (<Response 3815 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:28.411086 (Thread-1): 02:26:28  SQL status: SUCCESS 500 in 1.27 seconds
2022-04-22 02:26:28.424747 (Thread-1): 02:26:28  finished collecting timing info
2022-04-22 02:26:28.424985 (Thread-1): 02:26:28  On rpc.my_new_project.request: Close
2022-04-22 02:26:28.742800 (Thread-381): handling poll request
2022-04-22 02:26:28.743194 (Thread-381): 02:26:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380d8fa0>]}
2022-04-22 02:26:28.743734 (Thread-381): sending response (<Response 1371 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:30.060477 (Thread-382): handling poll request
2022-04-22 02:26:30.060866 (Thread-382): 02:26:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380da610>]}
2022-04-22 02:26:30.063925 (Thread-382): sending response (<Response 62197 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:46.755387 (Thread-383): handling status request
2022-04-22 02:26:46.755801 (Thread-383): 02:26:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380da130>]}
2022-04-22 02:26:46.756294 (Thread-383): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:47.077086 (Thread-384): handling run_sql request
2022-04-22 02:26:47.077474 (Thread-384): 02:26:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380daca0>]}
2022-04-22 02:26:49.568670 (Thread-384): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:49.593232 (MainThread): 02:26:49  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ef7cb737-33d5-4c19-ae54-5fb5b1a0644e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0262885d90>]}
2022-04-22 02:26:49.593780 (MainThread): 02:26:49  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:26:49.594431 (Thread-1): 02:26:49  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:26:49.594569 (Thread-1): 02:26:49  Began compiling node rpc.my_new_project.request
2022-04-22 02:26:49.594663 (Thread-1): 02:26:49  Compiling rpc.my_new_project.request
2022-04-22 02:26:49.596625 (Thread-1): 02:26:49  finished collecting timing info
2022-04-22 02:26:49.596753 (Thread-1): 02:26:49  Began executing node rpc.my_new_project.request
2022-04-22 02:26:49.597447 (Thread-1): 02:26:49  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:26:49.597536 (Thread-1): 02:26:49  On rpc.my_new_project.request: with
    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:26:49.597615 (Thread-1): 02:26:49  Opening a new connection, currently in state init
2022-04-22 02:26:49.883168 (Thread-385): handling poll request
2022-04-22 02:26:49.883614 (Thread-385): 02:26:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38151cd0>]}
2022-04-22 02:26:49.884513 (Thread-385): sending response (<Response 4014 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:26:50.508518 (Thread-1): 02:26:50  Snowflake adapter: Snowflake query id: 01a3c492-0501-5f4a-0004-7d830488a492
2022-04-22 02:26:50.508742 (Thread-1): 02:26:50  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:26:50.508929 (Thread-1): 02:26:50  finished collecting timing info
2022-04-22 02:26:50.509133 (Thread-1): 02:26:50  On rpc.my_new_project.request: Close
2022-04-22 02:26:50.742849 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:26:50.743886 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:26:51.186033 (Thread-386): handling poll request
2022-04-22 02:26:51.186463 (Thread-386): 02:26:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38063040>]}
2022-04-22 02:26:51.187116 (Thread-386): sending response (<Response 11924 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:28:26.866175 (Thread-387): handling status request
2022-04-22 02:28:26.868188 (Thread-387): 02:28:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38063490>]}
2022-04-22 02:28:26.868680 (Thread-387): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:28:27.187455 (Thread-388): handling run_sql request
2022-04-22 02:28:27.187848 (Thread-388): 02:28:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38063670>]}
2022-04-22 02:28:29.699395 (Thread-388): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:28:29.727394 (MainThread): 02:28:29  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aefc0ec4-b5b6-4ae4-a43f-7705eab360d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5c5eb7bdc0>]}
2022-04-22 02:28:29.727991 (MainThread): 02:28:29  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:28:29.728586 (Thread-1): 02:28:29  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:28:29.728727 (Thread-1): 02:28:29  Began compiling node rpc.my_new_project.request
2022-04-22 02:28:29.728825 (Thread-1): 02:28:29  Compiling rpc.my_new_project.request
2022-04-22 02:28:29.731982 (Thread-1): 02:28:29  finished collecting timing info
2022-04-22 02:28:29.732114 (Thread-1): 02:28:29  Began executing node rpc.my_new_project.request
2022-04-22 02:28:29.734360 (Thread-1): 02:28:29  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:28:29.734460 (Thread-1): 02:28:29  On rpc.my_new_project.request: with
  o as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:28:29.734543 (Thread-1): 02:28:29  Opening a new connection, currently in state init
2022-04-22 02:28:30.044185 (Thread-389): handling poll request
2022-04-22 02:28:30.044629 (Thread-389): 02:28:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38066070>]}
2022-04-22 02:28:30.045513 (Thread-389): sending response (<Response 5662 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:28:30.820144 (Thread-1): 02:28:30  Snowflake adapter: Snowflake query id: 01a3c494-0501-6083-0004-7d830488e53a
2022-04-22 02:28:30.820367 (Thread-1): 02:28:30  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:28:30.820555 (Thread-1): 02:28:30  finished collecting timing info
2022-04-22 02:28:30.820754 (Thread-1): 02:28:30  On rpc.my_new_project.request: Close
2022-04-22 02:28:31.005740 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:28:31.006822 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  o as ( {{ ref('stg_orders')}} ),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }}),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  o as ( {{ ref('stg_orders')}} ),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }}),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:28:31.350458 (Thread-390): handling poll request
2022-04-22 02:28:31.350850 (Thread-390): 02:28:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38066370>]}
2022-04-22 02:28:31.351563 (Thread-390): sending response (<Response 23937 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:28.918180 (Thread-391): handling status request
2022-04-22 02:29:28.918620 (Thread-391): 02:29:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380667f0>]}
2022-04-22 02:29:28.919131 (Thread-391): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:29.242760 (Thread-392): handling run_sql request
2022-04-22 02:29:29.243157 (Thread-392): 02:29:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380669d0>]}
2022-04-22 02:29:31.761917 (Thread-392): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:31.787786 (MainThread): 02:29:31  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd7b0984e-e8eb-49c7-be67-a46a74b4a089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89e34a5e80>]}
2022-04-22 02:29:31.788318 (MainThread): 02:29:31  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:29:31.788924 (Thread-1): 02:29:31  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:29:31.789063 (Thread-1): 02:29:31  Began compiling node rpc.my_new_project.request
2022-04-22 02:29:31.789156 (Thread-1): 02:29:31  Compiling rpc.my_new_project.request
2022-04-22 02:29:31.791127 (Thread-1): 02:29:31  finished collecting timing info
2022-04-22 02:29:31.791253 (Thread-1): 02:29:31  Began executing node rpc.my_new_project.request
2022-04-22 02:29:31.791945 (Thread-1): 02:29:31  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:29:31.792034 (Thread-1): 02:29:31  On rpc.my_new_project.request: with
    x as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from x as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:29:31.792115 (Thread-1): 02:29:31  Opening a new connection, currently in state init
2022-04-22 02:29:32.059528 (Thread-393): handling poll request
2022-04-22 02:29:32.059992 (Thread-393): 02:29:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3806c9a0>]}
2022-04-22 02:29:32.060862 (Thread-393): sending response (<Response 4014 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:33.215433 (Thread-1): 02:29:33  Snowflake adapter: Snowflake query id: 01a3c495-0501-6083-0004-7d830488e53e
2022-04-22 02:29:33.215666 (Thread-1): 02:29:33  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'X' does not exist or not authorized.
2022-04-22 02:29:33.215856 (Thread-1): 02:29:33  finished collecting timing info
2022-04-22 02:29:33.216053 (Thread-1): 02:29:33  On rpc.my_new_project.request: Close
2022-04-22 02:29:33.535084 (Thread-394): handling poll request
2022-04-22 02:29:33.535506 (Thread-394): 02:29:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3806cca0>]}
2022-04-22 02:29:33.536031 (Thread-394): sending response (<Response 1775 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:33.615740 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'X' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'X' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'X' does not exist or not authorized.
2022-04-22 02:29:33.616744 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'X' does not exist or not authorized.", 'raw_sql': "with\r\n    x as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from x as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    x as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from x as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'X' does not exist or not authorized.", 'raw_sql': "with\r\n    x as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from x as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    x as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from x as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from fo\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:29:34.863108 (Thread-395): handling poll request
2022-04-22 02:29:34.863589 (Thread-395): 02:29:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3806cdc0>]}
2022-04-22 02:29:34.864307 (Thread-395): sending response (<Response 11924 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:54.955448 (Thread-396): handling status request
2022-04-22 02:29:54.955928 (Thread-396): 02:29:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a380732b0>]}
2022-04-22 02:29:54.979658 (Thread-396): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:55.294801 (Thread-397): handling run_sql request
2022-04-22 02:29:55.295206 (Thread-397): 02:29:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38073b80>]}
2022-04-22 02:29:57.781651 (Thread-397): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:57.806421 (MainThread): 02:29:57  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0299bdaa-f926-4657-a69c-0a5f203a6c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91b1b69f70>]}
2022-04-22 02:29:57.806973 (MainThread): 02:29:57  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:29:57.807561 (Thread-1): 02:29:57  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:29:57.807695 (Thread-1): 02:29:57  Began compiling node rpc.my_new_project.request
2022-04-22 02:29:57.807792 (Thread-1): 02:29:57  Compiling rpc.my_new_project.request
2022-04-22 02:29:57.809730 (Thread-1): 02:29:57  finished collecting timing info
2022-04-22 02:29:57.809857 (Thread-1): 02:29:57  Began executing node rpc.my_new_project.request
2022-04-22 02:29:57.810616 (Thread-1): 02:29:57  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:29:57.810708 (Thread-1): 02:29:57  On rpc.my_new_project.request: with
    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:29:57.810787 (Thread-1): 02:29:57  Opening a new connection, currently in state init
2022-04-22 02:29:58.216116 (Thread-398): handling poll request
2022-04-22 02:29:58.216570 (Thread-398): 02:29:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38063eb0>]}
2022-04-22 02:29:58.217473 (Thread-398): sending response (<Response 4013 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:29:58.688813 (Thread-1): 02:29:58  Snowflake adapter: Snowflake query id: 01a3c495-0501-5f4a-0004-7d830488a496
2022-04-22 02:29:58.689032 (Thread-1): 02:29:58  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:29:58.689217 (Thread-1): 02:29:58  finished collecting timing info
2022-04-22 02:29:58.689410 (Thread-1): 02:29:58  On rpc.my_new_project.request: Close
2022-04-22 02:29:58.905267 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:29:58.906304 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n    o as ({{ ref('stg_orders') }}),\r\n\r\n    fo as (\r\n        select\r\n            fo.user_id,\r\n            min(fo.order_id) as first_order_id\r\n        from o as fo\r\n        where fo.status != 'cancelled'\r\n        group by fo.user_id\r\n    )\r\n\r\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n\n    fo as (\n        select\n            fo.user_id,\n            min(fo.order_id) as first_order_id\n        from o as fo\n        where fo.status != 'cancelled'\n        group by fo.user_id\n    )\n\nselect * from o\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:29:59.537875 (Thread-399): handling poll request
2022-04-22 02:29:59.538264 (Thread-399): 02:29:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffc55b0>]}
2022-04-22 02:29:59.538951 (Thread-399): sending response (<Response 11917 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:04.486263 (Thread-400): 02:30:04  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:30:04.486529 (Thread-400): 02:30:04  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:30:04.492618 (Thread-400): 02:30:04  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fff8ea90>]}
2022-04-22 02:30:05.278724 (Thread-401): handling status request
2022-04-22 02:30:05.279164 (Thread-401): 02:30:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffbe4c0>]}
2022-04-22 02:30:05.279666 (Thread-401): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:05.334414 (Thread-402): handling status request
2022-04-22 02:30:05.334888 (Thread-402): 02:30:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffbe250>]}
2022-04-22 02:30:05.335347 (Thread-402): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:14.775776 (Thread-403): 02:30:14  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 02:30:14.776174 (Thread-403): 02:30:14  Partial parsing: added file: my_new_project://models/staging/test.sql
2022-04-22 02:30:14.780036 (Thread-403): 02:30:14  1699: static parser successfully parsed staging/test.sql
2022-04-22 02:30:14.821711 (Thread-403): 02:30:14  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ffebd5b0>]}
2022-04-22 02:30:15.577804 (Thread-404): handling status request
2022-04-22 02:30:15.578188 (Thread-404): 02:30:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fff7e5b0>]}
2022-04-22 02:30:15.578700 (Thread-404): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:15.656212 (Thread-405): handling status request
2022-04-22 02:30:15.656593 (Thread-405): 02:30:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fff7e3d0>]}
2022-04-22 02:30:15.657073 (Thread-405): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:34.097790 (Thread-406): handling status request
2022-04-22 02:30:34.098195 (Thread-406): 02:30:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fff7e220>]}
2022-04-22 02:30:34.098708 (Thread-406): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:34.431763 (Thread-407): handling run_sql request
2022-04-22 02:30:34.432152 (Thread-407): 02:30:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fff7e070>]}
2022-04-22 02:30:36.948694 (Thread-407): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:36.974245 (MainThread): 02:30:36  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f0fe316e-d7c9-497f-81de-ae0b7e5b6e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f650b0b8e50>]}
2022-04-22 02:30:36.974869 (MainThread): 02:30:36  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:30:36.975491 (Thread-1): 02:30:36  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:30:36.975631 (Thread-1): 02:30:36  Began compiling node rpc.my_new_project.request
2022-04-22 02:30:36.975730 (Thread-1): 02:30:36  Compiling rpc.my_new_project.request
2022-04-22 02:30:36.977754 (Thread-1): 02:30:36  finished collecting timing info
2022-04-22 02:30:36.977885 (Thread-1): 02:30:36  Began executing node rpc.my_new_project.request
2022-04-22 02:30:36.978492 (Thread-1): 02:30:36  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:30:36.978586 (Thread-1): 02:30:36  On rpc.my_new_project.request: select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:30:36.978669 (Thread-1): 02:30:36  Opening a new connection, currently in state init
2022-04-22 02:30:37.261570 (Thread-408): handling poll request
2022-04-22 02:30:37.262040 (Thread-408): 02:30:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3806cf10>]}
2022-04-22 02:30:37.263060 (Thread-408): sending response (<Response 3776 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:37.887451 (Thread-1): 02:30:37  Snowflake adapter: Snowflake query id: 01a3c496-0501-6083-0004-7d830488e576
2022-04-22 02:30:37.887688 (Thread-1): 02:30:37  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:30:37.887878 (Thread-1): 02:30:37  finished collecting timing info
2022-04-22 02:30:37.888089 (Thread-1): 02:30:37  On rpc.my_new_project.request: Close
2022-04-22 02:30:38.105849 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:30:38.106920 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 02:30:38.573774 (Thread-409): handling poll request
2022-04-22 02:30:38.574168 (Thread-409): 02:30:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffe3310>]}
2022-04-22 02:30:38.574827 (Thread-409): sending response (<Response 10418 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:57.904262 (Thread-410): handling status request
2022-04-22 02:30:57.904702 (Thread-410): 02:30:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3810fdc0>]}
2022-04-22 02:30:57.905207 (Thread-410): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:30:58.206713 (Thread-411): handling run_sql request
2022-04-22 02:30:58.207110 (Thread-411): 02:30:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffe3040>]}
2022-04-22 02:31:00.720294 (Thread-411): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:00.745229 (MainThread): 02:31:00  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'abcd650e-cbbe-47d6-af2b-e176412d6ffc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f696d6b1eb0>]}
2022-04-22 02:31:00.745778 (MainThread): 02:31:00  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:31:00.746378 (Thread-1): 02:31:00  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:31:00.746515 (Thread-1): 02:31:00  Began compiling node rpc.my_new_project.request
2022-04-22 02:31:00.746612 (Thread-1): 02:31:00  Compiling rpc.my_new_project.request
2022-04-22 02:31:00.748754 (Thread-1): 02:31:00  finished collecting timing info
2022-04-22 02:31:00.748883 (Thread-1): 02:31:00  Began executing node rpc.my_new_project.request
2022-04-22 02:31:00.749960 (Thread-1): 02:31:00  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:31:00.750049 (Thread-1): 02:31:00  On rpc.my_new_project.request: with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:31:00.750130 (Thread-1): 02:31:00  Opening a new connection, currently in state init
2022-04-22 02:31:01.022301 (Thread-412): handling poll request
2022-04-22 02:31:01.022800 (Thread-412): 02:31:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffd8820>]}
2022-04-22 02:31:01.023694 (Thread-412): sending response (<Response 4483 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:01.694965 (Thread-1): 02:31:01  SQL status: SUCCESS 500 in 0.94 seconds
2022-04-22 02:31:01.709591 (Thread-1): 02:31:01  finished collecting timing info
2022-04-22 02:31:01.709863 (Thread-1): 02:31:01  On rpc.my_new_project.request: Close
2022-04-22 02:31:02.328089 (Thread-413): handling poll request
2022-04-22 02:31:02.328487 (Thread-413): 02:31:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38be5a60>]}
2022-04-22 02:31:02.331995 (Thread-413): sending response (<Response 24747 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:30.761720 (Thread-414): handling status request
2022-04-22 02:31:30.762134 (Thread-414): 02:31:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38be5e20>]}
2022-04-22 02:31:30.762680 (Thread-414): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:31.074715 (Thread-415): handling run_sql request
2022-04-22 02:31:31.075113 (Thread-415): 02:31:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38be5eb0>]}
2022-04-22 02:31:33.570499 (Thread-415): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:33.596881 (MainThread): 02:31:33  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5926f1c9-98c4-4e27-9f27-a0b77d271102', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e7753c220>]}
2022-04-22 02:31:33.597393 (MainThread): 02:31:33  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:31:33.597976 (Thread-1): 02:31:33  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:31:33.598117 (Thread-1): 02:31:33  Began compiling node rpc.my_new_project.request
2022-04-22 02:31:33.598215 (Thread-1): 02:31:33  Compiling rpc.my_new_project.request
2022-04-22 02:31:33.600135 (Thread-1): 02:31:33  finished collecting timing info
2022-04-22 02:31:33.600260 (Thread-1): 02:31:33  Began executing node rpc.my_new_project.request
2022-04-22 02:31:33.600771 (Thread-1): 02:31:33  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:31:33.600858 (Thread-1): 02:31:33  On rpc.my_new_project.request: select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:31:33.600937 (Thread-1): 02:31:33  Opening a new connection, currently in state init
2022-04-22 02:31:33.870962 (Thread-416): handling poll request
2022-04-22 02:31:33.871444 (Thread-416): 02:31:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bd84c0>]}
2022-04-22 02:31:33.872344 (Thread-416): sending response (<Response 3777 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:35.190812 (Thread-417): handling poll request
2022-04-22 02:31:35.191241 (Thread-417): 02:31:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38be5f40>]}
2022-04-22 02:31:35.191704 (Thread-417): sending response (<Response 385 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:31:35.636093 (Thread-1): 02:31:35  Snowflake adapter: Snowflake query id: 01a3c497-0501-5f4a-0004-7d830488a54e
2022-04-22 02:31:35.636325 (Thread-1): 02:31:35  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:31:35.636514 (Thread-1): 02:31:35  finished collecting timing info
2022-04-22 02:31:35.636715 (Thread-1): 02:31:35  On rpc.my_new_project.request: Close
2022-04-22 02:31:35.849653 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:31:35.850662 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 02:31:36.490469 (Thread-418): handling poll request
2022-04-22 02:31:36.490889 (Thread-418): 02:31:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bd8940>]}
2022-04-22 02:31:36.491566 (Thread-418): sending response (<Response 10418 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:11.625622 (Thread-419): handling status request
2022-04-22 02:32:11.626040 (Thread-419): 02:32:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bd8dc0>]}
2022-04-22 02:32:11.626599 (Thread-419): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:11.958326 (Thread-420): handling run_sql request
2022-04-22 02:32:11.958728 (Thread-420): 02:32:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bd8f70>]}
2022-04-22 02:32:14.469101 (Thread-420): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:14.494620 (MainThread): 02:32:14  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba77a320-9b73-4756-981a-fe7f30c81cca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3a6cf0850>]}
2022-04-22 02:32:14.495226 (MainThread): 02:32:14  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:32:14.495851 (Thread-1): 02:32:14  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:32:14.495989 (Thread-1): 02:32:14  Began compiling node rpc.my_new_project.request
2022-04-22 02:32:14.496085 (Thread-1): 02:32:14  Compiling rpc.my_new_project.request
2022-04-22 02:32:14.498226 (Thread-1): 02:32:14  finished collecting timing info
2022-04-22 02:32:14.498404 (Thread-1): 02:32:14  Began executing node rpc.my_new_project.request
2022-04-22 02:32:14.498981 (Thread-1): 02:32:14  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:32:14.499085 (Thread-1): 02:32:14  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_orders)
select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:32:14.499168 (Thread-1): 02:32:14  Opening a new connection, currently in state init
2022-04-22 02:32:14.771829 (Thread-421): handling poll request
2022-04-22 02:32:14.772348 (Thread-421): 02:32:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bf0fa0>]}
2022-04-22 02:32:14.773230 (Thread-421): sending response (<Response 3807 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:15.591070 (Thread-1): 02:32:15  SQL status: SUCCESS 500 in 1.09 seconds
2022-04-22 02:32:15.604787 (Thread-1): 02:32:15  finished collecting timing info
2022-04-22 02:32:15.605033 (Thread-1): 02:32:15  On rpc.my_new_project.request: Close
2022-04-22 02:32:16.094725 (Thread-422): handling poll request
2022-04-22 02:32:16.095133 (Thread-422): 02:32:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bf0dc0>]}
2022-04-22 02:32:16.098094 (Thread-422): sending response (<Response 63159 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:46.929824 (Thread-423): handling status request
2022-04-22 02:32:46.930218 (Thread-423): 02:32:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38bf0430>]}
2022-04-22 02:32:46.930749 (Thread-423): sending response (<Response 1552 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:47.236156 (Thread-424): handling run_sql request
2022-04-22 02:32:47.236549 (Thread-424): 02:32:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ffe65040>]}
2022-04-22 02:32:49.753972 (Thread-424): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:49.779825 (MainThread): 02:32:49  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad3bac69-e29f-49c2-93ea-4c7a96d932ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f071aeb2f10>]}
2022-04-22 02:32:49.780383 (MainThread): 02:32:49  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:32:49.781001 (Thread-1): 02:32:49  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:32:49.781141 (Thread-1): 02:32:49  Began compiling node rpc.my_new_project.request
2022-04-22 02:32:49.781240 (Thread-1): 02:32:49  Compiling rpc.my_new_project.request
2022-04-22 02:32:49.783368 (Thread-1): 02:32:49  finished collecting timing info
2022-04-22 02:32:49.783496 (Thread-1): 02:32:49  Began executing node rpc.my_new_project.request
2022-04-22 02:32:49.784205 (Thread-1): 02:32:49  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:32:49.784293 (Thread-1): 02:32:49  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:32:49.784375 (Thread-1): 02:32:49  Opening a new connection, currently in state init
2022-04-22 02:32:50.089770 (Thread-425): handling poll request
2022-04-22 02:32:50.090241 (Thread-425): 02:32:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ffe36190>]}
2022-04-22 02:32:50.091177 (Thread-425): sending response (<Response 4024 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:51.344287 (Thread-1): 02:32:51  SQL status: SUCCESS 500 in 1.56 seconds
2022-04-22 02:32:51.351794 (Thread-1): 02:32:51  finished collecting timing info
2022-04-22 02:32:51.352033 (Thread-1): 02:32:51  On rpc.my_new_project.request: Close
2022-04-22 02:32:51.452086 (Thread-426): handling poll request
2022-04-22 02:32:51.452475 (Thread-426): 02:32:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ffe651c0>]}
2022-04-22 02:32:51.474853 (Thread-426): sending response (<Response 1376 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:32:52.779378 (Thread-427): handling poll request
2022-04-22 02:32:52.779789 (Thread-427): 02:32:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ffdda850>]}
2022-04-22 02:32:52.781726 (Thread-427): sending response (<Response 12944 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:05.943553 (Thread-428): 02:33:05  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:33:05.944000 (Thread-428): 02:33:05  Partial parsing: updated file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 02:33:05.947981 (Thread-428): 02:33:05  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 02:33:05.991863 (Thread-428): 02:33:05  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38514f10>]}
2022-04-22 02:33:06.402105 (Thread-429): handling status request
2022-04-22 02:33:06.402527 (Thread-429): 02:33:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38370d90>]}
2022-04-22 02:33:06.403049 (Thread-429): sending response (<Response 1576 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:06.409713 (Thread-430): handling status request
2022-04-22 02:33:06.409968 (Thread-430): 02:33:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38370250>]}
2022-04-22 02:33:06.410361 (Thread-430): sending response (<Response 1576 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:17.483833 (Thread-431): 02:33:17  Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
2022-04-22 02:33:17.484120 (Thread-431): 02:33:17  Partial parsing: deleted file: my_new_project://models/staging/test.sql
2022-04-22 02:33:17.531290 (Thread-431): 02:33:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386d5f10>]}
2022-04-22 02:33:18.191081 (Thread-432): handling status request
2022-04-22 02:33:18.191494 (Thread-432): 02:33:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383e82b0>]}
2022-04-22 02:33:18.191976 (Thread-432): sending response (<Response 1256 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:18.255668 (Thread-433): handling status request
2022-04-22 02:33:18.256052 (Thread-433): 02:33:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383e8520>]}
2022-04-22 02:33:18.256501 (Thread-433): sending response (<Response 1256 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:29.654725 (Thread-434): handling status request
2022-04-22 02:33:29.655129 (Thread-434): 02:33:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383e8940>]}
2022-04-22 02:33:29.655592 (Thread-434): sending response (<Response 1256 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:29.978784 (Thread-435): handling run_sql request
2022-04-22 02:33:29.979233 (Thread-435): 02:33:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383e8ca0>]}
2022-04-22 02:33:32.486423 (Thread-435): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:32.512656 (MainThread): 02:33:32  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bdf0d11f-1e34-44ef-9dae-147ff0568aed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fead0177fd0>]}
2022-04-22 02:33:32.513185 (MainThread): 02:33:32  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:33:32.513770 (Thread-1): 02:33:32  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:33:32.513907 (Thread-1): 02:33:32  Began compiling node rpc.my_new_project.request
2022-04-22 02:33:32.514003 (Thread-1): 02:33:32  Compiling rpc.my_new_project.request
2022-04-22 02:33:32.516994 (Thread-1): 02:33:32  finished collecting timing info
2022-04-22 02:33:32.517120 (Thread-1): 02:33:32  Began executing node rpc.my_new_project.request
2022-04-22 02:33:32.519355 (Thread-1): 02:33:32  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:33:32.519454 (Thread-1): 02:33:32  On rpc.my_new_project.request: with
  o as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:33:32.519534 (Thread-1): 02:33:32  Opening a new connection, currently in state init
2022-04-22 02:33:32.806634 (Thread-436): handling poll request
2022-04-22 02:33:32.807094 (Thread-436): 02:33:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3838c130>]}
2022-04-22 02:33:32.808076 (Thread-436): sending response (<Response 5663 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:33.787635 (Thread-1): 02:33:33  Snowflake adapter: Snowflake query id: 01a3c499-0501-6083-0004-7d830488e5da
2022-04-22 02:33:33.787871 (Thread-1): 02:33:33  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 02:33:33.788062 (Thread-1): 02:33:33  finished collecting timing info
2022-04-22 02:33:33.788294 (Thread-1): 02:33:33  On rpc.my_new_project.request: Close
2022-04-22 02:33:34.110835 (Thread-437): handling poll request
2022-04-22 02:33:34.111282 (Thread-437): 02:33:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3838cd60>]}
2022-04-22 02:33:34.111830 (Thread-437): sending response (<Response 1767 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:34.366843 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 02:33:34.367916 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  o as ( {{ ref('stg_orders')}} ),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  o as ( {{ ref('stg_orders')}} ),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:33:35.407247 (Thread-438): handling poll request
2022-04-22 02:33:35.407637 (Thread-438): 02:33:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383625b0>]}
2022-04-22 02:33:35.408403 (Thread-438): sending response (<Response 23944 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:52.734834 (Thread-439): 02:33:52  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:33:52.735284 (Thread-439): 02:33:52  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 02:33:52.739769 (Thread-439): 02:33:52  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 02:33:52.783156 (Thread-439): 02:33:52  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3860d3d0>]}
2022-04-22 02:33:53.393522 (Thread-440): handling status request
2022-04-22 02:33:53.393956 (Thread-440): 02:33:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38358b50>]}
2022-04-22 02:33:53.394498 (Thread-440): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:53.418864 (Thread-441): handling status request
2022-04-22 02:33:53.419188 (Thread-441): 02:33:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffd8a60>]}
2022-04-22 02:33:53.419627 (Thread-441): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:54.652718 (Thread-442): handling status request
2022-04-22 02:33:54.653112 (Thread-442): 02:33:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffd8a60>]}
2022-04-22 02:33:54.653579 (Thread-442): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:54.974832 (Thread-443): handling run_sql request
2022-04-22 02:33:54.975227 (Thread-443): 02:33:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fffd8790>]}
2022-04-22 02:33:57.506143 (Thread-443): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:57.533938 (MainThread): 02:33:57  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2933efbc-5084-4372-8df0-aef76d6af3bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c2516be50>]}
2022-04-22 02:33:57.534504 (MainThread): 02:33:57  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:33:57.535107 (Thread-1): 02:33:57  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:33:57.535246 (Thread-1): 02:33:57  Began compiling node rpc.my_new_project.request
2022-04-22 02:33:57.535339 (Thread-1): 02:33:57  Compiling rpc.my_new_project.request
2022-04-22 02:33:57.538482 (Thread-1): 02:33:57  finished collecting timing info
2022-04-22 02:33:57.538611 (Thread-1): 02:33:57  Began executing node rpc.my_new_project.request
2022-04-22 02:33:57.540812 (Thread-1): 02:33:57  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:33:57.540910 (Thread-1): 02:33:57  On rpc.my_new_project.request: with
  o as (select * from raw.interview_sample_data.interview_orders),
  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:33:57.540991 (Thread-1): 02:33:57  Opening a new connection, currently in state init
2022-04-22 02:33:57.823139 (Thread-444): handling poll request
2022-04-22 02:33:57.823630 (Thread-444): 02:33:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38370400>]}
2022-04-22 02:33:57.824588 (Thread-444): sending response (<Response 5671 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:33:58.641419 (Thread-1): 02:33:58  Snowflake adapter: Snowflake query id: 01a3c499-0501-6083-0004-7d830488e5de
2022-04-22 02:33:58.641644 (Thread-1): 02:33:58  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'DO' does not exist or not authorized.
2022-04-22 02:33:58.641829 (Thread-1): 02:33:58  finished collecting timing info
2022-04-22 02:33:58.642025 (Thread-1): 02:33:58  On rpc.my_new_project.request: Close
2022-04-22 02:33:59.076465 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'DO' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'DO' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'DO' does not exist or not authorized.
2022-04-22 02:33:59.077777 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'DO' does not exist or not authorized.", 'raw_sql': "with\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as (select * from raw.interview_sample_data.interview_orders),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'DO' does not exist or not authorized.", 'raw_sql': "with\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as (select * from raw.interview_sample_data.interview_orders),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:33:59.130212 (Thread-445): handling poll request
2022-04-22 02:33:59.130675 (Thread-445): 02:33:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38370730>]}
2022-04-22 02:33:59.131315 (Thread-445): sending response (<Response 14831 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:34:00.455189 (Thread-446): handling poll request
2022-04-22 02:34:00.455583 (Thread-446): 02:34:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38e059a0>]}
2022-04-22 02:34:00.456322 (Thread-446): sending response (<Response 24124 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:38:55.768091 (Thread-447): handling status request
2022-04-22 02:38:55.770124 (Thread-447): 02:38:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38370b20>]}
2022-04-22 02:38:55.770994 (Thread-447): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:38:56.095720 (Thread-448): handling run_sql request
2022-04-22 02:38:56.096126 (Thread-448): 02:38:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385317c0>]}
2022-04-22 02:38:58.602424 (Thread-448): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:38:58.630256 (MainThread): 02:38:58  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '32ce7463-a091-4c04-8106-ef592bc34e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc72047ec10>]}
2022-04-22 02:38:58.630803 (MainThread): 02:38:58  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:38:58.631387 (Thread-1): 02:38:58  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:38:58.631522 (Thread-1): 02:38:58  Began compiling node rpc.my_new_project.request
2022-04-22 02:38:58.631618 (Thread-1): 02:38:58  Compiling rpc.my_new_project.request
2022-04-22 02:38:58.634711 (Thread-1): 02:38:58  finished collecting timing info
2022-04-22 02:38:58.634838 (Thread-1): 02:38:58  Began executing node rpc.my_new_project.request
2022-04-22 02:38:58.636999 (Thread-1): 02:38:58  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:38:58.637093 (Thread-1): 02:38:58  On rpc.my_new_project.request: with
  o as (select * from raw.interview_sample_data.interview_orders),
  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:38:58.637173 (Thread-1): 02:38:58  Opening a new connection, currently in state init
2022-04-22 02:38:58.937781 (Thread-449): handling poll request
2022-04-22 02:38:58.938230 (Thread-449): 02:38:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38519610>]}
2022-04-22 02:38:58.939193 (Thread-449): sending response (<Response 5671 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:38:59.595029 (Thread-1): 02:38:59  Snowflake adapter: Snowflake query id: 01a3c49e-0501-5f4a-0004-7d830488a5fe
2022-04-22 02:38:59.595290 (Thread-1): 02:38:59  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'DO' does not exist or not authorized.
2022-04-22 02:38:59.595483 (Thread-1): 02:38:59  finished collecting timing info
2022-04-22 02:38:59.595678 (Thread-1): 02:38:59  On rpc.my_new_project.request: Close
2022-04-22 02:38:59.787364 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'DO' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'DO' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'DO' does not exist or not authorized.
2022-04-22 02:38:59.788399 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'DO' does not exist or not authorized.", 'raw_sql': "with\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as (select * from raw.interview_sample_data.interview_orders),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'DO' does not exist or not authorized.", 'raw_sql': "with\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  do as ( {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as (select * from raw.interview_sample_data.interview_orders),\n  do as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:39:00.248906 (Thread-450): handling poll request
2022-04-22 02:39:00.249308 (Thread-450): 02:39:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38519310>]}
2022-04-22 02:39:00.250028 (Thread-450): sending response (<Response 24124 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:39:47.774325 (Thread-451): handling status request
2022-04-22 02:39:47.774741 (Thread-451): 02:39:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38362520>]}
2022-04-22 02:39:47.775289 (Thread-451): sending response (<Response 1538 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:39:47.777226 (Thread-452): handling status request
2022-04-22 02:39:47.777559 (Thread-452): 02:39:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387f0b50>]}
2022-04-22 02:39:47.777945 (Thread-452): sending response (<Response 1538 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:39:47.780794 (Thread-453): handling list request
2022-04-22 02:39:47.781039 (Thread-453): 02:39:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38578d30>]}
2022-04-22 02:39:47.877240 (Thread-454): sending response (<Response 214 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:39:49.139225 (Thread-455): handling status request
2022-04-22 02:39:49.139621 (Thread-455): 02:39:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a3836bd00>]}
2022-04-22 02:39:49.140101 (Thread-455): sending response (<Response 1538 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:39:49.145886 (Thread-456): handling list request
2022-04-22 02:39:49.146176 (Thread-456): 02:39:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386e09a0>]}
2022-04-22 02:39:49.181430 (Thread-456): 02:39:49  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a387f0430>]}
2022-04-22 02:39:49.181809 (Thread-456): 02:39:49  Found 12 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:39:49.185107 (Thread-456): sending response (<Response 5557 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:40:50.728470 (Thread-457): 02:40:50  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 02:40:50.728881 (Thread-457): 02:40:50  Partial parsing: added file: my_new_project://models/marts/test.sql
2022-04-22 02:40:50.732990 (Thread-457): 02:40:50  1699: static parser successfully parsed marts/test.sql
2022-04-22 02:40:50.780377 (Thread-457): 02:40:50  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a74152e20>]}
2022-04-22 02:40:51.506739 (Thread-458): handling status request
2022-04-22 02:40:51.507642 (Thread-459): handling status request
2022-04-22 02:40:51.507912 (Thread-458): 02:40:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a740d81f0>]}
2022-04-22 02:40:51.508209 (Thread-459): 02:40:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cd6670>]}
2022-04-22 02:40:51.508719 (Thread-458): sending response (<Response 1526 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:40:51.509181 (Thread-459): sending response (<Response 1526 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:40:51.551843 (Thread-460): handling list request
2022-04-22 02:40:51.552614 (Thread-461): handling list request
2022-04-22 02:40:51.552854 (Thread-460): 02:40:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cd6fa0>]}
2022-04-22 02:40:51.553141 (Thread-461): 02:40:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ccb730>]}
2022-04-22 02:40:51.587272 (Thread-462): handling status request
2022-04-22 02:40:51.594219 (Thread-460): sending response (<Response 4540 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:40:51.587516 (Thread-462): 02:40:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385f95e0>]}
2022-04-22 02:40:51.587964 (Thread-462): sending response (<Response 1548 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:40:51.588493 (Thread-460): 02:40:51  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385f9880>]}
2022-04-22 02:40:51.588764 (Thread-460): 02:40:51  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:40:51.589508 (Thread-461): 02:40:51  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7415ed30>]}
2022-04-22 02:40:51.589785 (Thread-461): 02:40:51  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:40:51.592586 (Thread-461): 02:40:51  The selection criterion '+models/marts/test.sql+' does not match any nodes
2022-04-22 02:40:51.592750 (Thread-461): 02:40:51  No nodes selected!
2022-04-22 02:40:51.596597 (Thread-461): sending response (<Response 4270 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:40:51.843802 (Thread-463): handling status request
2022-04-22 02:40:51.844202 (Thread-463): 02:40:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ccb790>]}
2022-04-22 02:40:51.844671 (Thread-463): sending response (<Response 1548 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:41:11.966312 (Thread-464): handling status request
2022-04-22 02:41:11.966707 (Thread-464): 02:41:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cef5b0>]}
2022-04-22 02:41:11.967178 (Thread-464): sending response (<Response 1548 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:41:12.264325 (Thread-465): handling run_sql request
2022-04-22 02:41:12.264712 (Thread-465): 02:41:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38cefc70>]}
2022-04-22 02:41:14.775801 (Thread-465): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:41:14.800437 (MainThread): 02:41:14  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b28ac1a2-222c-478a-b987-f4bd49e4cb0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f14b5a4be50>]}
2022-04-22 02:41:14.800989 (MainThread): 02:41:14  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:41:14.801578 (Thread-1): 02:41:14  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:41:14.801717 (Thread-1): 02:41:14  Began compiling node rpc.my_new_project.request
2022-04-22 02:41:14.801817 (Thread-1): 02:41:14  Compiling rpc.my_new_project.request
2022-04-22 02:41:14.803765 (Thread-1): 02:41:14  finished collecting timing info
2022-04-22 02:41:14.803895 (Thread-1): 02:41:14  Began executing node rpc.my_new_project.request
2022-04-22 02:41:14.804425 (Thread-1): 02:41:14  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:41:14.804511 (Thread-1): 02:41:14  On rpc.my_new_project.request: select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:41:14.804592 (Thread-1): 02:41:14  Opening a new connection, currently in state init
2022-04-22 02:41:15.092163 (Thread-466): handling poll request
2022-04-22 02:41:15.092692 (Thread-466): 02:41:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a383bea00>]}
2022-04-22 02:41:15.093594 (Thread-466): sending response (<Response 3775 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:41:15.677451 (Thread-1): 02:41:15  Snowflake adapter: Snowflake query id: 01a3c4a1-0501-5f4a-0004-7d830488a6ba
2022-04-22 02:41:15.677682 (Thread-1): 02:41:15  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:41:15.677871 (Thread-1): 02:41:15  finished collecting timing info
2022-04-22 02:41:15.678074 (Thread-1): 02:41:15  On rpc.my_new_project.request: Close
2022-04-22 02:41:15.878974 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:41:15.880047 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 02:41:16.389687 (Thread-467): handling poll request
2022-04-22 02:41:16.390076 (Thread-467): 02:41:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a386bfa90>]}
2022-04-22 02:41:16.391565 (Thread-467): sending response (<Response 10413 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:48:11.505197 (Thread-468): handling status request
2022-04-22 02:48:11.506876 (Thread-468): 02:48:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38ccb790>]}
2022-04-22 02:48:11.507441 (Thread-468): sending response (<Response 1548 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:48:11.831596 (Thread-469): handling run_sql request
2022-04-22 02:48:11.831998 (Thread-469): 02:48:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38dffee0>]}
2022-04-22 02:48:14.407417 (Thread-469): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:48:14.436719 (MainThread): 02:48:14  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f9b5d3b-e71f-4e5a-aa5a-1520c7631dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3e84f7ca0>]}
2022-04-22 02:48:14.437337 (MainThread): 02:48:14  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:48:14.437971 (Thread-1): 02:48:14  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:48:14.438112 (Thread-1): 02:48:14  Began compiling node rpc.my_new_project.request
2022-04-22 02:48:14.438350 (Thread-1): 02:48:14  Compiling rpc.my_new_project.request
2022-04-22 02:48:14.441699 (Thread-1): 02:48:14  finished collecting timing info
2022-04-22 02:48:14.441836 (Thread-1): 02:48:14  Began executing node rpc.my_new_project.request
2022-04-22 02:48:14.444190 (Thread-1): 02:48:14  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:48:14.444292 (Thread-1): 02:48:14  On rpc.my_new_project.request: with
  o as (select * from raw.interview_sample_data.interview_orders),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:48:14.444375 (Thread-1): 02:48:14  Opening a new connection, currently in state init
2022-04-22 02:48:14.717370 (Thread-470): handling poll request
2022-04-22 02:48:14.717839 (Thread-470): 02:48:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a65a90d00>]}
2022-04-22 02:48:14.718792 (Thread-470): sending response (<Response 5685 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:48:15.495706 (Thread-1): 02:48:15  Snowflake adapter: Snowflake query id: 01a3c4a8-0501-6163-0004-7d830488d9de
2022-04-22 02:48:15.495949 (Thread-1): 02:48:15  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:48:15.496142 (Thread-1): 02:48:15  finished collecting timing info
2022-04-22 02:48:15.496341 (Thread-1): 02:48:15  On rpc.my_new_project.request: Close
2022-04-22 02:48:15.702931 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:48:15.704039 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "with\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as (select * from raw.interview_sample_data.interview_orders),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "with\r\n  o as (select * from {{ source('interview_sample_data', 'interview_orders') }}),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( {{ ref('stg_first_order') }} ),\r\n  pa as ( {{ ref('stg_payments') }} ),\r\n  ct as ( {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as (select * from raw.interview_sample_data.interview_orders),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 02:48:16.028703 (Thread-471): handling poll request
2022-04-22 02:48:16.029095 (Thread-471): 02:48:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a9408a760>]}
2022-04-22 02:48:16.029798 (Thread-471): sending response (<Response 24453 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:49:06.922726 (Thread-472): handling status request
2022-04-22 02:49:06.923119 (Thread-472): 02:49:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38731940>]}
2022-04-22 02:49:06.923653 (Thread-472): sending response (<Response 1548 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:49:07.238935 (Thread-473): handling compile_sql request
2022-04-22 02:49:07.239334 (Thread-473): 02:49:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38731070>]}
2022-04-22 02:49:09.761654 (Thread-473): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:49:09.786906 (MainThread): 02:49:09  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba44bc9f-5a7f-4460-b892-be93a45658eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f5ba7ce80>]}
2022-04-22 02:49:09.787519 (MainThread): 02:49:09  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:49:09.788130 (Thread-1): 02:49:09  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:49:09.788265 (Thread-1): 02:49:09  Began compiling node rpc.my_new_project.request
2022-04-22 02:49:09.788364 (Thread-1): 02:49:09  Compiling rpc.my_new_project.request
2022-04-22 02:49:09.790329 (Thread-1): 02:49:09  finished collecting timing info
2022-04-22 02:49:09.790460 (Thread-1): 02:49:09  Began executing node rpc.my_new_project.request
2022-04-22 02:49:09.790557 (Thread-1): 02:49:09  finished collecting timing info
2022-04-22 02:49:10.064638 (Thread-474): handling poll request
2022-04-22 02:49:10.065084 (Thread-474): 02:49:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a7416c250>]}
2022-04-22 02:49:10.066237 (Thread-474): sending response (<Response 5338 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:16.188897 (Thread-475): 02:50:16  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:50:16.191014 (Thread-475): 02:50:16  Partial parsing: updated file: my_new_project://models/marts/test.sql
2022-04-22 02:50:16.195061 (Thread-475): 02:50:16  1699: static parser successfully parsed marts/test.sql
2022-04-22 02:50:16.236095 (Thread-475): 02:50:16  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38698640>]}
2022-04-22 02:50:16.890067 (Thread-476): handling status request
2022-04-22 02:50:16.890507 (Thread-476): 02:50:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf659bb0>]}
2022-04-22 02:50:16.891067 (Thread-476): sending response (<Response 1550 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:16.945080 (Thread-477): handling status request
2022-04-22 02:50:16.945438 (Thread-477): 02:50:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2aaf659c70>]}
2022-04-22 02:50:16.945885 (Thread-477): sending response (<Response 1550 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:24.367811 (Thread-478): 02:50:24  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 02:50:24.368259 (Thread-478): 02:50:24  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 02:50:24.372474 (Thread-478): 02:50:24  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 02:50:24.412276 (Thread-478): 02:50:24  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a385d4eb0>]}
2022-04-22 02:50:25.091711 (Thread-479): handling status request
2022-04-22 02:50:25.092115 (Thread-479): 02:50:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f6c820>]}
2022-04-22 02:50:25.092597 (Thread-479): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:25.255511 (Thread-480): handling status request
2022-04-22 02:50:25.255917 (Thread-480): 02:50:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f6cfd0>]}
2022-04-22 02:50:25.256395 (Thread-480): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:55.378033 (Thread-481): handling status request
2022-04-22 02:50:55.378445 (Thread-481): 02:50:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38f6ca60>]}
2022-04-22 02:50:55.400088 (Thread-481): sending response (<Response 1560 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:58.266881 (Thread-482): 02:50:58  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:50:58.267111 (Thread-482): 02:50:58  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:50:58.272612 (Thread-482): 02:50:58  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29fd58a460>]}
2022-04-22 02:50:58.981950 (Thread-483): handling status request
2022-04-22 02:50:58.982401 (Thread-483): 02:50:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38694f10>]}
2022-04-22 02:50:58.982888 (Thread-483): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:50:59.037957 (Thread-484): handling status request
2022-04-22 02:50:59.038386 (Thread-484): 02:50:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '5ce8a185-c08d-44a4-a4f2-ae4ad553881f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2a38694ee0>]}
2022-04-22 02:50:59.038841 (Thread-484): sending response (<Response 1244 bytes [200 OK]>) to 10.0.2.37
2022-04-22 02:54:28.415875 (MainThread): Running with dbt=1.0.5
2022-04-22 02:54:28.994995 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-22 02:54:29.009426 (MainThread): Tracking: tracking
2022-04-22 02:54:29.009837 (MainThread): 02:54:29  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa873c9f2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624fdd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624fde50>]}
2022-04-22 02:54:29.010191 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=23
2022-04-22 02:54:29.010938 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-22 02:54:29.011265 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-22 02:54:29.124751 (Thread-12): 02:54:29  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 02:54:29.124964 (Thread-12): 02:54:29  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 02:54:29.131525 (Thread-12): 02:54:29  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dda1f40>]}
2022-04-22 02:54:30.814105 (Thread-13): handling ps request
2022-04-22 02:54:30.815023 (Thread-14): handling status request
2022-04-22 02:54:30.815285 (Thread-13): 02:54:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bb610>]}
2022-04-22 02:54:30.815570 (Thread-14): 02:54:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd91f40>]}
2022-04-22 02:54:30.816197 (Thread-13): sending response (<Response 105 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:30.816705 (Thread-14): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:31.200864 (Thread-15): handling status request
2022-04-22 02:54:31.201253 (Thread-15): 02:54:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bb160>]}
2022-04-22 02:54:31.201702 (Thread-15): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:31.229467 (Thread-16): handling status request
2022-04-22 02:54:31.229880 (Thread-16): 02:54:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bb9d0>]}
2022-04-22 02:54:31.230563 (Thread-16): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:32.986352 (Thread-17): handling status request
2022-04-22 02:54:32.986749 (Thread-17): 02:54:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bb820>]}
2022-04-22 02:54:32.987267 (Thread-17): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:44.622265 (Thread-18): handling status request
2022-04-22 02:54:44.623240 (Thread-18): 02:54:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd91d90>]}
2022-04-22 02:54:44.623748 (Thread-18): sending response (<Response 1219 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:44.630286 (Thread-19): handling list request
2022-04-22 02:54:44.630547 (Thread-19): 02:54:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd91f10>]}
2022-04-22 02:54:44.666894 (Thread-19): 02:54:44  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa86243f1f0>]}
2022-04-22 02:54:44.667284 (Thread-19): 02:54:44  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:54:44.672101 (Thread-19): sending response (<Response 2582 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:48.004269 (Thread-20): handling status request
2022-04-22 02:54:48.004683 (Thread-20): 02:54:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bbc70>]}
2022-04-22 02:54:48.005154 (Thread-20): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:48.329506 (Thread-21): handling compile_sql request
2022-04-22 02:54:48.329930 (Thread-21): 02:54:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bbaf0>]}
2022-04-22 02:54:50.843013 (Thread-21): sending response (<Response 138 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:54:50.868477 (MainThread): 02:54:50  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42282847-5662-44c2-bd56-e9d2ba51578f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fedb7e34ee0>]}
2022-04-22 02:54:50.869040 (MainThread): 02:54:50  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:54:50.869640 (Thread-1): 02:54:50  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:54:50.869780 (Thread-1): 02:54:50  Began compiling node rpc.my_new_project.request
2022-04-22 02:54:50.869878 (Thread-1): 02:54:50  Compiling rpc.my_new_project.request
2022-04-22 02:54:50.871824 (Thread-1): 02:54:50  finished collecting timing info
2022-04-22 02:54:50.871973 (Thread-1): 02:54:50  Began executing node rpc.my_new_project.request
2022-04-22 02:54:50.872079 (Thread-1): 02:54:50  finished collecting timing info
2022-04-22 02:54:51.178747 (Thread-22): handling poll request
2022-04-22 02:54:51.179194 (Thread-22): 02:54:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85ddaa2e0>]}
2022-04-22 02:54:51.180331 (Thread-22): sending response (<Response 5330 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:24.169462 (Thread-23): handling status request
2022-04-22 02:55:24.171967 (Thread-23): 02:55:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85ddaa820>]}
2022-04-22 02:55:24.172528 (Thread-23): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:24.484173 (Thread-24): handling run_sql request
2022-04-22 02:55:24.484555 (Thread-24): 02:55:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85ddaa910>]}
2022-04-22 02:55:27.130643 (Thread-24): sending response (<Response 138 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:27.157151 (MainThread): 02:55:27  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb746ab5-4e43-4f8d-9172-378faefdf412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f9cdf2eb0>]}
2022-04-22 02:55:27.157706 (MainThread): 02:55:27  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:55:27.158312 (Thread-1): 02:55:27  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:55:27.158451 (Thread-1): 02:55:27  Began compiling node rpc.my_new_project.request
2022-04-22 02:55:27.158559 (Thread-1): 02:55:27  Compiling rpc.my_new_project.request
2022-04-22 02:55:27.160494 (Thread-1): 02:55:27  finished collecting timing info
2022-04-22 02:55:27.160623 (Thread-1): 02:55:27  Began executing node rpc.my_new_project.request
2022-04-22 02:55:27.161192 (Thread-1): 02:55:27  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:55:27.161282 (Thread-1): 02:55:27  On rpc.my_new_project.request: select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:55:27.161364 (Thread-1): 02:55:27  Opening a new connection, currently in state init
2022-04-22 02:55:27.478335 (Thread-25): handling poll request
2022-04-22 02:55:27.478772 (Thread-25): 02:55:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624f0460>]}
2022-04-22 02:55:27.479617 (Thread-25): sending response (<Response 3765 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:28.115416 (Thread-1): 02:55:28  Snowflake adapter: Snowflake query id: 01a3c4af-0501-5f4a-0004-7d830488a866
2022-04-22 02:55:28.115656 (Thread-1): 02:55:28  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:55:28.115902 (Thread-1): 02:55:28  finished collecting timing info
2022-04-22 02:55:28.116132 (Thread-1): 02:55:28  On rpc.my_new_project.request: Close
2022-04-22 02:55:28.407507 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 02:55:28.408533 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 02:55:28.800685 (Thread-26): handling poll request
2022-04-22 02:55:28.801073 (Thread-26): 02:55:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd004c0>]}
2022-04-22 02:55:28.801642 (Thread-26): sending response (<Response 10397 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:35.944057 (Thread-27): handling status request
2022-04-22 02:55:35.944437 (Thread-27): 02:55:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd00940>]}
2022-04-22 02:55:35.944960 (Thread-27): sending response (<Response 1219 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:35.949905 (Thread-28): handling list request
2022-04-22 02:55:35.950164 (Thread-28): 02:55:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd00b20>]}
2022-04-22 02:55:36.013696 (Thread-30): sending response (<Response 214 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:37.299996 (Thread-31): handling status request
2022-04-22 02:55:37.300396 (Thread-31): 02:55:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bbcd0>]}
2022-04-22 02:55:37.300903 (Thread-31): sending response (<Response 1219 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:37.306100 (Thread-32): handling list request
2022-04-22 02:55:37.306352 (Thread-32): 02:55:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd19fd0>]}
2022-04-22 02:55:37.340544 (Thread-32): 02:55:37  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd349a0>]}
2022-04-22 02:55:37.340859 (Thread-32): 02:55:37  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:55:37.343372 (Thread-32): sending response (<Response 2582 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:50.658499 (Thread-33): handling status request
2022-04-22 02:55:50.658898 (Thread-33): 02:55:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa86243fb50>]}
2022-04-22 02:55:50.659356 (Thread-33): sending response (<Response 1219 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:55:50.667377 (Thread-34): handling list request
2022-04-22 02:55:50.667633 (Thread-34): 02:55:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd00be0>]}
2022-04-22 02:55:50.701123 (Thread-34): 02:55:50  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd385e0>]}
2022-04-22 02:55:50.701613 (Thread-34): 02:55:50  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:55:50.706315 (Thread-34): sending response (<Response 2582 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:56:04.148615 (Thread-35): handling status request
2022-04-22 02:56:04.149043 (Thread-35): 02:56:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd38220>]}
2022-04-22 02:56:04.173461 (Thread-35): sending response (<Response 1241 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:56:04.564627 (Thread-36): handling run_sql request
2022-04-22 02:56:04.565035 (Thread-36): 02:56:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd38c10>]}
2022-04-22 02:56:07.130068 (Thread-36): sending response (<Response 138 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:56:07.155385 (MainThread): 02:56:07  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '90136078-fa69-4c7c-8b09-b3f29f9fdad9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe132baddf0>]}
2022-04-22 02:56:07.155948 (MainThread): 02:56:07  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:56:07.156537 (Thread-1): 02:56:07  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 02:56:07.156720 (Thread-1): 02:56:07  Began compiling node rpc.my_new_project.request
2022-04-22 02:56:07.156832 (Thread-1): 02:56:07  Compiling rpc.my_new_project.request
2022-04-22 02:56:07.158943 (Thread-1): 02:56:07  finished collecting timing info
2022-04-22 02:56:07.159085 (Thread-1): 02:56:07  Began executing node rpc.my_new_project.request
2022-04-22 02:56:07.159701 (Thread-1): 02:56:07  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 02:56:07.159797 (Thread-1): 02:56:07  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_orders)

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 02:56:07.159877 (Thread-1): 02:56:07  Opening a new connection, currently in state init
2022-04-22 02:56:07.450339 (Thread-37): handling poll request
2022-04-22 02:56:07.450842 (Thread-37): 02:56:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8624bbee0>]}
2022-04-22 02:56:07.451700 (Thread-37): sending response (<Response 3805 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:56:08.083321 (Thread-1): 02:56:08  SQL status: SUCCESS 500 in 0.92 seconds
2022-04-22 02:56:08.097237 (Thread-1): 02:56:08  finished collecting timing info
2022-04-22 02:56:08.097484 (Thread-1): 02:56:08  On rpc.my_new_project.request: Close
2022-04-22 02:56:08.779116 (Thread-38): handling poll request
2022-04-22 02:56:08.779492 (Thread-38): 02:56:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dc53460>]}
2022-04-22 02:56:08.782487 (Thread-38): sending response (<Response 63173 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:56:22.628758 (Thread-39): handling status request
2022-04-22 02:56:22.631551 (Thread-39): 02:56:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dc53640>]}
2022-04-22 02:56:22.632050 (Thread-39): sending response (<Response 1219 bytes [200 OK]>) to 10.0.14.238
2022-04-22 02:56:22.638156 (Thread-40): handling list request
2022-04-22 02:56:22.638444 (Thread-40): 02:56:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dd300a0>]}
2022-04-22 02:56:22.673784 (Thread-40): 02:56:22  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93785b76-5a07-4eee-a8a6-46fc2a5d63bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa85dc532b0>]}
2022-04-22 02:56:22.674130 (Thread-40): 02:56:22  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 02:56:22.678136 (Thread-40): sending response (<Response 1742 bytes [200 OK]>) to 10.0.14.238
2022-04-22 11:00:34.083282 (MainThread): Running with dbt=1.0.5
2022-04-22 11:00:34.652127 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-22 11:00:34.660717 (MainThread): Tracking: tracking
2022-04-22 11:00:34.661065 (MainThread): 11:00:34  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa164f9aa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa155526370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa15554bb80>]}
2022-04-22 11:00:34.661385 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-04-22 11:00:34.662618 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-22 11:00:34.667115 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-22 11:00:34.806205 (Thread-12): 11:00:34  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 11:00:34.806399 (Thread-12): 11:00:34  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 11:00:34.812720 (Thread-12): 11:00:34  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152e75df0>]}
2022-04-22 11:00:37.296040 (Thread-13): handling ps request
2022-04-22 11:00:37.296424 (Thread-13): 11:00:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1555a73d0>]}
2022-04-22 11:00:37.297003 (Thread-13): sending response (<Response 105 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:00:37.299317 (Thread-14): handling status request
2022-04-22 11:00:37.299594 (Thread-14): 11:00:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1555a7190>]}
2022-04-22 11:00:37.300023 (Thread-14): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:00:37.630241 (Thread-15): handling status request
2022-04-22 11:00:37.630624 (Thread-15): 11:00:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa155526f10>]}
2022-04-22 11:00:37.631079 (Thread-15): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:00:37.747598 (Thread-16): handling status request
2022-04-22 11:00:37.747961 (Thread-16): 11:00:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa155526eb0>]}
2022-04-22 11:00:37.748383 (Thread-16): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:00:40.665930 (Thread-17): handling status request
2022-04-22 11:00:40.666326 (Thread-17): 11:00:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1555a7490>]}
2022-04-22 11:00:40.666760 (Thread-17): sending response (<Response 1219 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:00:40.673623 (Thread-18): handling list request
2022-04-22 11:00:40.673860 (Thread-18): 11:00:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa155526bb0>]}
2022-04-22 11:00:40.716113 (Thread-18): 11:00:40  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1555545e0>]}
2022-04-22 11:00:40.716395 (Thread-18): 11:00:40  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:00:40.719184 (Thread-18): sending response (<Response 2582 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:00:40.824174 (Thread-19): handling status request
2022-04-22 11:00:40.824506 (Thread-19): 11:00:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa164f9aac0>]}
2022-04-22 11:00:40.824929 (Thread-19): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:22.817566 (Thread-20): handling status request
2022-04-22 11:01:22.818975 (Thread-20): 11:01:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa155526d00>]}
2022-04-22 11:01:22.819446 (Thread-20): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:23.265932 (Thread-21): handling run_sql request
2022-04-22 11:01:23.266315 (Thread-21): 11:01:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152e75fa0>]}
2022-04-22 11:01:25.735433 (Thread-21): sending response (<Response 138 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:25.763139 (MainThread): 11:01:25  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '61810b39-48c8-43c9-be9e-958559fd264d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6aa9ede50>]}
2022-04-22 11:01:25.763728 (MainThread): 11:01:25  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:01:25.764321 (Thread-1): 11:01:25  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:01:25.764463 (Thread-1): 11:01:25  Began compiling node rpc.my_new_project.request
2022-04-22 11:01:25.764563 (Thread-1): 11:01:25  Compiling rpc.my_new_project.request
2022-04-22 11:01:25.766626 (Thread-1): 11:01:25  finished collecting timing info
2022-04-22 11:01:25.766755 (Thread-1): 11:01:25  Began executing node rpc.my_new_project.request
2022-04-22 11:01:25.767295 (Thread-1): 11:01:25  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:01:25.767383 (Thread-1): 11:01:25  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_orders)

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:01:25.767462 (Thread-1): 11:01:25  Opening a new connection, currently in state init
2022-04-22 11:01:26.218085 (Thread-22): handling poll request
2022-04-22 11:01:26.218589 (Thread-22): 11:01:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152e7d610>]}
2022-04-22 11:01:26.219467 (Thread-22): sending response (<Response 3805 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:26.950821 (Thread-1): 11:01:26  SQL status: SUCCESS 500 in 1.18 seconds
2022-04-22 11:01:26.966129 (Thread-1): 11:01:26  finished collecting timing info
2022-04-22 11:01:26.966423 (Thread-1): 11:01:26  On rpc.my_new_project.request: Close
2022-04-22 11:01:27.624385 (Thread-23): handling poll request
2022-04-22 11:01:27.624772 (Thread-23): 11:01:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152dd8880>]}
2022-04-22 11:01:27.627800 (Thread-23): sending response (<Response 63174 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:47.575975 (Thread-24): handling status request
2022-04-22 11:01:47.577451 (Thread-24): 11:01:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152e7d6d0>]}
2022-04-22 11:01:47.577944 (Thread-24): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:47.979267 (Thread-25): handling run_sql request
2022-04-22 11:01:47.979717 (Thread-25): 11:01:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152e7dfd0>]}
2022-04-22 11:01:50.469161 (Thread-25): sending response (<Response 138 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:50.493825 (MainThread): 11:01:50  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18f6c5f8-d9d2-46e9-8cdc-40c6e3ea3639', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc23ee6c730>]}
2022-04-22 11:01:50.494412 (MainThread): 11:01:50  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:01:50.495020 (Thread-1): 11:01:50  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:01:50.495162 (Thread-1): 11:01:50  Began compiling node rpc.my_new_project.request
2022-04-22 11:01:50.495263 (Thread-1): 11:01:50  Compiling rpc.my_new_project.request
2022-04-22 11:01:50.497178 (Thread-1): 11:01:50  finished collecting timing info
2022-04-22 11:01:50.497307 (Thread-1): 11:01:50  Began executing node rpc.my_new_project.request
2022-04-22 11:01:50.497847 (Thread-1): 11:01:50  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:01:50.497935 (Thread-1): 11:01:50  On rpc.my_new_project.request: select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:01:50.498015 (Thread-1): 11:01:50  Opening a new connection, currently in state init
2022-04-22 11:01:50.895385 (Thread-26): handling poll request
2022-04-22 11:01:50.895886 (Thread-26): 11:01:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152de0be0>]}
2022-04-22 11:01:50.896710 (Thread-26): sending response (<Response 3765 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:52.308407 (Thread-27): handling poll request
2022-04-22 11:01:52.308778 (Thread-27): 11:01:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152de0d90>]}
2022-04-22 11:01:52.309249 (Thread-27): sending response (<Response 383 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:01:52.494748 (Thread-1): 11:01:52  Snowflake adapter: Snowflake query id: 01a3c695-0501-6083-0004-7d83048a5f96
2022-04-22 11:01:52.494982 (Thread-1): 11:01:52  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 11:01:52.495171 (Thread-1): 11:01:52  finished collecting timing info
2022-04-22 11:01:52.495368 (Thread-1): 11:01:52  On rpc.my_new_project.request: Close
2022-04-22 11:01:52.997719 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 11:01:52.998729 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 11:01:53.726344 (Thread-28): handling poll request
2022-04-22 11:01:53.726758 (Thread-28): 11:01:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152de0ac0>]}
2022-04-22 11:01:53.727357 (Thread-28): sending response (<Response 10397 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:07.947313 (Thread-29): handling status request
2022-04-22 11:07:07.948935 (Thread-29): 11:07:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152de0670>]}
2022-04-22 11:07:07.949560 (Thread-29): sending response (<Response 1241 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:08.345659 (Thread-30): handling run_sql request
2022-04-22 11:07:08.346085 (Thread-30): 11:07:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152de06a0>]}
2022-04-22 11:07:10.859416 (Thread-30): sending response (<Response 138 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:10.885924 (MainThread): 11:07:10  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1bad0072-0ea2-4d20-8303-b865514308b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feaa26f1850>]}
2022-04-22 11:07:10.886430 (MainThread): 11:07:10  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:07:10.887007 (Thread-1): 11:07:10  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:07:10.887144 (Thread-1): 11:07:10  Began compiling node rpc.my_new_project.request
2022-04-22 11:07:10.887251 (Thread-1): 11:07:10  Compiling rpc.my_new_project.request
2022-04-22 11:07:10.889342 (Thread-1): 11:07:10  finished collecting timing info
2022-04-22 11:07:10.889469 (Thread-1): 11:07:10  Began executing node rpc.my_new_project.request
2022-04-22 11:07:10.890020 (Thread-1): 11:07:10  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:07:10.890108 (Thread-1): 11:07:10  On rpc.my_new_project.request: with
    o as (select *
    from raw.interview_sample_data.interview_orders -- raw.interview_sample_data.interview_orders
    )

select * from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:07:10.890185 (Thread-1): 11:07:10  Opening a new connection, currently in state init
2022-04-22 11:07:11.309418 (Thread-31): handling poll request
2022-04-22 11:07:11.309869 (Thread-31): 11:07:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152d6b250>]}
2022-04-22 11:07:11.310692 (Thread-31): sending response (<Response 3862 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:11.971014 (Thread-1): 11:07:11  SQL status: SUCCESS 500 in 1.08 seconds
2022-04-22 11:07:11.984835 (Thread-1): 11:07:11  finished collecting timing info
2022-04-22 11:07:11.985103 (Thread-1): 11:07:11  On rpc.my_new_project.request: Close
2022-04-22 11:07:12.739082 (Thread-32): handling poll request
2022-04-22 11:07:12.739466 (Thread-32): 11:07:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152d6b670>]}
2022-04-22 11:07:12.742414 (Thread-32): sending response (<Response 63409 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:17.006754 (Thread-33): 11:07:17  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:07:17.007175 (Thread-33): 11:07:17  Partial parsing: updated file: my_new_project://models/staging/stg_orders.sql
2022-04-22 11:07:17.018276 (Thread-33): 11:07:17  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:07:17.083994 (Thread-33): 11:07:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1506595b0>]}
2022-04-22 11:07:17.767327 (Thread-34): handling status request
2022-04-22 11:07:17.767732 (Thread-34): 11:07:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa152de0f70>]}
2022-04-22 11:07:17.768229 (Thread-34): sending response (<Response 1562 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:17.837900 (Thread-35): handling status request
2022-04-22 11:07:17.838186 (Thread-35): 11:07:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa150650d90>]}
2022-04-22 11:07:17.838583 (Thread-35): sending response (<Response 1562 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:22.851362 (Thread-36): handling status request
2022-04-22 11:07:22.851807 (Thread-36): 11:07:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa150617460>]}
2022-04-22 11:07:22.852263 (Thread-36): sending response (<Response 1562 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:23.294199 (Thread-37): handling run_sql request
2022-04-22 11:07:23.294602 (Thread-37): 11:07:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1555a78b0>]}
2022-04-22 11:07:25.751376 (Thread-37): sending response (<Response 138 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:25.775742 (MainThread): 11:07:25  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a0c7f1ab-68df-437c-bd65-2ac151019dee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1e4b8bc460>]}
2022-04-22 11:07:25.776261 (MainThread): 11:07:25  Found 13 models, 4 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:07:25.776839 (Thread-1): 11:07:25  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:07:25.776988 (Thread-1): 11:07:25  Began compiling node rpc.my_new_project.request
2022-04-22 11:07:25.777086 (Thread-1): 11:07:25  Compiling rpc.my_new_project.request
2022-04-22 11:07:25.778969 (Thread-1): 11:07:25  finished collecting timing info
2022-04-22 11:07:25.779096 (Thread-1): 11:07:25  Began executing node rpc.my_new_project.request
2022-04-22 11:07:25.779631 (Thread-1): 11:07:25  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:07:25.779727 (Thread-1): 11:07:25  On rpc.my_new_project.request: select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:07:25.779809 (Thread-1): 11:07:25  Opening a new connection, currently in state init
2022-04-22 11:07:26.138515 (Thread-38): handling poll request
2022-04-22 11:07:26.138952 (Thread-38): 11:07:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1506b72b0>]}
2022-04-22 11:07:26.139884 (Thread-38): sending response (<Response 3764 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:07:26.822881 (Thread-1): 11:07:26  Snowflake adapter: Snowflake query id: 01a3c69b-0501-6083-0004-7d83048a82b2
2022-04-22 11:07:26.823112 (Thread-1): 11:07:26  Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 11:07:26.823300 (Thread-1): 11:07:26  finished collecting timing info
2022-04-22 11:07:26.823492 (Thread-1): 11:07:26  On rpc.my_new_project.request: Close
2022-04-22 11:07:27.028387 (Thread-1): Got an exception: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (02000): SQL compilation error:
Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (02000): SQL compilation error:
  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.
2022-04-22 11:07:27.029384 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (02000): SQL compilation error:\n  Schema 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW' does not exist or not authorized.", 'raw_sql': "select * from {{ref('stg_orders')}}\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': 'select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders\nlimit 500\n/* limit added automatically by dbt cloud */', 'tags': None}, None)
2022-04-22 11:07:27.561066 (Thread-39): handling poll request
2022-04-22 11:07:27.561502 (Thread-39): 11:07:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1506abf10>]}
2022-04-22 11:07:27.593127 (Thread-39): sending response (<Response 10397 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:08:53.476340 (Thread-40): 11:08:53  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:08:53.478042 (Thread-40): 11:08:53  Partial parsing: updated file: my_new_project://models/staging/stg_orders.sql
2022-04-22 11:08:53.482508 (Thread-40): 11:08:53  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:08:53.529160 (Thread-40): 11:08:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa15055bf40>]}
2022-04-22 11:08:54.197739 (Thread-41): handling status request
2022-04-22 11:08:54.198128 (Thread-41): 11:08:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1505cd700>]}
2022-04-22 11:08:54.198626 (Thread-41): sending response (<Response 1562 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:08:54.284925 (Thread-42): handling status request
2022-04-22 11:08:54.285241 (Thread-42): 11:08:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '723be083-d9de-4a6b-af5e-f614d6964f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1505cd5b0>]}
2022-04-22 11:08:54.285667 (Thread-42): sending response (<Response 1562 bytes [200 OK]>) to 10.0.41.177
2022-04-22 11:31:39.091052 (MainThread): Running with dbt=1.0.5
2022-04-22 11:31:39.685977 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-22 11:31:39.689715 (MainThread): Tracking: tracking
2022-04-22 11:31:39.691693 (MainThread): 11:31:39  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50fc69a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe64692640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50fd4370>]}
2022-04-22 11:31:39.696256 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-04-22 11:31:39.696717 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-22 11:31:39.703116 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-22 11:31:39.840497 (Thread-12): 11:31:39  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 11:31:39.840811 (Thread-12): 11:31:39  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 11:31:39.847884 (Thread-12): 11:31:39  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e876f40>]}
2022-04-22 11:31:43.362367 (Thread-13): handling status request
2022-04-22 11:31:43.362751 (Thread-13): 11:31:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f8f7f0>]}
2022-04-22 11:31:43.363374 (Thread-13): sending response (<Response 1241 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:31:43.405032 (Thread-14): handling status request
2022-04-22 11:31:43.405403 (Thread-14): 11:31:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f8f610>]}
2022-04-22 11:31:43.405840 (Thread-14): sending response (<Response 1241 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:31:43.444478 (Thread-15): handling status request
2022-04-22 11:31:43.444852 (Thread-15): 11:31:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f8f430>]}
2022-04-22 11:31:43.445326 (Thread-15): sending response (<Response 1241 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:31:43.685688 (Thread-16): handling ps request
2022-04-22 11:31:43.686060 (Thread-16): 11:31:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f8f280>]}
2022-04-22 11:31:43.686494 (Thread-16): sending response (<Response 105 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:31:45.407590 (Thread-17): handling status request
2022-04-22 11:31:45.407969 (Thread-17): 11:31:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f8f1c0>]}
2022-04-22 11:31:45.408428 (Thread-17): sending response (<Response 1241 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:31:59.061238 (Thread-18): 11:31:59  Partial parsing enabled: 3 files deleted, 0 files added, 0 files changed.
2022-04-22 11:31:59.063705 (Thread-18): 11:31:59  Partial parsing: deleted file: my_new_project://models/example/my_first_dbt_model.sql
2022-04-22 11:31:59.063858 (Thread-18): 11:31:59  Partial parsing: deleted file: my_new_project://models/example/my_second_dbt_model.sql
2022-04-22 11:31:59.100688 (Thread-18): 11:31:59  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:31:59.106730 (Thread-18): 11:31:59  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7ce970>]}
2022-04-22 11:31:59.744207 (Thread-19): handling status request
2022-04-22 11:31:59.744573 (Thread-19): 11:31:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e8a9790>]}
2022-04-22 11:31:59.745042 (Thread-19): sending response (<Response 2034 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:31:59.848609 (Thread-20): handling status request
2022-04-22 11:31:59.848992 (Thread-20): 11:31:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e8a9520>]}
2022-04-22 11:31:59.849470 (Thread-20): sending response (<Response 2034 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:12.719220 (Thread-21): 11:32:12  Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
2022-04-22 11:32:12.720177 (Thread-21): 11:32:12  Partial parsing: deleted file: my_new_project://models/marts/test.sql
2022-04-22 11:32:12.756494 (Thread-21): 11:32:12  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:32:12.761499 (Thread-21): 11:32:12  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e8b1700>]}
2022-04-22 11:32:13.441272 (Thread-22): handling status request
2022-04-22 11:32:13.441651 (Thread-22): 11:32:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7b5850>]}
2022-04-22 11:32:13.442115 (Thread-22): sending response (<Response 1691 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:13.495519 (Thread-23): handling status request
2022-04-22 11:32:13.495874 (Thread-23): 11:32:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7b5670>]}
2022-04-22 11:32:13.496328 (Thread-23): sending response (<Response 1691 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:19.189779 (Thread-24): handling status request
2022-04-22 11:32:19.190216 (Thread-24): 11:32:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7b5430>]}
2022-04-22 11:32:19.190687 (Thread-24): sending response (<Response 1691 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:19.589732 (Thread-25): handling status request
2022-04-22 11:32:19.590149 (Thread-25): 11:32:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7b53d0>]}
2022-04-22 11:32:19.590607 (Thread-25): sending response (<Response 1691 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:19.601260 (Thread-26): handling cli_args request
2022-04-22 11:32:19.601520 (Thread-26): 11:32:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e875730>]}
2022-04-22 11:32:22.104269 (Thread-26): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:22.149345 (MainThread): 11:32:22  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 11:32:22.149729 (MainThread): 11:32:22  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb97d95a490>]}
2022-04-22 11:32:22.193690 (MainThread): 11:32:22  Parsing macros/adapters.sql
2022-04-22 11:32:22.232480 (MainThread): 11:32:22  Parsing macros/catalog.sql
2022-04-22 11:32:22.234333 (MainThread): 11:32:22  Parsing macros/materializations/table.sql
2022-04-22 11:32:22.237386 (MainThread): 11:32:22  Parsing macros/materializations/seed.sql
2022-04-22 11:32:22.242558 (MainThread): 11:32:22  Parsing macros/materializations/incremental.sql
2022-04-22 11:32:22.251193 (MainThread): 11:32:22  Parsing macros/materializations/merge.sql
2022-04-22 11:32:22.255045 (MainThread): 11:32:22  Parsing macros/materializations/snapshot.sql
2022-04-22 11:32:22.256015 (MainThread): 11:32:22  Parsing macros/materializations/view.sql
2022-04-22 11:32:22.257330 (MainThread): 11:32:22  Parsing macros/adapters/metadata.sql
2022-04-22 11:32:22.264572 (MainThread): 11:32:22  Parsing macros/adapters/columns.sql
2022-04-22 11:32:22.274540 (MainThread): 11:32:22  Parsing macros/adapters/freshness.sql
2022-04-22 11:32:22.277384 (MainThread): 11:32:22  Parsing macros/adapters/persist_docs.sql
2022-04-22 11:32:22.281811 (MainThread): 11:32:22  Parsing macros/adapters/relation.sql
2022-04-22 11:32:22.291551 (MainThread): 11:32:22  Parsing macros/adapters/schema.sql
2022-04-22 11:32:22.293691 (MainThread): 11:32:22  Parsing macros/adapters/indexes.sql
2022-04-22 11:32:22.296481 (MainThread): 11:32:22  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 11:32:22.298867 (MainThread): 11:32:22  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 11:32:22.300423 (MainThread): 11:32:22  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 11:32:22.301957 (MainThread): 11:32:22  Parsing macros/etc/datetime.sql
2022-04-22 11:32:22.310343 (MainThread): 11:32:22  Parsing macros/etc/statement.sql
2022-04-22 11:32:22.314798 (MainThread): 11:32:22  Parsing macros/generic_test_sql/unique.sql
2022-04-22 11:32:22.315514 (MainThread): 11:32:22  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 11:32:22.316134 (MainThread): 11:32:22  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 11:32:22.317475 (MainThread): 11:32:22  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 11:32:22.318299 (MainThread): 11:32:22  Parsing macros/materializations/configs.sql
2022-04-22 11:32:22.320505 (MainThread): 11:32:22  Parsing macros/materializations/hooks.sql
2022-04-22 11:32:22.324388 (MainThread): 11:32:22  Parsing macros/materializations/models/table/table.sql
2022-04-22 11:32:22.331862 (MainThread): 11:32:22  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 11:32:22.334694 (MainThread): 11:32:22  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 11:32:22.337438 (MainThread): 11:32:22  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 11:32:22.338681 (MainThread): 11:32:22  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 11:32:22.340975 (MainThread): 11:32:22  Parsing macros/materializations/models/view/view.sql
2022-04-22 11:32:22.348199 (MainThread): 11:32:22  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 11:32:22.358249 (MainThread): 11:32:22  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 11:32:22.373707 (MainThread): 11:32:22  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 11:32:22.375141 (MainThread): 11:32:22  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 11:32:22.386142 (MainThread): 11:32:22  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 11:32:22.390457 (MainThread): 11:32:22  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 11:32:22.406524 (MainThread): 11:32:22  Parsing macros/materializations/seeds/seed.sql
2022-04-22 11:32:22.412438 (MainThread): 11:32:22  Parsing macros/materializations/tests/helpers.sql
2022-04-22 11:32:22.414109 (MainThread): 11:32:22  Parsing macros/materializations/tests/test.sql
2022-04-22 11:32:22.418498 (MainThread): 11:32:22  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 11:32:22.420329 (MainThread): 11:32:22  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 11:32:22.431296 (MainThread): 11:32:22  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 11:32:22.447912 (MainThread): 11:32:22  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 11:32:22.449462 (MainThread): 11:32:22  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 11:32:22.461211 (MainThread): 11:32:22  Parsing tests/generic/builtin.sql
2022-04-22 11:32:22.472785 (Thread-27): handling poll request
2022-04-22 11:32:22.473174 (Thread-27): 11:32:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e8840d0>]}
2022-04-22 11:32:22.474424 (Thread-27): sending response (<Response 14737 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:22.655276 (MainThread): 11:32:22  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 11:32:22.666205 (MainThread): 11:32:22  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 11:32:22.668256 (MainThread): 11:32:22  1603: static parser failed on _archive/test_loop.sql
2022-04-22 11:32:22.671309 (MainThread): 11:32:22  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 11:32:22.672383 (MainThread): 11:32:22  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:32:22.674243 (MainThread): 11:32:22  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 11:32:22.676121 (MainThread): 11:32:22  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:32:22.678068 (MainThread): 11:32:22  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:32:22.680126 (MainThread): 11:32:22  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 11:32:22.682020 (MainThread): 11:32:22  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 11:32:22.684327 (MainThread): 11:32:22  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:32:22.749674 (MainThread): 11:32:22  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:32:22.754091 (MainThread): 11:32:22  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb956fbef40>]}
2022-04-22 11:32:22.786540 (MainThread): 11:32:22  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb956fbef40>]}
2022-04-22 11:32:22.786794 (MainThread): 11:32:22  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:32:22.788290 (MainThread): 11:32:22  
2022-04-22 11:32:22.788573 (MainThread): 11:32:22  Acquiring new snowflake connection "master"
2022-04-22 11:32:22.789780 (ThreadPoolExecutor-0_0): 11:32:22  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 11:32:22.801412 (ThreadPoolExecutor-0_0): 11:32:22  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 11:32:22.801515 (ThreadPoolExecutor-0_0): 11:32:22  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 11:32:22.801599 (ThreadPoolExecutor-0_0): 11:32:22  Opening a new connection, currently in state init
2022-04-22 11:32:23.780218 (ThreadPoolExecutor-0_0): 11:32:23  SQL status: SUCCESS 3 in 0.98 seconds
2022-04-22 11:32:23.782872 (ThreadPoolExecutor-0_0): 11:32:23  On list_PE_ALEXANDER_B: Close
2022-04-22 11:32:23.831591 (Thread-28): handling poll request
2022-04-22 11:32:23.831979 (Thread-28): 11:32:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f70160>]}
2022-04-22 11:32:23.832727 (Thread-28): sending response (<Response 7924 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:23.979701 (ThreadPoolExecutor-0_0): 11:32:23  Acquiring new snowflake connection "create_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:32:23.979996 (ThreadPoolExecutor-0_0): 11:32:23  Acquiring new snowflake connection "create_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:32:23.980250 (ThreadPoolExecutor-0_0): 11:32:23  Creating schema "_ReferenceKey(database='pe_alexander_b', schema='abrown_dbt_interview', identifier=None)"
2022-04-22 11:32:23.985811 (ThreadPoolExecutor-0_0): 11:32:23  Using snowflake connection "create_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:32:23.985944 (ThreadPoolExecutor-0_0): 11:32:23  On create_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "create_PE_ALEXANDER_B_abrown_dbt_interview"} */
create schema if not exists PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 11:32:23.986047 (ThreadPoolExecutor-0_0): 11:32:23  Opening a new connection, currently in state closed
2022-04-22 11:32:25.088390 (ThreadPoolExecutor-0_0): 11:32:25  SQL status: SUCCESS 1 in 1.1 seconds
2022-04-22 11:32:25.089292 (ThreadPoolExecutor-0_0): 11:32:25  On create_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 11:32:25.172853 (Thread-29): handling poll request
2022-04-22 11:32:25.173225 (Thread-29): 11:32:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f8f070>]}
2022-04-22 11:32:25.173758 (Thread-29): sending response (<Response 3105 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:25.286736 (ThreadPoolExecutor-2_0): 11:32:25  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:32:25.367000 (ThreadPoolExecutor-2_0): 11:32:25  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:32:25.367148 (ThreadPoolExecutor-2_0): 11:32:25  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 11:32:25.367239 (ThreadPoolExecutor-2_0): 11:32:25  Opening a new connection, currently in state closed
2022-04-22 11:32:26.277669 (ThreadPoolExecutor-2_0): 11:32:26  SQL status: SUCCESS 0 in 0.91 seconds
2022-04-22 11:32:26.278914 (ThreadPoolExecutor-2_0): 11:32:26  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 11:32:26.496561 (MainThread): 11:32:26  Concurrency: 4 threads (target='default')
2022-04-22 11:32:26.496736 (MainThread): 11:32:26  
2022-04-22 11:32:26.499358 (Thread-1): 11:32:26  Began running node model.my_new_project.orginal_query
2022-04-22 11:32:26.499713 (Thread-1): 11:32:26  1 of 10 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 11:32:26.499988 (Thread-1): 11:32:26  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 11:32:26.500092 (Thread-1): 11:32:26  Began compiling node model.my_new_project.orginal_query
2022-04-22 11:32:26.500199 (Thread-1): 11:32:26  Compiling model.my_new_project.orginal_query
2022-04-22 11:32:26.500848 (Thread-2): 11:32:26  Began running node model.my_new_project.stg_ctry_type
2022-04-22 11:32:26.501091 (Thread-2): 11:32:26  2 of 10 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 11:32:26.501346 (Thread-2): 11:32:26  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 11:32:26.501435 (Thread-2): 11:32:26  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 11:32:26.501521 (Thread-2): 11:32:26  Compiling model.my_new_project.stg_ctry_type
2022-04-22 11:32:26.503822 (Thread-2): 11:32:26  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 11:32:26.511832 (Thread-30): handling poll request
2022-04-22 11:32:26.512110 (Thread-30): 11:32:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7f56d0>]}
2022-04-22 11:32:26.512763 (Thread-30): sending response (<Response 7570 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:26.504668 (Thread-3): 11:32:26  Began running node model.my_new_project.stg_device_orders
2022-04-22 11:32:26.505025 (Thread-3): 11:32:26  3 of 10 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 11:32:26.505413 (Thread-3): 11:32:26  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 11:32:26.505571 (Thread-3): 11:32:26  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 11:32:26.505726 (Thread-3): 11:32:26  Compiling model.my_new_project.stg_device_orders
2022-04-22 11:32:26.508059 (Thread-3): 11:32:26  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 11:32:26.509366 (Thread-1): 11:32:26  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 11:32:26.509599 (Thread-4): 11:32:26  Began running node model.my_new_project.stg_first_order
2022-04-22 11:32:26.509827 (Thread-4): 11:32:26  4 of 10 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 11:32:26.510066 (Thread-4): 11:32:26  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 11:32:26.510175 (Thread-4): 11:32:26  Began compiling node model.my_new_project.stg_first_order
2022-04-22 11:32:26.510261 (Thread-4): 11:32:26  Compiling model.my_new_project.stg_first_order
2022-04-22 11:32:26.512239 (Thread-4): 11:32:26  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 11:32:26.545084 (Thread-3): 11:32:26  finished collecting timing info
2022-04-22 11:32:26.545238 (Thread-3): 11:32:26  Began executing node model.my_new_project.stg_device_orders
2022-04-22 11:32:26.561158 (Thread-4): 11:32:26  finished collecting timing info
2022-04-22 11:32:26.561301 (Thread-4): 11:32:26  Began executing node model.my_new_project.stg_first_order
2022-04-22 11:32:26.576346 (Thread-4): 11:32:26  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 11:32:26.580226 (Thread-3): 11:32:26  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 11:32:26.582156 (Thread-2): 11:32:26  finished collecting timing info
2022-04-22 11:32:26.582293 (Thread-2): 11:32:26  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 11:32:26.583909 (Thread-2): 11:32:26  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 11:32:26.585467 (Thread-1): 11:32:26  finished collecting timing info
2022-04-22 11:32:26.585610 (Thread-1): 11:32:26  Began executing node model.my_new_project.orginal_query
2022-04-22 11:32:26.587332 (Thread-1): 11:32:26  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 11:32:26.619677 (Thread-4): 11:32:26  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 11:32:26.619799 (Thread-4): 11:32:26  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 11:32:26.619892 (Thread-4): 11:32:26  Opening a new connection, currently in state init
2022-04-22 11:32:26.623292 (Thread-3): 11:32:26  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 11:32:26.623415 (Thread-3): 11:32:26  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 11:32:26.623535 (Thread-3): 11:32:26  Opening a new connection, currently in state init
2022-04-22 11:32:26.627599 (Thread-2): 11:32:26  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 11:32:26.627716 (Thread-2): 11:32:26  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 11:32:26.627803 (Thread-2): 11:32:26  Opening a new connection, currently in state init
2022-04-22 11:32:26.634582 (Thread-1): 11:32:26  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 11:32:26.634702 (Thread-1): 11:32:26  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `dbt-public.interview_task.orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as int64) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `dbt-public.interview_task.devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `dbt-public.interview_task.orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `dbt-public.interview_task.addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `dbt-public.interview_task.payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
  );
2022-04-22 11:32:26.634789 (Thread-1): 11:32:26  Opening a new connection, currently in state closed
2022-04-22 11:32:27.797965 (Thread-1): 11:32:27  Snowflake adapter: Snowflake query id: 01a3c6b4-0501-6083-0004-7d83048a85a2
2022-04-22 11:32:27.798136 (Thread-1): 11:32:27  Snowflake adapter: Snowflake error: 002040 (42601): SQL compilation error:
Unsupported data type 'INT64'.
2022-04-22 11:32:27.798313 (Thread-1): 11:32:27  finished collecting timing info
2022-04-22 11:32:27.798460 (Thread-1): 11:32:27  On model.my_new_project.orginal_query: Close
2022-04-22 11:32:27.855866 (Thread-31): handling poll request
2022-04-22 11:32:27.856267 (Thread-31): 11:32:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50f164c0>]}
2022-04-22 11:32:27.857246 (Thread-31): sending response (<Response 22392 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:27.856350 (Thread-4): 11:32:27  SQL status: SUCCESS 1 in 1.24 seconds
2022-04-22 11:32:27.864592 (Thread-4): 11:32:27  finished collecting timing info
2022-04-22 11:32:27.864754 (Thread-4): 11:32:27  On model.my_new_project.stg_first_order: Close
2022-04-22 11:32:27.932268 (Thread-2): 11:32:27  SQL status: SUCCESS 1 in 1.3 seconds
2022-04-22 11:32:27.933585 (Thread-2): 11:32:27  finished collecting timing info
2022-04-22 11:32:27.933737 (Thread-2): 11:32:27  On model.my_new_project.stg_ctry_type: Close
2022-04-22 11:32:27.943841 (Thread-3): 11:32:27  SQL status: SUCCESS 1 in 1.32 seconds
2022-04-22 11:32:27.945024 (Thread-3): 11:32:27  finished collecting timing info
2022-04-22 11:32:27.945161 (Thread-3): 11:32:27  On model.my_new_project.stg_device_orders: Close
2022-04-22 11:32:27.996891 (Thread-1): 11:32:27  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  002040 (42601): SQL compilation error:
  Unsupported data type 'INT64'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 11:32:27.997242 (Thread-1): 11:32:27  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b2fac640>]}
2022-04-22 11:32:27.997603 (Thread-1): 11:32:27  1 of 10 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.50s]
2022-04-22 11:32:27.997728 (Thread-1): 11:32:27  Finished running node model.my_new_project.orginal_query
2022-04-22 11:32:27.997882 (Thread-1): 11:32:27  Began running node model.my_new_project.stg_orders
2022-04-22 11:32:27.998075 (Thread-1): 11:32:27  5 of 10 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 11:32:27.998315 (Thread-1): 11:32:27  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 11:32:27.998408 (Thread-1): 11:32:27  Began compiling node model.my_new_project.stg_orders
2022-04-22 11:32:27.998499 (Thread-1): 11:32:27  Compiling model.my_new_project.stg_orders
2022-04-22 11:32:28.002051 (Thread-1): 11:32:28  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 11:32:28.014824 (Thread-1): 11:32:28  finished collecting timing info
2022-04-22 11:32:28.014975 (Thread-1): 11:32:28  Began executing node model.my_new_project.stg_orders
2022-04-22 11:32:28.016947 (Thread-1): 11:32:28  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 11:32:28.029239 (Thread-1): 11:32:28  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 11:32:28.029359 (Thread-1): 11:32:28  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select * from o
  );
2022-04-22 11:32:28.029450 (Thread-1): 11:32:28  Opening a new connection, currently in state closed
2022-04-22 11:32:28.037206 (Thread-4): 11:32:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b2fccf40>]}
2022-04-22 11:32:28.037522 (Thread-4): 11:32:28  4 of 10 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 1.53s]
2022-04-22 11:32:28.037640 (Thread-4): 11:32:28  Finished running node model.my_new_project.stg_first_order
2022-04-22 11:32:28.037773 (Thread-4): 11:32:28  Began running node model.my_new_project.stg_payments
2022-04-22 11:32:28.037951 (Thread-4): 11:32:28  6 of 10 START view model abrown_dbt_interview.stg_payments...................... [RUN]
2022-04-22 11:32:28.038174 (Thread-4): 11:32:28  Acquiring new snowflake connection "model.my_new_project.stg_payments"
2022-04-22 11:32:28.038261 (Thread-4): 11:32:28  Began compiling node model.my_new_project.stg_payments
2022-04-22 11:32:28.038347 (Thread-4): 11:32:28  Compiling model.my_new_project.stg_payments
2022-04-22 11:32:28.040567 (Thread-4): 11:32:28  Writing injected SQL for node "model.my_new_project.stg_payments"
2022-04-22 11:32:28.052570 (Thread-4): 11:32:28  finished collecting timing info
2022-04-22 11:32:28.052742 (Thread-4): 11:32:28  Began executing node model.my_new_project.stg_payments
2022-04-22 11:32:28.054527 (Thread-4): 11:32:28  Writing runtime SQL for node "model.my_new_project.stg_payments"
2022-04-22 11:32:28.067031 (Thread-4): 11:32:28  Using snowflake connection "model.my_new_project.stg_payments"
2022-04-22 11:32:28.067150 (Thread-4): 11:32:28  On model.my_new_project.stg_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_payments 
  
   as (
    with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
  );
2022-04-22 11:32:28.067237 (Thread-4): 11:32:28  Opening a new connection, currently in state closed
2022-04-22 11:32:28.133113 (Thread-2): 11:32:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb97d8c6100>]}
2022-04-22 11:32:28.133512 (Thread-2): 11:32:28  2 of 10 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 1.63s]
2022-04-22 11:32:28.133639 (Thread-2): 11:32:28  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 11:32:28.133788 (Thread-2): 11:32:28  Began running node model.my_new_project.stg_query
2022-04-22 11:32:28.133972 (Thread-2): 11:32:28  7 of 10 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 11:32:28.134220 (Thread-2): 11:32:28  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 11:32:28.134314 (Thread-2): 11:32:28  Began compiling node model.my_new_project.stg_query
2022-04-22 11:32:28.134405 (Thread-2): 11:32:28  Compiling model.my_new_project.stg_query
2022-04-22 11:32:28.138051 (Thread-2): 11:32:28  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 11:32:28.140651 (Thread-3): 11:32:28  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb97d88dee0>]}
2022-04-22 11:32:28.141016 (Thread-3): 11:32:28  3 of 10 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 1.64s]
2022-04-22 11:32:28.141190 (Thread-3): 11:32:28  Finished running node model.my_new_project.stg_device_orders
2022-04-22 11:32:28.141406 (Thread-3): 11:32:28  Began running node model.my_new_project.test_conn
2022-04-22 11:32:28.141686 (Thread-3): 11:32:28  8 of 10 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 11:32:28.142013 (Thread-3): 11:32:28  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 11:32:28.142165 (Thread-3): 11:32:28  Began compiling node model.my_new_project.test_conn
2022-04-22 11:32:28.142310 (Thread-3): 11:32:28  Compiling model.my_new_project.test_conn
2022-04-22 11:32:28.144940 (Thread-3): 11:32:28  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 11:32:28.156746 (Thread-3): 11:32:28  finished collecting timing info
2022-04-22 11:32:28.156964 (Thread-3): 11:32:28  Began executing node model.my_new_project.test_conn
2022-04-22 11:32:28.159556 (Thread-3): 11:32:28  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 11:32:28.159853 (Thread-2): 11:32:28  finished collecting timing info
2022-04-22 11:32:28.159984 (Thread-2): 11:32:28  Began executing node model.my_new_project.stg_query
2022-04-22 11:32:28.161719 (Thread-2): 11:32:28  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 11:32:28.172587 (Thread-3): 11:32:28  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 11:32:28.172758 (Thread-3): 11:32:28  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    -- select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_devices
-- select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_addresses
-- select * from raw.interview_sample_data.interview_payments

-- select * from raw.interview_sample_data.interview_orders
  );
2022-04-22 11:32:28.172860 (Thread-3): 11:32:28  Opening a new connection, currently in state closed
2022-04-22 11:32:28.190460 (Thread-2): 11:32:28  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 11:32:28.190578 (Thread-2): 11:32:28  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 11:32:28.190665 (Thread-2): 11:32:28  Opening a new connection, currently in state closed
2022-04-22 11:32:29.067899 (Thread-3): 11:32:29  Snowflake adapter: Snowflake query id: 01a3c6b4-0501-6083-0004-7d83048a85a6
2022-04-22 11:32:29.068116 (Thread-3): 11:32:29  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 2 unexpected ')'.
2022-04-22 11:32:29.068307 (Thread-3): 11:32:29  finished collecting timing info
2022-04-22 11:32:29.068452 (Thread-3): 11:32:29  On model.my_new_project.test_conn: Close
2022-04-22 11:32:29.079037 (Thread-4): 11:32:29  SQL status: SUCCESS 1 in 1.01 seconds
2022-04-22 11:32:29.080478 (Thread-4): 11:32:29  finished collecting timing info
2022-04-22 11:32:29.080623 (Thread-4): 11:32:29  On model.my_new_project.stg_payments: Close
2022-04-22 11:32:29.116730 (Thread-1): 11:32:29  SQL status: SUCCESS 1 in 1.09 seconds
2022-04-22 11:32:29.118083 (Thread-1): 11:32:29  finished collecting timing info
2022-04-22 11:32:29.118229 (Thread-1): 11:32:29  On model.my_new_project.stg_orders: Close
2022-04-22 11:32:29.244210 (Thread-32): handling poll request
2022-04-22 11:32:29.244593 (Thread-32): 11:32:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e84f790>]}
2022-04-22 11:32:29.245875 (Thread-32): sending response (<Response 39305 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:29.253448 (Thread-3): 11:32:29  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 11:32:29.253729 (Thread-3): 11:32:29  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b2fe0370>]}
2022-04-22 11:32:29.254078 (Thread-3): 11:32:29  8 of 10 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 1.11s]
2022-04-22 11:32:29.254202 (Thread-3): 11:32:29  Finished running node model.my_new_project.test_conn
2022-04-22 11:32:29.254347 (Thread-3): 11:32:29  Began running node model.my_new_project.test_loop
2022-04-22 11:32:29.254536 (Thread-3): 11:32:29  9 of 10 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 11:32:29.254783 (Thread-3): 11:32:29  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 11:32:29.254873 (Thread-3): 11:32:29  Began compiling node model.my_new_project.test_loop
2022-04-22 11:32:29.254964 (Thread-3): 11:32:29  Compiling model.my_new_project.test_loop
2022-04-22 11:32:29.259407 (Thread-3): 11:32:29  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 11:32:29.270540 (Thread-3): 11:32:29  finished collecting timing info
2022-04-22 11:32:29.270701 (Thread-3): 11:32:29  Began executing node model.my_new_project.test_loop
2022-04-22 11:32:29.272586 (Thread-3): 11:32:29  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 11:32:29.278740 (Thread-4): 11:32:29  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b301e940>]}
2022-04-22 11:32:29.279081 (Thread-4): 11:32:29  6 of 10 OK created view model abrown_dbt_interview.stg_payments................. [SUCCESS 1 in 1.24s]
2022-04-22 11:32:29.279198 (Thread-4): 11:32:29  Finished running node model.my_new_project.stg_payments
2022-04-22 11:32:29.279877 (Thread-4): 11:32:29  Began running node model.my_new_project.fct_final
2022-04-22 11:32:29.280085 (Thread-4): 11:32:29  10 of 10 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 11:32:29.280328 (Thread-4): 11:32:29  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 11:32:29.280439 (Thread-4): 11:32:29  Began compiling node model.my_new_project.fct_final
2022-04-22 11:32:29.280528 (Thread-4): 11:32:29  Compiling model.my_new_project.fct_final
2022-04-22 11:32:29.285290 (Thread-4): 11:32:29  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 11:32:29.285829 (Thread-3): 11:32:29  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 11:32:29.285943 (Thread-3): 11:32:29  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    -- list tables




select * from raw.interview_sample_data.interview_devices
  );
2022-04-22 11:32:29.286034 (Thread-3): 11:32:29  Opening a new connection, currently in state closed
2022-04-22 11:32:29.305631 (Thread-4): 11:32:29  finished collecting timing info
2022-04-22 11:32:29.305847 (Thread-4): 11:32:29  Began executing node model.my_new_project.fct_final
2022-04-22 11:32:29.308351 (Thread-4): 11:32:29  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 11:32:29.314618 (Thread-1): 11:32:29  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b1eab250>]}
2022-04-22 11:32:29.314918 (Thread-1): 11:32:29  5 of 10 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 1.32s]
2022-04-22 11:32:29.315032 (Thread-1): 11:32:29  Finished running node model.my_new_project.stg_orders
2022-04-22 11:32:29.329454 (Thread-4): 11:32:29  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 11:32:29.329584 (Thread-4): 11:32:29  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o as (select * from raw.interview_sample_data.interview_orders),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 11:32:29.329675 (Thread-4): 11:32:29  Opening a new connection, currently in state closed
2022-04-22 11:32:29.476580 (Thread-2): 11:32:29  SQL status: SUCCESS 1 in 1.29 seconds
2022-04-22 11:32:29.478001 (Thread-2): 11:32:29  finished collecting timing info
2022-04-22 11:32:29.478167 (Thread-2): 11:32:29  On model.my_new_project.stg_query: Close
2022-04-22 11:32:29.752195 (Thread-2): 11:32:29  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9ab5c9d60>]}
2022-04-22 11:32:29.752610 (Thread-2): 11:32:29  7 of 10 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.62s]
2022-04-22 11:32:29.752741 (Thread-2): 11:32:29  Finished running node model.my_new_project.stg_query
2022-04-22 11:32:30.218549 (Thread-4): 11:32:30  Snowflake adapter: Snowflake query id: 01a3c6b4-0501-6163-0004-7d83048a7732
2022-04-22 11:32:30.218740 (Thread-4): 11:32:30  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.FO' does not exist or not authorized.
2022-04-22 11:32:30.218928 (Thread-4): 11:32:30  finished collecting timing info
2022-04-22 11:32:30.219078 (Thread-4): 11:32:30  On model.my_new_project.fct_final: Close
2022-04-22 11:32:30.227078 (Thread-3): 11:32:30  SQL status: SUCCESS 1 in 0.94 seconds
2022-04-22 11:32:30.228586 (Thread-3): 11:32:30  finished collecting timing info
2022-04-22 11:32:30.228739 (Thread-3): 11:32:30  On model.my_new_project.test_loop: Close
2022-04-22 11:32:30.467588 (Thread-4): 11:32:30  Database Error in model fct_final (models/marts/fct_final.sql)
  002003 (42S02): SQL compilation error:
  Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.FO' does not exist or not authorized.
  compiled SQL at target/run/my_new_project/models/marts/fct_final.sql
2022-04-22 11:32:30.467878 (Thread-4): 11:32:30  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9ab6321f0>]}
2022-04-22 11:32:30.468227 (Thread-4): 11:32:30  10 of 10 ERROR creating view model abrown_dbt_interview.fct_final............... [ERROR in 1.19s]
2022-04-22 11:32:30.468353 (Thread-4): 11:32:30  Finished running node model.my_new_project.fct_final
2022-04-22 11:32:30.577393 (Thread-33): handling poll request
2022-04-22 11:32:30.577831 (Thread-33): 11:32:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e849ca0>]}
2022-04-22 11:32:30.578779 (Thread-33): sending response (<Response 24260 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:30.749396 (Thread-3): 11:32:30  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4de84466-2478-4882-8913-f64ee5416ca5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b2fcfaf0>]}
2022-04-22 11:32:30.749816 (Thread-3): 11:32:30  9 of 10 OK created view model abrown_dbt_interview.test_loop.................... [SUCCESS 1 in 1.49s]
2022-04-22 11:32:30.749959 (Thread-3): 11:32:30  Finished running node model.my_new_project.test_loop
2022-04-22 11:32:30.751584 (MainThread): 11:32:30  Acquiring new snowflake connection "master"
2022-04-22 11:32:30.751938 (MainThread): 11:32:30  
2022-04-22 11:32:30.752049 (MainThread): 11:32:30  Finished running 10 view models in 7.96s.
2022-04-22 11:32:30.752135 (MainThread): 11:32:30  Connection 'master' was properly closed.
2022-04-22 11:32:30.752208 (MainThread): 11:32:30  Connection 'model.my_new_project.stg_orders' was properly closed.
2022-04-22 11:32:30.752277 (MainThread): 11:32:30  Connection 'model.my_new_project.stg_query' was properly closed.
2022-04-22 11:32:30.752343 (MainThread): 11:32:30  Connection 'model.my_new_project.test_loop' was properly closed.
2022-04-22 11:32:30.752407 (MainThread): 11:32:30  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 11:32:30.805862 (MainThread): 11:32:30  
2022-04-22 11:32:30.806039 (MainThread): 11:32:30  Completed with 3 errors and 0 warnings:
2022-04-22 11:32:30.806134 (MainThread): 11:32:30  
2022-04-22 11:32:30.806230 (MainThread): 11:32:30  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 11:32:30.806313 (MainThread): 11:32:30    002040 (42601): SQL compilation error:
2022-04-22 11:32:30.806387 (MainThread): 11:32:30    Unsupported data type 'INT64'.
2022-04-22 11:32:30.806457 (MainThread): 11:32:30    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 11:32:30.806531 (MainThread): 11:32:30  
2022-04-22 11:32:30.806609 (MainThread): 11:32:30  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 11:32:30.806681 (MainThread): 11:32:30    001003 (42000): SQL compilation error:
2022-04-22 11:32:30.806749 (MainThread): 11:32:30    syntax error line 11 at position 2 unexpected ')'.
2022-04-22 11:32:30.806815 (MainThread): 11:32:30    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 11:32:30.806885 (MainThread): 11:32:30  
2022-04-22 11:32:30.806961 (MainThread): 11:32:30  Database Error in model fct_final (models/marts/fct_final.sql)
2022-04-22 11:32:30.807030 (MainThread): 11:32:30    002003 (42S02): SQL compilation error:
2022-04-22 11:32:30.807096 (MainThread): 11:32:30    Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.FO' does not exist or not authorized.
2022-04-22 11:32:30.807161 (MainThread): 11:32:30    compiled SQL at target/run/my_new_project/models/marts/fct_final.sql
2022-04-22 11:32:30.807246 (MainThread): 11:32:30  
2022-04-22 11:32:30.807327 (MainThread): 11:32:30  Done. PASS=7 WARN=0 ERROR=3 SKIP=0 TOTAL=10
2022-04-22 11:32:31.921714 (Thread-34): handling poll request
2022-04-22 11:32:31.922096 (Thread-34): 11:32:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7db460>]}
2022-04-22 11:32:31.924011 (Thread-34): sending response (<Response 60599 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:33.136736 (Thread-35): handling status request
2022-04-22 11:32:33.137132 (Thread-35): 11:32:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7dba30>]}
2022-04-22 11:32:33.137641 (Thread-35): sending response (<Response 1691 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:32:33.175900 (Thread-36): handling status request
2022-04-22 11:32:33.176192 (Thread-36): 11:32:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7dbaf0>]}
2022-04-22 11:32:33.176607 (Thread-36): sending response (<Response 1691 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:33:00.117251 (Thread-37): handling status request
2022-04-22 11:33:00.119210 (Thread-37): 11:33:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7dbd30>]}
2022-04-22 11:33:00.119737 (Thread-37): sending response (<Response 1669 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:33:00.144656 (Thread-38): handling list request
2022-04-22 11:33:00.144978 (Thread-38): 11:33:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7dbeb0>]}
2022-04-22 11:33:00.175780 (Thread-38): 11:33:00  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7e5b80>]}
2022-04-22 11:33:00.176107 (Thread-38): 11:33:00  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:33:00.181102 (Thread-38): sending response (<Response 5557 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:33:19.768543 (Thread-39): handling status request
2022-04-22 11:33:19.768931 (Thread-39): 11:33:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7e59d0>]}
2022-04-22 11:33:19.792367 (Thread-39): sending response (<Response 1669 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:33:19.798689 (Thread-40): handling list request
2022-04-22 11:33:19.798965 (Thread-40): 11:33:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7e5b20>]}
2022-04-22 11:33:19.836327 (Thread-40): 11:33:19  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7637c0>]}
2022-04-22 11:33:19.836965 (Thread-40): 11:33:19  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:33:19.839835 (Thread-40): sending response (<Response 2042 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:11.340846 (Thread-41): 11:34:11  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 11:34:11.341206 (Thread-41): 11:34:11  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e884130>]}
2022-04-22 11:34:11.387657 (Thread-41): 11:34:11  Parsing macros/adapters.sql
2022-04-22 11:34:11.425031 (Thread-41): 11:34:11  Parsing macros/catalog.sql
2022-04-22 11:34:11.426877 (Thread-41): 11:34:11  Parsing macros/materializations/table.sql
2022-04-22 11:34:11.429905 (Thread-41): 11:34:11  Parsing macros/materializations/seed.sql
2022-04-22 11:34:11.434925 (Thread-41): 11:34:11  Parsing macros/materializations/incremental.sql
2022-04-22 11:34:11.443205 (Thread-41): 11:34:11  Parsing macros/materializations/merge.sql
2022-04-22 11:34:11.446925 (Thread-41): 11:34:11  Parsing macros/materializations/snapshot.sql
2022-04-22 11:34:11.447903 (Thread-41): 11:34:11  Parsing macros/materializations/view.sql
2022-04-22 11:34:11.449218 (Thread-41): 11:34:11  Parsing macros/adapters/metadata.sql
2022-04-22 11:34:11.456096 (Thread-41): 11:34:11  Parsing macros/adapters/columns.sql
2022-04-22 11:34:11.465781 (Thread-41): 11:34:11  Parsing macros/adapters/freshness.sql
2022-04-22 11:34:11.468623 (Thread-41): 11:34:11  Parsing macros/adapters/persist_docs.sql
2022-04-22 11:34:11.472907 (Thread-41): 11:34:11  Parsing macros/adapters/relation.sql
2022-04-22 11:34:11.482128 (Thread-41): 11:34:11  Parsing macros/adapters/schema.sql
2022-04-22 11:34:11.484353 (Thread-41): 11:34:11  Parsing macros/adapters/indexes.sql
2022-04-22 11:34:11.487105 (Thread-41): 11:34:11  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 11:34:11.489712 (Thread-41): 11:34:11  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 11:34:11.491268 (Thread-41): 11:34:11  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 11:34:11.492933 (Thread-41): 11:34:11  Parsing macros/etc/datetime.sql
2022-04-22 11:34:11.501360 (Thread-41): 11:34:11  Parsing macros/etc/statement.sql
2022-04-22 11:34:11.505845 (Thread-41): 11:34:11  Parsing macros/generic_test_sql/unique.sql
2022-04-22 11:34:11.506570 (Thread-41): 11:34:11  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 11:34:11.507134 (Thread-41): 11:34:11  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 11:34:11.508569 (Thread-41): 11:34:11  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 11:34:11.509448 (Thread-41): 11:34:11  Parsing macros/materializations/configs.sql
2022-04-22 11:34:11.511766 (Thread-41): 11:34:11  Parsing macros/materializations/hooks.sql
2022-04-22 11:34:11.515657 (Thread-41): 11:34:11  Parsing macros/materializations/models/table/table.sql
2022-04-22 11:34:11.523257 (Thread-41): 11:34:11  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 11:34:11.526196 (Thread-41): 11:34:11  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 11:34:11.528910 (Thread-41): 11:34:11  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 11:34:11.530281 (Thread-41): 11:34:11  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 11:34:11.532638 (Thread-41): 11:34:11  Parsing macros/materializations/models/view/view.sql
2022-04-22 11:34:11.539748 (Thread-41): 11:34:11  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 11:34:11.549765 (Thread-41): 11:34:11  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 11:34:11.565207 (Thread-41): 11:34:11  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 11:34:11.567149 (Thread-41): 11:34:11  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 11:34:11.578352 (Thread-41): 11:34:11  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 11:34:11.582846 (Thread-41): 11:34:11  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 11:34:11.599144 (Thread-41): 11:34:11  Parsing macros/materializations/seeds/seed.sql
2022-04-22 11:34:11.605135 (Thread-41): 11:34:11  Parsing macros/materializations/tests/helpers.sql
2022-04-22 11:34:11.606913 (Thread-41): 11:34:11  Parsing macros/materializations/tests/test.sql
2022-04-22 11:34:11.611383 (Thread-41): 11:34:11  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 11:34:11.613231 (Thread-41): 11:34:11  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 11:34:11.624625 (Thread-41): 11:34:11  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 11:34:11.641365 (Thread-41): 11:34:11  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 11:34:11.643054 (Thread-41): 11:34:11  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 11:34:11.654782 (Thread-41): 11:34:11  Parsing tests/generic/builtin.sql
2022-04-22 11:34:11.880268 (Thread-41): 11:34:11  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 11:34:11.895238 (Thread-41): 11:34:11  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 11:34:11.899364 (Thread-41): 11:34:11  1603: static parser failed on _archive/test_loop.sql
2022-04-22 11:34:11.903819 (Thread-41): 11:34:11  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 11:34:11.905121 (Thread-41): 11:34:11  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:34:11.907146 (Thread-41): 11:34:11  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 11:34:11.910217 (Thread-41): 11:34:11  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:34:11.913269 (Thread-41): 11:34:11  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:34:11.916107 (Thread-41): 11:34:11  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 11:34:11.919487 (Thread-41): 11:34:11  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 11:34:11.922941 (Thread-41): 11:34:11  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:34:11.991952 (Thread-41): 11:34:11  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:34:11.997401 (Thread-41): 11:34:11  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c0af2b0>]}
2022-04-22 11:34:12.171067 (Thread-42): handling status request
2022-04-22 11:34:12.171451 (Thread-42): 11:34:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c07ce50>]}
2022-04-22 11:34:12.172446 (Thread-42): sending response (<Response 18745 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:12.207673 (Thread-43): handling list request
2022-04-22 11:34:12.208026 (Thread-43): 11:34:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c07c550>]}
2022-04-22 11:34:12.239005 (Thread-43): 11:34:12  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c0729a0>]}
2022-04-22 11:34:12.239392 (Thread-43): 11:34:12  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:34:12.242606 (Thread-43): sending response (<Response 6121 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:12.279449 (Thread-44): handling status request
2022-04-22 11:34:12.279841 (Thread-44): 11:34:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e884610>]}
2022-04-22 11:34:12.280713 (Thread-44): sending response (<Response 18767 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:12.333599 (Thread-45): handling status request
2022-04-22 11:34:12.333970 (Thread-45): 11:34:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c07c190>]}
2022-04-22 11:34:12.334917 (Thread-45): sending response (<Response 18767 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:26.433740 (Thread-46): 11:34:26  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:34:26.434160 (Thread-46): 11:34:26  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:34:26.438245 (Thread-46): 11:34:26  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:34:26.474927 (Thread-46): 11:34:26  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:34:26.479670 (Thread-46): 11:34:26  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf8ccd0>]}
2022-04-22 11:34:27.167233 (Thread-47): handling status request
2022-04-22 11:34:27.167703 (Thread-47): 11:34:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf5e880>]}
2022-04-22 11:34:27.168219 (Thread-47): sending response (<Response 1974 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:27.194048 (Thread-48): handling list request
2022-04-22 11:34:27.194380 (Thread-48): 11:34:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf5e400>]}
2022-04-22 11:34:27.228301 (Thread-48): 11:34:27  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c072610>]}
2022-04-22 11:34:27.228632 (Thread-48): 11:34:27  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:34:27.232015 (Thread-48): sending response (<Response 6121 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:27.436499 (Thread-49): handling status request
2022-04-22 11:34:27.436910 (Thread-49): 11:34:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf5ecd0>]}
2022-04-22 11:34:27.437431 (Thread-49): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:27.485132 (Thread-50): handling status request
2022-04-22 11:34:27.485482 (Thread-50): 11:34:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e72be80>]}
2022-04-22 11:34:27.485952 (Thread-50): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:34.372386 (Thread-51): handling status request
2022-04-22 11:34:34.372795 (Thread-51): 11:34:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e72bd00>]}
2022-04-22 11:34:34.373292 (Thread-51): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:34.699634 (Thread-52): handling run_sql request
2022-04-22 11:34:34.700011 (Thread-52): 11:34:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf8caf0>]}
2022-04-22 11:34:37.212402 (Thread-52): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:37.238882 (MainThread): 11:34:37  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39f1cb56-64b4-4cf3-bd07-d5652c364942', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd375a80fa0>]}
2022-04-22 11:34:37.239419 (MainThread): 11:34:37  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:34:37.240030 (Thread-1): 11:34:37  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:34:37.240164 (Thread-1): 11:34:37  Began compiling node rpc.my_new_project.request
2022-04-22 11:34:37.240254 (Thread-1): 11:34:37  Compiling rpc.my_new_project.request
2022-04-22 11:34:37.243223 (Thread-1): 11:34:37  finished collecting timing info
2022-04-22 11:34:37.243353 (Thread-1): 11:34:37  Began executing node rpc.my_new_project.request
2022-04-22 11:34:37.245581 (Thread-1): 11:34:37  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:34:37.245680 (Thread-1): 11:34:37  On rpc.my_new_project.request: with
  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:34:37.245761 (Thread-1): 11:34:37  Opening a new connection, currently in state init
2022-04-22 11:34:37.551854 (Thread-53): handling poll request
2022-04-22 11:34:37.552319 (Thread-53): 11:34:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf8a460>]}
2022-04-22 11:34:37.553256 (Thread-53): sending response (<Response 5726 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:38.230852 (Thread-1): 11:34:38  Snowflake adapter: Snowflake query id: 01a3c6b6-0501-5fd8-0004-7d83048a2f0e
2022-04-22 11:34:38.231094 (Thread-1): 11:34:38  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 11:34:38.231289 (Thread-1): 11:34:38  finished collecting timing info
2022-04-22 11:34:38.231521 (Thread-1): 11:34:38  On rpc.my_new_project.request: Close
2022-04-22 11:34:38.420865 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 11:34:38.422132 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  -- o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  -- o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 11:34:38.900023 (Thread-54): handling poll request
2022-04-22 11:34:38.900448 (Thread-54): 11:34:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf8aac0>]}
2022-04-22 11:34:38.901111 (Thread-54): sending response (<Response 24442 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:47.469942 (Thread-55): handling status request
2022-04-22 11:34:47.470357 (Thread-55): 11:34:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf84790>]}
2022-04-22 11:34:47.470882 (Thread-55): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:47.829943 (Thread-56): handling run_sql request
2022-04-22 11:34:47.830340 (Thread-56): 11:34:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf84970>]}
2022-04-22 11:34:50.348099 (Thread-56): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:50.374505 (MainThread): 11:34:50  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7b68b7f0-0940-4ba2-aa3c-85dfb5308a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc17f1aeeb0>]}
2022-04-22 11:34:50.375045 (MainThread): 11:34:50  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:34:50.375641 (Thread-1): 11:34:50  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:34:50.375775 (Thread-1): 11:34:50  Began compiling node rpc.my_new_project.request
2022-04-22 11:34:50.375866 (Thread-1): 11:34:50  Compiling rpc.my_new_project.request
2022-04-22 11:34:50.378862 (Thread-1): 11:34:50  finished collecting timing info
2022-04-22 11:34:50.378988 (Thread-1): 11:34:50  Began executing node rpc.my_new_project.request
2022-04-22 11:34:50.381272 (Thread-1): 11:34:50  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:34:50.381371 (Thread-1): 11:34:50  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:34:50.381451 (Thread-1): 11:34:50  Opening a new connection, currently in state init
2022-04-22 11:34:50.678245 (Thread-57): handling poll request
2022-04-22 11:34:50.678678 (Thread-57): 11:34:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81940>]}
2022-04-22 11:34:50.679553 (Thread-57): sending response (<Response 5723 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:52.019761 (Thread-58): handling poll request
2022-04-22 11:34:52.020134 (Thread-58): 11:34:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81b20>]}
2022-04-22 11:34:52.020606 (Thread-58): sending response (<Response 386 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:53.361459 (Thread-59): handling poll request
2022-04-22 11:34:53.361832 (Thread-59): 11:34:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81be0>]}
2022-04-22 11:34:53.362289 (Thread-59): sending response (<Response 387 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:54.731016 (Thread-60): handling poll request
2022-04-22 11:34:54.731406 (Thread-60): 11:34:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81d60>]}
2022-04-22 11:34:54.731913 (Thread-60): sending response (<Response 388 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:56.070953 (Thread-61): handling poll request
2022-04-22 11:34:56.071341 (Thread-61): 11:34:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81f70>]}
2022-04-22 11:34:56.071847 (Thread-61): sending response (<Response 388 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:57.420573 (Thread-62): handling poll request
2022-04-22 11:34:57.420955 (Thread-62): 11:34:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf78160>]}
2022-04-22 11:34:57.421858 (Thread-62): sending response (<Response 388 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:58.777438 (Thread-63): handling poll request
2022-04-22 11:34:58.777813 (Thread-63): 11:34:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81940>]}
2022-04-22 11:34:58.778298 (Thread-63): sending response (<Response 389 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:34:59.655291 (Thread-1): 11:34:59  SQL status: SUCCESS 500 in 9.27 seconds
2022-04-22 11:35:00.142514 (Thread-64): handling poll request
2022-04-22 11:35:00.142953 (Thread-64): 11:35:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf81640>]}
2022-04-22 11:35:00.143444 (Thread-64): sending response (<Response 668 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:00.237108 (Thread-1): 11:35:00  finished collecting timing info
2022-04-22 11:35:00.237390 (Thread-1): 11:35:00  On rpc.my_new_project.request: Close
2022-04-22 11:35:01.481995 (Thread-65): handling poll request
2022-04-22 11:35:01.482373 (Thread-65): 11:35:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bfd5280>]}
2022-04-22 11:35:01.513728 (Thread-65): sending response (<Response 143358 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:07.502498 (Thread-66): 11:35:07  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:35:07.503050 (Thread-66): 11:35:07  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:35:07.508190 (Thread-66): 11:35:07  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:35:07.546250 (Thread-66): 11:35:07  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:35:07.551701 (Thread-66): 11:35:07  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe380aed60>]}
2022-04-22 11:35:08.547524 (Thread-67): handling status request
2022-04-22 11:35:08.547930 (Thread-67): 11:35:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4972be80>]}
2022-04-22 11:35:08.548490 (Thread-67): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:08.587877 (Thread-68): handling status request
2022-04-22 11:35:08.588256 (Thread-68): 11:35:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf9a8b0>]}
2022-04-22 11:35:08.588737 (Thread-68): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:22.083328 (Thread-69): handling status request
2022-04-22 11:35:22.083772 (Thread-69): 11:35:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf9ab50>]}
2022-04-22 11:35:22.084261 (Thread-69): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:26.682975 (Thread-70): 11:35:26  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 11:35:26.683206 (Thread-70): 11:35:26  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 11:35:26.683780 (Thread-70): 11:35:26  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:35:26.689263 (Thread-70): 11:35:26  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe38089f10>]}
2022-04-22 11:35:27.540389 (Thread-71): handling status request
2022-04-22 11:35:27.540816 (Thread-71): 11:35:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf6c730>]}
2022-04-22 11:35:27.541312 (Thread-71): sending response (<Response 1681 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:27.569573 (Thread-72): handling status request
2022-04-22 11:35:27.569895 (Thread-72): 11:35:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf6c970>]}
2022-04-22 11:35:27.570341 (Thread-72): sending response (<Response 1681 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:32.256870 (Thread-73): handling status request
2022-04-22 11:35:32.257361 (Thread-73): 11:35:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf6cb20>]}
2022-04-22 11:35:32.257887 (Thread-73): sending response (<Response 1659 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:32.259030 (Thread-74): handling status request
2022-04-22 11:35:32.259405 (Thread-74): 11:35:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf67580>]}
2022-04-22 11:35:32.259935 (Thread-74): sending response (<Response 1659 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:32.265443 (Thread-75): handling list request
2022-04-22 11:35:32.265880 (Thread-75): 11:35:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf67670>]}
2022-04-22 11:35:32.267776 (Thread-76): handling list request
2022-04-22 11:35:32.268391 (Thread-76): 11:35:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7a7790>]}
2022-04-22 11:35:32.302950 (Thread-76): 11:35:32  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf78070>]}
2022-04-22 11:35:32.303295 (Thread-76): 11:35:32  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:35:32.304067 (Thread-75): 11:35:32  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf5e400>]}
2022-04-22 11:35:32.309545 (Thread-75): sending response (<Response 5104 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:32.304448 (Thread-75): 11:35:32  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:35:32.310679 (Thread-76): sending response (<Response 2881 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:48.493303 (Thread-77): handling status request
2022-04-22 11:35:48.493702 (Thread-77): 11:35:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf846d0>]}
2022-04-22 11:35:48.494199 (Thread-77): sending response (<Response 1659 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:35:48.501531 (Thread-78): handling list request
2022-04-22 11:35:48.501855 (Thread-78): 11:35:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e72b5b0>]}
2022-04-22 11:35:48.533753 (Thread-78): 11:35:48  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf786d0>]}
2022-04-22 11:35:48.534117 (Thread-78): 11:35:48  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:35:48.537227 (Thread-78): sending response (<Response 2777 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:22.735138 (Thread-79): 11:36:22  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:36:22.735597 (Thread-79): 11:36:22  Partial parsing: updated file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 11:36:22.739327 (Thread-79): 11:36:22  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:36:22.776917 (Thread-79): 11:36:22  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:36:22.782800 (Thread-79): 11:36:22  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe281a3c40>]}
2022-04-22 11:36:23.524560 (Thread-80): handling status request
2022-04-22 11:36:23.524947 (Thread-80): 11:36:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe281ef8b0>]}
2022-04-22 11:36:23.525431 (Thread-80): sending response (<Response 1990 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:23.537424 (Thread-81): handling list request
2022-04-22 11:36:23.537706 (Thread-81): 11:36:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe281efdc0>]}
2022-04-22 11:36:23.572861 (Thread-81): 11:36:23  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e773220>]}
2022-04-22 11:36:23.573138 (Thread-81): 11:36:23  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:36:23.575520 (Thread-81): sending response (<Response 2777 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:23.592008 (Thread-82): handling status request
2022-04-22 11:36:23.592246 (Thread-82): 11:36:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe281802b0>]}
2022-04-22 11:36:23.592624 (Thread-82): sending response (<Response 2012 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:23.619196 (Thread-83): handling status request
2022-04-22 11:36:23.619444 (Thread-83): 11:36:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe281804c0>]}
2022-04-22 11:36:23.619821 (Thread-83): sending response (<Response 2012 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:24.141310 (Thread-84): handling status request
2022-04-22 11:36:24.141720 (Thread-84): 11:36:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28180400>]}
2022-04-22 11:36:24.142223 (Thread-84): sending response (<Response 1990 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:24.147897 (Thread-85): handling list request
2022-04-22 11:36:24.148161 (Thread-85): 11:36:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28180a90>]}
2022-04-22 11:36:24.179372 (Thread-85): 11:36:24  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe281a3b20>]}
2022-04-22 11:36:24.179750 (Thread-85): 11:36:24  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:36:24.188352 (Thread-85): sending response (<Response 2757 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:26.303634 (Thread-86): handling status request
2022-04-22 11:36:26.304066 (Thread-86): 11:36:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e7ceb50>]}
2022-04-22 11:36:26.304550 (Thread-86): sending response (<Response 1990 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:26.310675 (Thread-87): handling list request
2022-04-22 11:36:26.310925 (Thread-87): 11:36:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2817b220>]}
2022-04-22 11:36:26.345184 (Thread-87): 11:36:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2817b730>]}
2022-04-22 11:36:26.345476 (Thread-87): 11:36:26  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:36:26.348405 (Thread-87): sending response (<Response 6121 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:32.985736 (Thread-88): 11:36:32  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:36:32.986129 (Thread-88): 11:36:32  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:36:32.990567 (Thread-88): 11:36:32  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:36:33.028806 (Thread-88): 11:36:33  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:36:33.033766 (Thread-88): 11:36:33  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280c0850>]}
2022-04-22 11:36:33.761243 (Thread-89): handling status request
2022-04-22 11:36:33.761635 (Thread-89): 11:36:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2812fe80>]}
2022-04-22 11:36:33.790544 (Thread-89): sending response (<Response 1974 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:33.800432 (Thread-90): handling list request
2022-04-22 11:36:33.800746 (Thread-90): 11:36:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe38094d60>]}
2022-04-22 11:36:33.828614 (Thread-90): 11:36:33  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280c09d0>]}
2022-04-22 11:36:33.828970 (Thread-90): 11:36:33  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:36:33.832470 (Thread-90): sending response (<Response 6121 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:33.967275 (Thread-91): handling status request
2022-04-22 11:36:33.967717 (Thread-91): 11:36:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf671f0>]}
2022-04-22 11:36:33.968389 (Thread-91): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:33.993188 (Thread-92): handling status request
2022-04-22 11:36:33.993524 (Thread-92): 11:36:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28177a00>]}
2022-04-22 11:36:33.993979 (Thread-92): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:42.694136 (Thread-93): handling status request
2022-04-22 11:36:42.694577 (Thread-93): 11:36:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28177280>]}
2022-04-22 11:36:42.695106 (Thread-93): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:43.032476 (Thread-94): handling run_sql request
2022-04-22 11:36:43.032854 (Thread-94): 11:36:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2812fd30>]}
2022-04-22 11:36:45.642433 (Thread-94): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:45.669561 (MainThread): 11:36:45  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22711c9d-da80-482c-b44e-7da02cb86ce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5267334eb0>]}
2022-04-22 11:36:45.670071 (MainThread): 11:36:45  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:36:45.670654 (Thread-1): 11:36:45  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:36:45.670789 (Thread-1): 11:36:45  Began compiling node rpc.my_new_project.request
2022-04-22 11:36:45.670949 (Thread-1): 11:36:45  Compiling rpc.my_new_project.request
2022-04-22 11:36:45.674032 (Thread-1): 11:36:45  finished collecting timing info
2022-04-22 11:36:45.674177 (Thread-1): 11:36:45  Began executing node rpc.my_new_project.request
2022-04-22 11:36:45.676451 (Thread-1): 11:36:45  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:36:45.676555 (Thread-1): 11:36:45  On rpc.my_new_project.request: with
  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:36:45.676637 (Thread-1): 11:36:45  Opening a new connection, currently in state init
2022-04-22 11:36:46.029522 (Thread-95): handling poll request
2022-04-22 11:36:46.029959 (Thread-95): 11:36:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280ddbe0>]}
2022-04-22 11:36:46.030909 (Thread-95): sending response (<Response 5726 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:36:46.668038 (Thread-1): 11:36:46  Snowflake adapter: Snowflake query id: 01a3c6b8-0501-5f4a-0004-7d83048a6f22
2022-04-22 11:36:46.668267 (Thread-1): 11:36:46  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 11:36:46.668465 (Thread-1): 11:36:46  finished collecting timing info
2022-04-22 11:36:46.668678 (Thread-1): 11:36:46  On rpc.my_new_project.request: Close
2022-04-22 11:36:46.847582 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 11:36:46.848660 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  -- o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  -- o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 11:36:47.402689 (Thread-96): handling poll request
2022-04-22 11:36:47.403071 (Thread-96): 11:36:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280dd820>]}
2022-04-22 11:36:47.403796 (Thread-96): sending response (<Response 24442 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:37:04.857453 (Thread-97): 11:37:04  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:37:04.857891 (Thread-97): 11:37:04  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:37:04.862322 (Thread-97): 11:37:04  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:37:04.899875 (Thread-97): 11:37:04  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:37:04.904761 (Thread-97): 11:37:04  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08a1b9d0>]}
2022-04-22 11:37:05.738881 (Thread-98): handling status request
2022-04-22 11:37:05.739260 (Thread-98): 11:37:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280928b0>]}
2022-04-22 11:37:05.739836 (Thread-98): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:37:05.764831 (Thread-99): handling status request
2022-04-22 11:37:05.765148 (Thread-99): 11:37:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28092640>]}
2022-04-22 11:37:05.765582 (Thread-99): sending response (<Response 1996 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:37:17.707359 (Thread-100): 11:37:17  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:37:17.707796 (Thread-100): 11:37:17  Partial parsing: updated file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 11:37:17.711460 (Thread-100): 11:37:17  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:37:17.746407 (Thread-100): 11:37:17  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:37:17.751282 (Thread-100): 11:37:17  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe081bba60>]}
2022-04-22 11:37:18.601964 (Thread-101): handling status request
2022-04-22 11:37:18.602346 (Thread-101): 11:37:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2805d520>]}
2022-04-22 11:37:18.602848 (Thread-101): sending response (<Response 2017 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:37:18.625178 (Thread-102): handling status request
2022-04-22 11:37:18.625442 (Thread-102): 11:37:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2805d340>]}
2022-04-22 11:37:18.625835 (Thread-102): sending response (<Response 2017 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:38.893257 (Thread-103): 11:42:38  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:42:38.894368 (Thread-103): 11:42:38  Partial parsing: updated file: my_new_project://models/staging/stg_first_order.sql
2022-04-22 11:42:38.898155 (Thread-103): 11:42:38  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:42:38.941171 (Thread-103): 11:42:38  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:42:38.946689 (Thread-103): 11:42:38  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08121f40>]}
2022-04-22 11:42:39.670212 (Thread-104): handling status request
2022-04-22 11:42:39.670595 (Thread-104): 11:42:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0818a0a0>]}
2022-04-22 11:42:39.671091 (Thread-104): sending response (<Response 2017 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:39.741096 (Thread-105): handling status request
2022-04-22 11:42:39.741573 (Thread-105): 11:42:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0818e460>]}
2022-04-22 11:42:39.742098 (Thread-105): sending response (<Response 2017 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:43.476459 (Thread-106): handling status request
2022-04-22 11:42:43.477107 (Thread-106): 11:42:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe081fcbb0>]}
2022-04-22 11:42:43.477580 (Thread-107): handling status request
2022-04-22 11:42:43.478150 (Thread-106): sending response (<Response 1995 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:43.478501 (Thread-107): 11:42:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08161a60>]}
2022-04-22 11:42:43.479271 (Thread-107): sending response (<Response 1995 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:43.484806 (Thread-108): handling list request
2022-04-22 11:42:43.485366 (Thread-109): handling list request
2022-04-22 11:42:43.485714 (Thread-108): 11:42:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2805de80>]}
2022-04-22 11:42:43.485985 (Thread-109): 11:42:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0816faf0>]}
2022-04-22 11:42:43.516488 (Thread-108): 11:42:43  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe081fcd00>]}
2022-04-22 11:42:43.516784 (Thread-108): 11:42:43  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:42:43.521770 (Thread-108): sending response (<Response 714 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:43.517425 (Thread-109): 11:42:43  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2806c460>]}
2022-04-22 11:42:43.517685 (Thread-109): 11:42:43  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:42:43.523104 (Thread-109): sending response (<Response 4364 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:53.700465 (Thread-110): handling status request
2022-04-22 11:42:53.700856 (Thread-110): 11:42:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0816fd90>]}
2022-04-22 11:42:53.701361 (Thread-110): sending response (<Response 1995 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:42:53.712793 (Thread-111): handling list request
2022-04-22 11:42:53.713071 (Thread-111): 11:42:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2805dee0>]}
2022-04-22 11:42:53.748891 (Thread-111): 11:42:53  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0816f4f0>]}
2022-04-22 11:42:53.749212 (Thread-111): 11:42:53  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:42:53.752974 (Thread-111): sending response (<Response 6094 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:01.180615 (Thread-112): 11:43:01  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:43:01.181006 (Thread-112): 11:43:01  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:43:01.185458 (Thread-112): 11:43:01  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:43:01.221896 (Thread-112): 11:43:01  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:43:01.226879 (Thread-112): 11:43:01  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe080b5b50>]}
2022-04-22 11:43:01.902393 (Thread-113): handling status request
2022-04-22 11:43:01.902772 (Thread-113): 11:43:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08128520>]}
2022-04-22 11:43:01.903261 (Thread-113): sending response (<Response 1979 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:01.909234 (Thread-114): handling list request
2022-04-22 11:43:01.909487 (Thread-114): 11:43:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe081284c0>]}
2022-04-22 11:43:01.944518 (Thread-114): 11:43:01  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0817fa60>]}
2022-04-22 11:43:01.968042 (Thread-114): 11:43:01  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:43:01.971081 (Thread-114): sending response (<Response 6094 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:01.995000 (Thread-115): handling status request
2022-04-22 11:43:01.995287 (Thread-115): 11:43:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe080afe80>]}
2022-04-22 11:43:01.995801 (Thread-115): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:02.071443 (Thread-116): handling status request
2022-04-22 11:43:02.071806 (Thread-116): 11:43:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe080afc40>]}
2022-04-22 11:43:02.072253 (Thread-116): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:05.761502 (Thread-117): handling status request
2022-04-22 11:43:05.761883 (Thread-117): 11:43:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08080a90>]}
2022-04-22 11:43:05.762355 (Thread-117): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:06.131939 (Thread-118): handling run_sql request
2022-04-22 11:43:06.132337 (Thread-118): 11:43:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28070d00>]}
2022-04-22 11:43:08.676130 (Thread-118): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:08.702818 (MainThread): 11:43:08  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7748246b-b0f4-4064-a39f-73553ebf3d9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa176c9fdf0>]}
2022-04-22 11:43:08.703359 (MainThread): 11:43:08  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:43:08.703970 (Thread-1): 11:43:08  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:43:08.704099 (Thread-1): 11:43:08  Began compiling node rpc.my_new_project.request
2022-04-22 11:43:08.704203 (Thread-1): 11:43:08  Compiling rpc.my_new_project.request
2022-04-22 11:43:08.707175 (Thread-1): 11:43:08  finished collecting timing info
2022-04-22 11:43:08.707307 (Thread-1): 11:43:08  Began executing node rpc.my_new_project.request
2022-04-22 11:43:08.709510 (Thread-1): 11:43:08  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:43:08.709607 (Thread-1): 11:43:08  On rpc.my_new_project.request: with
  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:43:08.709689 (Thread-1): 11:43:08  Opening a new connection, currently in state init
2022-04-22 11:43:08.999674 (Thread-119): handling poll request
2022-04-22 11:43:09.000118 (Thread-119): 11:43:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0812d1c0>]}
2022-04-22 11:43:09.001041 (Thread-119): sending response (<Response 5726 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:09.784363 (Thread-1): 11:43:09  Snowflake adapter: Snowflake query id: 01a3c6bf-0501-6163-0004-7d83048a782e
2022-04-22 11:43:09.784593 (Thread-1): 11:43:09  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.
2022-04-22 11:43:09.784783 (Thread-1): 11:43:09  finished collecting timing info
2022-04-22 11:43:09.784985 (Thread-1): 11:43:09  On rpc.my_new_project.request: Close
2022-04-22 11:43:10.042396 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'O' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'O' does not exist or not authorized.
2022-04-22 11:43:10.043510 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  -- o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'O' does not exist or not authorized.", 'raw_sql': "with\r\n  -- o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.status as order_status,\r\n        case\r\n          when o.status in (\r\n            'paid',\r\n            'completed',\r\n            'shipped'\r\n          ) then 'completed'\r\n          else o.status\r\n        end as order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  -- o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.status as order_status,\n        case\n          when o.status in (\n            'paid',\n            'completed',\n            'shipped'\n          ) then 'completed'\n          else o.status\n        end as order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 11:43:10.344398 (Thread-120): handling poll request
2022-04-22 11:43:10.344789 (Thread-120): 11:43:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0812d4c0>]}
2022-04-22 11:43:10.345467 (Thread-120): sending response (<Response 24442 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:19.354300 (Thread-121): 11:43:19  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:43:19.354744 (Thread-121): 11:43:19  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:43:19.359212 (Thread-121): 11:43:19  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:43:19.396474 (Thread-121): 11:43:19  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:43:19.403394 (Thread-121): 11:43:19  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5dcf70>]}
2022-04-22 11:43:20.099455 (Thread-122): handling status request
2022-04-22 11:43:20.099918 (Thread-122): 11:43:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08004a00>]}
2022-04-22 11:43:20.100460 (Thread-122): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:20.299853 (Thread-123): handling status request
2022-04-22 11:43:20.307522 (Thread-123): 11:43:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08004820>]}
2022-04-22 11:43:20.308005 (Thread-123): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:23.812413 (Thread-124): handling status request
2022-04-22 11:43:23.812776 (Thread-124): 11:43:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe080046a0>]}
2022-04-22 11:43:23.813233 (Thread-124): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:24.135305 (Thread-125): handling run_sql request
2022-04-22 11:43:24.135764 (Thread-125): 11:43:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08004490>]}
2022-04-22 11:43:26.642127 (Thread-125): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:26.668756 (MainThread): 11:43:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1a26004-eb64-4d81-aa24-01da7d16aa37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35764a5e50>]}
2022-04-22 11:43:26.669298 (MainThread): 11:43:26  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:43:26.669882 (Thread-1): 11:43:26  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:43:26.670017 (Thread-1): 11:43:26  Began compiling node rpc.my_new_project.request
2022-04-22 11:43:26.670111 (Thread-1): 11:43:26  Compiling rpc.my_new_project.request
2022-04-22 11:43:26.673158 (Thread-1): 11:43:26  finished collecting timing info
2022-04-22 11:43:26.673289 (Thread-1): 11:43:26  Began executing node rpc.my_new_project.request
2022-04-22 11:43:26.675623 (Thread-1): 11:43:26  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:43:26.675725 (Thread-1): 11:43:26  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:43:26.675809 (Thread-1): 11:43:26  Opening a new connection, currently in state init
2022-04-22 11:43:26.980705 (Thread-126): handling poll request
2022-04-22 11:43:26.981145 (Thread-126): 11:43:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe080a0520>]}
2022-04-22 11:43:26.982067 (Thread-126): sending response (<Response 5723 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:28.341083 (Thread-127): handling poll request
2022-04-22 11:43:28.341490 (Thread-127): 11:43:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0803d490>]}
2022-04-22 11:43:28.341998 (Thread-127): sending response (<Response 388 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:29.456504 (Thread-1): 11:43:29  SQL status: SUCCESS 500 in 2.78 seconds
2022-04-22 11:43:29.697745 (Thread-128): handling poll request
2022-04-22 11:43:29.698128 (Thread-128): 11:43:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0803d400>]}
2022-04-22 11:43:29.698626 (Thread-128): sending response (<Response 667 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:30.002417 (Thread-1): 11:43:30  finished collecting timing info
2022-04-22 11:43:30.002699 (Thread-1): 11:43:30  On rpc.my_new_project.request: Close
2022-04-22 11:43:31.070079 (Thread-129): handling poll request
2022-04-22 11:43:31.070500 (Thread-129): 11:43:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4bf783d0>]}
2022-04-22 11:43:31.079597 (Thread-129): sending response (<Response 143735 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:33.704345 (Thread-130): handling status request
2022-04-22 11:43:33.704757 (Thread-130): 11:43:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe49799b50>]}
2022-04-22 11:43:33.705293 (Thread-130): sending response (<Response 1979 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:43:33.710840 (Thread-131): handling list request
2022-04-22 11:43:33.711100 (Thread-131): 11:43:33  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe49799c10>]}
2022-04-22 11:43:33.747906 (Thread-131): 11:43:33  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4972b7f0>]}
2022-04-22 11:43:33.748209 (Thread-131): 11:43:33  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:43:33.751367 (Thread-131): sending response (<Response 1864 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:47:21.856892 (Thread-132): handling status request
2022-04-22 11:47:21.858845 (Thread-132): 11:47:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4972b9d0>]}
2022-04-22 11:47:21.859350 (Thread-132): sending response (<Response 1979 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:47:21.868298 (Thread-133): handling list request
2022-04-22 11:47:21.868546 (Thread-133): 11:47:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4972b520>]}
2022-04-22 11:47:21.904637 (Thread-133): 11:47:21  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5daa60>]}
2022-04-22 11:47:21.905089 (Thread-133): 11:47:21  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:47:21.909876 (Thread-133): sending response (<Response 3343 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:00.150754 (Thread-134): 11:48:00  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:48:00.151241 (Thread-134): 11:48:00  Partial parsing: updated file: my_new_project://models/staging/stg_orders.sql
2022-04-22 11:48:00.155318 (Thread-134): 11:48:00  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:48:00.195146 (Thread-134): 11:48:00  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:48:00.200317 (Thread-134): 11:48:00  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3e5670>]}
2022-04-22 11:48:00.899947 (Thread-135): handling status request
2022-04-22 11:48:00.900326 (Thread-135): 11:48:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3c2e50>]}
2022-04-22 11:48:00.900829 (Thread-135): sending response (<Response 1985 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:00.916496 (Thread-136): handling list request
2022-04-22 11:48:00.916769 (Thread-136): 11:48:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3c2d30>]}
2022-04-22 11:48:00.951092 (Thread-136): 11:48:00  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc4b58b0>]}
2022-04-22 11:48:00.951381 (Thread-136): 11:48:00  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:48:00.953868 (Thread-136): sending response (<Response 3343 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:00.998019 (Thread-137): handling status request
2022-04-22 11:48:00.998300 (Thread-137): 11:48:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3c2ca0>]}
2022-04-22 11:48:00.998747 (Thread-137): sending response (<Response 2007 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:01.163209 (Thread-138): handling status request
2022-04-22 11:48:01.163629 (Thread-138): 11:48:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3c2f10>]}
2022-04-22 11:48:01.164135 (Thread-138): sending response (<Response 2007 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:01.477987 (Thread-139): handling status request
2022-04-22 11:48:01.478370 (Thread-139): 11:48:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc4b5070>]}
2022-04-22 11:48:01.478833 (Thread-139): sending response (<Response 1985 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:01.484469 (Thread-140): handling list request
2022-04-22 11:48:01.484773 (Thread-140): 11:48:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0802e8b0>]}
2022-04-22 11:48:01.518495 (Thread-140): 11:48:01  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5b8df0>]}
2022-04-22 11:48:01.539784 (Thread-140): 11:48:01  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:48:01.542393 (Thread-140): sending response (<Response 3343 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:23.010662 (Thread-141): 11:48:23  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:48:23.011056 (Thread-141): 11:48:23  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 11:48:23.015149 (Thread-141): 11:48:23  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:48:23.053344 (Thread-141): 11:48:23  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:48:23.058711 (Thread-141): 11:48:23  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3710a0>]}
2022-04-22 11:48:23.750801 (Thread-142): handling status request
2022-04-22 11:48:23.751198 (Thread-142): 11:48:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3a0910>]}
2022-04-22 11:48:23.751763 (Thread-142): sending response (<Response 1979 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:23.757860 (Thread-143): handling list request
2022-04-22 11:48:23.758125 (Thread-143): 11:48:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3a07c0>]}
2022-04-22 11:48:23.793501 (Thread-143): 11:48:23  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5b89a0>]}
2022-04-22 11:48:23.793902 (Thread-143): 11:48:23  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:48:23.962463 (Thread-144): handling status request
2022-04-22 11:48:23.962898 (Thread-144): 11:48:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5ba6a0>]}
2022-04-22 11:48:23.966999 (Thread-143): sending response (<Response 6094 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:23.967598 (Thread-144): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:24.047033 (Thread-145): handling status request
2022-04-22 11:48:24.047427 (Thread-145): 11:48:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc361790>]}
2022-04-22 11:48:24.047934 (Thread-145): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:27.337345 (Thread-146): handling status request
2022-04-22 11:48:27.337730 (Thread-146): 11:48:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3614f0>]}
2022-04-22 11:48:27.338197 (Thread-146): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:27.689052 (Thread-147): handling run_sql request
2022-04-22 11:48:27.689435 (Thread-147): 11:48:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc361bb0>]}
2022-04-22 11:48:30.196928 (Thread-147): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:30.223528 (MainThread): 11:48:30  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '37dfc04d-249d-4104-830b-416b4e093069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad189b4e80>]}
2022-04-22 11:48:30.224062 (MainThread): 11:48:30  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:48:30.224651 (Thread-1): 11:48:30  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:48:30.224784 (Thread-1): 11:48:30  Began compiling node rpc.my_new_project.request
2022-04-22 11:48:30.224877 (Thread-1): 11:48:30  Compiling rpc.my_new_project.request
2022-04-22 11:48:30.227882 (Thread-1): 11:48:30  finished collecting timing info
2022-04-22 11:48:30.228012 (Thread-1): 11:48:30  Began executing node rpc.my_new_project.request
2022-04-22 11:48:30.230147 (Thread-1): 11:48:30  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:48:30.230245 (Thread-1): 11:48:30  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:48:30.230328 (Thread-1): 11:48:30  Opening a new connection, currently in state init
2022-04-22 11:48:30.702339 (Thread-148): handling poll request
2022-04-22 11:48:30.702776 (Thread-148): 11:48:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3cff10>]}
2022-04-22 11:48:30.703711 (Thread-148): sending response (<Response 5539 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:31.189552 (Thread-1): 11:48:31  Snowflake adapter: Snowflake query id: 01a3c6c4-0501-6163-0004-7d83048a78d6
2022-04-22 11:48:31.189786 (Thread-1): 11:48:31  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 19 at position 8
invalid identifier 'O.ORDER_STATUS'
2022-04-22 11:48:31.190007 (Thread-1): 11:48:31  finished collecting timing info
2022-04-22 11:48:31.190222 (Thread-1): 11:48:31  On rpc.my_new_project.request: Close
2022-04-22 11:48:31.381385 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 19 at position 8
  invalid identifier 'O.ORDER_STATUS'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 19 at position 8
invalid identifier 'O.ORDER_STATUS'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 19 at position 8
  invalid identifier 'O.ORDER_STATUS'
2022-04-22 11:48:31.382379 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 19 at position 8\n  invalid identifier 'O.ORDER_STATUS'", 'raw_sql': "with\r\n  o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 19 at position 8\n  invalid identifier 'O.ORDER_STATUS'", 'raw_sql': "with\r\n  o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        case\r\n          when fo.first_order_id = o.order_id then 'new'\r\n          else 'repeat'\r\n        end as user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_shipping_amount_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join fo\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        case\n          when fo.first_order_id = o.order_id then 'new'\n          else 'repeat'\n        end as user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_shipping_amount_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join fo\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 11:48:32.072993 (Thread-149): handling poll request
2022-04-22 11:48:32.073401 (Thread-149): 11:48:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3ec370>]}
2022-04-22 11:48:32.074132 (Thread-149): sending response (<Response 23182 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:40.290056 (Thread-150): handling status request
2022-04-22 11:48:40.290432 (Thread-150): 11:48:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3e5280>]}
2022-04-22 11:48:40.290950 (Thread-150): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:40.662095 (Thread-151): handling status request
2022-04-22 11:48:40.662492 (Thread-151): 11:48:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3e5d00>]}
2022-04-22 11:48:40.662969 (Thread-151): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:40.671870 (Thread-152): handling cli_args request
2022-04-22 11:48:40.672125 (Thread-152): 11:48:40  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc3c5cd0>]}
2022-04-22 11:48:43.176287 (Thread-152): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:43.221425 (MainThread): 11:48:43  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 11:48:43.221814 (MainThread): 11:48:43  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f45fe3520>]}
2022-04-22 11:48:43.260390 (MainThread): 11:48:43  Parsing macros/adapters.sql
2022-04-22 11:48:43.299755 (MainThread): 11:48:43  Parsing macros/catalog.sql
2022-04-22 11:48:43.301620 (MainThread): 11:48:43  Parsing macros/materializations/table.sql
2022-04-22 11:48:43.304741 (MainThread): 11:48:43  Parsing macros/materializations/seed.sql
2022-04-22 11:48:43.310091 (MainThread): 11:48:43  Parsing macros/materializations/incremental.sql
2022-04-22 11:48:43.318935 (MainThread): 11:48:43  Parsing macros/materializations/merge.sql
2022-04-22 11:48:43.322829 (MainThread): 11:48:43  Parsing macros/materializations/snapshot.sql
2022-04-22 11:48:43.323807 (MainThread): 11:48:43  Parsing macros/materializations/view.sql
2022-04-22 11:48:43.325138 (MainThread): 11:48:43  Parsing macros/adapters/metadata.sql
2022-04-22 11:48:43.332427 (MainThread): 11:48:43  Parsing macros/adapters/columns.sql
2022-04-22 11:48:43.342429 (MainThread): 11:48:43  Parsing macros/adapters/freshness.sql
2022-04-22 11:48:43.345355 (MainThread): 11:48:43  Parsing macros/adapters/persist_docs.sql
2022-04-22 11:48:43.349860 (MainThread): 11:48:43  Parsing macros/adapters/relation.sql
2022-04-22 11:48:43.359592 (MainThread): 11:48:43  Parsing macros/adapters/schema.sql
2022-04-22 11:48:43.361825 (MainThread): 11:48:43  Parsing macros/adapters/indexes.sql
2022-04-22 11:48:43.364563 (MainThread): 11:48:43  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 11:48:43.367053 (MainThread): 11:48:43  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 11:48:43.368575 (MainThread): 11:48:43  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 11:48:43.370100 (MainThread): 11:48:43  Parsing macros/etc/datetime.sql
2022-04-22 11:48:43.378773 (MainThread): 11:48:43  Parsing macros/etc/statement.sql
2022-04-22 11:48:43.383957 (MainThread): 11:48:43  Parsing macros/generic_test_sql/unique.sql
2022-04-22 11:48:43.384722 (MainThread): 11:48:43  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 11:48:43.385307 (MainThread): 11:48:43  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 11:48:43.386655 (MainThread): 11:48:43  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 11:48:43.387652 (MainThread): 11:48:43  Parsing macros/materializations/configs.sql
2022-04-22 11:48:43.389934 (MainThread): 11:48:43  Parsing macros/materializations/hooks.sql
2022-04-22 11:48:43.393875 (MainThread): 11:48:43  Parsing macros/materializations/models/table/table.sql
2022-04-22 11:48:43.401442 (MainThread): 11:48:43  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 11:48:43.404446 (MainThread): 11:48:43  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 11:48:43.407068 (MainThread): 11:48:43  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 11:48:43.408501 (MainThread): 11:48:43  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 11:48:43.410767 (MainThread): 11:48:43  Parsing macros/materializations/models/view/view.sql
2022-04-22 11:48:43.418251 (MainThread): 11:48:43  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 11:48:43.428470 (MainThread): 11:48:43  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 11:48:43.444213 (MainThread): 11:48:43  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 11:48:43.445693 (MainThread): 11:48:43  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 11:48:43.457015 (MainThread): 11:48:43  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 11:48:43.461528 (MainThread): 11:48:43  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 11:48:43.478058 (MainThread): 11:48:43  Parsing macros/materializations/seeds/seed.sql
2022-04-22 11:48:43.484103 (MainThread): 11:48:43  Parsing macros/materializations/tests/helpers.sql
2022-04-22 11:48:43.485953 (MainThread): 11:48:43  Parsing macros/materializations/tests/test.sql
2022-04-22 11:48:43.490446 (MainThread): 11:48:43  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 11:48:43.508655 (Thread-153): handling poll request
2022-04-22 11:48:43.509068 (Thread-153): 11:48:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08121ac0>]}
2022-04-22 11:48:43.510669 (Thread-153): sending response (<Response 13266 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:43.492285 (MainThread): 11:48:43  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 11:48:43.503467 (MainThread): 11:48:43  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 11:48:43.520812 (MainThread): 11:48:43  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 11:48:43.522476 (MainThread): 11:48:43  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 11:48:43.534364 (MainThread): 11:48:43  Parsing tests/generic/builtin.sql
2022-04-22 11:48:43.734718 (MainThread): 11:48:43  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 11:48:43.745728 (MainThread): 11:48:43  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 11:48:43.747806 (MainThread): 11:48:43  1603: static parser failed on _archive/test_loop.sql
2022-04-22 11:48:43.750980 (MainThread): 11:48:43  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 11:48:43.751982 (MainThread): 11:48:43  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:48:43.753838 (MainThread): 11:48:43  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 11:48:43.755757 (MainThread): 11:48:43  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:48:43.757730 (MainThread): 11:48:43  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:48:43.759823 (MainThread): 11:48:43  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 11:48:43.761743 (MainThread): 11:48:43  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 11:48:43.764017 (MainThread): 11:48:43  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:48:43.830118 (MainThread): 11:48:43  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:48:43.834577 (MainThread): 11:48:43  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f441adf70>]}
2022-04-22 11:48:43.869950 (MainThread): 11:48:43  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f45e7ad60>]}
2022-04-22 11:48:43.870299 (MainThread): 11:48:43  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:48:43.871757 (MainThread): 11:48:43  
2022-04-22 11:48:43.872040 (MainThread): 11:48:43  Acquiring new snowflake connection "master"
2022-04-22 11:48:43.873196 (ThreadPoolExecutor-0_0): 11:48:43  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 11:48:43.885098 (ThreadPoolExecutor-0_0): 11:48:43  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 11:48:43.885205 (ThreadPoolExecutor-0_0): 11:48:43  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 11:48:43.885291 (ThreadPoolExecutor-0_0): 11:48:43  Opening a new connection, currently in state init
2022-04-22 11:48:44.803001 (ThreadPoolExecutor-0_0): 11:48:44  SQL status: SUCCESS 4 in 0.92 seconds
2022-04-22 11:48:44.805104 (ThreadPoolExecutor-0_0): 11:48:44  On list_PE_ALEXANDER_B: Close
2022-04-22 11:48:44.849913 (Thread-154): handling poll request
2022-04-22 11:48:44.850285 (Thread-154): 11:48:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5ba6a0>]}
2022-04-22 11:48:44.851079 (Thread-154): sending response (<Response 9395 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:45.070617 (ThreadPoolExecutor-2_0): 11:48:45  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:48:45.078102 (ThreadPoolExecutor-2_0): 11:48:45  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:48:45.078247 (ThreadPoolExecutor-2_0): 11:48:45  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 11:48:45.078349 (ThreadPoolExecutor-2_0): 11:48:45  Opening a new connection, currently in state closed
2022-04-22 11:48:46.059262 (ThreadPoolExecutor-2_0): 11:48:46  SQL status: SUCCESS 7 in 0.98 seconds
2022-04-22 11:48:46.060953 (ThreadPoolExecutor-2_0): 11:48:46  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 11:48:46.222644 (Thread-155): handling poll request
2022-04-22 11:48:46.223024 (Thread-155): 11:48:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0817a760>]}
2022-04-22 11:48:46.223613 (Thread-155): sending response (<Response 2395 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:46.255888 (MainThread): 11:48:46  Concurrency: 4 threads (target='default')
2022-04-22 11:48:46.256082 (MainThread): 11:48:46  
2022-04-22 11:48:46.258788 (Thread-1): 11:48:46  Began running node model.my_new_project.orginal_query
2022-04-22 11:48:46.259115 (Thread-1): 11:48:46  1 of 10 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 11:48:46.259388 (Thread-1): 11:48:46  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 11:48:46.259522 (Thread-1): 11:48:46  Began compiling node model.my_new_project.orginal_query
2022-04-22 11:48:46.259657 (Thread-1): 11:48:46  Compiling model.my_new_project.orginal_query
2022-04-22 11:48:46.261769 (Thread-2): 11:48:46  Began running node model.my_new_project.stg_ctry_type
2022-04-22 11:48:46.262063 (Thread-2): 11:48:46  2 of 10 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 11:48:46.262341 (Thread-2): 11:48:46  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 11:48:46.262437 (Thread-2): 11:48:46  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 11:48:46.262522 (Thread-2): 11:48:46  Compiling model.my_new_project.stg_ctry_type
2022-04-22 11:48:46.264867 (Thread-2): 11:48:46  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 11:48:46.265148 (Thread-3): 11:48:46  Began running node model.my_new_project.stg_device_orders
2022-04-22 11:48:46.265394 (Thread-3): 11:48:46  3 of 10 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 11:48:46.265647 (Thread-3): 11:48:46  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 11:48:46.265738 (Thread-3): 11:48:46  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 11:48:46.265822 (Thread-3): 11:48:46  Compiling model.my_new_project.stg_device_orders
2022-04-22 11:48:46.267897 (Thread-3): 11:48:46  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 11:48:46.268166 (Thread-4): 11:48:46  Began running node model.my_new_project.stg_orders
2022-04-22 11:48:46.268399 (Thread-4): 11:48:46  4 of 10 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 11:48:46.268653 (Thread-4): 11:48:46  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 11:48:46.268746 (Thread-4): 11:48:46  Began compiling node model.my_new_project.stg_orders
2022-04-22 11:48:46.268833 (Thread-4): 11:48:46  Compiling model.my_new_project.stg_orders
2022-04-22 11:48:46.270782 (Thread-4): 11:48:46  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 11:48:46.333357 (Thread-1): 11:48:46  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 11:48:46.345492 (Thread-4): 11:48:46  finished collecting timing info
2022-04-22 11:48:46.345666 (Thread-4): 11:48:46  Began executing node model.my_new_project.stg_orders
2022-04-22 11:48:46.350668 (Thread-2): 11:48:46  finished collecting timing info
2022-04-22 11:48:46.350813 (Thread-2): 11:48:46  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 11:48:46.355743 (Thread-3): 11:48:46  finished collecting timing info
2022-04-22 11:48:46.355884 (Thread-3): 11:48:46  Began executing node model.my_new_project.stg_device_orders
2022-04-22 11:48:46.371436 (Thread-1): 11:48:46  finished collecting timing info
2022-04-22 11:48:46.371606 (Thread-1): 11:48:46  Began executing node model.my_new_project.orginal_query
2022-04-22 11:48:46.395248 (Thread-1): 11:48:46  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 11:48:46.398104 (Thread-4): 11:48:46  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 11:48:46.398954 (Thread-3): 11:48:46  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 11:48:46.402149 (Thread-2): 11:48:46  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 11:48:46.419500 (Thread-1): 11:48:46  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 11:48:46.419620 (Thread-1): 11:48:46  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    SELECT
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount 

FROM (
    
    SELECT
      o.order_id,
      o.user_id,
      o.created_at,
      o.updated_at,
      o.shipped_at,
      o.currency,
      o.status AS order_status,
      CASE
        WHEN o.status IN (
          'paid',
          'completed',
          'shipped'
        ) THEN 'completed'
        ELSE o.status
      END AS order_status_category,
      CASE
        WHEN oa.country_code IS NULL THEN 'Null country'
        WHEN oa.country_code = 'US' THEN 'US'
        WHEN oa.country_code != 'US' THEN 'International'
      END AS country_type,
      o.shipping_method,
      CASE
        WHEN d.device = 'web' THEN 'desktop'
        WHEN d.device IN ('ios-app', 'android-app') THEN 'mobile-app'
        when d.device IN ('mobile', 'tablet') THEN 'mobile-web'
        when NULLIF(d.device, '') IS NULL THEN 'unknown'
        ELSE 'ERROR'
      END AS purchase_device_type,
      d.device AS purchase_device,
      CASE
        WHEN fo.first_order_id = o.order_id THEN 'new'
        ELSE 'repeat'
      END AS user_type,
      o.amount_total_cents,
      pa.gross_total_amount_cents,
      CASE
        WHEN o.currency = 'USD' then o.amount_total_cents
        ELSE pa.gross_total_amount_cents
      END AS total_amount_cents,
      pa.gross_tax_amount_cents,
      pa.gross_amount_cents,
      pa.gross_shipping_amount_cents
    FROM `dbt-public.interview_task.orders` o
    LEFT JOIN (
        SELECT
          DISTINCT cast(d.type_id as int64) as order_id,
          FIRST_VALUE(d.device) OVER (
            PARTITION BY d.type_id
            ORDER BY
              d.created_at ROWS BETWEEN UNBOUNDED PRECEDING
              AND UNBOUNDED FOLLOWING
          ) AS device
        FROM `dbt-public.interview_task.devices` d
        WHERE d.type = 'order'
    ) d ON d.order_id = o.order_id
    LEFT JOIN (
        SELECT
          fo.user_id,
          MIN(fo.order_id) as first_order_id
        FROM `dbt-public.interview_task.orders` as fo
        WHERE
          fo.status != 'cancelled'
        GROUP BY
          fo.user_id
      ) fo ON o.user_id = fo.user_id
    left join `dbt-public.interview_task.addresses` oa 
      ON oa.order_id = o.order_id
    LEFT JOIN (
        select
          order_id,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents
              ELSE 0
            END
          ) as gross_tax_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_cents
              ELSE 0
            END
          ) as gross_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN amount_shipping_cents
              ELSE 0
            END
        ) as gross_shipping_amount_cents,
          sum(
            CASE
              WHEN status = 'completed' THEN tax_amount_cents + amount_cents + amount_shipping_cents
              ELSE 0
            END
          ) as gross_total_amount_cents
        FROM `dbt-public.interview_task.payments`
        GROUP BY order_id
    ) pa ON pa.order_id = o.order_id
  )
  );
2022-04-22 11:48:46.419711 (Thread-1): 11:48:46  Opening a new connection, currently in state closed
2022-04-22 11:48:46.421023 (Thread-4): 11:48:46  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 11:48:46.421132 (Thread-4): 11:48:46  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
  );
2022-04-22 11:48:46.421222 (Thread-4): 11:48:46  Opening a new connection, currently in state init
2022-04-22 11:48:46.422327 (Thread-3): 11:48:46  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 11:48:46.422438 (Thread-3): 11:48:46  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 11:48:46.422524 (Thread-3): 11:48:46  Opening a new connection, currently in state init
2022-04-22 11:48:46.425413 (Thread-2): 11:48:46  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 11:48:46.425535 (Thread-2): 11:48:46  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 11:48:46.425623 (Thread-2): 11:48:46  Opening a new connection, currently in state init
2022-04-22 11:48:47.590697 (Thread-156): handling poll request
2022-04-22 11:48:47.591081 (Thread-156): 11:48:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe08121340>]}
2022-04-22 11:48:47.592299 (Thread-156): sending response (<Response 25909 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:47.678349 (Thread-2): 11:48:47  SQL status: SUCCESS 1 in 1.25 seconds
2022-04-22 11:48:47.684869 (Thread-2): 11:48:47  finished collecting timing info
2022-04-22 11:48:47.685039 (Thread-2): 11:48:47  On model.my_new_project.stg_ctry_type: Close
2022-04-22 11:48:47.770837 (Thread-3): 11:48:47  SQL status: SUCCESS 1 in 1.35 seconds
2022-04-22 11:48:47.772159 (Thread-3): 11:48:47  finished collecting timing info
2022-04-22 11:48:47.772330 (Thread-3): 11:48:47  On model.my_new_project.stg_device_orders: Close
2022-04-22 11:48:47.778114 (Thread-1): 11:48:47  Snowflake adapter: Snowflake query id: 01a3c6c4-0501-6083-0004-7d83048a878a
2022-04-22 11:48:47.778234 (Thread-1): 11:48:47  Snowflake adapter: Snowflake error: 002040 (42601): SQL compilation error:
Unsupported data type 'INT64'.
2022-04-22 11:48:47.778391 (Thread-1): 11:48:47  finished collecting timing info
2022-04-22 11:48:47.778514 (Thread-1): 11:48:47  On model.my_new_project.orginal_query: Close
2022-04-22 11:48:47.823529 (Thread-4): 11:48:47  SQL status: SUCCESS 1 in 1.4 seconds
2022-04-22 11:48:47.824939 (Thread-4): 11:48:47  finished collecting timing info
2022-04-22 11:48:47.825090 (Thread-4): 11:48:47  On model.my_new_project.stg_orders: Close
2022-04-22 11:48:47.890629 (Thread-2): 11:48:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7ba006d0>]}
2022-04-22 11:48:47.891068 (Thread-2): 11:48:47  2 of 10 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 1.63s]
2022-04-22 11:48:47.891202 (Thread-2): 11:48:47  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 11:48:47.891352 (Thread-2): 11:48:47  Began running node model.my_new_project.stg_payments
2022-04-22 11:48:47.891571 (Thread-2): 11:48:47  5 of 10 START view model abrown_dbt_interview.stg_payments...................... [RUN]
2022-04-22 11:48:47.891914 (Thread-2): 11:48:47  Acquiring new snowflake connection "model.my_new_project.stg_payments"
2022-04-22 11:48:47.892043 (Thread-2): 11:48:47  Began compiling node model.my_new_project.stg_payments
2022-04-22 11:48:47.892144 (Thread-2): 11:48:47  Compiling model.my_new_project.stg_payments
2022-04-22 11:48:47.895849 (Thread-2): 11:48:47  Writing injected SQL for node "model.my_new_project.stg_payments"
2022-04-22 11:48:47.911677 (Thread-2): 11:48:47  finished collecting timing info
2022-04-22 11:48:47.911823 (Thread-2): 11:48:47  Began executing node model.my_new_project.stg_payments
2022-04-22 11:48:47.915241 (Thread-2): 11:48:47  Writing runtime SQL for node "model.my_new_project.stg_payments"
2022-04-22 11:48:47.932009 (Thread-2): 11:48:47  Using snowflake connection "model.my_new_project.stg_payments"
2022-04-22 11:48:47.932142 (Thread-2): 11:48:47  On model.my_new_project.stg_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_payments 
  
   as (
    with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
  );
2022-04-22 11:48:47.932237 (Thread-2): 11:48:47  Opening a new connection, currently in state closed
2022-04-22 11:48:47.983452 (Thread-1): 11:48:47  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  002040 (42601): SQL compilation error:
  Unsupported data type 'INT64'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 11:48:47.983905 (Thread-1): 11:48:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a5c3550>]}
2022-04-22 11:48:47.984432 (Thread-1): 11:48:47  1 of 10 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.72s]
2022-04-22 11:48:47.984578 (Thread-1): 11:48:47  Finished running node model.my_new_project.orginal_query
2022-04-22 11:48:47.984722 (Thread-1): 11:48:47  Began running node model.my_new_project.stg_query
2022-04-22 11:48:47.984905 (Thread-1): 11:48:47  6 of 10 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 11:48:47.985144 (Thread-1): 11:48:47  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 11:48:47.985235 (Thread-1): 11:48:47  Began compiling node model.my_new_project.stg_query
2022-04-22 11:48:47.985325 (Thread-1): 11:48:47  Compiling model.my_new_project.stg_query
2022-04-22 11:48:47.988962 (Thread-1): 11:48:47  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 11:48:48.001576 (Thread-3): 11:48:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a595130>]}
2022-04-22 11:48:48.001875 (Thread-3): 11:48:48  3 of 10 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 1.74s]
2022-04-22 11:48:48.001989 (Thread-3): 11:48:48  Finished running node model.my_new_project.stg_device_orders
2022-04-22 11:48:48.002134 (Thread-3): 11:48:48  Began running node model.my_new_project.test_conn
2022-04-22 11:48:48.002302 (Thread-3): 11:48:48  7 of 10 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 11:48:48.002514 (Thread-3): 11:48:48  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 11:48:48.002603 (Thread-3): 11:48:48  Began compiling node model.my_new_project.test_conn
2022-04-22 11:48:48.002688 (Thread-3): 11:48:48  Compiling model.my_new_project.test_conn
2022-04-22 11:48:48.004710 (Thread-3): 11:48:48  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 11:48:48.018698 (Thread-1): 11:48:48  finished collecting timing info
2022-04-22 11:48:48.018842 (Thread-1): 11:48:48  Began executing node model.my_new_project.stg_query
2022-04-22 11:48:48.020769 (Thread-1): 11:48:48  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 11:48:48.021061 (Thread-3): 11:48:48  finished collecting timing info
2022-04-22 11:48:48.021199 (Thread-3): 11:48:48  Began executing node model.my_new_project.test_conn
2022-04-22 11:48:48.022968 (Thread-3): 11:48:48  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 11:48:48.039718 (Thread-3): 11:48:48  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 11:48:48.039843 (Thread-3): 11:48:48  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    -- select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_devices
-- select * from raw.interview_sample_data.interview_orders
-- select * from raw.interview_sample_data.interview_addresses
-- select * from raw.interview_sample_data.interview_payments

-- select * from raw.interview_sample_data.interview_orders
  );
2022-04-22 11:48:48.039936 (Thread-3): 11:48:48  Opening a new connection, currently in state closed
2022-04-22 11:48:48.047071 (Thread-4): 11:48:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a59c0a0>]}
2022-04-22 11:48:48.047387 (Thread-4): 11:48:48  4 of 10 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 1.78s]
2022-04-22 11:48:48.047537 (Thread-4): 11:48:48  Finished running node model.my_new_project.stg_orders
2022-04-22 11:48:48.047680 (Thread-4): 11:48:48  Began running node model.my_new_project.test_loop
2022-04-22 11:48:48.047860 (Thread-4): 11:48:48  8 of 10 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 11:48:48.048077 (Thread-4): 11:48:48  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 11:48:48.048165 (Thread-4): 11:48:48  Began compiling node model.my_new_project.test_loop
2022-04-22 11:48:48.048250 (Thread-4): 11:48:48  Compiling model.my_new_project.test_loop
2022-04-22 11:48:48.050772 (Thread-4): 11:48:48  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 11:48:48.055373 (Thread-1): 11:48:48  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 11:48:48.055519 (Thread-1): 11:48:48  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 11:48:48.055612 (Thread-1): 11:48:48  Opening a new connection, currently in state closed
2022-04-22 11:48:48.065335 (Thread-4): 11:48:48  finished collecting timing info
2022-04-22 11:48:48.065479 (Thread-4): 11:48:48  Began executing node model.my_new_project.test_loop
2022-04-22 11:48:48.067410 (Thread-4): 11:48:48  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 11:48:48.082196 (Thread-4): 11:48:48  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 11:48:48.082312 (Thread-4): 11:48:48  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    -- list tables




select * from raw.interview_sample_data.interview_devices
  );
2022-04-22 11:48:48.082399 (Thread-4): 11:48:48  Opening a new connection, currently in state closed
2022-04-22 11:48:48.928082 (Thread-157): handling poll request
2022-04-22 11:48:48.928492 (Thread-157): 11:48:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe38094d60>]}
2022-04-22 11:48:48.930054 (Thread-157): sending response (<Response 36976 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:49.148057 (Thread-3): 11:48:49  Snowflake adapter: Snowflake query id: 01a3c6c4-0501-6163-0004-7d83048a78e6
2022-04-22 11:48:49.148224 (Thread-3): 11:48:49  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 2 unexpected ')'.
2022-04-22 11:48:49.148399 (Thread-3): 11:48:49  finished collecting timing info
2022-04-22 11:48:49.148548 (Thread-3): 11:48:49  On model.my_new_project.test_conn: Close
2022-04-22 11:48:49.158572 (Thread-1): 11:48:49  SQL status: SUCCESS 1 in 1.1 seconds
2022-04-22 11:48:49.159974 (Thread-1): 11:48:49  finished collecting timing info
2022-04-22 11:48:49.160115 (Thread-1): 11:48:49  On model.my_new_project.stg_query: Close
2022-04-22 11:48:49.213922 (Thread-2): 11:48:49  SQL status: SUCCESS 1 in 1.28 seconds
2022-04-22 11:48:49.215257 (Thread-2): 11:48:49  finished collecting timing info
2022-04-22 11:48:49.215397 (Thread-2): 11:48:49  On model.my_new_project.stg_payments: Close
2022-04-22 11:48:49.268934 (Thread-4): 11:48:49  SQL status: SUCCESS 1 in 1.19 seconds
2022-04-22 11:48:49.270237 (Thread-4): 11:48:49  finished collecting timing info
2022-04-22 11:48:49.270381 (Thread-4): 11:48:49  On model.my_new_project.test_loop: Close
2022-04-22 11:48:49.343129 (Thread-3): 11:48:49  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 11:48:49.343358 (Thread-3): 11:48:49  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f73c0c520>]}
2022-04-22 11:48:49.343736 (Thread-3): 11:48:49  7 of 10 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 1.34s]
2022-04-22 11:48:49.343870 (Thread-3): 11:48:49  Finished running node model.my_new_project.test_conn
2022-04-22 11:48:49.344023 (Thread-3): 11:48:49  Began running node model.my_new_project.stg_first_order
2022-04-22 11:48:49.344233 (Thread-3): 11:48:49  9 of 10 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 11:48:49.344487 (Thread-3): 11:48:49  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 11:48:49.344581 (Thread-3): 11:48:49  Began compiling node model.my_new_project.stg_first_order
2022-04-22 11:48:49.344674 (Thread-3): 11:48:49  Compiling model.my_new_project.stg_first_order
2022-04-22 11:48:49.347981 (Thread-3): 11:48:49  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 11:48:49.362796 (Thread-3): 11:48:49  finished collecting timing info
2022-04-22 11:48:49.363136 (Thread-3): 11:48:49  Began executing node model.my_new_project.stg_first_order
2022-04-22 11:48:49.365443 (Thread-3): 11:48:49  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 11:48:49.371891 (Thread-1): 11:48:49  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a5842b0>]}
2022-04-22 11:48:49.372188 (Thread-1): 11:48:49  6 of 10 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.39s]
2022-04-22 11:48:49.372301 (Thread-1): 11:48:49  Finished running node model.my_new_project.stg_query
2022-04-22 11:48:49.381312 (Thread-3): 11:48:49  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 11:48:49.381436 (Thread-3): 11:48:49  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 11:48:49.381529 (Thread-3): 11:48:49  Opening a new connection, currently in state closed
2022-04-22 11:48:49.431778 (Thread-2): 11:48:49  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a59c490>]}
2022-04-22 11:48:49.432084 (Thread-2): 11:48:49  5 of 10 OK created view model abrown_dbt_interview.stg_payments................. [SUCCESS 1 in 1.54s]
2022-04-22 11:48:49.432200 (Thread-2): 11:48:49  Finished running node model.my_new_project.stg_payments
2022-04-22 11:48:49.477225 (Thread-4): 11:48:49  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a5abd30>]}
2022-04-22 11:48:49.477515 (Thread-4): 11:48:49  8 of 10 OK created view model abrown_dbt_interview.test_loop.................... [SUCCESS 1 in 1.43s]
2022-04-22 11:48:49.477625 (Thread-4): 11:48:49  Finished running node model.my_new_project.test_loop
2022-04-22 11:48:50.127659 (Thread-3): 11:48:50  SQL status: SUCCESS 1 in 0.75 seconds
2022-04-22 11:48:50.129166 (Thread-3): 11:48:50  finished collecting timing info
2022-04-22 11:48:50.129337 (Thread-3): 11:48:50  On model.my_new_project.stg_first_order: Close
2022-04-22 11:48:50.282067 (Thread-158): handling poll request
2022-04-22 11:48:50.282425 (Thread-158): 11:48:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0819d850>]}
2022-04-22 11:48:50.283344 (Thread-158): sending response (<Response 17701 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:50.319116 (Thread-3): 11:48:50  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a5683d0>]}
2022-04-22 11:48:50.319580 (Thread-3): 11:48:50  9 of 10 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 0.97s]
2022-04-22 11:48:50.319729 (Thread-3): 11:48:50  Finished running node model.my_new_project.stg_first_order
2022-04-22 11:48:50.320806 (Thread-1): 11:48:50  Began running node model.my_new_project.fct_final
2022-04-22 11:48:50.321067 (Thread-1): 11:48:50  10 of 10 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 11:48:50.321324 (Thread-1): 11:48:50  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 11:48:50.321419 (Thread-1): 11:48:50  Began compiling node model.my_new_project.fct_final
2022-04-22 11:48:50.321512 (Thread-1): 11:48:50  Compiling model.my_new_project.fct_final
2022-04-22 11:48:50.324697 (Thread-1): 11:48:50  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 11:48:50.340920 (Thread-1): 11:48:50  finished collecting timing info
2022-04-22 11:48:50.341065 (Thread-1): 11:48:50  Began executing node model.my_new_project.fct_final
2022-04-22 11:48:50.343584 (Thread-1): 11:48:50  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 11:48:50.360137 (Thread-1): 11:48:50  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 11:48:50.360255 (Thread-1): 11:48:50  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 11:48:50.360347 (Thread-1): 11:48:50  Opening a new connection, currently in state closed
2022-04-22 11:48:51.168537 (Thread-1): 11:48:51  SQL status: SUCCESS 1 in 0.81 seconds
2022-04-22 11:48:51.170008 (Thread-1): 11:48:51  finished collecting timing info
2022-04-22 11:48:51.170174 (Thread-1): 11:48:51  On model.my_new_project.fct_final: Close
2022-04-22 11:48:51.401501 (Thread-1): 11:48:51  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4c2de7-7e73-416c-8584-d95ac6baf28b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5f7a509e20>]}
2022-04-22 11:48:51.401913 (Thread-1): 11:48:51  10 of 10 OK created view model abrown_dbt_interview.fct_final................... [SUCCESS 1 in 1.08s]
2022-04-22 11:48:51.402045 (Thread-1): 11:48:51  Finished running node model.my_new_project.fct_final
2022-04-22 11:48:51.403766 (MainThread): 11:48:51  Acquiring new snowflake connection "master"
2022-04-22 11:48:51.404131 (MainThread): 11:48:51  
2022-04-22 11:48:51.404254 (MainThread): 11:48:51  Finished running 10 view models in 7.53s.
2022-04-22 11:48:51.404343 (MainThread): 11:48:51  Connection 'master' was properly closed.
2022-04-22 11:48:51.404416 (MainThread): 11:48:51  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 11:48:51.404485 (MainThread): 11:48:51  Connection 'model.my_new_project.stg_payments' was properly closed.
2022-04-22 11:48:51.404552 (MainThread): 11:48:51  Connection 'model.my_new_project.stg_first_order' was properly closed.
2022-04-22 11:48:51.404618 (MainThread): 11:48:51  Connection 'model.my_new_project.test_loop' was properly closed.
2022-04-22 11:48:51.477889 (MainThread): 11:48:51  
2022-04-22 11:48:51.478109 (MainThread): 11:48:51  Completed with 2 errors and 0 warnings:
2022-04-22 11:48:51.478205 (MainThread): 11:48:51  
2022-04-22 11:48:51.478303 (MainThread): 11:48:51  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 11:48:51.478385 (MainThread): 11:48:51    002040 (42601): SQL compilation error:
2022-04-22 11:48:51.478458 (MainThread): 11:48:51    Unsupported data type 'INT64'.
2022-04-22 11:48:51.478526 (MainThread): 11:48:51    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 11:48:51.478599 (MainThread): 11:48:51  
2022-04-22 11:48:51.478678 (MainThread): 11:48:51  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 11:48:51.478750 (MainThread): 11:48:51    001003 (42000): SQL compilation error:
2022-04-22 11:48:51.478818 (MainThread): 11:48:51    syntax error line 11 at position 2 unexpected ')'.
2022-04-22 11:48:51.478885 (MainThread): 11:48:51    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 11:48:51.478973 (MainThread): 11:48:51  
2022-04-22 11:48:51.479059 (MainThread): 11:48:51  Done. PASS=8 WARN=0 ERROR=2 SKIP=0 TOTAL=10
2022-04-22 11:48:51.616798 (Thread-159): handling poll request
2022-04-22 11:48:51.617195 (Thread-159): 11:48:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28038a00>]}
2022-04-22 11:48:51.618375 (Thread-159): sending response (<Response 19257 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:52.949391 (Thread-160): handling poll request
2022-04-22 11:48:52.949777 (Thread-160): 11:48:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0819d7f0>]}
2022-04-22 11:48:52.951358 (Thread-160): sending response (<Response 48832 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:53.832653 (Thread-161): handling status request
2022-04-22 11:48:53.833062 (Thread-161): 11:48:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28038a00>]}
2022-04-22 11:48:53.833603 (Thread-161): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:48:53.941552 (Thread-162): handling status request
2022-04-22 11:48:53.941936 (Thread-162): 11:48:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28038ee0>]}
2022-04-22 11:48:53.942428 (Thread-162): sending response (<Response 2001 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:50:24.410867 (Thread-163): 11:50:24  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 11:50:24.411740 (Thread-163): 11:50:24  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0819d7f0>]}
2022-04-22 11:50:24.456265 (Thread-163): 11:50:24  Parsing macros/adapters.sql
2022-04-22 11:50:24.494977 (Thread-163): 11:50:24  Parsing macros/catalog.sql
2022-04-22 11:50:24.496893 (Thread-163): 11:50:24  Parsing macros/materializations/table.sql
2022-04-22 11:50:24.499963 (Thread-163): 11:50:24  Parsing macros/materializations/seed.sql
2022-04-22 11:50:24.505044 (Thread-163): 11:50:24  Parsing macros/materializations/incremental.sql
2022-04-22 11:50:24.513945 (Thread-163): 11:50:24  Parsing macros/materializations/merge.sql
2022-04-22 11:50:24.517742 (Thread-163): 11:50:24  Parsing macros/materializations/snapshot.sql
2022-04-22 11:50:24.518811 (Thread-163): 11:50:24  Parsing macros/materializations/view.sql
2022-04-22 11:50:24.520278 (Thread-163): 11:50:24  Parsing macros/adapters/metadata.sql
2022-04-22 11:50:24.527313 (Thread-163): 11:50:24  Parsing macros/adapters/columns.sql
2022-04-22 11:50:24.537895 (Thread-163): 11:50:24  Parsing macros/adapters/freshness.sql
2022-04-22 11:50:24.541193 (Thread-163): 11:50:24  Parsing macros/adapters/persist_docs.sql
2022-04-22 11:50:24.546037 (Thread-163): 11:50:24  Parsing macros/adapters/relation.sql
2022-04-22 11:50:24.556508 (Thread-163): 11:50:24  Parsing macros/adapters/schema.sql
2022-04-22 11:50:24.558909 (Thread-163): 11:50:24  Parsing macros/adapters/indexes.sql
2022-04-22 11:50:24.561951 (Thread-163): 11:50:24  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 11:50:24.564728 (Thread-163): 11:50:24  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 11:50:24.566314 (Thread-163): 11:50:24  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 11:50:24.568162 (Thread-163): 11:50:24  Parsing macros/etc/datetime.sql
2022-04-22 11:50:24.577163 (Thread-163): 11:50:24  Parsing macros/etc/statement.sql
2022-04-22 11:50:24.581700 (Thread-163): 11:50:24  Parsing macros/generic_test_sql/unique.sql
2022-04-22 11:50:24.582477 (Thread-163): 11:50:24  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 11:50:24.583111 (Thread-163): 11:50:24  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 11:50:24.584592 (Thread-163): 11:50:24  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 11:50:24.585483 (Thread-163): 11:50:24  Parsing macros/materializations/configs.sql
2022-04-22 11:50:24.587869 (Thread-163): 11:50:24  Parsing macros/materializations/hooks.sql
2022-04-22 11:50:24.591832 (Thread-163): 11:50:24  Parsing macros/materializations/models/table/table.sql
2022-04-22 11:50:24.599634 (Thread-163): 11:50:24  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 11:50:24.602714 (Thread-163): 11:50:24  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 11:50:24.605533 (Thread-163): 11:50:24  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 11:50:24.606986 (Thread-163): 11:50:24  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 11:50:24.609482 (Thread-163): 11:50:24  Parsing macros/materializations/models/view/view.sql
2022-04-22 11:50:24.616873 (Thread-163): 11:50:24  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 11:50:24.627420 (Thread-163): 11:50:24  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 11:50:24.643370 (Thread-163): 11:50:24  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 11:50:24.644954 (Thread-163): 11:50:24  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 11:50:24.656413 (Thread-163): 11:50:24  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 11:50:24.660869 (Thread-163): 11:50:24  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 11:50:24.677719 (Thread-163): 11:50:24  Parsing macros/materializations/seeds/seed.sql
2022-04-22 11:50:24.683823 (Thread-163): 11:50:24  Parsing macros/materializations/tests/helpers.sql
2022-04-22 11:50:24.685637 (Thread-163): 11:50:24  Parsing macros/materializations/tests/test.sql
2022-04-22 11:50:24.690114 (Thread-163): 11:50:24  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 11:50:24.691996 (Thread-163): 11:50:24  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 11:50:24.703897 (Thread-163): 11:50:24  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 11:50:24.720870 (Thread-163): 11:50:24  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 11:50:24.722570 (Thread-163): 11:50:24  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 11:50:24.734138 (Thread-163): 11:50:24  Parsing tests/generic/builtin.sql
2022-04-22 11:50:24.931439 (Thread-163): 11:50:24  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 11:50:24.933754 (Thread-163): 11:50:24  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 11:50:24.935772 (Thread-163): 11:50:24  1603: static parser failed on _archive/test_loop.sql
2022-04-22 11:50:24.939371 (Thread-163): 11:50:24  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 11:50:24.940401 (Thread-163): 11:50:24  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:50:24.942305 (Thread-163): 11:50:24  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 11:50:24.944259 (Thread-163): 11:50:24  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:50:24.946329 (Thread-163): 11:50:24  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:50:24.948228 (Thread-163): 11:50:24  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 11:50:24.950105 (Thread-163): 11:50:24  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 11:50:24.952495 (Thread-163): 11:50:24  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:50:25.012864 (Thread-163): 11:50:25  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:50:25.017860 (Thread-163): 11:50:25  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e71e1c0>]}
2022-04-22 11:50:25.234328 (Thread-164): handling status request
2022-04-22 11:50:25.234710 (Thread-164): 11:50:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e71ec70>]}
2022-04-22 11:50:25.235746 (Thread-164): sending response (<Response 18829 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:50:25.361063 (Thread-165): handling status request
2022-04-22 11:50:25.361422 (Thread-165): 11:50:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e753280>]}
2022-04-22 11:50:25.362378 (Thread-165): sending response (<Response 18829 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:50:56.663502 (Thread-166): 11:50:56  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 11:50:56.663926 (Thread-166): 11:50:56  Partial parsing: updated file: my_new_project://models/_archive/orginal_query.sql
2022-04-22 11:50:56.667789 (Thread-166): 11:50:56  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:50:56.705786 (Thread-166): 11:50:56  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:50:56.710573 (Thread-166): 11:50:56  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe2804dd30>]}
2022-04-22 11:50:57.453639 (Thread-167): handling status request
2022-04-22 11:50:57.454047 (Thread-167): 11:50:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280cd7c0>]}
2022-04-22 11:50:57.454573 (Thread-167): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:50:57.486109 (Thread-168): handling status request
2022-04-22 11:50:57.486383 (Thread-168): 11:50:57  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280cd790>]}
2022-04-22 11:50:57.510737 (Thread-168): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:00.151931 (Thread-169): handling status request
2022-04-22 11:51:00.152349 (Thread-169): 11:51:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280cd100>]}
2022-04-22 11:51:00.152850 (Thread-169): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:00.490662 (Thread-170): handling cli_args request
2022-04-22 11:51:00.491071 (Thread-170): 11:51:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280cd5e0>]}
2022-04-22 11:51:00.533995 (Thread-171): handling status request
2022-04-22 11:51:00.534767 (Thread-171): 11:51:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280cd070>]}
2022-04-22 11:51:00.535795 (Thread-171): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:03.081127 (Thread-170): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:03.127846 (MainThread): 11:51:03  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 11:51:03.128257 (MainThread): 11:51:03  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf2aa1f580>]}
2022-04-22 11:51:03.169453 (MainThread): 11:51:03  Parsing macros/adapters.sql
2022-04-22 11:51:03.208852 (MainThread): 11:51:03  Parsing macros/catalog.sql
2022-04-22 11:51:03.210716 (MainThread): 11:51:03  Parsing macros/materializations/table.sql
2022-04-22 11:51:03.213909 (MainThread): 11:51:03  Parsing macros/materializations/seed.sql
2022-04-22 11:51:03.219142 (MainThread): 11:51:03  Parsing macros/materializations/incremental.sql
2022-04-22 11:51:03.227843 (MainThread): 11:51:03  Parsing macros/materializations/merge.sql
2022-04-22 11:51:03.231776 (MainThread): 11:51:03  Parsing macros/materializations/snapshot.sql
2022-04-22 11:51:03.232721 (MainThread): 11:51:03  Parsing macros/materializations/view.sql
2022-04-22 11:51:03.234082 (MainThread): 11:51:03  Parsing macros/adapters/metadata.sql
2022-04-22 11:51:03.241532 (MainThread): 11:51:03  Parsing macros/adapters/columns.sql
2022-04-22 11:51:03.251593 (MainThread): 11:51:03  Parsing macros/adapters/freshness.sql
2022-04-22 11:51:03.254480 (MainThread): 11:51:03  Parsing macros/adapters/persist_docs.sql
2022-04-22 11:51:03.259025 (MainThread): 11:51:03  Parsing macros/adapters/relation.sql
2022-04-22 11:51:03.268641 (MainThread): 11:51:03  Parsing macros/adapters/schema.sql
2022-04-22 11:51:03.270912 (MainThread): 11:51:03  Parsing macros/adapters/indexes.sql
2022-04-22 11:51:03.273629 (MainThread): 11:51:03  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 11:51:03.276238 (MainThread): 11:51:03  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 11:51:03.277702 (MainThread): 11:51:03  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 11:51:03.279277 (MainThread): 11:51:03  Parsing macros/etc/datetime.sql
2022-04-22 11:51:03.288038 (MainThread): 11:51:03  Parsing macros/etc/statement.sql
2022-04-22 11:51:03.292562 (MainThread): 11:51:03  Parsing macros/generic_test_sql/unique.sql
2022-04-22 11:51:03.293243 (MainThread): 11:51:03  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 11:51:03.293808 (MainThread): 11:51:03  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 11:51:03.295289 (MainThread): 11:51:03  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 11:51:03.296212 (MainThread): 11:51:03  Parsing macros/materializations/configs.sql
2022-04-22 11:51:03.298478 (MainThread): 11:51:03  Parsing macros/materializations/hooks.sql
2022-04-22 11:51:03.302353 (MainThread): 11:51:03  Parsing macros/materializations/models/table/table.sql
2022-04-22 11:51:03.309925 (MainThread): 11:51:03  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 11:51:03.312889 (MainThread): 11:51:03  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 11:51:03.315579 (MainThread): 11:51:03  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 11:51:03.316928 (MainThread): 11:51:03  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 11:51:03.319265 (MainThread): 11:51:03  Parsing macros/materializations/models/view/view.sql
2022-04-22 11:51:03.326513 (MainThread): 11:51:03  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 11:51:03.336840 (MainThread): 11:51:03  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 11:51:03.352344 (MainThread): 11:51:03  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 11:51:03.353820 (MainThread): 11:51:03  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 11:51:03.365181 (MainThread): 11:51:03  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 11:51:03.369792 (MainThread): 11:51:03  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 11:51:03.386050 (MainThread): 11:51:03  Parsing macros/materializations/seeds/seed.sql
2022-04-22 11:51:03.392172 (MainThread): 11:51:03  Parsing macros/materializations/tests/helpers.sql
2022-04-22 11:51:03.393943 (MainThread): 11:51:03  Parsing macros/materializations/tests/test.sql
2022-04-22 11:51:03.403435 (Thread-172): handling poll request
2022-04-22 11:51:03.403798 (Thread-172): 11:51:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe3809a5e0>]}
2022-04-22 11:51:03.404855 (Thread-172): sending response (<Response 13010 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:03.398437 (MainThread): 11:51:03  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 11:51:03.400199 (MainThread): 11:51:03  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 11:51:03.411409 (MainThread): 11:51:03  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 11:51:03.427997 (MainThread): 11:51:03  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 11:51:03.429571 (MainThread): 11:51:03  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 11:51:03.441301 (MainThread): 11:51:03  Parsing tests/generic/builtin.sql
2022-04-22 11:51:03.635643 (MainThread): 11:51:03  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 11:51:03.646761 (MainThread): 11:51:03  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 11:51:03.648901 (MainThread): 11:51:03  1603: static parser failed on _archive/test_loop.sql
2022-04-22 11:51:03.652169 (MainThread): 11:51:03  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 11:51:03.653149 (MainThread): 11:51:03  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:51:03.655043 (MainThread): 11:51:03  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 11:51:03.657026 (MainThread): 11:51:03  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:51:03.659058 (MainThread): 11:51:03  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:51:03.661198 (MainThread): 11:51:03  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 11:51:03.663185 (MainThread): 11:51:03  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 11:51:03.665566 (MainThread): 11:51:03  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:51:03.733625 (MainThread): 11:51:03  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:51:03.738193 (MainThread): 11:51:03  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee3fccf70>]}
2022-04-22 11:51:03.771840 (MainThread): 11:51:03  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf2a85c5b0>]}
2022-04-22 11:51:03.772387 (MainThread): 11:51:03  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:51:03.773852 (MainThread): 11:51:03  
2022-04-22 11:51:03.774116 (MainThread): 11:51:03  Acquiring new snowflake connection "master"
2022-04-22 11:51:03.775282 (ThreadPoolExecutor-0_0): 11:51:03  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 11:51:03.787191 (ThreadPoolExecutor-0_0): 11:51:03  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 11:51:03.787296 (ThreadPoolExecutor-0_0): 11:51:03  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 11:51:03.787381 (ThreadPoolExecutor-0_0): 11:51:03  Opening a new connection, currently in state init
2022-04-22 11:51:04.709048 (ThreadPoolExecutor-0_0): 11:51:04  SQL status: SUCCESS 4 in 0.92 seconds
2022-04-22 11:51:04.711114 (ThreadPoolExecutor-0_0): 11:51:04  On list_PE_ALEXANDER_B: Close
2022-04-22 11:51:04.758250 (Thread-173): handling poll request
2022-04-22 11:51:04.758619 (Thread-173): 11:51:04  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc36aca0>]}
2022-04-22 11:51:04.759354 (Thread-173): sending response (<Response 9723 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:05.036288 (ThreadPoolExecutor-2_0): 11:51:05  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:51:05.043767 (ThreadPoolExecutor-2_0): 11:51:05  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 11:51:05.043920 (ThreadPoolExecutor-2_0): 11:51:05  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 11:51:05.044026 (ThreadPoolExecutor-2_0): 11:51:05  Opening a new connection, currently in state closed
2022-04-22 11:51:05.799099 (ThreadPoolExecutor-2_0): 11:51:05  SQL status: SUCCESS 8 in 0.76 seconds
2022-04-22 11:51:05.800789 (ThreadPoolExecutor-2_0): 11:51:05  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 11:51:06.000524 (MainThread): 11:51:06  Concurrency: 4 threads (target='default')
2022-04-22 11:51:06.000707 (MainThread): 11:51:06  
2022-04-22 11:51:06.003413 (Thread-1): 11:51:06  Began running node model.my_new_project.orginal_query
2022-04-22 11:51:06.003770 (Thread-1): 11:51:06  1 of 10 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 11:51:06.004050 (Thread-1): 11:51:06  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 11:51:06.004154 (Thread-1): 11:51:06  Began compiling node model.my_new_project.orginal_query
2022-04-22 11:51:06.004299 (Thread-1): 11:51:06  Compiling model.my_new_project.orginal_query
2022-04-22 11:51:06.006001 (Thread-2): 11:51:06  Began running node model.my_new_project.stg_ctry_type
2022-04-22 11:51:06.006245 (Thread-2): 11:51:06  2 of 10 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 11:51:06.006503 (Thread-2): 11:51:06  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 11:51:06.006591 (Thread-2): 11:51:06  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 11:51:06.006674 (Thread-2): 11:51:06  Compiling model.my_new_project.stg_ctry_type
2022-04-22 11:51:06.009006 (Thread-2): 11:51:06  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 11:51:06.009771 (Thread-3): 11:51:06  Began running node model.my_new_project.stg_device_orders
2022-04-22 11:51:06.009991 (Thread-3): 11:51:06  3 of 10 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 11:51:06.010234 (Thread-3): 11:51:06  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 11:51:06.089961 (Thread-174): handling poll request
2022-04-22 11:51:06.090280 (Thread-174): 11:51:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc36afa0>]}
2022-04-22 11:51:06.091029 (Thread-174): sending response (<Response 9098 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:06.010323 (Thread-3): 11:51:06  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 11:51:06.010405 (Thread-3): 11:51:06  Compiling model.my_new_project.stg_device_orders
2022-04-22 11:51:06.012508 (Thread-3): 11:51:06  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 11:51:06.012807 (Thread-4): 11:51:06  Began running node model.my_new_project.stg_orders
2022-04-22 11:51:06.013041 (Thread-4): 11:51:06  4 of 10 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 11:51:06.013286 (Thread-4): 11:51:06  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 11:51:06.013374 (Thread-4): 11:51:06  Began compiling node model.my_new_project.stg_orders
2022-04-22 11:51:06.013456 (Thread-4): 11:51:06  Compiling model.my_new_project.stg_orders
2022-04-22 11:51:06.015433 (Thread-4): 11:51:06  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 11:51:06.080985 (Thread-1): 11:51:06  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 11:51:06.081144 (Thread-1): 11:51:06  finished collecting timing info
2022-04-22 11:51:06.081267 (Thread-1): 11:51:06  Began executing node model.my_new_project.orginal_query
2022-04-22 11:51:06.105533 (Thread-1): 11:51:06  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 11:51:06.106239 (Thread-3): 11:51:06  finished collecting timing info
2022-04-22 11:51:06.106412 (Thread-3): 11:51:06  Began executing node model.my_new_project.stg_device_orders
2022-04-22 11:51:06.108399 (Thread-3): 11:51:06  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 11:51:06.108587 (Thread-2): 11:51:06  finished collecting timing info
2022-04-22 11:51:06.108708 (Thread-2): 11:51:06  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 11:51:06.110535 (Thread-2): 11:51:06  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 11:51:06.111417 (Thread-4): 11:51:06  finished collecting timing info
2022-04-22 11:51:06.111589 (Thread-4): 11:51:06  Began executing node model.my_new_project.stg_orders
2022-04-22 11:51:06.113456 (Thread-4): 11:51:06  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 11:51:06.121684 (Thread-1): 11:51:06  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 11:51:06.121807 (Thread-1): 11:51:06  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    
  );
2022-04-22 11:51:06.121899 (Thread-1): 11:51:06  Opening a new connection, currently in state closed
2022-04-22 11:51:06.126486 (Thread-2): 11:51:06  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 11:51:06.126606 (Thread-2): 11:51:06  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 11:51:06.126694 (Thread-2): 11:51:06  Opening a new connection, currently in state init
2022-04-22 11:51:06.128538 (Thread-3): 11:51:06  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 11:51:06.128657 (Thread-3): 11:51:06  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 11:51:06.128741 (Thread-3): 11:51:06  Opening a new connection, currently in state init
2022-04-22 11:51:06.129919 (Thread-4): 11:51:06  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 11:51:06.130023 (Thread-4): 11:51:06  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
  );
2022-04-22 11:51:06.130108 (Thread-4): 11:51:06  Opening a new connection, currently in state init
2022-04-22 11:51:07.112169 (Thread-1): 11:51:07  Snowflake adapter: Snowflake query id: 01a3c6c7-0501-6163-0004-7d83048a7a0e
2022-04-22 11:51:07.112332 (Thread-1): 11:51:07  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 11:51:07.112511 (Thread-1): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.112654 (Thread-1): 11:51:07  On model.my_new_project.orginal_query: Close
2022-04-22 11:51:07.318841 (Thread-1): 11:51:07  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 11:51:07.319147 (Thread-1): 11:51:07  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5f8152e0>]}
2022-04-22 11:51:07.319550 (Thread-1): 11:51:07  1 of 10 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.32s]
2022-04-22 11:51:07.319689 (Thread-1): 11:51:07  Finished running node model.my_new_project.orginal_query
2022-04-22 11:51:07.319838 (Thread-1): 11:51:07  Began running node model.my_new_project.stg_payments
2022-04-22 11:51:07.320031 (Thread-1): 11:51:07  5 of 10 START view model abrown_dbt_interview.stg_payments...................... [RUN]
2022-04-22 11:51:07.320275 (Thread-1): 11:51:07  Acquiring new snowflake connection "model.my_new_project.stg_payments"
2022-04-22 11:51:07.320367 (Thread-1): 11:51:07  Began compiling node model.my_new_project.stg_payments
2022-04-22 11:51:07.320462 (Thread-1): 11:51:07  Compiling model.my_new_project.stg_payments
2022-04-22 11:51:07.322792 (Thread-1): 11:51:07  Writing injected SQL for node "model.my_new_project.stg_payments"
2022-04-22 11:51:07.338853 (Thread-1): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.338997 (Thread-1): 11:51:07  Began executing node model.my_new_project.stg_payments
2022-04-22 11:51:07.341609 (Thread-1): 11:51:07  Writing runtime SQL for node "model.my_new_project.stg_payments"
2022-04-22 11:51:07.358131 (Thread-1): 11:51:07  Using snowflake connection "model.my_new_project.stg_payments"
2022-04-22 11:51:07.358245 (Thread-1): 11:51:07  On model.my_new_project.stg_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_payments 
  
   as (
    with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
  );
2022-04-22 11:51:07.358334 (Thread-1): 11:51:07  Opening a new connection, currently in state closed
2022-04-22 11:51:07.398178 (Thread-2): 11:51:07  SQL status: SUCCESS 1 in 1.27 seconds
2022-04-22 11:51:07.404431 (Thread-2): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.404576 (Thread-2): 11:51:07  On model.my_new_project.stg_ctry_type: Close
2022-04-22 11:51:07.416105 (Thread-3): 11:51:07  SQL status: SUCCESS 1 in 1.29 seconds
2022-04-22 11:51:07.417259 (Thread-3): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.417393 (Thread-3): 11:51:07  On model.my_new_project.stg_device_orders: Close
2022-04-22 11:51:07.448107 (Thread-175): handling poll request
2022-04-22 11:51:07.448416 (Thread-175): 11:51:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc365c70>]}
2022-04-22 11:51:07.449660 (Thread-175): sending response (<Response 27326 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:07.473812 (Thread-4): 11:51:07  SQL status: SUCCESS 1 in 1.34 seconds
2022-04-22 11:51:07.474985 (Thread-4): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.475122 (Thread-4): 11:51:07  On model.my_new_project.stg_orders: Close
2022-04-22 11:51:07.627043 (Thread-2): 11:51:07  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6045eb80>]}
2022-04-22 11:51:07.627449 (Thread-2): 11:51:07  2 of 10 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 1.62s]
2022-04-22 11:51:07.627620 (Thread-2): 11:51:07  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 11:51:07.627772 (Thread-2): 11:51:07  Began running node model.my_new_project.stg_query
2022-04-22 11:51:07.627957 (Thread-2): 11:51:07  6 of 10 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 11:51:07.628191 (Thread-2): 11:51:07  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 11:51:07.628280 (Thread-2): 11:51:07  Began compiling node model.my_new_project.stg_query
2022-04-22 11:51:07.628368 (Thread-2): 11:51:07  Compiling model.my_new_project.stg_query
2022-04-22 11:51:07.637386 (Thread-3): 11:51:07  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6045e700>]}
2022-04-22 11:51:07.637678 (Thread-3): 11:51:07  3 of 10 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 1.63s]
2022-04-22 11:51:07.637791 (Thread-3): 11:51:07  Finished running node model.my_new_project.stg_device_orders
2022-04-22 11:51:07.637908 (Thread-3): 11:51:07  Began running node model.my_new_project.test_conn
2022-04-22 11:51:07.638070 (Thread-3): 11:51:07  7 of 10 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 11:51:07.638281 (Thread-3): 11:51:07  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 11:51:07.638370 (Thread-3): 11:51:07  Began compiling node model.my_new_project.test_conn
2022-04-22 11:51:07.638455 (Thread-3): 11:51:07  Compiling model.my_new_project.test_conn
2022-04-22 11:51:07.639922 (Thread-3): 11:51:07  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 11:51:07.640037 (Thread-3): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.640143 (Thread-3): 11:51:07  Began executing node model.my_new_project.test_conn
2022-04-22 11:51:07.646740 (Thread-3): 11:51:07  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 11:51:07.652660 (Thread-2): 11:51:07  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 11:51:07.669428 (Thread-4): 11:51:07  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5f7c79a0>]}
2022-04-22 11:51:07.669732 (Thread-4): 11:51:07  4 of 10 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 1.66s]
2022-04-22 11:51:07.669850 (Thread-4): 11:51:07  Finished running node model.my_new_project.stg_orders
2022-04-22 11:51:07.669982 (Thread-4): 11:51:07  Began running node model.my_new_project.test_loop
2022-04-22 11:51:07.670151 (Thread-4): 11:51:07  8 of 10 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 11:51:07.670360 (Thread-4): 11:51:07  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 11:51:07.670447 (Thread-4): 11:51:07  Began compiling node model.my_new_project.test_loop
2022-04-22 11:51:07.670529 (Thread-4): 11:51:07  Compiling model.my_new_project.test_loop
2022-04-22 11:51:07.672911 (Thread-4): 11:51:07  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 11:51:07.683613 (Thread-3): 11:51:07  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 11:51:07.683733 (Thread-3): 11:51:07  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    
  );
2022-04-22 11:51:07.683823 (Thread-3): 11:51:07  Opening a new connection, currently in state closed
2022-04-22 11:51:07.703212 (Thread-2): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.703358 (Thread-2): 11:51:07  Began executing node model.my_new_project.stg_query
2022-04-22 11:51:07.705361 (Thread-2): 11:51:07  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 11:51:07.723444 (Thread-4): 11:51:07  finished collecting timing info
2022-04-22 11:51:07.723628 (Thread-4): 11:51:07  Began executing node model.my_new_project.test_loop
2022-04-22 11:51:07.725471 (Thread-4): 11:51:07  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 11:51:07.746199 (Thread-4): 11:51:07  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 11:51:07.746325 (Thread-4): 11:51:07  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    -- list tables




select * from raw.interview_sample_data.interview_devices
  );
2022-04-22 11:51:07.746415 (Thread-4): 11:51:07  Opening a new connection, currently in state closed
2022-04-22 11:51:07.751066 (Thread-2): 11:51:07  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 11:51:07.751171 (Thread-2): 11:51:07  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 11:51:07.751257 (Thread-2): 11:51:07  Opening a new connection, currently in state closed
2022-04-22 11:51:08.112809 (Thread-1): 11:51:08  SQL status: SUCCESS 1 in 0.75 seconds
2022-04-22 11:51:08.114293 (Thread-1): 11:51:08  finished collecting timing info
2022-04-22 11:51:08.114459 (Thread-1): 11:51:08  On model.my_new_project.stg_payments: Close
2022-04-22 11:51:08.416769 (Thread-1): 11:51:08  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5f7c91f0>]}
2022-04-22 11:51:08.417186 (Thread-1): 11:51:08  5 of 10 OK created view model abrown_dbt_interview.stg_payments................. [SUCCESS 1 in 1.10s]
2022-04-22 11:51:08.417324 (Thread-1): 11:51:08  Finished running node model.my_new_project.stg_payments
2022-04-22 11:51:08.417472 (Thread-1): 11:51:08  Began running node model.my_new_project.stg_first_order
2022-04-22 11:51:08.417659 (Thread-1): 11:51:08  9 of 10 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 11:51:08.417902 (Thread-1): 11:51:08  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 11:51:08.417993 (Thread-1): 11:51:08  Began compiling node model.my_new_project.stg_first_order
2022-04-22 11:51:08.418084 (Thread-1): 11:51:08  Compiling model.my_new_project.stg_first_order
2022-04-22 11:51:08.421654 (Thread-1): 11:51:08  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 11:51:08.450155 (Thread-1): 11:51:08  finished collecting timing info
2022-04-22 11:51:08.450322 (Thread-1): 11:51:08  Began executing node model.my_new_project.stg_first_order
2022-04-22 11:51:08.457808 (Thread-1): 11:51:08  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 11:51:08.479415 (Thread-1): 11:51:08  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 11:51:08.479589 (Thread-1): 11:51:08  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 11:51:08.479692 (Thread-1): 11:51:08  Opening a new connection, currently in state closed
2022-04-22 11:51:08.644625 (Thread-3): 11:51:08  Snowflake adapter: Snowflake query id: 01a3c6c7-0501-6163-0004-7d83048a7a16
2022-04-22 11:51:08.644784 (Thread-3): 11:51:08  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 11:51:08.644952 (Thread-3): 11:51:08  finished collecting timing info
2022-04-22 11:51:08.645094 (Thread-3): 11:51:08  On model.my_new_project.test_conn: Close
2022-04-22 11:51:08.777349 (Thread-176): handling poll request
2022-04-22 11:51:08.777712 (Thread-176): 11:51:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c0323d0>]}
2022-04-22 11:51:08.778884 (Thread-176): sending response (<Response 34280 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:08.847397 (Thread-4): 11:51:08  SQL status: SUCCESS 1 in 1.1 seconds
2022-04-22 11:51:08.848885 (Thread-4): 11:51:08  finished collecting timing info
2022-04-22 11:51:08.849052 (Thread-4): 11:51:08  On model.my_new_project.test_loop: Close
2022-04-22 11:51:08.853119 (Thread-3): 11:51:08  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 11:51:08.853339 (Thread-3): 11:51:08  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5f779760>]}
2022-04-22 11:51:08.853661 (Thread-3): 11:51:08  7 of 10 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 1.22s]
2022-04-22 11:51:08.853781 (Thread-3): 11:51:08  Finished running node model.my_new_project.test_conn
2022-04-22 11:51:09.056338 (Thread-2): 11:51:09  SQL status: SUCCESS 1 in 1.3 seconds
2022-04-22 11:51:09.057775 (Thread-2): 11:51:09  finished collecting timing info
2022-04-22 11:51:09.057941 (Thread-2): 11:51:09  On model.my_new_project.stg_query: Close
2022-04-22 11:51:09.078400 (Thread-4): 11:51:09  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf58621220>]}
2022-04-22 11:51:09.078761 (Thread-4): 11:51:09  8 of 10 OK created view model abrown_dbt_interview.test_loop.................... [SUCCESS 1 in 1.41s]
2022-04-22 11:51:09.078887 (Thread-4): 11:51:09  Finished running node model.my_new_project.test_loop
2022-04-22 11:51:09.186168 (Thread-1): 11:51:09  SQL status: SUCCESS 1 in 0.71 seconds
2022-04-22 11:51:09.187597 (Thread-1): 11:51:09  finished collecting timing info
2022-04-22 11:51:09.187761 (Thread-1): 11:51:09  On model.my_new_project.stg_first_order: Close
2022-04-22 11:51:09.247185 (Thread-2): 11:51:09  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5f824ca0>]}
2022-04-22 11:51:09.247625 (Thread-2): 11:51:09  6 of 10 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.62s]
2022-04-22 11:51:09.247764 (Thread-2): 11:51:09  Finished running node model.my_new_project.stg_query
2022-04-22 11:51:09.364920 (Thread-1): 11:51:09  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5f82c910>]}
2022-04-22 11:51:09.365315 (Thread-1): 11:51:09  9 of 10 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 0.95s]
2022-04-22 11:51:09.365440 (Thread-1): 11:51:09  Finished running node model.my_new_project.stg_first_order
2022-04-22 11:51:09.366354 (Thread-3): 11:51:09  Began running node model.my_new_project.fct_final
2022-04-22 11:51:09.366584 (Thread-3): 11:51:09  10 of 10 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 11:51:09.366837 (Thread-3): 11:51:09  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 11:51:09.366930 (Thread-3): 11:51:09  Began compiling node model.my_new_project.fct_final
2022-04-22 11:51:09.367023 (Thread-3): 11:51:09  Compiling model.my_new_project.fct_final
2022-04-22 11:51:09.370236 (Thread-3): 11:51:09  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 11:51:09.386426 (Thread-3): 11:51:09  finished collecting timing info
2022-04-22 11:51:09.386578 (Thread-3): 11:51:09  Began executing node model.my_new_project.fct_final
2022-04-22 11:51:09.388988 (Thread-3): 11:51:09  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 11:51:09.406099 (Thread-3): 11:51:09  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 11:51:09.406226 (Thread-3): 11:51:09  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 11:51:09.406320 (Thread-3): 11:51:09  Opening a new connection, currently in state closed
2022-04-22 11:51:10.128110 (Thread-177): handling poll request
2022-04-22 11:51:10.128507 (Thread-177): 11:51:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c087040>]}
2022-04-22 11:51:10.129362 (Thread-177): sending response (<Response 16571 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:10.982056 (Thread-3): 11:51:10  SQL status: SUCCESS 1 in 1.58 seconds
2022-04-22 11:51:10.983884 (Thread-3): 11:51:10  finished collecting timing info
2022-04-22 11:51:10.984091 (Thread-3): 11:51:10  On model.my_new_project.fct_final: Close
2022-04-22 11:51:11.168754 (Thread-3): 11:51:11  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09cbd2f9-4620-4c9a-851a-4260c4cb83c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf58628250>]}
2022-04-22 11:51:11.169159 (Thread-3): 11:51:11  10 of 10 OK created view model abrown_dbt_interview.fct_final................... [SUCCESS 1 in 1.80s]
2022-04-22 11:51:11.169289 (Thread-3): 11:51:11  Finished running node model.my_new_project.fct_final
2022-04-22 11:51:11.170865 (MainThread): 11:51:11  Acquiring new snowflake connection "master"
2022-04-22 11:51:11.171223 (MainThread): 11:51:11  
2022-04-22 11:51:11.171335 (MainThread): 11:51:11  Finished running 10 view models in 7.40s.
2022-04-22 11:51:11.171422 (MainThread): 11:51:11  Connection 'master' was properly closed.
2022-04-22 11:51:11.171522 (MainThread): 11:51:11  Connection 'model.my_new_project.stg_first_order' was properly closed.
2022-04-22 11:51:11.171594 (MainThread): 11:51:11  Connection 'model.my_new_project.stg_query' was properly closed.
2022-04-22 11:51:11.171661 (MainThread): 11:51:11  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 11:51:11.171727 (MainThread): 11:51:11  Connection 'model.my_new_project.test_loop' was properly closed.
2022-04-22 11:51:11.240636 (MainThread): 11:51:11  
2022-04-22 11:51:11.240841 (MainThread): 11:51:11  Completed with 2 errors and 0 warnings:
2022-04-22 11:51:11.240937 (MainThread): 11:51:11  
2022-04-22 11:51:11.241033 (MainThread): 11:51:11  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 11:51:11.241114 (MainThread): 11:51:11    001003 (42000): SQL compilation error:
2022-04-22 11:51:11.241186 (MainThread): 11:51:11    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 11:51:11.241255 (MainThread): 11:51:11    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 11:51:11.241327 (MainThread): 11:51:11  
2022-04-22 11:51:11.241407 (MainThread): 11:51:11  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 11:51:11.241479 (MainThread): 11:51:11    001003 (42000): SQL compilation error:
2022-04-22 11:51:11.241546 (MainThread): 11:51:11    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 11:51:11.241613 (MainThread): 11:51:11    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 11:51:11.241699 (MainThread): 11:51:11  
2022-04-22 11:51:11.241783 (MainThread): 11:51:11  Done. PASS=8 WARN=0 ERROR=2 SKIP=0 TOTAL=10
2022-04-22 11:51:11.462400 (Thread-178): handling poll request
2022-04-22 11:51:11.462784 (Thread-178): 11:51:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe380ae190>]}
2022-04-22 11:51:11.463566 (Thread-178): sending response (<Response 11125 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:12.814753 (Thread-179): handling poll request
2022-04-22 11:51:12.815136 (Thread-179): 11:51:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c02a160>]}
2022-04-22 11:51:12.816743 (Thread-179): sending response (<Response 44605 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:13.717514 (Thread-180): handling status request
2022-04-22 11:51:13.717904 (Thread-180): 11:51:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe380ae0d0>]}
2022-04-22 11:51:13.718404 (Thread-180): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:13.801374 (Thread-181): handling status request
2022-04-22 11:51:13.801754 (Thread-181): 11:51:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe380aea30>]}
2022-04-22 11:51:13.802222 (Thread-181): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:42.281557 (Thread-182): handling status request
2022-04-22 11:51:42.281946 (Thread-182): 11:51:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe380ae970>]}
2022-04-22 11:51:42.282420 (Thread-182): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:42.621466 (Thread-183): handling run_sql request
2022-04-22 11:51:42.621843 (Thread-183): 11:51:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe5100e490>]}
2022-04-22 11:51:45.157889 (Thread-183): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:45.184815 (MainThread): 11:51:45  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f925377d-3d5f-42b1-9f32-93ce6202161a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc0db4f10>]}
2022-04-22 11:51:45.185355 (MainThread): 11:51:45  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:51:45.185935 (Thread-1): 11:51:45  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:51:45.186072 (Thread-1): 11:51:45  Began compiling node rpc.my_new_project.request
2022-04-22 11:51:45.186166 (Thread-1): 11:51:45  Compiling rpc.my_new_project.request
2022-04-22 11:51:45.189171 (Thread-1): 11:51:45  finished collecting timing info
2022-04-22 11:51:45.189304 (Thread-1): 11:51:45  Began executing node rpc.my_new_project.request
2022-04-22 11:51:45.191452 (Thread-1): 11:51:45  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:51:45.191576 (Thread-1): 11:51:45  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:51:45.191658 (Thread-1): 11:51:45  Opening a new connection, currently in state init
2022-04-22 11:51:45.486957 (Thread-184): handling poll request
2022-04-22 11:51:45.487396 (Thread-184): 11:51:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c01ddf0>]}
2022-04-22 11:51:45.488353 (Thread-184): sending response (<Response 5549 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:46.841391 (Thread-185): handling poll request
2022-04-22 11:51:46.841776 (Thread-185): 11:51:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c01deb0>]}
2022-04-22 11:51:46.842274 (Thread-185): sending response (<Response 387 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:48.155776 (Thread-1): 11:51:48  SQL status: SUCCESS 500 in 2.96 seconds
2022-04-22 11:51:48.181635 (Thread-186): handling poll request
2022-04-22 11:51:48.181999 (Thread-186): 11:51:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c01d280>]}
2022-04-22 11:51:48.182480 (Thread-186): sending response (<Response 668 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:51:48.726427 (Thread-1): 11:51:48  finished collecting timing info
2022-04-22 11:51:48.726726 (Thread-1): 11:51:48  On rpc.my_new_project.request: Close
2022-04-22 11:51:49.634593 (Thread-187): handling poll request
2022-04-22 11:51:49.634983 (Thread-187): 11:51:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e729ca0>]}
2022-04-22 11:51:49.644011 (Thread-187): sending response (<Response 143042 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:55:21.244292 (Thread-188): handling status request
2022-04-22 11:55:21.246479 (Thread-188): 11:55:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe381615b0>]}
2022-04-22 11:55:21.247008 (Thread-188): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:55:21.612253 (Thread-189): handling run_sql request
2022-04-22 11:55:21.612651 (Thread-189): 11:55:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4e753550>]}
2022-04-22 11:55:24.101698 (Thread-189): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:55:24.129041 (MainThread): 11:55:24  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f767db32-debc-4407-82bd-ad2918ca1c24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c7c9b3cd0>]}
2022-04-22 11:55:24.129589 (MainThread): 11:55:24  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:55:24.130179 (Thread-1): 11:55:24  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:55:24.130313 (Thread-1): 11:55:24  Began compiling node rpc.my_new_project.request
2022-04-22 11:55:24.130405 (Thread-1): 11:55:24  Compiling rpc.my_new_project.request
2022-04-22 11:55:24.133474 (Thread-1): 11:55:24  finished collecting timing info
2022-04-22 11:55:24.133601 (Thread-1): 11:55:24  Began executing node rpc.my_new_project.request
2022-04-22 11:55:24.135829 (Thread-1): 11:55:24  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:55:24.135927 (Thread-1): 11:55:24  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
order by user_id
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:55:24.136008 (Thread-1): 11:55:24  Opening a new connection, currently in state init
2022-04-22 11:55:24.471853 (Thread-190): handling poll request
2022-04-22 11:55:24.472353 (Thread-190): 11:55:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28038a00>]}
2022-04-22 11:55:24.473286 (Thread-190): sending response (<Response 5567 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:55:25.832166 (Thread-191): handling poll request
2022-04-22 11:55:25.832543 (Thread-191): 11:55:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5dc2e0>]}
2022-04-22 11:55:25.833025 (Thread-191): sending response (<Response 388 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:55:26.646104 (Thread-1): 11:55:26  SQL status: SUCCESS 500 in 2.51 seconds
2022-04-22 11:55:27.164454 (Thread-192): handling poll request
2022-04-22 11:55:27.164834 (Thread-192): 11:55:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc5dceb0>]}
2022-04-22 11:55:27.165317 (Thread-192): sending response (<Response 667 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:55:27.184318 (Thread-1): 11:55:27  finished collecting timing info
2022-04-22 11:55:27.184611 (Thread-1): 11:55:27  On rpc.my_new_project.request: Close
2022-04-22 11:55:28.530941 (Thread-193): handling poll request
2022-04-22 11:55:28.531345 (Thread-193): 11:55:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe28177fd0>]}
2022-04-22 11:55:28.541368 (Thread-193): sending response (<Response 143067 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:31.140576 (Thread-194): handling status request
2022-04-22 11:57:31.142651 (Thread-194): 11:57:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50ffc580>]}
2022-04-22 11:57:31.143225 (Thread-194): sending response (<Response 2015 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:31.542184 (Thread-195): handling run_sql request
2022-04-22 11:57:31.542585 (Thread-195): 11:57:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe399903a0>]}
2022-04-22 11:57:34.041381 (Thread-195): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:34.068545 (MainThread): 11:57:34  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '54564614-87c6-4945-802a-5c1eb074819f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7052fb4e20>]}
2022-04-22 11:57:34.069072 (MainThread): 11:57:34  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 11:57:34.069674 (Thread-1): 11:57:34  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 11:57:34.069809 (Thread-1): 11:57:34  Began compiling node rpc.my_new_project.request
2022-04-22 11:57:34.069903 (Thread-1): 11:57:34  Compiling rpc.my_new_project.request
2022-04-22 11:57:34.072946 (Thread-1): 11:57:34  finished collecting timing info
2022-04-22 11:57:34.073081 (Thread-1): 11:57:34  Began executing node rpc.my_new_project.request
2022-04-22 11:57:34.075305 (Thread-1): 11:57:34  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 11:57:34.075403 (Thread-1): 11:57:34  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
where user_id = 790
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 11:57:34.075511 (Thread-1): 11:57:34  Opening a new connection, currently in state init
2022-04-22 11:57:34.446473 (Thread-196): handling poll request
2022-04-22 11:57:34.446918 (Thread-196): 11:57:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c01dc70>]}
2022-04-22 11:57:34.447867 (Thread-196): sending response (<Response 5570 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:35.824146 (Thread-197): handling poll request
2022-04-22 11:57:35.824584 (Thread-197): 11:57:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe280b7a30>]}
2022-04-22 11:57:35.825069 (Thread-197): sending response (<Response 388 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:37.128260 (Thread-1): 11:57:37  SQL status: SUCCESS 2 in 3.05 seconds
2022-04-22 11:57:37.130748 (Thread-1): 11:57:37  finished collecting timing info
2022-04-22 11:57:37.130991 (Thread-1): 11:57:37  On rpc.my_new_project.request: Close
2022-04-22 11:57:37.175140 (Thread-198): handling poll request
2022-04-22 11:57:37.175534 (Thread-198): 11:57:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4c01d8b0>]}
2022-04-22 11:57:37.201111 (Thread-198): sending response (<Response 1366 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:38.521353 (Thread-199): handling poll request
2022-04-22 11:57:38.521782 (Thread-199): 11:57:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe50fa1a30>]}
2022-04-22 11:57:38.522720 (Thread-199): sending response (<Response 10995 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:50.776494 (Thread-200): 11:57:50  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 11:57:50.776830 (Thread-200): 11:57:50  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efdcc420100>]}
2022-04-22 11:57:50.823599 (Thread-200): 11:57:50  Parsing macros/adapters.sql
2022-04-22 11:57:50.861016 (Thread-200): 11:57:50  Parsing macros/catalog.sql
2022-04-22 11:57:50.862853 (Thread-200): 11:57:50  Parsing macros/materializations/table.sql
2022-04-22 11:57:50.865930 (Thread-200): 11:57:50  Parsing macros/materializations/seed.sql
2022-04-22 11:57:50.871004 (Thread-200): 11:57:50  Parsing macros/materializations/incremental.sql
2022-04-22 11:57:50.879336 (Thread-200): 11:57:50  Parsing macros/materializations/merge.sql
2022-04-22 11:57:50.883049 (Thread-200): 11:57:50  Parsing macros/materializations/snapshot.sql
2022-04-22 11:57:50.884028 (Thread-200): 11:57:50  Parsing macros/materializations/view.sql
2022-04-22 11:57:50.885371 (Thread-200): 11:57:50  Parsing macros/adapters/metadata.sql
2022-04-22 11:57:50.892387 (Thread-200): 11:57:50  Parsing macros/adapters/columns.sql
2022-04-22 11:57:50.902003 (Thread-200): 11:57:50  Parsing macros/adapters/freshness.sql
2022-04-22 11:57:50.904909 (Thread-200): 11:57:50  Parsing macros/adapters/persist_docs.sql
2022-04-22 11:57:50.909188 (Thread-200): 11:57:50  Parsing macros/adapters/relation.sql
2022-04-22 11:57:50.918499 (Thread-200): 11:57:50  Parsing macros/adapters/schema.sql
2022-04-22 11:57:50.920647 (Thread-200): 11:57:50  Parsing macros/adapters/indexes.sql
2022-04-22 11:57:50.923260 (Thread-200): 11:57:50  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 11:57:50.925700 (Thread-200): 11:57:50  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 11:57:50.927161 (Thread-200): 11:57:50  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 11:57:50.928782 (Thread-200): 11:57:50  Parsing macros/etc/datetime.sql
2022-04-22 11:57:50.936946 (Thread-200): 11:57:50  Parsing macros/etc/statement.sql
2022-04-22 11:57:50.941241 (Thread-200): 11:57:50  Parsing macros/generic_test_sql/unique.sql
2022-04-22 11:57:50.941955 (Thread-200): 11:57:50  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 11:57:50.942517 (Thread-200): 11:57:50  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 11:57:50.943884 (Thread-200): 11:57:50  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 11:57:50.944775 (Thread-200): 11:57:50  Parsing macros/materializations/configs.sql
2022-04-22 11:57:50.947016 (Thread-200): 11:57:50  Parsing macros/materializations/hooks.sql
2022-04-22 11:57:50.950836 (Thread-200): 11:57:50  Parsing macros/materializations/models/table/table.sql
2022-04-22 11:57:50.958310 (Thread-200): 11:57:50  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 11:57:50.961193 (Thread-200): 11:57:50  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 11:57:50.963836 (Thread-200): 11:57:50  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 11:57:50.965158 (Thread-200): 11:57:50  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 11:57:50.967446 (Thread-200): 11:57:50  Parsing macros/materializations/models/view/view.sql
2022-04-22 11:57:50.974689 (Thread-200): 11:57:50  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 11:57:50.984519 (Thread-200): 11:57:50  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 11:57:50.999914 (Thread-200): 11:57:50  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 11:57:51.001439 (Thread-200): 11:57:51  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 11:57:51.012688 (Thread-200): 11:57:51  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 11:57:51.017154 (Thread-200): 11:57:51  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 11:57:51.033358 (Thread-200): 11:57:51  Parsing macros/materializations/seeds/seed.sql
2022-04-22 11:57:51.039356 (Thread-200): 11:57:51  Parsing macros/materializations/tests/helpers.sql
2022-04-22 11:57:51.041230 (Thread-200): 11:57:51  Parsing macros/materializations/tests/test.sql
2022-04-22 11:57:51.045685 (Thread-200): 11:57:51  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 11:57:51.047577 (Thread-200): 11:57:51  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 11:57:51.058753 (Thread-200): 11:57:51  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 11:57:51.075456 (Thread-200): 11:57:51  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 11:57:51.077113 (Thread-200): 11:57:51  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 11:57:51.088673 (Thread-200): 11:57:51  Parsing tests/generic/builtin.sql
2022-04-22 11:57:51.281307 (Thread-200): 11:57:51  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 11:57:51.283690 (Thread-200): 11:57:51  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 11:57:51.285710 (Thread-200): 11:57:51  1603: static parser failed on _archive/test_loop.sql
2022-04-22 11:57:51.289384 (Thread-200): 11:57:51  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 11:57:51.290394 (Thread-200): 11:57:51  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 11:57:51.292339 (Thread-200): 11:57:51  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 11:57:51.294277 (Thread-200): 11:57:51  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 11:57:51.296403 (Thread-200): 11:57:51  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 11:57:51.298285 (Thread-200): 11:57:51  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 11:57:51.300255 (Thread-200): 11:57:51  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 11:57:51.302599 (Thread-200): 11:57:51  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 11:57:51.360031 (Thread-200): 11:57:51  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 11:57:51.365341 (Thread-200): 11:57:51  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c7755b0>]}
2022-04-22 11:57:51.622705 (Thread-201): handling status request
2022-04-22 11:57:51.623086 (Thread-201): 11:57:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c775820>]}
2022-04-22 11:57:51.624098 (Thread-201): sending response (<Response 18829 bytes [200 OK]>) to 10.0.16.21
2022-04-22 11:57:51.714285 (Thread-202): handling status request
2022-04-22 11:57:51.714648 (Thread-202): 11:57:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c775fa0>]}
2022-04-22 11:57:51.715584 (Thread-202): sending response (<Response 18829 bytes [200 OK]>) to 10.0.16.21
2022-04-22 12:03:18.414663 (Thread-203): handling status request
2022-04-22 12:03:18.415642 (Thread-203): 12:03:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c775e20>]}
2022-04-22 12:03:18.416575 (Thread-203): sending response (<Response 18829 bytes [200 OK]>) to 10.0.16.21
2022-04-22 12:03:23.025032 (Thread-204): 12:03:23  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 12:03:23.025252 (Thread-204): 12:03:23  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 12:03:23.025717 (Thread-204): 12:03:23  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 12:03:23.030700 (Thread-204): 12:03:23  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c6e65b0>]}
2022-04-22 12:03:23.862689 (Thread-205): handling status request
2022-04-22 12:03:23.863100 (Thread-205): 12:03:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c71b0d0>]}
2022-04-22 12:03:23.863634 (Thread-205): sending response (<Response 1685 bytes [200 OK]>) to 10.0.16.21
2022-04-22 12:03:23.987312 (Thread-206): handling status request
2022-04-22 12:03:23.987739 (Thread-206): 12:03:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '04e22368-55a6-46b4-82f1-bf8cab8aa9c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8c71b130>]}
2022-04-22 12:03:23.988213 (Thread-206): sending response (<Response 1685 bytes [200 OK]>) to 10.0.16.21
2022-04-22 15:36:59.616624 (MainThread): Running with dbt=1.0.5
2022-04-22 15:37:00.203180 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-22 15:37:00.212201 (MainThread): Tracking: tracking
2022-04-22 15:37:00.212518 (MainThread): 15:37:00  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bdfbab670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bc25ed7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bc25fbfd0>]}
2022-04-22 15:37:00.212890 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-04-22 15:37:00.213206 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-22 15:37:00.214165 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-22 15:37:00.342818 (Thread-12): 15:37:00  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 15:37:00.343053 (Thread-12): 15:37:00  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 15:37:00.343624 (Thread-12): 15:37:00  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 15:37:00.349898 (Thread-12): 15:37:00  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe8ac10>]}
2022-04-22 15:37:03.388492 (Thread-13): handling status request
2022-04-22 15:37:03.389178 (Thread-13): 15:37:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bc25fb070>]}
2022-04-22 15:37:03.389698 (Thread-14): handling ps request
2022-04-22 15:37:03.390428 (Thread-13): sending response (<Response 1681 bytes [200 OK]>) to 10.0.11.65
2022-04-22 15:37:03.390849 (Thread-14): 15:37:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe7daf0>]}
2022-04-22 15:37:03.391838 (Thread-14): sending response (<Response 105 bytes [200 OK]>) to 10.0.11.65
2022-04-22 15:37:03.524446 (Thread-15): handling status request
2022-04-22 15:37:03.524903 (Thread-15): 15:37:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bc25af580>]}
2022-04-22 15:37:03.525377 (Thread-15): sending response (<Response 1681 bytes [200 OK]>) to 10.0.11.65
2022-04-22 15:37:03.654239 (Thread-16): handling status request
2022-04-22 15:37:03.654659 (Thread-16): 15:37:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe7ddf0>]}
2022-04-22 15:37:03.655210 (Thread-16): sending response (<Response 1681 bytes [200 OK]>) to 10.0.11.65
2022-04-22 15:37:05.302971 (Thread-17): handling status request
2022-04-22 15:37:05.303391 (Thread-17): 15:37:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe7dfd0>]}
2022-04-22 15:37:05.303887 (Thread-17): sending response (<Response 1681 bytes [200 OK]>) to 10.0.11.65
2022-04-22 15:38:01.926207 (Thread-18): handling status request
2022-04-22 15:38:01.927963 (Thread-18): 15:38:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe7da30>]}
2022-04-22 15:38:01.928443 (Thread-18): sending response (<Response 1659 bytes [200 OK]>) to 10.0.11.65
2022-04-22 15:38:01.934595 (Thread-19): handling list request
2022-04-22 15:38:01.934841 (Thread-19): 15:38:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe7d940>]}
2022-04-22 15:38:01.978594 (Thread-19): 15:38:01  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24188080-cff8-461b-90e6-4c76042a0eff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4bbfe8a9a0>]}
2022-04-22 15:38:01.978970 (Thread-19): 15:38:01  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 15:38:01.988481 (Thread-19): sending response (<Response 6092 bytes [200 OK]>) to 10.0.11.65
2022-04-22 19:21:26.939402 (MainThread): Running with dbt=1.0.5
2022-04-22 19:21:27.505342 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt_rpc.task.server.RPCServerTask'>, debug=None, defer=None, exclude=None, fail_fast=None, host='0.0.0.0', log_cache_events=False, log_format=None, models=None, partial_parse=True, port=8580, printer_width=None, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='rpc', write_json=None)
2022-04-22 19:21:27.508838 (MainThread): Tracking: tracking
2022-04-22 19:21:27.510474 (MainThread): 19:21:27  Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0da3820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30b448f700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0da7100>]}
2022-04-22 19:21:27.514741 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-04-22 19:21:27.515097 (MainThread): Supported methods: ['build', 'cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'list', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'source-freshness', 'status', 'test']
2022-04-22 19:21:27.516080 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-04-22 19:21:27.641282 (Thread-12): 19:21:27  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 19:21:27.641510 (Thread-12): 19:21:27  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 19:21:27.642094 (Thread-12): 19:21:27  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 19:21:27.648174 (Thread-12): 19:21:27  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e63baf0>]}
2022-04-22 19:21:30.526532 (Thread-13): handling ps request
2022-04-22 19:21:30.526948 (Thread-13): 19:21:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e6a7eb0>]}
2022-04-22 19:21:30.527533 (Thread-13): sending response (<Response 105 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:21:30.746971 (Thread-14): handling status request
2022-04-22 19:21:30.747343 (Thread-14): 19:21:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62bf40>]}
2022-04-22 19:21:30.747825 (Thread-14): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:21:30.874435 (Thread-15): handling status request
2022-04-22 19:21:30.874816 (Thread-15): 19:21:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62ba90>]}
2022-04-22 19:21:30.875275 (Thread-15): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:21:30.912390 (Thread-16): handling status request
2022-04-22 19:21:30.912756 (Thread-16): 19:21:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62bdc0>]}
2022-04-22 19:21:30.913209 (Thread-16): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:21:31.983228 (Thread-17): handling status request
2022-04-22 19:21:31.983630 (Thread-17): 19:21:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62b9d0>]}
2022-04-22 19:21:31.984103 (Thread-17): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:21:31.990436 (Thread-18): handling list request
2022-04-22 19:21:31.990738 (Thread-18): 19:21:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62b880>]}
2022-04-22 19:21:32.026625 (Thread-18): 19:21:32  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62b9a0>]}
2022-04-22 19:21:32.027062 (Thread-18): 19:21:32  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:21:32.030681 (Thread-18): sending response (<Response 6094 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:21:32.220121 (Thread-19): handling status request
2022-04-22 19:21:32.220513 (Thread-19): 19:21:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0da37f0>]}
2022-04-22 19:21:32.220990 (Thread-19): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:32.089024 (Thread-20): handling status request
2022-04-22 19:31:32.089925 (Thread-20): 19:31:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0d58340>]}
2022-04-22 19:31:32.090408 (Thread-20): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:32.102524 (Thread-21): handling list request
2022-04-22 19:31:32.102829 (Thread-21): 19:31:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0d583d0>]}
2022-04-22 19:31:32.133009 (Thread-21): 19:31:32  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e642910>]}
2022-04-22 19:31:32.133389 (Thread-21): 19:31:32  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:31:32.139211 (Thread-21): sending response (<Response 2780 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:36.222869 (Thread-22): handling status request
2022-04-22 19:31:36.223277 (Thread-22): 19:31:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e642b80>]}
2022-04-22 19:31:36.223800 (Thread-22): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:36.229955 (Thread-23): handling list request
2022-04-22 19:31:36.230281 (Thread-23): 19:31:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e60d430>]}
2022-04-22 19:31:36.258295 (Thread-23): 19:31:36  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e62b760>]}
2022-04-22 19:31:36.258883 (Thread-23): 19:31:36  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:31:36.262362 (Thread-23): sending response (<Response 2790 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:45.817201 (Thread-24): handling status request
2022-04-22 19:31:45.818592 (Thread-24): 19:31:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e60dfa0>]}
2022-04-22 19:31:45.819096 (Thread-24): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:45.839591 (Thread-25): handling list request
2022-04-22 19:31:45.839871 (Thread-25): 19:31:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e613370>]}
2022-04-22 19:31:45.866566 (Thread-25): 19:31:45  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e60dc10>]}
2022-04-22 19:31:45.866876 (Thread-25): 19:31:45  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:31:45.870247 (Thread-25): sending response (<Response 3343 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:54.515870 (Thread-26): handling status request
2022-04-22 19:31:54.516271 (Thread-26): 19:31:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e613760>]}
2022-04-22 19:31:54.516748 (Thread-26): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:31:54.528016 (Thread-27): handling list request
2022-04-22 19:31:54.528375 (Thread-27): 19:31:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e624250>]}
2022-04-22 19:31:54.557492 (Thread-27): 19:31:54  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e613cd0>]}
2022-04-22 19:31:54.557950 (Thread-27): 19:31:54  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:31:54.561475 (Thread-27): sending response (<Response 2773 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:33:34.279644 (Thread-28): handling status request
2022-04-22 19:33:34.280945 (Thread-28): 19:33:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5a9220>]}
2022-04-22 19:33:34.281460 (Thread-28): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:33:34.287677 (Thread-29): handling list request
2022-04-22 19:33:34.287999 (Thread-29): 19:33:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5a94f0>]}
2022-04-22 19:33:34.316055 (Thread-29): 19:33:34  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e624b80>]}
2022-04-22 19:33:34.316436 (Thread-29): 19:33:34  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:33:34.321459 (Thread-29): sending response (<Response 3343 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:36:39.147468 (Thread-30): handling status request
2022-04-22 19:36:39.148889 (Thread-30): 19:36:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5c05b0>]}
2022-04-22 19:36:39.149401 (Thread-30): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:36:39.166056 (Thread-31): handling list request
2022-04-22 19:36:39.166386 (Thread-31): 19:36:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5c09a0>]}
2022-04-22 19:36:39.193829 (Thread-31): 19:36:39  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0da78b0>]}
2022-04-22 19:36:39.194164 (Thread-31): 19:36:39  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:36:39.198234 (Thread-31): sending response (<Response 2780 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:39:00.682680 (Thread-32): handling status request
2022-04-22 19:39:00.684714 (Thread-32): 19:39:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5ca370>]}
2022-04-22 19:39:00.685213 (Thread-32): sending response (<Response 1659 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:39:00.701019 (Thread-33): handling list request
2022-04-22 19:39:00.701338 (Thread-33): 19:39:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5ca640>]}
2022-04-22 19:39:00.754692 (Thread-33): 19:39:00  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0cf0040>]}
2022-04-22 19:39:00.755053 (Thread-33): 19:39:00  Found 10 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 19:39:00.761253 (Thread-33): sending response (<Response 6094 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:46:10.248705 (Thread-34): 19:46:10  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 19:46:10.249939 (Thread-34): 19:46:10  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 19:46:10.250456 (Thread-34): 19:46:10  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 19:46:10.255787 (Thread-34): 19:46:10  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5129a0>]}
2022-04-22 19:46:11.088641 (Thread-35): handling status request
2022-04-22 19:46:11.089040 (Thread-35): 19:46:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e579280>]}
2022-04-22 19:46:11.089536 (Thread-35): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:46:11.478376 (Thread-36): handling status request
2022-04-22 19:46:11.478742 (Thread-36): 19:46:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e579160>]}
2022-04-22 19:46:11.479201 (Thread-36): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:47:36.278407 (Thread-37): 19:47:36  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 19:47:36.279566 (Thread-37): 19:47:36  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 19:47:36.280106 (Thread-37): 19:47:36  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 19:47:36.285794 (Thread-37): 19:47:36  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be55af0>]}
2022-04-22 19:47:37.035244 (Thread-38): handling status request
2022-04-22 19:47:37.035660 (Thread-38): 19:47:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e50c4f0>]}
2022-04-22 19:47:37.036149 (Thread-38): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:47:37.375754 (Thread-39): handling status request
2022-04-22 19:47:37.376220 (Thread-39): 19:47:37  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e624280>]}
2022-04-22 19:47:37.376706 (Thread-39): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:47:47.456681 (Thread-40): 19:47:47  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 19:47:47.456902 (Thread-40): 19:47:47  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 19:47:47.457402 (Thread-40): 19:47:47  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 19:47:47.462937 (Thread-40): 19:47:47  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5286a0>]}
2022-04-22 19:47:48.274450 (Thread-41): handling status request
2022-04-22 19:47:48.274843 (Thread-41): 19:47:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be49400>]}
2022-04-22 19:47:48.275320 (Thread-41): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:47:48.361196 (Thread-42): handling status request
2022-04-22 19:47:48.361631 (Thread-42): 19:47:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be49220>]}
2022-04-22 19:47:48.362145 (Thread-42): sending response (<Response 1681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:48:06.822607 (Thread-43): 19:48:06  Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
2022-04-22 19:48:06.823014 (Thread-43): 19:48:06  Partial parsing: added file: my_new_project://models/intermediate/user_type.sql
2022-04-22 19:48:06.833987 (Thread-43): 19:48:06  1699: static parser successfully parsed intermediate/user_type.sql
2022-04-22 19:48:06.893269 (Thread-43): 19:48:06  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 19:48:06.898408 (Thread-43): 19:48:06  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be1f970>]}
2022-04-22 19:48:07.694805 (Thread-44): handling status request
2022-04-22 19:48:07.695205 (Thread-44): 19:48:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e4ef880>]}
2022-04-22 19:48:07.695730 (Thread-44): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 19:48:07.735756 (Thread-45): handling status request
2022-04-22 19:48:07.736185 (Thread-45): 19:48:07  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be228e0>]}
2022-04-22 19:48:07.736662 (Thread-45): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:00:16.997211 (Thread-46): handling status request
2022-04-22 20:00:16.998595 (Thread-46): 20:00:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be56f10>]}
2022-04-22 20:00:16.999094 (Thread-46): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:00:17.366323 (Thread-47): handling run_sql request
2022-04-22 20:00:17.366716 (Thread-47): 20:00:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be56d60>]}
2022-04-22 20:00:19.965288 (Thread-47): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:00:19.989979 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1278, in process_node
    _process_refs_for_node(manifest, config.project_name, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1163, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 901, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 620, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a node named 'stg_first_orders' which was not found
2022-04-22 20:00:20.306519 (Thread-48): handling poll request
2022-04-22 20:00:20.306968 (Thread-48): 20:00:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be55fd0>]}
2022-04-22 20:00:20.307740 (Thread-48): sending response (<Response 2842 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:08.008757 (Thread-49): handling status request
2022-04-22 20:01:08.009172 (Thread-49): 20:01:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be55b50>]}
2022-04-22 20:01:08.009767 (Thread-49): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:08.260470 (Thread-50): handling status request
2022-04-22 20:01:08.260855 (Thread-50): 20:01:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be55550>]}
2022-04-22 20:01:08.261347 (Thread-50): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:08.355074 (Thread-51): handling cli_args request
2022-04-22 20:01:08.355481 (Thread-51): 20:01:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be55700>]}
2022-04-22 20:01:10.998970 (Thread-51): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:11.049839 (MainThread): 20:01:11  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 20:01:11.050300 (MainThread): 20:01:11  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0abfc9b550>]}
2022-04-22 20:01:11.106409 (MainThread): 20:01:11  Parsing macros/adapters.sql
2022-04-22 20:01:11.145743 (MainThread): 20:01:11  Parsing macros/catalog.sql
2022-04-22 20:01:11.147710 (MainThread): 20:01:11  Parsing macros/materializations/table.sql
2022-04-22 20:01:11.150837 (MainThread): 20:01:11  Parsing macros/materializations/seed.sql
2022-04-22 20:01:11.159012 (MainThread): 20:01:11  Parsing macros/materializations/incremental.sql
2022-04-22 20:01:11.173008 (MainThread): 20:01:11  Parsing macros/materializations/merge.sql
2022-04-22 20:01:11.179372 (MainThread): 20:01:11  Parsing macros/materializations/snapshot.sql
2022-04-22 20:01:11.180967 (MainThread): 20:01:11  Parsing macros/materializations/view.sql
2022-04-22 20:01:11.183134 (MainThread): 20:01:11  Parsing macros/adapters/metadata.sql
2022-04-22 20:01:11.194662 (MainThread): 20:01:11  Parsing macros/adapters/columns.sql
2022-04-22 20:01:11.210529 (MainThread): 20:01:11  Parsing macros/adapters/freshness.sql
2022-04-22 20:01:11.215175 (MainThread): 20:01:11  Parsing macros/adapters/persist_docs.sql
2022-04-22 20:01:11.220594 (MainThread): 20:01:11  Parsing macros/adapters/relation.sql
2022-04-22 20:01:11.230659 (MainThread): 20:01:11  Parsing macros/adapters/schema.sql
2022-04-22 20:01:11.233060 (MainThread): 20:01:11  Parsing macros/adapters/indexes.sql
2022-04-22 20:01:11.235861 (MainThread): 20:01:11  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 20:01:11.238454 (MainThread): 20:01:11  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 20:01:11.239946 (MainThread): 20:01:11  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 20:01:11.241495 (MainThread): 20:01:11  Parsing macros/etc/datetime.sql
2022-04-22 20:01:11.250149 (MainThread): 20:01:11  Parsing macros/etc/statement.sql
2022-04-22 20:01:11.254781 (MainThread): 20:01:11  Parsing macros/generic_test_sql/unique.sql
2022-04-22 20:01:11.255566 (MainThread): 20:01:11  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 20:01:11.256125 (MainThread): 20:01:11  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 20:01:11.257636 (MainThread): 20:01:11  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 20:01:11.258513 (MainThread): 20:01:11  Parsing macros/materializations/configs.sql
2022-04-22 20:01:11.260820 (MainThread): 20:01:11  Parsing macros/materializations/hooks.sql
2022-04-22 20:01:11.264744 (MainThread): 20:01:11  Parsing macros/materializations/models/table/table.sql
2022-04-22 20:01:11.272392 (MainThread): 20:01:11  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 20:01:11.275449 (MainThread): 20:01:11  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 20:01:11.278242 (MainThread): 20:01:11  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 20:01:11.279557 (MainThread): 20:01:11  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 20:01:11.281882 (MainThread): 20:01:11  Parsing macros/materializations/models/view/view.sql
2022-04-22 20:01:11.289195 (MainThread): 20:01:11  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 20:01:11.299432 (MainThread): 20:01:11  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 20:01:11.315412 (MainThread): 20:01:11  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 20:01:11.317022 (MainThread): 20:01:11  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 20:01:11.350418 (Thread-52): handling poll request
2022-04-22 20:01:11.350862 (Thread-52): 20:01:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bdf83a0>]}
2022-04-22 20:01:11.328475 (MainThread): 20:01:11  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 20:01:11.352256 (Thread-52): sending response (<Response 11804 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:11.333143 (MainThread): 20:01:11  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 20:01:11.350271 (MainThread): 20:01:11  Parsing macros/materializations/seeds/seed.sql
2022-04-22 20:01:11.356626 (MainThread): 20:01:11  Parsing macros/materializations/tests/helpers.sql
2022-04-22 20:01:11.358538 (MainThread): 20:01:11  Parsing macros/materializations/tests/test.sql
2022-04-22 20:01:11.363085 (MainThread): 20:01:11  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 20:01:11.364957 (MainThread): 20:01:11  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 20:01:11.376292 (MainThread): 20:01:11  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 20:01:11.394403 (MainThread): 20:01:11  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 20:01:11.396128 (MainThread): 20:01:11  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 20:01:11.407968 (MainThread): 20:01:11  Parsing tests/generic/builtin.sql
2022-04-22 20:01:11.604923 (MainThread): 20:01:11  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:01:11.616862 (MainThread): 20:01:11  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 20:01:11.619048 (MainThread): 20:01:11  1603: static parser failed on _archive/test_loop.sql
2022-04-22 20:01:11.622803 (MainThread): 20:01:11  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 20:01:11.623818 (MainThread): 20:01:11  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 20:01:11.625848 (MainThread): 20:01:11  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 20:01:11.628128 (MainThread): 20:01:11  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 20:01:11.630284 (MainThread): 20:01:11  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 20:01:11.632534 (MainThread): 20:01:11  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 20:01:11.634436 (MainThread): 20:01:11  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 20:01:11.636290 (MainThread): 20:01:11  1699: static parser successfully parsed intermediate/user_type.sql
2022-04-22 20:01:11.638736 (MainThread): 20:01:11  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:01:11.706765 (MainThread): 20:01:11  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:01:11.711828 (MainThread): 20:01:11  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0abd3195b0>]}
2022-04-22 20:01:11.738297 (MainThread): 20:01:11  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0abfbb4be0>]}
2022-04-22 20:01:11.738629 (MainThread): 20:01:11  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:01:11.740241 (MainThread): 20:01:11  
2022-04-22 20:01:11.740574 (MainThread): 20:01:11  Acquiring new snowflake connection "master"
2022-04-22 20:01:11.741835 (ThreadPoolExecutor-0_0): 20:01:11  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 20:01:11.754934 (ThreadPoolExecutor-0_0): 20:01:11  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 20:01:11.755072 (ThreadPoolExecutor-0_0): 20:01:11  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 20:01:11.755166 (ThreadPoolExecutor-0_0): 20:01:11  Opening a new connection, currently in state init
2022-04-22 20:01:12.739197 (ThreadPoolExecutor-0_0): 20:01:12  SQL status: SUCCESS 4 in 0.98 seconds
2022-04-22 20:01:12.741234 (ThreadPoolExecutor-0_0): 20:01:12  On list_PE_ALEXANDER_B: Close
2022-04-22 20:01:12.758186 (Thread-53): handling poll request
2022-04-22 20:01:12.758541 (Thread-53): 20:01:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be02730>]}
2022-04-22 20:01:12.759360 (Thread-53): sending response (<Response 11165 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:13.084713 (ThreadPoolExecutor-2_0): 20:01:13  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 20:01:13.092340 (ThreadPoolExecutor-2_0): 20:01:13  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 20:01:13.092509 (ThreadPoolExecutor-2_0): 20:01:13  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 20:01:13.092622 (ThreadPoolExecutor-2_0): 20:01:13  Opening a new connection, currently in state closed
2022-04-22 20:01:14.122392 (Thread-54): handling poll request
2022-04-22 20:01:14.122804 (Thread-54): 20:01:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e511130>]}
2022-04-22 20:01:14.123367 (Thread-54): sending response (<Response 1796 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:14.347466 (ThreadPoolExecutor-2_0): 20:01:14  SQL status: SUCCESS 8 in 1.25 seconds
2022-04-22 20:01:14.349088 (ThreadPoolExecutor-2_0): 20:01:14  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 20:01:14.542516 (MainThread): 20:01:14  Concurrency: 4 threads (target='default')
2022-04-22 20:01:14.542705 (MainThread): 20:01:14  
2022-04-22 20:01:14.545438 (Thread-1): 20:01:14  Began running node model.my_new_project.orginal_query
2022-04-22 20:01:14.545805 (Thread-1): 20:01:14  1 of 10 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 20:01:14.546096 (Thread-1): 20:01:14  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 20:01:14.546204 (Thread-1): 20:01:14  Began compiling node model.my_new_project.orginal_query
2022-04-22 20:01:14.546313 (Thread-1): 20:01:14  Compiling model.my_new_project.orginal_query
2022-04-22 20:01:14.546912 (Thread-2): 20:01:14  Began running node model.my_new_project.stg_ctry_type
2022-04-22 20:01:14.547164 (Thread-2): 20:01:14  2 of 10 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 20:01:14.547431 (Thread-2): 20:01:14  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 20:01:14.547524 (Thread-2): 20:01:14  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 20:01:14.547610 (Thread-2): 20:01:14  Compiling model.my_new_project.stg_ctry_type
2022-04-22 20:01:14.549992 (Thread-2): 20:01:14  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 20:01:14.550783 (Thread-3): 20:01:14  Began running node model.my_new_project.stg_device_orders
2022-04-22 20:01:14.551032 (Thread-3): 20:01:14  3 of 10 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 20:01:14.551290 (Thread-3): 20:01:14  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 20:01:14.551383 (Thread-3): 20:01:14  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 20:01:14.551468 (Thread-3): 20:01:14  Compiling model.my_new_project.stg_device_orders
2022-04-22 20:01:14.553657 (Thread-3): 20:01:14  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 20:01:14.553910 (Thread-4): 20:01:14  Began running node model.my_new_project.stg_orders
2022-04-22 20:01:14.554151 (Thread-4): 20:01:14  4 of 10 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 20:01:14.554410 (Thread-4): 20:01:14  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 20:01:14.554506 (Thread-4): 20:01:14  Began compiling node model.my_new_project.stg_orders
2022-04-22 20:01:14.554592 (Thread-4): 20:01:14  Compiling model.my_new_project.stg_orders
2022-04-22 20:01:14.556636 (Thread-4): 20:01:14  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 20:01:14.558664 (Thread-1): 20:01:14  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 20:01:14.558802 (Thread-1): 20:01:14  finished collecting timing info
2022-04-22 20:01:14.558923 (Thread-1): 20:01:14  Began executing node model.my_new_project.orginal_query
2022-04-22 20:01:14.583998 (Thread-1): 20:01:14  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 20:01:14.586396 (Thread-2): 20:01:14  finished collecting timing info
2022-04-22 20:01:14.586589 (Thread-2): 20:01:14  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 20:01:14.588843 (Thread-2): 20:01:14  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 20:01:14.589196 (Thread-4): 20:01:14  finished collecting timing info
2022-04-22 20:01:14.589352 (Thread-4): 20:01:14  Began executing node model.my_new_project.stg_orders
2022-04-22 20:01:14.591415 (Thread-4): 20:01:14  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 20:01:14.591649 (Thread-3): 20:01:14  finished collecting timing info
2022-04-22 20:01:14.591800 (Thread-3): 20:01:14  Began executing node model.my_new_project.stg_device_orders
2022-04-22 20:01:14.593672 (Thread-3): 20:01:14  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 20:01:14.601396 (Thread-1): 20:01:14  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 20:01:14.601552 (Thread-1): 20:01:14  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    
  );
2022-04-22 20:01:14.601707 (Thread-1): 20:01:14  Opening a new connection, currently in state closed
2022-04-22 20:01:14.605630 (Thread-4): 20:01:14  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 20:01:14.605778 (Thread-4): 20:01:14  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
  );
2022-04-22 20:01:14.605922 (Thread-4): 20:01:14  Opening a new connection, currently in state init
2022-04-22 20:01:14.608526 (Thread-2): 20:01:14  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 20:01:14.608657 (Thread-2): 20:01:14  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 20:01:14.608746 (Thread-2): 20:01:14  Opening a new connection, currently in state init
2022-04-22 20:01:14.610437 (Thread-3): 20:01:14  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 20:01:14.610548 (Thread-3): 20:01:14  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 20:01:14.610642 (Thread-3): 20:01:14  Opening a new connection, currently in state init
2022-04-22 20:01:15.467442 (Thread-55): handling poll request
2022-04-22 20:01:15.467864 (Thread-55): 20:01:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bdf0490>]}
2022-04-22 20:01:15.468927 (Thread-55): sending response (<Response 22821 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:15.559416 (Thread-1): 20:01:15  Snowflake adapter: Snowflake query id: 01a3c8b1-0501-61f2-0004-7d83048c2e22
2022-04-22 20:01:15.559590 (Thread-1): 20:01:15  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:01:15.559791 (Thread-1): 20:01:15  finished collecting timing info
2022-04-22 20:01:15.559945 (Thread-1): 20:01:15  On model.my_new_project.orginal_query: Close
2022-04-22 20:01:15.776487 (Thread-1): 20:01:15  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 20:01:15.776938 (Thread-1): 20:01:15  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0abfc0e910>]}
2022-04-22 20:01:15.777325 (Thread-1): 20:01:15  1 of 10 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.23s]
2022-04-22 20:01:15.777456 (Thread-1): 20:01:15  Finished running node model.my_new_project.orginal_query
2022-04-22 20:01:15.777638 (Thread-1): 20:01:15  Began running node model.my_new_project.stg_payments
2022-04-22 20:01:15.777843 (Thread-1): 20:01:15  5 of 10 START view model abrown_dbt_interview.stg_payments...................... [RUN]
2022-04-22 20:01:15.778093 (Thread-1): 20:01:15  Acquiring new snowflake connection "model.my_new_project.stg_payments"
2022-04-22 20:01:15.778184 (Thread-1): 20:01:15  Began compiling node model.my_new_project.stg_payments
2022-04-22 20:01:15.778278 (Thread-1): 20:01:15  Compiling model.my_new_project.stg_payments
2022-04-22 20:01:15.780604 (Thread-1): 20:01:15  Writing injected SQL for node "model.my_new_project.stg_payments"
2022-04-22 20:01:15.793198 (Thread-1): 20:01:15  finished collecting timing info
2022-04-22 20:01:15.793405 (Thread-1): 20:01:15  Began executing node model.my_new_project.stg_payments
2022-04-22 20:01:15.796337 (Thread-1): 20:01:15  Writing runtime SQL for node "model.my_new_project.stg_payments"
2022-04-22 20:01:15.808908 (Thread-1): 20:01:15  Using snowflake connection "model.my_new_project.stg_payments"
2022-04-22 20:01:15.809078 (Thread-1): 20:01:15  On model.my_new_project.stg_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_payments 
  
   as (
    with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
    sum(case
            when status = 'completed' then tax_amount_cents else 0
        end
        ) as gross_tax_amount_cents,
    sum(case
            when status = 'completed' then amount_cents else 0
        end
        ) as gross_amount_cents,
    sum(case
            when status = 'completed' then amount_shipping_cents else 0
        end
        ) as gross_shipping_amount_cents,
    sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
        ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
  );
2022-04-22 20:01:15.809177 (Thread-1): 20:01:15  Opening a new connection, currently in state closed
2022-04-22 20:01:16.328215 (Thread-4): 20:01:16  SQL status: SUCCESS 1 in 1.72 seconds
2022-04-22 20:01:16.335008 (Thread-4): 20:01:16  finished collecting timing info
2022-04-22 20:01:16.335201 (Thread-4): 20:01:16  On model.my_new_project.stg_orders: Close
2022-04-22 20:01:16.656280 (Thread-1): 20:01:16  SQL status: SUCCESS 1 in 0.85 seconds
2022-04-22 20:01:16.657797 (Thread-1): 20:01:16  finished collecting timing info
2022-04-22 20:01:16.657972 (Thread-1): 20:01:16  On model.my_new_project.stg_payments: Close
2022-04-22 20:01:16.690929 (Thread-4): 20:01:16  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af5886ca0>]}
2022-04-22 20:01:16.691373 (Thread-4): 20:01:16  4 of 10 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 2.14s]
2022-04-22 20:01:16.691506 (Thread-4): 20:01:16  Finished running node model.my_new_project.stg_orders
2022-04-22 20:01:16.691667 (Thread-4): 20:01:16  Began running node model.my_new_project.stg_query
2022-04-22 20:01:16.691901 (Thread-4): 20:01:16  6 of 10 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 20:01:16.692165 (Thread-4): 20:01:16  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 20:01:16.692260 (Thread-4): 20:01:16  Began compiling node model.my_new_project.stg_query
2022-04-22 20:01:16.692355 (Thread-4): 20:01:16  Compiling model.my_new_project.stg_query
2022-04-22 20:01:16.697270 (Thread-4): 20:01:16  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 20:01:16.725148 (Thread-4): 20:01:16  finished collecting timing info
2022-04-22 20:01:16.725370 (Thread-4): 20:01:16  Began executing node model.my_new_project.stg_query
2022-04-22 20:01:16.727603 (Thread-4): 20:01:16  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 20:01:16.755651 (Thread-4): 20:01:16  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 20:01:16.755830 (Thread-4): 20:01:16  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents,
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 20:01:16.755969 (Thread-4): 20:01:16  Opening a new connection, currently in state closed
2022-04-22 20:01:16.808785 (Thread-56): handling poll request
2022-04-22 20:01:16.809159 (Thread-56): 20:01:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be5eb80>]}
2022-04-22 20:01:16.810085 (Thread-56): sending response (<Response 22985 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:17.157171 (Thread-2): 20:01:17  SQL status: SUCCESS 1 in 2.55 seconds
2022-04-22 20:01:17.158745 (Thread-2): 20:01:17  finished collecting timing info
2022-04-22 20:01:17.158918 (Thread-2): 20:01:17  On model.my_new_project.stg_ctry_type: Close
2022-04-22 20:01:17.161514 (Thread-3): 20:01:17  SQL status: SUCCESS 1 in 2.55 seconds
2022-04-22 20:01:17.162855 (Thread-3): 20:01:17  finished collecting timing info
2022-04-22 20:01:17.163008 (Thread-3): 20:01:17  On model.my_new_project.stg_device_orders: Close
2022-04-22 20:01:17.237535 (Thread-1): 20:01:17  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af4264820>]}
2022-04-22 20:01:17.238024 (Thread-1): 20:01:17  5 of 10 OK created view model abrown_dbt_interview.stg_payments................. [SUCCESS 1 in 1.46s]
2022-04-22 20:01:17.238162 (Thread-1): 20:01:17  Finished running node model.my_new_project.stg_payments
2022-04-22 20:01:17.238310 (Thread-1): 20:01:17  Began running node model.my_new_project.test_conn
2022-04-22 20:01:17.238496 (Thread-1): 20:01:17  7 of 10 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 20:01:17.238746 (Thread-1): 20:01:17  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 20:01:17.238840 (Thread-1): 20:01:17  Began compiling node model.my_new_project.test_conn
2022-04-22 20:01:17.238934 (Thread-1): 20:01:17  Compiling model.my_new_project.test_conn
2022-04-22 20:01:17.240740 (Thread-1): 20:01:17  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 20:01:17.240865 (Thread-1): 20:01:17  finished collecting timing info
2022-04-22 20:01:17.240981 (Thread-1): 20:01:17  Began executing node model.my_new_project.test_conn
2022-04-22 20:01:17.244812 (Thread-1): 20:01:17  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 20:01:17.259053 (Thread-1): 20:01:17  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 20:01:17.259203 (Thread-1): 20:01:17  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    
  );
2022-04-22 20:01:17.259301 (Thread-1): 20:01:17  Opening a new connection, currently in state closed
2022-04-22 20:01:17.515968 (Thread-2): 20:01:17  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af4305be0>]}
2022-04-22 20:01:17.516414 (Thread-2): 20:01:17  2 of 10 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 2.97s]
2022-04-22 20:01:17.516549 (Thread-2): 20:01:17  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 20:01:17.516703 (Thread-2): 20:01:17  Began running node model.my_new_project.test_loop
2022-04-22 20:01:17.516903 (Thread-2): 20:01:17  8 of 10 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 20:01:17.517170 (Thread-2): 20:01:17  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 20:01:17.517264 (Thread-2): 20:01:17  Began compiling node model.my_new_project.test_loop
2022-04-22 20:01:17.517358 (Thread-2): 20:01:17  Compiling model.my_new_project.test_loop
2022-04-22 20:01:17.525909 (Thread-2): 20:01:17  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 20:01:17.532434 (Thread-3): 20:01:17  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0abd339a90>]}
2022-04-22 20:01:17.538201 (Thread-3): 20:01:17  3 of 10 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 2.98s]
2022-04-22 20:01:17.538377 (Thread-3): 20:01:17  Finished running node model.my_new_project.stg_device_orders
2022-04-22 20:01:17.538528 (Thread-3): 20:01:17  Began running node model.my_new_project.stg_first_order
2022-04-22 20:01:17.538729 (Thread-3): 20:01:17  9 of 10 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 20:01:17.539010 (Thread-3): 20:01:17  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 20:01:17.539104 (Thread-3): 20:01:17  Began compiling node model.my_new_project.stg_first_order
2022-04-22 20:01:17.539198 (Thread-3): 20:01:17  Compiling model.my_new_project.stg_first_order
2022-04-22 20:01:17.541486 (Thread-3): 20:01:17  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 20:01:17.563088 (Thread-2): 20:01:17  finished collecting timing info
2022-04-22 20:01:17.563300 (Thread-2): 20:01:17  Began executing node model.my_new_project.test_loop
2022-04-22 20:01:17.565673 (Thread-2): 20:01:17  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 20:01:17.580289 (Thread-3): 20:01:17  finished collecting timing info
2022-04-22 20:01:17.580496 (Thread-3): 20:01:17  Began executing node model.my_new_project.stg_first_order
2022-04-22 20:01:17.582865 (Thread-3): 20:01:17  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 20:01:17.604478 (Thread-2): 20:01:17  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 20:01:17.604654 (Thread-2): 20:01:17  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    -- list tables




select * from raw.interview_sample_data.interview_devices
  );
2022-04-22 20:01:17.604757 (Thread-2): 20:01:17  Opening a new connection, currently in state closed
2022-04-22 20:01:17.622032 (Thread-4): 20:01:17  SQL status: SUCCESS 1 in 0.87 seconds
2022-04-22 20:01:17.623482 (Thread-4): 20:01:17  finished collecting timing info
2022-04-22 20:01:17.623665 (Thread-4): 20:01:17  On model.my_new_project.stg_query: Close
2022-04-22 20:01:17.624626 (Thread-3): 20:01:17  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 20:01:17.624745 (Thread-3): 20:01:17  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 20:01:17.624836 (Thread-3): 20:01:17  Opening a new connection, currently in state closed
2022-04-22 20:01:17.871522 (Thread-4): 20:01:17  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af42c0af0>]}
2022-04-22 20:01:17.871982 (Thread-4): 20:01:17  6 of 10 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.18s]
2022-04-22 20:01:17.872126 (Thread-4): 20:01:17  Finished running node model.my_new_project.stg_query
2022-04-22 20:01:18.214416 (Thread-57): handling poll request
2022-04-22 20:01:18.214839 (Thread-57): 20:01:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be49670>]}
2022-04-22 20:01:18.216025 (Thread-57): sending response (<Response 24092 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:18.558914 (Thread-3): 20:01:18  SQL status: SUCCESS 1 in 0.93 seconds
2022-04-22 20:01:18.560437 (Thread-3): 20:01:18  finished collecting timing info
2022-04-22 20:01:18.560612 (Thread-3): 20:01:18  On model.my_new_project.stg_first_order: Close
2022-04-22 20:01:18.567509 (Thread-2): 20:01:18  SQL status: SUCCESS 1 in 0.96 seconds
2022-04-22 20:01:18.568931 (Thread-2): 20:01:18  finished collecting timing info
2022-04-22 20:01:18.569092 (Thread-2): 20:01:18  On model.my_new_project.test_loop: Close
2022-04-22 20:01:18.796906 (Thread-3): 20:01:18  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0aed9825b0>]}
2022-04-22 20:01:18.797339 (Thread-3): 20:01:18  9 of 10 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 1.26s]
2022-04-22 20:01:18.797472 (Thread-3): 20:01:18  Finished running node model.my_new_project.stg_first_order
2022-04-22 20:01:18.798235 (Thread-4): 20:01:18  Began running node model.my_new_project.fct_final
2022-04-22 20:01:18.798501 (Thread-4): 20:01:18  10 of 10 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 20:01:18.798777 (Thread-4): 20:01:18  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 20:01:18.798878 (Thread-4): 20:01:18  Began compiling node model.my_new_project.fct_final
2022-04-22 20:01:18.798973 (Thread-4): 20:01:18  Compiling model.my_new_project.fct_final
2022-04-22 20:01:18.802248 (Thread-4): 20:01:18  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 20:01:18.815727 (Thread-4): 20:01:18  finished collecting timing info
2022-04-22 20:01:18.815930 (Thread-4): 20:01:18  Began executing node model.my_new_project.fct_final
2022-04-22 20:01:18.818944 (Thread-4): 20:01:18  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 20:01:18.832889 (Thread-4): 20:01:18  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 20:01:18.833045 (Thread-4): 20:01:18  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 20:01:18.833146 (Thread-4): 20:01:18  Opening a new connection, currently in state closed
2022-04-22 20:01:18.919064 (Thread-2): 20:01:18  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af42b9dc0>]}
2022-04-22 20:01:18.919490 (Thread-2): 20:01:18  8 of 10 OK created view model abrown_dbt_interview.test_loop.................... [SUCCESS 1 in 1.40s]
2022-04-22 20:01:18.919618 (Thread-2): 20:01:18  Finished running node model.my_new_project.test_loop
2022-04-22 20:01:19.225370 (Thread-1): 20:01:19  Snowflake adapter: Snowflake query id: 01a3c8b1-0501-5fd8-0004-7d83048c58c2
2022-04-22 20:01:19.225542 (Thread-1): 20:01:19  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:01:19.225826 (Thread-1): 20:01:19  finished collecting timing info
2022-04-22 20:01:19.226052 (Thread-1): 20:01:19  On model.my_new_project.test_conn: Close
2022-04-22 20:01:19.429459 (Thread-1): 20:01:19  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 20:01:19.429788 (Thread-1): 20:01:19  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af42b9c70>]}
2022-04-22 20:01:19.430320 (Thread-1): 20:01:19  7 of 10 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 2.19s]
2022-04-22 20:01:19.430452 (Thread-1): 20:01:19  Finished running node model.my_new_project.test_conn
2022-04-22 20:01:19.547181 (Thread-58): handling poll request
2022-04-22 20:01:19.547564 (Thread-58): 20:01:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be7f190>]}
2022-04-22 20:01:19.548367 (Thread-58): sending response (<Response 15681 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:19.787250 (Thread-4): 20:01:19  SQL status: SUCCESS 1 in 0.95 seconds
2022-04-22 20:01:19.788733 (Thread-4): 20:01:19  finished collecting timing info
2022-04-22 20:01:19.788896 (Thread-4): 20:01:19  On model.my_new_project.fct_final: Close
2022-04-22 20:01:20.000271 (Thread-4): 20:01:20  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bd6c536-749d-4d99-91e8-e735b473fed1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0af4279b80>]}
2022-04-22 20:01:20.000835 (Thread-4): 20:01:20  10 of 10 OK created view model abrown_dbt_interview.fct_final................... [SUCCESS 1 in 1.20s]
2022-04-22 20:01:20.000979 (Thread-4): 20:01:20  Finished running node model.my_new_project.fct_final
2022-04-22 20:01:20.002600 (MainThread): 20:01:20  Acquiring new snowflake connection "master"
2022-04-22 20:01:20.002958 (MainThread): 20:01:20  
2022-04-22 20:01:20.003073 (MainThread): 20:01:20  Finished running 10 view models in 8.26s.
2022-04-22 20:01:20.003164 (MainThread): 20:01:20  Connection 'master' was properly closed.
2022-04-22 20:01:20.003238 (MainThread): 20:01:20  Connection 'model.my_new_project.test_conn' was properly closed.
2022-04-22 20:01:20.003307 (MainThread): 20:01:20  Connection 'model.my_new_project.test_loop' was properly closed.
2022-04-22 20:01:20.003374 (MainThread): 20:01:20  Connection 'model.my_new_project.stg_first_order' was properly closed.
2022-04-22 20:01:20.003440 (MainThread): 20:01:20  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 20:01:20.094606 (MainThread): 20:01:20  
2022-04-22 20:01:20.094847 (MainThread): 20:01:20  Completed with 2 errors and 0 warnings:
2022-04-22 20:01:20.094948 (MainThread): 20:01:20  
2022-04-22 20:01:20.095051 (MainThread): 20:01:20  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 20:01:20.095136 (MainThread): 20:01:20    001003 (42000): SQL compilation error:
2022-04-22 20:01:20.095211 (MainThread): 20:01:20    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:01:20.095281 (MainThread): 20:01:20    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 20:01:20.095356 (MainThread): 20:01:20  
2022-04-22 20:01:20.095439 (MainThread): 20:01:20  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 20:01:20.095512 (MainThread): 20:01:20    001003 (42000): SQL compilation error:
2022-04-22 20:01:20.095581 (MainThread): 20:01:20    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:01:20.095661 (MainThread): 20:01:20    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 20:01:20.095754 (MainThread): 20:01:20  
2022-04-22 20:01:20.095844 (MainThread): 20:01:20  Done. PASS=8 WARN=0 ERROR=2 SKIP=0 TOTAL=10
2022-04-22 20:01:20.896202 (Thread-59): handling poll request
2022-04-22 20:01:20.896588 (Thread-59): 20:01:20  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bdccdf0>]}
2022-04-22 20:01:20.898592 (Thread-59): sending response (<Response 55406 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:21.854897 (Thread-60): handling status request
2022-04-22 20:01:21.855288 (Thread-60): 20:01:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e569d60>]}
2022-04-22 20:01:21.855819 (Thread-60): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:21.899894 (Thread-61): handling status request
2022-04-22 20:01:21.900294 (Thread-61): 20:01:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5678b0>]}
2022-04-22 20:01:21.900795 (Thread-61): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:31.981454 (Thread-62): handling status request
2022-04-22 20:01:31.981910 (Thread-62): 20:01:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e567af0>]}
2022-04-22 20:01:32.005523 (Thread-62): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:32.321342 (Thread-63): handling run_sql request
2022-04-22 20:01:32.321764 (Thread-63): 20:01:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e567e20>]}
2022-04-22 20:01:35.009034 (Thread-63): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:35.034727 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1278, in process_node
    _process_refs_for_node(manifest, config.project_name, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1163, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 901, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 620, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a node named 'stg_first_orders' which was not found
2022-04-22 20:01:35.334803 (Thread-64): handling poll request
2022-04-22 20:01:35.335249 (Thread-64): 20:01:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e55b0a0>]}
2022-04-22 20:01:35.336010 (Thread-64): sending response (<Response 2842 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:51.065972 (Thread-65): handling status request
2022-04-22 20:01:51.066370 (Thread-65): 20:01:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e4fc070>]}
2022-04-22 20:01:51.066928 (Thread-65): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:51.384180 (Thread-66): handling run_sql request
2022-04-22 20:01:51.384583 (Thread-66): 20:01:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e4fc250>]}
2022-04-22 20:01:53.988427 (Thread-66): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:01:54.014196 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1278, in process_node
    _process_refs_for_node(manifest, config.project_name, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1163, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 901, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 620, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a node named 'stg_first_orders' which was not found
2022-04-22 20:01:54.377638 (Thread-67): handling poll request
2022-04-22 20:01:54.378086 (Thread-67): 20:01:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e4fcdf0>]}
2022-04-22 20:01:54.378834 (Thread-67): sending response (<Response 2842 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:32:44.732721 (Thread-68): handling status request
2022-04-22 20:32:44.734220 (Thread-68): 20:32:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5059a0>]}
2022-04-22 20:32:44.734837 (Thread-68): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:32:45.136896 (Thread-69): handling run_sql request
2022-04-22 20:32:45.137278 (Thread-69): 20:32:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e505970>]}
2022-04-22 20:32:47.730157 (Thread-69): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:32:47.755999 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/task_handler.py", line 102, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 164, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 125, in _get_exec_node
    add_new_refs(
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 50, in add_new_refs
    process_node(config, manifest, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1278, in process_node
    _process_refs_for_node(manifest, config.project_name, node)
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 1163, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/dist-packages/dbt/parser/manifest.py", line 901, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 620, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/dist-packages/dbt/exceptions.py", line 454, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Rpc 'rpc.my_new_project.request' (from remote system) depends on a node named 'stg_first_orders' which was not found
2022-04-22 20:32:48.100092 (Thread-70): handling poll request
2022-04-22 20:32:48.100549 (Thread-70): 20:32:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5005b0>]}
2022-04-22 20:32:48.101298 (Thread-70): sending response (<Response 2925 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:09.658163 (Thread-71): handling status request
2022-04-22 20:33:09.659215 (Thread-71): 20:33:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e505f70>]}
2022-04-22 20:33:09.659770 (Thread-71): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:10.009413 (Thread-72): handling run_sql request
2022-04-22 20:33:10.009893 (Thread-72): 20:33:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309be7f460>]}
2022-04-22 20:33:12.542394 (Thread-72): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:12.568572 (MainThread): 20:33:12  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3cb5c9ef-d2e9-4f38-a3fb-dc4a900dbf6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f14d05f6fa0>]}
2022-04-22 20:33:12.569095 (MainThread): 20:33:12  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:33:12.569703 (Thread-1): 20:33:12  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:33:12.569835 (Thread-1): 20:33:12  Began compiling node rpc.my_new_project.request
2022-04-22 20:33:12.569925 (Thread-1): 20:33:12  Compiling rpc.my_new_project.request
2022-04-22 20:33:12.572135 (Thread-1): 20:33:12  finished collecting timing info
2022-04-22 20:33:12.572266 (Thread-1): 20:33:12  Began executing node rpc.my_new_project.request
2022-04-22 20:33:12.573089 (Thread-1): 20:33:12  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:33:12.573180 (Thread-1): 20:33:12  On rpc.my_new_project.request: with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),
    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
    ut as (
        select
            o.order_id
            case
                when fo.first_order_id = o.order_id then 'new'
                else 'repeat'
            end as user_type
        from o
        left join fo
            on o.user_id = fo.user_id

    )

select * from ut
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:33:12.573262 (Thread-1): 20:33:12  Opening a new connection, currently in state init
2022-04-22 20:33:12.966819 (Thread-73): handling poll request
2022-04-22 20:33:12.967263 (Thread-73): 20:33:12  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e500c70>]}
2022-04-22 20:33:12.968204 (Thread-73): sending response (<Response 4177 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:13.523904 (Thread-1): 20:33:13  Snowflake adapter: Snowflake query id: 01a3c8d1-0501-616b-0004-7d83048c86b6
2022-04-22 20:33:13.524139 (Thread-1): 20:33:13  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 16 unexpected 'when'.
2022-04-22 20:33:13.524336 (Thread-1): 20:33:13  finished collecting timing info
2022-04-22 20:33:13.524558 (Thread-1): 20:33:13  On rpc.my_new_project.request: Close
2022-04-22 20:33:13.734410 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 16 unexpected 'when'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 8 at position 16 unexpected 'when'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 16 unexpected 'when'.
2022-04-22 20:33:13.735433 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 16 unexpected 'when'.", 'raw_sql': "with\r\n    o as (select * from {{ ref('stg_orders') }}),\r\n    fo as (select * from {{ ref('stg_first_order') }}),\r\n    ut as (\r\n        select\r\n            o.order_id\r\n            case\r\n                when fo.first_order_id = o.order_id then 'new'\r\n                else 'repeat'\r\n            end as user_type\r\n        from o\r\n        left join fo\r\n            on o.user_id = fo.user_id\r\n\r\n    )\r\n\r\nselect * from ut\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n    ut as (\n        select\n            o.order_id\n            case\n                when fo.first_order_id = o.order_id then 'new'\n                else 'repeat'\n            end as user_type\n        from o\n        left join fo\n            on o.user_id = fo.user_id\n\n    )\n\nselect * from ut\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 16 unexpected 'when'.", 'raw_sql': "with\r\n    o as (select * from {{ ref('stg_orders') }}),\r\n    fo as (select * from {{ ref('stg_first_order') }}),\r\n    ut as (\r\n        select\r\n            o.order_id\r\n            case\r\n                when fo.first_order_id = o.order_id then 'new'\r\n                else 'repeat'\r\n            end as user_type\r\n        from o\r\n        left join fo\r\n            on o.user_id = fo.user_id\r\n\r\n    )\r\n\r\nselect * from ut\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),\n    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),\n    ut as (\n        select\n            o.order_id\n            case\n                when fo.first_order_id = o.order_id then 'new'\n                else 'repeat'\n            end as user_type\n        from o\n        left join fo\n            on o.user_id = fo.user_id\n\n    )\n\nselect * from ut\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 20:33:14.330260 (Thread-74): handling poll request
2022-04-22 20:33:14.330651 (Thread-74): 20:33:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e500f70>]}
2022-04-22 20:33:14.331270 (Thread-74): sending response (<Response 13167 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:30.935954 (Thread-75): handling status request
2022-04-22 20:33:30.936352 (Thread-75): 20:33:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bddf430>]}
2022-04-22 20:33:30.936891 (Thread-75): sending response (<Response 2008 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:31.377005 (Thread-76): handling run_sql request
2022-04-22 20:33:31.377397 (Thread-76): 20:33:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bddf610>]}
2022-04-22 20:33:33.953662 (Thread-76): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:33.979982 (MainThread): 20:33:33  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '29cb8d16-b4ee-4424-b001-b37afe3f9ea7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec58c7ec10>]}
2022-04-22 20:33:33.980601 (MainThread): 20:33:33  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:33:33.981166 (Thread-1): 20:33:33  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:33:33.981287 (Thread-1): 20:33:33  Began compiling node rpc.my_new_project.request
2022-04-22 20:33:33.981377 (Thread-1): 20:33:33  Compiling rpc.my_new_project.request
2022-04-22 20:33:33.983783 (Thread-1): 20:33:33  finished collecting timing info
2022-04-22 20:33:33.983917 (Thread-1): 20:33:33  Began executing node rpc.my_new_project.request
2022-04-22 20:33:33.984793 (Thread-1): 20:33:33  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:33:33.984884 (Thread-1): 20:33:33  On rpc.my_new_project.request: with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),
    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
    ut as (
        select
            o.order_id,
            case
                when fo.first_order_id = o.order_id then 'new'
                else 'repeat'
            end as user_type
        from o
        left join fo
            on o.user_id = fo.user_id

    )

select * from ut
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:33:33.984968 (Thread-1): 20:33:33  Opening a new connection, currently in state init
2022-04-22 20:33:34.307750 (Thread-77): handling poll request
2022-04-22 20:33:34.308204 (Thread-77): 20:33:34  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bdc05e0>]}
2022-04-22 20:33:34.309150 (Thread-77): sending response (<Response 4178 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:35.636192 (Thread-78): handling poll request
2022-04-22 20:33:35.636583 (Thread-78): 20:33:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bdc07c0>]}
2022-04-22 20:33:35.637075 (Thread-78): sending response (<Response 395 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:35.947898 (Thread-1): 20:33:35  SQL status: SUCCESS 500 in 1.96 seconds
2022-04-22 20:33:35.954443 (Thread-1): 20:33:35  finished collecting timing info
2022-04-22 20:33:35.954703 (Thread-1): 20:33:35  On rpc.my_new_project.request: Close
2022-04-22 20:33:36.963558 (Thread-79): handling poll request
2022-04-22 20:33:36.963960 (Thread-79): 20:33:36  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bd69790>]}
2022-04-22 20:33:36.965565 (Thread-79): sending response (<Response 14437 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:48.770856 (Thread-80): 20:33:48  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 20:33:48.771207 (Thread-80): 20:33:48  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bddff40>]}
2022-04-22 20:33:48.825163 (Thread-80): 20:33:48  Parsing macros/adapters.sql
2022-04-22 20:33:48.862613 (Thread-80): 20:33:48  Parsing macros/catalog.sql
2022-04-22 20:33:48.864540 (Thread-80): 20:33:48  Parsing macros/materializations/table.sql
2022-04-22 20:33:48.867613 (Thread-80): 20:33:48  Parsing macros/materializations/seed.sql
2022-04-22 20:33:48.872592 (Thread-80): 20:33:48  Parsing macros/materializations/incremental.sql
2022-04-22 20:33:48.880851 (Thread-80): 20:33:48  Parsing macros/materializations/merge.sql
2022-04-22 20:33:48.884534 (Thread-80): 20:33:48  Parsing macros/materializations/snapshot.sql
2022-04-22 20:33:48.885490 (Thread-80): 20:33:48  Parsing macros/materializations/view.sql
2022-04-22 20:33:48.886839 (Thread-80): 20:33:48  Parsing macros/adapters/metadata.sql
2022-04-22 20:33:48.893635 (Thread-80): 20:33:48  Parsing macros/adapters/columns.sql
2022-04-22 20:33:48.903032 (Thread-80): 20:33:48  Parsing macros/adapters/freshness.sql
2022-04-22 20:33:48.905815 (Thread-80): 20:33:48  Parsing macros/adapters/persist_docs.sql
2022-04-22 20:33:48.910014 (Thread-80): 20:33:48  Parsing macros/adapters/relation.sql
2022-04-22 20:33:48.919207 (Thread-80): 20:33:48  Parsing macros/adapters/schema.sql
2022-04-22 20:33:48.921305 (Thread-80): 20:33:48  Parsing macros/adapters/indexes.sql
2022-04-22 20:33:48.923923 (Thread-80): 20:33:48  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 20:33:48.926302 (Thread-80): 20:33:48  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 20:33:48.927766 (Thread-80): 20:33:48  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 20:33:48.929280 (Thread-80): 20:33:48  Parsing macros/etc/datetime.sql
2022-04-22 20:33:48.937359 (Thread-80): 20:33:48  Parsing macros/etc/statement.sql
2022-04-22 20:33:48.941726 (Thread-80): 20:33:48  Parsing macros/generic_test_sql/unique.sql
2022-04-22 20:33:48.942477 (Thread-80): 20:33:48  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 20:33:48.943045 (Thread-80): 20:33:48  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 20:33:48.944372 (Thread-80): 20:33:48  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 20:33:48.945254 (Thread-80): 20:33:48  Parsing macros/materializations/configs.sql
2022-04-22 20:33:48.947501 (Thread-80): 20:33:48  Parsing macros/materializations/hooks.sql
2022-04-22 20:33:48.951182 (Thread-80): 20:33:48  Parsing macros/materializations/models/table/table.sql
2022-04-22 20:33:48.958462 (Thread-80): 20:33:48  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 20:33:48.961219 (Thread-80): 20:33:48  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 20:33:48.963820 (Thread-80): 20:33:48  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 20:33:48.965097 (Thread-80): 20:33:48  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 20:33:48.967358 (Thread-80): 20:33:48  Parsing macros/materializations/models/view/view.sql
2022-04-22 20:33:48.974594 (Thread-80): 20:33:48  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 20:33:48.984408 (Thread-80): 20:33:48  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 20:33:48.999518 (Thread-80): 20:33:48  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 20:33:49.001032 (Thread-80): 20:33:49  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 20:33:49.011979 (Thread-80): 20:33:49  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 20:33:49.016297 (Thread-80): 20:33:49  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 20:33:49.032523 (Thread-80): 20:33:49  Parsing macros/materializations/seeds/seed.sql
2022-04-22 20:33:49.038451 (Thread-80): 20:33:49  Parsing macros/materializations/tests/helpers.sql
2022-04-22 20:33:49.040723 (Thread-80): 20:33:49  Parsing macros/materializations/tests/test.sql
2022-04-22 20:33:49.045096 (Thread-80): 20:33:49  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 20:33:49.047073 (Thread-80): 20:33:49  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 20:33:49.058506 (Thread-80): 20:33:49  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 20:33:49.075352 (Thread-80): 20:33:49  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 20:33:49.077274 (Thread-80): 20:33:49  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 20:33:49.088615 (Thread-80): 20:33:49  Parsing tests/generic/builtin.sql
2022-04-22 20:33:49.276372 (Thread-80): 20:33:49  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:33:49.280287 (Thread-80): 20:33:49  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 20:33:49.283639 (Thread-80): 20:33:49  1603: static parser failed on _archive/test_loop.sql
2022-04-22 20:33:49.289918 (Thread-80): 20:33:49  1602: parser fallback to jinja rendering on _archive/test_loop.sql
2022-04-22 20:33:49.291766 (Thread-80): 20:33:49  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 20:33:49.294929 (Thread-80): 20:33:49  1699: static parser successfully parsed staging/stg_payments.sql
2022-04-22 20:33:49.298175 (Thread-80): 20:33:49  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 20:33:49.301477 (Thread-80): 20:33:49  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 20:33:49.304481 (Thread-80): 20:33:49  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 20:33:49.307508 (Thread-80): 20:33:49  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 20:33:49.310724 (Thread-80): 20:33:49  1699: static parser successfully parsed intermediate/user_type.sql
2022-04-22 20:33:49.314526 (Thread-80): 20:33:49  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:33:49.379434 (Thread-80): 20:33:49  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:33:49.384903 (Thread-80): 20:33:49  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309966b730>]}
2022-04-22 20:33:49.504468 (Thread-81): handling status request
2022-04-22 20:33:49.504895 (Thread-81): 20:33:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309966b7c0>]}
2022-04-22 20:33:49.505905 (Thread-81): sending response (<Response 19074 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:33:49.525413 (Thread-82): handling status request
2022-04-22 20:33:49.525847 (Thread-82): 20:33:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309966bee0>]}
2022-04-22 20:33:49.526786 (Thread-82): sending response (<Response 19074 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:40:01.416838 (Thread-83): 20:40:01  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 20:40:01.418260 (Thread-83): 20:40:01  Partial parsing: updated file: my_new_project://models/_archive/test_loop.sql
2022-04-22 20:40:01.422573 (Thread-83): 20:40:01  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-22 20:40:01.460362 (Thread-83): 20:40:01  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:40:01.469119 (Thread-83): 20:40:01  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30995b4d60>]}
2022-04-22 20:40:02.273628 (Thread-84): handling status request
2022-04-22 20:40:02.274008 (Thread-84): 20:40:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30996267f0>]}
2022-04-22 20:40:02.274499 (Thread-84): sending response (<Response 2002 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:40:02.278288 (Thread-85): handling status request
2022-04-22 20:40:02.278549 (Thread-85): 20:40:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099626e80>]}
2022-04-22 20:40:02.278919 (Thread-85): sending response (<Response 2002 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:45:41.697059 (Thread-86): handling status request
2022-04-22 20:45:41.698389 (Thread-86): 20:45:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099632610>]}
2022-04-22 20:45:41.698884 (Thread-86): sending response (<Response 2002 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:45:41.994998 (Thread-87): handling compile_sql request
2022-04-22 20:45:41.995393 (Thread-87): 20:45:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099632490>]}
2022-04-22 20:45:44.547645 (Thread-87): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:45:44.574450 (MainThread): 20:45:44  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c959d34b-508f-4031-9971-3b53e8aaac52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f063527fc40>]}
2022-04-22 20:45:44.574999 (MainThread): 20:45:44  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:45:44.575570 (Thread-1): 20:45:44  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:45:44.575700 (Thread-1): 20:45:44  Began compiling node rpc.my_new_project.request
2022-04-22 20:45:44.575790 (Thread-1): 20:45:44  Compiling rpc.my_new_project.request
2022-04-22 20:45:44.578362 (Thread-1): 20:45:44  finished collecting timing info
2022-04-22 20:45:44.578490 (Thread-1): 20:45:44  Began executing node rpc.my_new_project.request
2022-04-22 20:45:44.578584 (Thread-1): 20:45:44  finished collecting timing info
2022-04-22 20:45:44.882137 (Thread-88): handling poll request
2022-04-22 20:45:44.882563 (Thread-88): 20:45:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30995b4a30>]}
2022-04-22 20:45:44.883779 (Thread-88): sending response (<Response 9183 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:46:05.207840 (Thread-89): handling status request
2022-04-22 20:46:05.208233 (Thread-89): 20:46:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30995b7e20>]}
2022-04-22 20:46:05.208785 (Thread-89): sending response (<Response 2002 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:46:05.499749 (Thread-90): handling compile_sql request
2022-04-22 20:46:05.500167 (Thread-90): 20:46:05  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30995b70d0>]}
2022-04-22 20:46:08.082972 (Thread-90): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:46:08.110380 (MainThread): 20:46:08  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '478fad46-5121-4df6-a97a-fef14a449590', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde890f3c40>]}
2022-04-22 20:46:08.111159 (MainThread): 20:46:08  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:46:08.111843 (Thread-1): 20:46:08  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:46:08.111973 (Thread-1): 20:46:08  Began compiling node rpc.my_new_project.request
2022-04-22 20:46:08.112066 (Thread-1): 20:46:08  Compiling rpc.my_new_project.request
2022-04-22 20:46:08.114756 (Thread-1): 20:46:08  finished collecting timing info
2022-04-22 20:46:08.114890 (Thread-1): 20:46:08  Began executing node rpc.my_new_project.request
2022-04-22 20:46:08.114989 (Thread-1): 20:46:08  finished collecting timing info
2022-04-22 20:46:08.437074 (Thread-91): handling poll request
2022-04-22 20:46:08.437520 (Thread-91): 20:46:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309965d520>]}
2022-04-22 20:46:08.461355 (Thread-91): sending response (<Response 9190 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:46:26.494216 (Thread-92): handling status request
2022-04-22 20:46:26.494677 (Thread-92): 20:46:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bd73820>]}
2022-04-22 20:46:26.495231 (Thread-92): sending response (<Response 2002 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:46:26.802061 (Thread-93): handling compile_sql request
2022-04-22 20:46:26.802452 (Thread-93): 20:46:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309965d490>]}
2022-04-22 20:46:29.395412 (Thread-93): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:46:29.420785 (MainThread): 20:46:29  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '706d1edf-a5a6-4177-afe8-eb157bf80393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd05d33c70>]}
2022-04-22 20:46:29.421351 (MainThread): 20:46:29  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:46:29.421971 (Thread-1): 20:46:29  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:46:29.422099 (Thread-1): 20:46:29  Began compiling node rpc.my_new_project.request
2022-04-22 20:46:29.422190 (Thread-1): 20:46:29  Compiling rpc.my_new_project.request
2022-04-22 20:46:29.424874 (Thread-1): 20:46:29  finished collecting timing info
2022-04-22 20:46:29.425011 (Thread-1): 20:46:29  Began executing node rpc.my_new_project.request
2022-04-22 20:46:29.425111 (Thread-1): 20:46:29  finished collecting timing info
2022-04-22 20:46:29.853879 (Thread-94): handling poll request
2022-04-22 20:46:29.854329 (Thread-94): 20:46:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30996569a0>]}
2022-04-22 20:46:29.855547 (Thread-94): sending response (<Response 9180 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:01.452712 (Thread-95): 20:48:01  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 20:48:01.454372 (Thread-95): 20:48:01  Partial parsing: updated file: my_new_project://models/staging/stg_payments.sql
2022-04-22 20:48:01.461855 (Thread-95): 20:48:01  1603: static parser failed on staging/stg_payments.sql
2022-04-22 20:48:01.468509 (Thread-95): 20:48:01  1602: parser fallback to jinja rendering on staging/stg_payments.sql
2022-04-22 20:48:01.504544 (Thread-95): 20:48:01  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:48:01.509862 (Thread-95): 20:48:01  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099509b80>]}
2022-04-22 20:48:02.241433 (Thread-96): handling status request
2022-04-22 20:48:02.241867 (Thread-96): 20:48:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099558910>]}
2022-04-22 20:48:02.242404 (Thread-96): sending response (<Response 2305 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:02.296059 (Thread-97): handling status request
2022-04-22 20:48:02.296514 (Thread-97): 20:48:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bd1ed00>]}
2022-04-22 20:48:02.297047 (Thread-97): sending response (<Response 2305 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:03.499873 (Thread-98): handling status request
2022-04-22 20:48:03.500271 (Thread-98): 20:48:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099558cd0>]}
2022-04-22 20:48:03.500762 (Thread-98): sending response (<Response 2305 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:03.836501 (Thread-99): handling run_sql request
2022-04-22 20:48:03.836895 (Thread-99): 20:48:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099558af0>]}
2022-04-22 20:48:06.395638 (Thread-99): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:06.421382 (MainThread): 20:48:06  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '871c0e8f-063a-4b01-b25f-456090150bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43b72aac10>]}
2022-04-22 20:48:06.421968 (MainThread): 20:48:06  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:48:06.422562 (Thread-1): 20:48:06  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:48:06.422695 (Thread-1): 20:48:06  Began compiling node rpc.my_new_project.request
2022-04-22 20:48:06.422819 (Thread-1): 20:48:06  Compiling rpc.my_new_project.request
2022-04-22 20:48:06.425808 (Thread-1): 20:48:06  finished collecting timing info
2022-04-22 20:48:06.425942 (Thread-1): 20:48:06  Began executing node rpc.my_new_project.request
2022-04-22 20:48:06.427033 (Thread-1): 20:48:06  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:48:06.427125 (Thread-1): 20:48:06  On rpc.my_new_project.request: with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:48:06.427205 (Thread-1): 20:48:06  Opening a new connection, currently in state init
2022-04-22 20:48:06.753418 (Thread-100): handling poll request
2022-04-22 20:48:06.753911 (Thread-100): 20:48:06  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099509b80>]}
2022-04-22 20:48:06.754842 (Thread-100): sending response (<Response 4415 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:08.072152 (Thread-101): handling poll request
2022-04-22 20:48:08.072560 (Thread-101): 20:48:08  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099509c70>]}
2022-04-22 20:48:08.073090 (Thread-101): sending response (<Response 393 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:08.200882 (Thread-1): 20:48:08  SQL status: SUCCESS 500 in 1.77 seconds
2022-04-22 20:48:08.215189 (Thread-1): 20:48:08  finished collecting timing info
2022-04-22 20:48:08.215456 (Thread-1): 20:48:08  On rpc.my_new_project.request: Close
2022-04-22 20:48:09.393660 (Thread-102): handling poll request
2022-04-22 20:48:09.394056 (Thread-102): 20:48:09  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30995c7c70>]}
2022-04-22 20:48:09.397523 (Thread-102): sending response (<Response 24289 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:20.627617 (Thread-103): 20:48:20  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 20:48:20.627989 (Thread-103): 20:48:20  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 20:48:20.628944 (Thread-103): 20:48:20  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:48:20.635973 (Thread-103): 20:48:20  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f308804bf10>]}
2022-04-22 20:48:21.298229 (Thread-104): handling status request
2022-04-22 20:48:21.298629 (Thread-104): 20:48:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080180b50>]}
2022-04-22 20:48:21.299146 (Thread-104): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:21.312645 (Thread-105): handling status request
2022-04-22 20:48:21.313032 (Thread-105): 20:48:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080180940>]}
2022-04-22 20:48:21.313491 (Thread-105): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:24.718307 (Thread-106): 20:48:24  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 20:48:24.718836 (Thread-106): 20:48:24  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 20:48:24.724452 (Thread-106): 20:48:24  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:48:24.759075 (Thread-106): 20:48:24  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:48:24.766617 (Thread-106): 20:48:24  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f308009feb0>]}
2022-04-22 20:48:25.384486 (Thread-107): handling status request
2022-04-22 20:48:25.384900 (Thread-107): 20:48:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5e51f0>]}
2022-04-22 20:48:25.385431 (Thread-107): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:25.400537 (Thread-108): handling status request
2022-04-22 20:48:25.401038 (Thread-108): 20:48:25  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5e5c10>]}
2022-04-22 20:48:25.401815 (Thread-108): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:27.153131 (Thread-109): 20:48:27  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 20:48:27.153610 (Thread-109): 20:48:27  Partial parsing: updated file: my_new_project://models/_archive/stg_query.sql
2022-04-22 20:48:27.157962 (Thread-109): 20:48:27  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:48:27.194173 (Thread-109): 20:48:27  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:48:27.199420 (Thread-109): 20:48:27  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800c0e20>]}
2022-04-22 20:48:27.898673 (Thread-110): handling status request
2022-04-22 20:48:27.899064 (Thread-110): 20:48:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30801176d0>]}
2022-04-22 20:48:27.899546 (Thread-110): sending response (<Response 2007 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:48:27.936526 (Thread-111): handling status request
2022-04-22 20:48:27.936933 (Thread-111): 20:48:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800f9ee0>]}
2022-04-22 20:48:27.937435 (Thread-111): sending response (<Response 2007 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:23.501333 (Thread-112): 20:49:23  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 20:49:23.501812 (Thread-112): 20:49:23  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 20:49:23.506505 (Thread-112): 20:49:23  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:49:23.541799 (Thread-112): 20:49:23  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:49:23.547535 (Thread-112): 20:49:23  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080030520>]}
2022-04-22 20:49:24.202833 (Thread-113): handling status request
2022-04-22 20:49:24.203227 (Thread-113): 20:49:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f308804bf10>]}
2022-04-22 20:49:24.203716 (Thread-113): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:24.243253 (Thread-114): handling status request
2022-04-22 20:49:24.243631 (Thread-114): 20:49:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f308017c9d0>]}
2022-04-22 20:49:24.244103 (Thread-114): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:35.188156 (Thread-115): handling status request
2022-04-22 20:49:35.188552 (Thread-115): 20:49:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30801170d0>]}
2022-04-22 20:49:35.189030 (Thread-115): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:35.629282 (Thread-116): handling cli_args request
2022-04-22 20:49:35.629722 (Thread-116): 20:49:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30801173a0>]}
2022-04-22 20:49:35.633038 (Thread-117): handling status request
2022-04-22 20:49:35.633713 (Thread-117): 20:49:35  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3099566340>]}
2022-04-22 20:49:35.634264 (Thread-117): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:38.160451 (Thread-116): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:38.207607 (MainThread): 20:49:38  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 20:49:38.208016 (MainThread): 20:49:38  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76e361a5b0>]}
2022-04-22 20:49:38.251960 (MainThread): 20:49:38  Parsing macros/adapters.sql
2022-04-22 20:49:38.290003 (MainThread): 20:49:38  Parsing macros/catalog.sql
2022-04-22 20:49:38.291862 (MainThread): 20:49:38  Parsing macros/materializations/table.sql
2022-04-22 20:49:38.294870 (MainThread): 20:49:38  Parsing macros/materializations/seed.sql
2022-04-22 20:49:38.299929 (MainThread): 20:49:38  Parsing macros/materializations/incremental.sql
2022-04-22 20:49:38.308240 (MainThread): 20:49:38  Parsing macros/materializations/merge.sql
2022-04-22 20:49:38.311964 (MainThread): 20:49:38  Parsing macros/materializations/snapshot.sql
2022-04-22 20:49:38.312837 (MainThread): 20:49:38  Parsing macros/materializations/view.sql
2022-04-22 20:49:38.314115 (MainThread): 20:49:38  Parsing macros/adapters/metadata.sql
2022-04-22 20:49:38.320949 (MainThread): 20:49:38  Parsing macros/adapters/columns.sql
2022-04-22 20:49:38.330499 (MainThread): 20:49:38  Parsing macros/adapters/freshness.sql
2022-04-22 20:49:38.333317 (MainThread): 20:49:38  Parsing macros/adapters/persist_docs.sql
2022-04-22 20:49:38.337625 (MainThread): 20:49:38  Parsing macros/adapters/relation.sql
2022-04-22 20:49:38.347057 (MainThread): 20:49:38  Parsing macros/adapters/schema.sql
2022-04-22 20:49:38.349134 (MainThread): 20:49:38  Parsing macros/adapters/indexes.sql
2022-04-22 20:49:38.351718 (MainThread): 20:49:38  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 20:49:38.354188 (MainThread): 20:49:38  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 20:49:38.355586 (MainThread): 20:49:38  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 20:49:38.357043 (MainThread): 20:49:38  Parsing macros/etc/datetime.sql
2022-04-22 20:49:38.365306 (MainThread): 20:49:38  Parsing macros/etc/statement.sql
2022-04-22 20:49:38.369640 (MainThread): 20:49:38  Parsing macros/generic_test_sql/unique.sql
2022-04-22 20:49:38.370315 (MainThread): 20:49:38  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 20:49:38.370833 (MainThread): 20:49:38  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 20:49:38.372107 (MainThread): 20:49:38  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 20:49:38.373029 (MainThread): 20:49:38  Parsing macros/materializations/configs.sql
2022-04-22 20:49:38.375285 (MainThread): 20:49:38  Parsing macros/materializations/hooks.sql
2022-04-22 20:49:38.379051 (MainThread): 20:49:38  Parsing macros/materializations/models/table/table.sql
2022-04-22 20:49:38.386317 (MainThread): 20:49:38  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 20:49:38.389135 (MainThread): 20:49:38  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 20:49:38.391674 (MainThread): 20:49:38  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 20:49:38.392895 (MainThread): 20:49:38  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 20:49:38.395208 (MainThread): 20:49:38  Parsing macros/materializations/models/view/view.sql
2022-04-22 20:49:38.402127 (MainThread): 20:49:38  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 20:49:38.411908 (MainThread): 20:49:38  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 20:49:38.427101 (MainThread): 20:49:38  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 20:49:38.428515 (MainThread): 20:49:38  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 20:49:38.439486 (MainThread): 20:49:38  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 20:49:38.443791 (MainThread): 20:49:38  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 20:49:38.459728 (MainThread): 20:49:38  Parsing macros/materializations/seeds/seed.sql
2022-04-22 20:49:38.465525 (MainThread): 20:49:38  Parsing macros/materializations/tests/helpers.sql
2022-04-22 20:49:38.467329 (MainThread): 20:49:38  Parsing macros/materializations/tests/test.sql
2022-04-22 20:49:38.471656 (MainThread): 20:49:38  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 20:49:38.506311 (Thread-118): handling poll request
2022-04-22 20:49:38.506787 (Thread-118): 20:49:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080117370>]}
2022-04-22 20:49:38.508094 (Thread-118): sending response (<Response 13266 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:38.473365 (MainThread): 20:49:38  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 20:49:38.484286 (MainThread): 20:49:38  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 20:49:38.501035 (MainThread): 20:49:38  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 20:49:38.502718 (MainThread): 20:49:38  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 20:49:38.514036 (MainThread): 20:49:38  Parsing tests/generic/builtin.sql
2022-04-22 20:49:38.705109 (MainThread): 20:49:38  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:49:38.716052 (MainThread): 20:49:38  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 20:49:38.718049 (MainThread): 20:49:38  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-22 20:49:38.719879 (MainThread): 20:49:38  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 20:49:38.721877 (MainThread): 20:49:38  1603: static parser failed on staging/stg_payments.sql
2022-04-22 20:49:38.725299 (MainThread): 20:49:38  1602: parser fallback to jinja rendering on staging/stg_payments.sql
2022-04-22 20:49:38.726244 (MainThread): 20:49:38  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 20:49:38.728158 (MainThread): 20:49:38  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 20:49:38.730291 (MainThread): 20:49:38  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 20:49:38.732378 (MainThread): 20:49:38  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 20:49:38.734343 (MainThread): 20:49:38  1699: static parser successfully parsed intermediate/user_type.sql
2022-04-22 20:49:38.736795 (MainThread): 20:49:38  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:49:38.802907 (MainThread): 20:49:38  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:49:38.807810 (MainThread): 20:49:38  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76e0cd3700>]}
2022-04-22 20:49:38.848482 (MainThread): 20:49:38  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76e3538640>]}
2022-04-22 20:49:38.848773 (MainThread): 20:49:38  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:49:38.850353 (MainThread): 20:49:38  
2022-04-22 20:49:38.850666 (MainThread): 20:49:38  Acquiring new snowflake connection "master"
2022-04-22 20:49:38.851932 (ThreadPoolExecutor-0_0): 20:49:38  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 20:49:38.864644 (ThreadPoolExecutor-0_0): 20:49:38  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 20:49:38.864752 (ThreadPoolExecutor-0_0): 20:49:38  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 20:49:38.864837 (ThreadPoolExecutor-0_0): 20:49:38  Opening a new connection, currently in state init
2022-04-22 20:49:39.830626 (Thread-119): handling poll request
2022-04-22 20:49:39.831024 (Thread-119): 20:49:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30880228b0>]}
2022-04-22 20:49:39.831771 (Thread-119): sending response (<Response 9128 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:40.258265 (ThreadPoolExecutor-0_0): 20:49:40  SQL status: SUCCESS 4 in 1.39 seconds
2022-04-22 20:49:40.260363 (ThreadPoolExecutor-0_0): 20:49:40  On list_PE_ALEXANDER_B: Close
2022-04-22 20:49:40.464953 (ThreadPoolExecutor-2_0): 20:49:40  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 20:49:40.472395 (ThreadPoolExecutor-2_0): 20:49:40  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 20:49:40.472546 (ThreadPoolExecutor-2_0): 20:49:40  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 20:49:40.472647 (ThreadPoolExecutor-2_0): 20:49:40  Opening a new connection, currently in state closed
2022-04-22 20:49:41.160208 (Thread-120): handling poll request
2022-04-22 20:49:41.160599 (Thread-120): 20:49:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080182070>]}
2022-04-22 20:49:41.161181 (Thread-120): sending response (<Response 2373 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:41.420747 (ThreadPoolExecutor-2_0): 20:49:41  SQL status: SUCCESS 8 in 0.95 seconds
2022-04-22 20:49:41.422426 (ThreadPoolExecutor-2_0): 20:49:41  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 20:49:41.679361 (MainThread): 20:49:41  Concurrency: 4 threads (target='default')
2022-04-22 20:49:41.679546 (MainThread): 20:49:41  
2022-04-22 20:49:41.682587 (Thread-1): 20:49:41  Began running node model.my_new_project.orginal_query
2022-04-22 20:49:41.682939 (Thread-1): 20:49:41  1 of 11 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 20:49:41.683213 (Thread-1): 20:49:41  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 20:49:41.683319 (Thread-1): 20:49:41  Began compiling node model.my_new_project.orginal_query
2022-04-22 20:49:41.683456 (Thread-1): 20:49:41  Compiling model.my_new_project.orginal_query
2022-04-22 20:49:41.754367 (Thread-2): 20:49:41  Began running node model.my_new_project.stg_ctry_type
2022-04-22 20:49:41.754689 (Thread-2): 20:49:41  2 of 11 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 20:49:41.755034 (Thread-2): 20:49:41  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 20:49:41.755136 (Thread-2): 20:49:41  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 20:49:41.755224 (Thread-2): 20:49:41  Compiling model.my_new_project.stg_ctry_type
2022-04-22 20:49:41.757534 (Thread-2): 20:49:41  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 20:49:41.758068 (Thread-3): 20:49:41  Began running node model.my_new_project.stg_device_orders
2022-04-22 20:49:41.758313 (Thread-3): 20:49:41  3 of 11 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 20:49:41.758573 (Thread-3): 20:49:41  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 20:49:41.758665 (Thread-3): 20:49:41  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 20:49:41.758760 (Thread-3): 20:49:41  Compiling model.my_new_project.stg_device_orders
2022-04-22 20:49:41.760785 (Thread-3): 20:49:41  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 20:49:41.761233 (Thread-4): 20:49:41  Began running node model.my_new_project.stg_orders
2022-04-22 20:49:41.761482 (Thread-4): 20:49:41  4 of 11 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 20:49:41.761775 (Thread-4): 20:49:41  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 20:49:41.761932 (Thread-4): 20:49:41  Began compiling node model.my_new_project.stg_orders
2022-04-22 20:49:41.762026 (Thread-4): 20:49:41  Compiling model.my_new_project.stg_orders
2022-04-22 20:49:41.763945 (Thread-4): 20:49:41  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 20:49:41.766021 (Thread-1): 20:49:41  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 20:49:41.766151 (Thread-1): 20:49:41  finished collecting timing info
2022-04-22 20:49:41.766263 (Thread-1): 20:49:41  Began executing node model.my_new_project.orginal_query
2022-04-22 20:49:41.784492 (Thread-2): 20:49:41  finished collecting timing info
2022-04-22 20:49:41.784655 (Thread-2): 20:49:41  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 20:49:41.789996 (Thread-3): 20:49:41  finished collecting timing info
2022-04-22 20:49:41.790138 (Thread-3): 20:49:41  Began executing node model.my_new_project.stg_device_orders
2022-04-22 20:49:41.799387 (Thread-2): 20:49:41  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 20:49:41.800081 (Thread-1): 20:49:41  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 20:49:41.800291 (Thread-4): 20:49:41  finished collecting timing info
2022-04-22 20:49:41.800429 (Thread-4): 20:49:41  Began executing node model.my_new_project.stg_orders
2022-04-22 20:49:41.802351 (Thread-4): 20:49:41  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 20:49:41.805087 (Thread-3): 20:49:41  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 20:49:41.815648 (Thread-2): 20:49:41  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 20:49:41.815780 (Thread-2): 20:49:41  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 20:49:41.815873 (Thread-2): 20:49:41  Opening a new connection, currently in state init
2022-04-22 20:49:41.818995 (Thread-3): 20:49:41  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 20:49:41.819123 (Thread-3): 20:49:41  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 20:49:41.819213 (Thread-3): 20:49:41  Opening a new connection, currently in state init
2022-04-22 20:49:41.820443 (Thread-4): 20:49:41  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 20:49:41.820549 (Thread-4): 20:49:41  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
  );
2022-04-22 20:49:41.820631 (Thread-4): 20:49:41  Opening a new connection, currently in state init
2022-04-22 20:49:41.821348 (Thread-1): 20:49:41  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 20:49:41.821455 (Thread-1): 20:49:41  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    
  );
2022-04-22 20:49:41.821539 (Thread-1): 20:49:41  Opening a new connection, currently in state closed
2022-04-22 20:49:42.483131 (Thread-121): handling poll request
2022-04-22 20:49:42.483576 (Thread-121): 20:49:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080082100>]}
2022-04-22 20:49:42.508551 (Thread-121): sending response (<Response 22821 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:42.940441 (Thread-1): 20:49:42  Snowflake adapter: Snowflake query id: 01a3c8e1-0501-61f2-0004-7d83048c7cfe
2022-04-22 20:49:42.940618 (Thread-1): 20:49:42  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:49:42.940799 (Thread-1): 20:49:42  finished collecting timing info
2022-04-22 20:49:42.940947 (Thread-1): 20:49:42  On model.my_new_project.orginal_query: Close
2022-04-22 20:49:43.067248 (Thread-4): 20:49:43  SQL status: SUCCESS 1 in 1.25 seconds
2022-04-22 20:49:43.073918 (Thread-4): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.074091 (Thread-4): 20:49:43  On model.my_new_project.stg_orders: Close
2022-04-22 20:49:43.098383 (Thread-2): 20:49:43  SQL status: SUCCESS 1 in 1.28 seconds
2022-04-22 20:49:43.099797 (Thread-2): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.099958 (Thread-2): 20:49:43  On model.my_new_project.stg_ctry_type: Close
2022-04-22 20:49:43.121354 (Thread-3): 20:49:43  SQL status: SUCCESS 1 in 1.3 seconds
2022-04-22 20:49:43.122692 (Thread-3): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.122859 (Thread-3): 20:49:43  On model.my_new_project.stg_device_orders: Close
2022-04-22 20:49:43.157692 (Thread-1): 20:49:43  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 20:49:43.158138 (Thread-1): 20:49:43  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7718c822e0>]}
2022-04-22 20:49:43.158511 (Thread-1): 20:49:43  1 of 11 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.47s]
2022-04-22 20:49:43.158638 (Thread-1): 20:49:43  Finished running node model.my_new_project.orginal_query
2022-04-22 20:49:43.158803 (Thread-1): 20:49:43  Began running node model.my_new_project.stg_payments
2022-04-22 20:49:43.159004 (Thread-1): 20:49:43  5 of 11 START view model abrown_dbt_interview.stg_payments...................... [RUN]
2022-04-22 20:49:43.159259 (Thread-1): 20:49:43  Acquiring new snowflake connection "model.my_new_project.stg_payments"
2022-04-22 20:49:43.159353 (Thread-1): 20:49:43  Began compiling node model.my_new_project.stg_payments
2022-04-22 20:49:43.159443 (Thread-1): 20:49:43  Compiling model.my_new_project.stg_payments
2022-04-22 20:49:43.165867 (Thread-1): 20:49:43  Writing injected SQL for node "model.my_new_project.stg_payments"
2022-04-22 20:49:43.176583 (Thread-1): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.176744 (Thread-1): 20:49:43  Began executing node model.my_new_project.stg_payments
2022-04-22 20:49:43.178944 (Thread-1): 20:49:43  Writing runtime SQL for node "model.my_new_project.stg_payments"
2022-04-22 20:49:43.191245 (Thread-1): 20:49:43  Using snowflake connection "model.my_new_project.stg_payments"
2022-04-22 20:49:43.191380 (Thread-1): 20:49:43  On model.my_new_project.stg_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_payments 
  
   as (
    

with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
  );
2022-04-22 20:49:43.191474 (Thread-1): 20:49:43  Opening a new connection, currently in state closed
2022-04-22 20:49:43.289009 (Thread-4): 20:49:43  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76e0ccd460>]}
2022-04-22 20:49:43.289450 (Thread-4): 20:49:43  4 of 11 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 1.53s]
2022-04-22 20:49:43.289608 (Thread-4): 20:49:43  Finished running node model.my_new_project.stg_orders
2022-04-22 20:49:43.289758 (Thread-4): 20:49:43  Began running node model.my_new_project.stg_query
2022-04-22 20:49:43.289944 (Thread-4): 20:49:43  6 of 11 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 20:49:43.290194 (Thread-4): 20:49:43  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 20:49:43.290286 (Thread-4): 20:49:43  Began compiling node model.my_new_project.stg_query
2022-04-22 20:49:43.290375 (Thread-4): 20:49:43  Compiling model.my_new_project.stg_query
2022-04-22 20:49:43.294190 (Thread-4): 20:49:43  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 20:49:43.308416 (Thread-2): 20:49:43  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f77190dd850>]}
2022-04-22 20:49:43.308782 (Thread-2): 20:49:43  2 of 11 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 1.55s]
2022-04-22 20:49:43.308904 (Thread-2): 20:49:43  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 20:49:43.309040 (Thread-2): 20:49:43  Began running node model.my_new_project.test_conn
2022-04-22 20:49:43.309218 (Thread-2): 20:49:43  7 of 11 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 20:49:43.309451 (Thread-2): 20:49:43  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 20:49:43.309543 (Thread-2): 20:49:43  Began compiling node model.my_new_project.test_conn
2022-04-22 20:49:43.309692 (Thread-2): 20:49:43  Compiling model.my_new_project.test_conn
2022-04-22 20:49:43.311383 (Thread-2): 20:49:43  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 20:49:43.311499 (Thread-2): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.311604 (Thread-2): 20:49:43  Began executing node model.my_new_project.test_conn
2022-04-22 20:49:43.313571 (Thread-2): 20:49:43  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 20:49:43.320066 (Thread-4): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.320221 (Thread-4): 20:49:43  Began executing node model.my_new_project.stg_query
2022-04-22 20:49:43.322217 (Thread-4): 20:49:43  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 20:49:43.327207 (Thread-2): 20:49:43  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 20:49:43.327339 (Thread-2): 20:49:43  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    
  );
2022-04-22 20:49:43.327428 (Thread-2): 20:49:43  Opening a new connection, currently in state closed
2022-04-22 20:49:43.332000 (Thread-3): 20:49:43  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f77191b05e0>]}
2022-04-22 20:49:43.332340 (Thread-3): 20:49:43  3 of 11 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 1.57s]
2022-04-22 20:49:43.332457 (Thread-3): 20:49:43  Finished running node model.my_new_project.stg_device_orders
2022-04-22 20:49:43.332592 (Thread-3): 20:49:43  Began running node model.my_new_project.test_loop
2022-04-22 20:49:43.332768 (Thread-3): 20:49:43  8 of 11 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 20:49:43.332997 (Thread-3): 20:49:43  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 20:49:43.333088 (Thread-3): 20:49:43  Began compiling node model.my_new_project.test_loop
2022-04-22 20:49:43.333174 (Thread-3): 20:49:43  Compiling model.my_new_project.test_loop
2022-04-22 20:49:43.336604 (Thread-3): 20:49:43  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 20:49:43.336735 (Thread-3): 20:49:43  finished collecting timing info
2022-04-22 20:49:43.336842 (Thread-3): 20:49:43  Began executing node model.my_new_project.test_loop
2022-04-22 20:49:43.338780 (Thread-3): 20:49:43  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 20:49:43.352206 (Thread-4): 20:49:43  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 20:49:43.352354 (Thread-4): 20:49:43  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents, -- minor change to name here
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 20:49:43.352446 (Thread-4): 20:49:43  Opening a new connection, currently in state closed
2022-04-22 20:49:43.353626 (Thread-3): 20:49:43  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 20:49:43.353750 (Thread-3): 20:49:43  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    
  );
2022-04-22 20:49:43.353837 (Thread-3): 20:49:43  Opening a new connection, currently in state closed
2022-04-22 20:49:43.850274 (Thread-122): handling poll request
2022-04-22 20:49:43.850660 (Thread-122): 20:49:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080017130>]}
2022-04-22 20:49:43.851939 (Thread-122): sending response (<Response 36430 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:44.321459 (Thread-1): 20:49:44  SQL status: SUCCESS 1 in 1.13 seconds
2022-04-22 20:49:44.323001 (Thread-1): 20:49:44  finished collecting timing info
2022-04-22 20:49:44.323173 (Thread-1): 20:49:44  On model.my_new_project.stg_payments: Close
2022-04-22 20:49:44.519271 (Thread-2): 20:49:44  Snowflake adapter: Snowflake query id: 01a3c8e1-0501-61f2-0004-7d83048c7d0e
2022-04-22 20:49:44.519439 (Thread-2): 20:49:44  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:49:44.519609 (Thread-2): 20:49:44  finished collecting timing info
2022-04-22 20:49:44.519746 (Thread-2): 20:49:44  On model.my_new_project.test_conn: Close
2022-04-22 20:49:44.541828 (Thread-3): 20:49:44  Snowflake adapter: Snowflake query id: 01a3c8e1-0501-616b-0004-7d83048c8aca
2022-04-22 20:49:44.541987 (Thread-3): 20:49:44  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:49:44.542155 (Thread-3): 20:49:44  finished collecting timing info
2022-04-22 20:49:44.542293 (Thread-3): 20:49:44  On model.my_new_project.test_loop: Close
2022-04-22 20:49:44.597867 (Thread-1): 20:49:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7717c62a90>]}
2022-04-22 20:49:44.598296 (Thread-1): 20:49:44  5 of 11 OK created view model abrown_dbt_interview.stg_payments................. [SUCCESS 1 in 1.44s]
2022-04-22 20:49:44.598424 (Thread-1): 20:49:44  Finished running node model.my_new_project.stg_payments
2022-04-22 20:49:44.598573 (Thread-1): 20:49:44  Began running node model.my_new_project.stg_first_order
2022-04-22 20:49:44.598774 (Thread-1): 20:49:44  9 of 11 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 20:49:44.599026 (Thread-1): 20:49:44  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 20:49:44.599119 (Thread-1): 20:49:44  Began compiling node model.my_new_project.stg_first_order
2022-04-22 20:49:44.599210 (Thread-1): 20:49:44  Compiling model.my_new_project.stg_first_order
2022-04-22 20:49:44.601422 (Thread-1): 20:49:44  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 20:49:44.613076 (Thread-1): 20:49:44  finished collecting timing info
2022-04-22 20:49:44.613245 (Thread-1): 20:49:44  Began executing node model.my_new_project.stg_first_order
2022-04-22 20:49:44.616013 (Thread-1): 20:49:44  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 20:49:44.626948 (Thread-1): 20:49:44  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 20:49:44.627084 (Thread-1): 20:49:44  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 20:49:44.627178 (Thread-1): 20:49:44  Opening a new connection, currently in state closed
2022-04-22 20:49:44.729742 (Thread-2): 20:49:44  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 20:49:44.730052 (Thread-2): 20:49:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7717b6e670>]}
2022-04-22 20:49:44.730654 (Thread-2): 20:49:44  7 of 11 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 1.42s]
2022-04-22 20:49:44.730820 (Thread-2): 20:49:44  Finished running node model.my_new_project.test_conn
2022-04-22 20:49:44.755759 (Thread-3): 20:49:44  Database Error in model test_loop (models/_archive/test_loop.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_loop.sql
2022-04-22 20:49:44.756045 (Thread-3): 20:49:44  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7717be4040>]}
2022-04-22 20:49:44.756388 (Thread-3): 20:49:44  8 of 11 ERROR creating view model abrown_dbt_interview.test_loop................ [ERROR in 1.42s]
2022-04-22 20:49:44.756507 (Thread-3): 20:49:44  Finished running node model.my_new_project.test_loop
2022-04-22 20:49:44.923889 (Thread-4): 20:49:44  SQL status: SUCCESS 1 in 1.57 seconds
2022-04-22 20:49:44.925397 (Thread-4): 20:49:44  finished collecting timing info
2022-04-22 20:49:44.925567 (Thread-4): 20:49:44  On model.my_new_project.stg_query: Close
2022-04-22 20:49:45.162348 (Thread-4): 20:49:45  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7717befc70>]}
2022-04-22 20:49:45.162798 (Thread-4): 20:49:45  6 of 11 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.87s]
2022-04-22 20:49:45.162927 (Thread-4): 20:49:45  Finished running node model.my_new_project.stg_query
2022-04-22 20:49:45.195818 (Thread-123): handling poll request
2022-04-22 20:49:45.196209 (Thread-123): 20:49:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5e5520>]}
2022-04-22 20:49:45.197079 (Thread-123): sending response (<Response 17779 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:45.444825 (Thread-1): 20:49:45  SQL status: SUCCESS 1 in 0.82 seconds
2022-04-22 20:49:45.446435 (Thread-1): 20:49:45  finished collecting timing info
2022-04-22 20:49:45.446603 (Thread-1): 20:49:45  On model.my_new_project.stg_first_order: Close
2022-04-22 20:49:45.659325 (Thread-1): 20:49:45  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f77112860d0>]}
2022-04-22 20:49:45.659748 (Thread-1): 20:49:45  9 of 11 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 1.06s]
2022-04-22 20:49:45.659874 (Thread-1): 20:49:45  Finished running node model.my_new_project.stg_first_order
2022-04-22 20:49:45.660944 (Thread-2): 20:49:45  Began running node model.my_new_project.fct_final
2022-04-22 20:49:45.661297 (Thread-2): 20:49:45  10 of 11 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 20:49:45.661609 (Thread-2): 20:49:45  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 20:49:45.661722 (Thread-2): 20:49:45  Began compiling node model.my_new_project.fct_final
2022-04-22 20:49:45.661817 (Thread-2): 20:49:45  Compiling model.my_new_project.fct_final
2022-04-22 20:49:45.664991 (Thread-2): 20:49:45  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 20:49:45.665220 (Thread-3): 20:49:45  Began running node model.my_new_project.user_type
2022-04-22 20:49:45.665452 (Thread-3): 20:49:45  11 of 11 START view model abrown_dbt_interview.user_type........................ [RUN]
2022-04-22 20:49:45.665736 (Thread-3): 20:49:45  Acquiring new snowflake connection "model.my_new_project.user_type"
2022-04-22 20:49:45.665834 (Thread-3): 20:49:45  Began compiling node model.my_new_project.user_type
2022-04-22 20:49:45.665919 (Thread-3): 20:49:45  Compiling model.my_new_project.user_type
2022-04-22 20:49:45.668922 (Thread-3): 20:49:45  Writing injected SQL for node "model.my_new_project.user_type"
2022-04-22 20:49:45.677215 (Thread-2): 20:49:45  finished collecting timing info
2022-04-22 20:49:45.677388 (Thread-2): 20:49:45  Began executing node model.my_new_project.fct_final
2022-04-22 20:49:45.680025 (Thread-2): 20:49:45  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 20:49:45.683895 (Thread-3): 20:49:45  finished collecting timing info
2022-04-22 20:49:45.684040 (Thread-3): 20:49:45  Began executing node model.my_new_project.user_type
2022-04-22 20:49:45.685987 (Thread-3): 20:49:45  Writing runtime SQL for node "model.my_new_project.user_type"
2022-04-22 20:49:45.695056 (Thread-2): 20:49:45  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 20:49:45.695198 (Thread-2): 20:49:45  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 20:49:45.695292 (Thread-2): 20:49:45  Opening a new connection, currently in state closed
2022-04-22 20:49:45.700646 (Thread-3): 20:49:45  Using snowflake connection "model.my_new_project.user_type"
2022-04-22 20:49:45.700768 (Thread-3): 20:49:45  On model.my_new_project.user_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.user_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.user_type 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),
    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
    ut as (
        select
            o.order_id,
            case
                when fo.first_order_id = o.order_id then 'new'
                else 'repeat'
            end as user_type
        from o
        left join fo
            on o.user_id = fo.user_id

    )

select * from ut
  );
2022-04-22 20:49:45.700854 (Thread-3): 20:49:45  Opening a new connection, currently in state closed
2022-04-22 20:49:46.515572 (Thread-124): handling poll request
2022-04-22 20:49:46.515963 (Thread-124): 20:49:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080030d00>]}
2022-04-22 20:49:46.516761 (Thread-124): sending response (<Response 14866 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:46.777634 (Thread-3): 20:49:46  SQL status: SUCCESS 1 in 1.08 seconds
2022-04-22 20:49:46.779149 (Thread-3): 20:49:46  finished collecting timing info
2022-04-22 20:49:46.779316 (Thread-3): 20:49:46  On model.my_new_project.user_type: Close
2022-04-22 20:49:46.850004 (Thread-2): 20:49:46  Snowflake adapter: Snowflake query id: 01a3c8e1-0501-61f2-0004-7d83048c7d1e
2022-04-22 20:49:46.850166 (Thread-2): 20:49:46  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.UT' does not exist or not authorized.
2022-04-22 20:49:46.850336 (Thread-2): 20:49:46  finished collecting timing info
2022-04-22 20:49:46.850474 (Thread-2): 20:49:46  On model.my_new_project.fct_final: Close
2022-04-22 20:49:47.012931 (Thread-3): 20:49:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f76e0cd80d0>]}
2022-04-22 20:49:47.013537 (Thread-3): 20:49:47  11 of 11 OK created view model abrown_dbt_interview.user_type................... [SUCCESS 1 in 1.35s]
2022-04-22 20:49:47.013724 (Thread-3): 20:49:47  Finished running node model.my_new_project.user_type
2022-04-22 20:49:47.043241 (Thread-2): 20:49:47  Database Error in model fct_final (models/marts/fct_final.sql)
  002003 (42S02): SQL compilation error:
  Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.UT' does not exist or not authorized.
  compiled SQL at target/run/my_new_project/models/marts/fct_final.sql
2022-04-22 20:49:47.043499 (Thread-2): 20:49:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6da4c67-b05d-4dff-9697-b910c2f4a58c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f77112bb1c0>]}
2022-04-22 20:49:47.043939 (Thread-2): 20:49:47  10 of 11 ERROR creating view model abrown_dbt_interview.fct_final............... [ERROR in 1.38s]
2022-04-22 20:49:47.044060 (Thread-2): 20:49:47  Finished running node model.my_new_project.fct_final
2022-04-22 20:49:47.045679 (MainThread): 20:49:47  Acquiring new snowflake connection "master"
2022-04-22 20:49:47.046044 (MainThread): 20:49:47  
2022-04-22 20:49:47.046154 (MainThread): 20:49:47  Finished running 11 view models in 8.20s.
2022-04-22 20:49:47.046243 (MainThread): 20:49:47  Connection 'master' was properly closed.
2022-04-22 20:49:47.046315 (MainThread): 20:49:47  Connection 'model.my_new_project.stg_first_order' was properly closed.
2022-04-22 20:49:47.046381 (MainThread): 20:49:47  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 20:49:47.046444 (MainThread): 20:49:47  Connection 'model.my_new_project.user_type' was properly closed.
2022-04-22 20:49:47.046506 (MainThread): 20:49:47  Connection 'model.my_new_project.stg_query' was properly closed.
2022-04-22 20:49:47.116583 (MainThread): 20:49:47  
2022-04-22 20:49:47.116807 (MainThread): 20:49:47  Completed with 4 errors and 0 warnings:
2022-04-22 20:49:47.116922 (MainThread): 20:49:47  
2022-04-22 20:49:47.117030 (MainThread): 20:49:47  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 20:49:47.117113 (MainThread): 20:49:47    001003 (42000): SQL compilation error:
2022-04-22 20:49:47.117184 (MainThread): 20:49:47    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:49:47.117254 (MainThread): 20:49:47    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 20:49:47.117327 (MainThread): 20:49:47  
2022-04-22 20:49:47.117406 (MainThread): 20:49:47  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 20:49:47.117476 (MainThread): 20:49:47    001003 (42000): SQL compilation error:
2022-04-22 20:49:47.117545 (MainThread): 20:49:47    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:49:47.117660 (MainThread): 20:49:47    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 20:49:47.117736 (MainThread): 20:49:47  
2022-04-22 20:49:47.117813 (MainThread): 20:49:47  Database Error in model test_loop (models/_archive/test_loop.sql)
2022-04-22 20:49:47.117882 (MainThread): 20:49:47    001003 (42000): SQL compilation error:
2022-04-22 20:49:47.117948 (MainThread): 20:49:47    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:49:47.118028 (MainThread): 20:49:47    compiled SQL at target/run/my_new_project/models/_archive/test_loop.sql
2022-04-22 20:49:47.118109 (MainThread): 20:49:47  
2022-04-22 20:49:47.118186 (MainThread): 20:49:47  Database Error in model fct_final (models/marts/fct_final.sql)
2022-04-22 20:49:47.118255 (MainThread): 20:49:47    002003 (42S02): SQL compilation error:
2022-04-22 20:49:47.118320 (MainThread): 20:49:47    Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.UT' does not exist or not authorized.
2022-04-22 20:49:47.118384 (MainThread): 20:49:47    compiled SQL at target/run/my_new_project/models/marts/fct_final.sql
2022-04-22 20:49:47.118469 (MainThread): 20:49:47  
2022-04-22 20:49:47.118552 (MainThread): 20:49:47  Done. PASS=7 WARN=0 ERROR=4 SKIP=0 TOTAL=11
2022-04-22 20:49:47.838147 (Thread-125): handling poll request
2022-04-22 20:49:47.838536 (Thread-125): 20:49:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f308001fb80>]}
2022-04-22 20:49:47.840587 (Thread-125): sending response (<Response 65757 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:48.663891 (Thread-126): handling status request
2022-04-22 20:49:48.664266 (Thread-126): 20:49:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800392e0>]}
2022-04-22 20:49:48.664779 (Thread-126): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:49:48.730442 (Thread-127): handling status request
2022-04-22 20:49:48.730838 (Thread-127): 20:49:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800393a0>]}
2022-04-22 20:49:48.731322 (Thread-127): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:50:13.864161 (Thread-128): handling status request
2022-04-22 20:50:13.864563 (Thread-128): 20:50:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800395b0>]}
2022-04-22 20:50:13.865047 (Thread-128): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:50:14.160473 (Thread-129): handling run_sql request
2022-04-22 20:50:14.160873 (Thread-129): 20:50:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080039760>]}
2022-04-22 20:50:16.776103 (Thread-129): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:50:16.803792 (MainThread): 20:50:16  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75889b46-fda8-438f-9426-e6b61d3d8333', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f45d8eb3ca0>]}
2022-04-22 20:50:16.804400 (MainThread): 20:50:16  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:50:16.805018 (Thread-1): 20:50:16  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:50:16.805152 (Thread-1): 20:50:16  Began compiling node rpc.my_new_project.request
2022-04-22 20:50:16.805253 (Thread-1): 20:50:16  Compiling rpc.my_new_project.request
2022-04-22 20:50:16.808728 (Thread-1): 20:50:16  finished collecting timing info
2022-04-22 20:50:16.808888 (Thread-1): 20:50:16  Began executing node rpc.my_new_project.request
2022-04-22 20:50:16.811231 (Thread-1): 20:50:16  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:50:16.811349 (Thread-1): 20:50:16  On rpc.my_new_project.request: with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:50:16.811436 (Thread-1): 20:50:16  Opening a new connection, currently in state init
2022-04-22 20:50:17.161330 (Thread-130): handling poll request
2022-04-22 20:50:17.161817 (Thread-130): 20:50:17  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080041730>]}
2022-04-22 20:50:17.162718 (Thread-130): sending response (<Response 5448 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:50:18.355022 (Thread-1): 20:50:18  Snowflake adapter: Snowflake query id: 01a3c8e2-0501-616b-0004-7d83048c8ace
2022-04-22 20:50:18.355258 (Thread-1): 20:50:18  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'UT' does not exist or not authorized.
2022-04-22 20:50:18.355455 (Thread-1): 20:50:18  finished collecting timing info
2022-04-22 20:50:18.355672 (Thread-1): 20:50:18  On rpc.my_new_project.request: Close
2022-04-22 20:50:18.491522 (Thread-131): handling poll request
2022-04-22 20:50:18.491916 (Thread-131): 20:50:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080041a90>]}
2022-04-22 20:50:18.492468 (Thread-131): sending response (<Response 1768 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:50:18.559635 (Thread-1): Got an exception: Database Error
  002003 (42S02): SQL compilation error:
  Object 'UT' does not exist or not authorized.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'UT' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  002003 (42S02): SQL compilation error:
  Object 'UT' does not exist or not authorized.
2022-04-22 20:50:18.560704 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'UT' does not exist or not authorized.", 'raw_sql': "with\r\n  o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  002003 (42S02): SQL compilation error:\n  Object 'UT' does not exist or not authorized.", 'raw_sql': "with\r\n  o as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.user_id = fo.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.user_id = fo.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 20:50:19.806604 (Thread-132): handling poll request
2022-04-22 20:50:19.807001 (Thread-132): 20:50:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3080041b50>]}
2022-04-22 20:50:19.807701 (Thread-132): sending response (<Response 22329 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:18.890338 (Thread-133): 20:51:18  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 20:51:18.890692 (Thread-133): 20:51:18  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800418b0>]}
2022-04-22 20:51:18.945715 (Thread-133): 20:51:18  Parsing macros/adapters.sql
2022-04-22 20:51:18.983334 (Thread-133): 20:51:18  Parsing macros/catalog.sql
2022-04-22 20:51:18.985257 (Thread-133): 20:51:18  Parsing macros/materializations/table.sql
2022-04-22 20:51:18.988358 (Thread-133): 20:51:18  Parsing macros/materializations/seed.sql
2022-04-22 20:51:18.993350 (Thread-133): 20:51:18  Parsing macros/materializations/incremental.sql
2022-04-22 20:51:19.001653 (Thread-133): 20:51:19  Parsing macros/materializations/merge.sql
2022-04-22 20:51:19.005356 (Thread-133): 20:51:19  Parsing macros/materializations/snapshot.sql
2022-04-22 20:51:19.006349 (Thread-133): 20:51:19  Parsing macros/materializations/view.sql
2022-04-22 20:51:19.007686 (Thread-133): 20:51:19  Parsing macros/adapters/metadata.sql
2022-04-22 20:51:19.014535 (Thread-133): 20:51:19  Parsing macros/adapters/columns.sql
2022-04-22 20:51:19.024128 (Thread-133): 20:51:19  Parsing macros/adapters/freshness.sql
2022-04-22 20:51:19.027057 (Thread-133): 20:51:19  Parsing macros/adapters/persist_docs.sql
2022-04-22 20:51:19.031350 (Thread-133): 20:51:19  Parsing macros/adapters/relation.sql
2022-04-22 20:51:19.040573 (Thread-133): 20:51:19  Parsing macros/adapters/schema.sql
2022-04-22 20:51:19.042748 (Thread-133): 20:51:19  Parsing macros/adapters/indexes.sql
2022-04-22 20:51:19.045372 (Thread-133): 20:51:19  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 20:51:19.047802 (Thread-133): 20:51:19  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 20:51:19.049260 (Thread-133): 20:51:19  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 20:51:19.050842 (Thread-133): 20:51:19  Parsing macros/etc/datetime.sql
2022-04-22 20:51:19.059010 (Thread-133): 20:51:19  Parsing macros/etc/statement.sql
2022-04-22 20:51:19.063367 (Thread-133): 20:51:19  Parsing macros/generic_test_sql/unique.sql
2022-04-22 20:51:19.064115 (Thread-133): 20:51:19  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 20:51:19.064676 (Thread-133): 20:51:19  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 20:51:19.066044 (Thread-133): 20:51:19  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 20:51:19.066926 (Thread-133): 20:51:19  Parsing macros/materializations/configs.sql
2022-04-22 20:51:19.069821 (Thread-133): 20:51:19  Parsing macros/materializations/hooks.sql
2022-04-22 20:51:19.073567 (Thread-133): 20:51:19  Parsing macros/materializations/models/table/table.sql
2022-04-22 20:51:19.081104 (Thread-133): 20:51:19  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 20:51:19.084009 (Thread-133): 20:51:19  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 20:51:19.086646 (Thread-133): 20:51:19  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 20:51:19.087968 (Thread-133): 20:51:19  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 20:51:19.090229 (Thread-133): 20:51:19  Parsing macros/materializations/models/view/view.sql
2022-04-22 20:51:19.097193 (Thread-133): 20:51:19  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 20:51:19.107005 (Thread-133): 20:51:19  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 20:51:19.122470 (Thread-133): 20:51:19  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 20:51:19.124105 (Thread-133): 20:51:19  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 20:51:19.135350 (Thread-133): 20:51:19  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 20:51:19.139863 (Thread-133): 20:51:19  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 20:51:19.156297 (Thread-133): 20:51:19  Parsing macros/materializations/seeds/seed.sql
2022-04-22 20:51:19.162312 (Thread-133): 20:51:19  Parsing macros/materializations/tests/helpers.sql
2022-04-22 20:51:19.164215 (Thread-133): 20:51:19  Parsing macros/materializations/tests/test.sql
2022-04-22 20:51:19.168694 (Thread-133): 20:51:19  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 20:51:19.170625 (Thread-133): 20:51:19  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 20:51:19.181940 (Thread-133): 20:51:19  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 20:51:19.198760 (Thread-133): 20:51:19  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 20:51:19.206128 (Thread-133): 20:51:19  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 20:51:19.222210 (Thread-133): 20:51:19  Parsing tests/generic/builtin.sql
2022-04-22 20:51:19.412026 (Thread-133): 20:51:19  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:51:19.415759 (Thread-133): 20:51:19  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 20:51:19.418746 (Thread-133): 20:51:19  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-22 20:51:19.421414 (Thread-133): 20:51:19  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 20:51:19.424659 (Thread-133): 20:51:19  1603: static parser failed on staging/stg_payments.sql
2022-04-22 20:51:19.429350 (Thread-133): 20:51:19  1602: parser fallback to jinja rendering on staging/stg_payments.sql
2022-04-22 20:51:19.431332 (Thread-133): 20:51:19  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 20:51:19.434065 (Thread-133): 20:51:19  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 20:51:19.436049 (Thread-133): 20:51:19  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 20:51:19.438063 (Thread-133): 20:51:19  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 20:51:19.440185 (Thread-133): 20:51:19  1699: static parser successfully parsed intermediate/user_type.sql
2022-04-22 20:51:19.442717 (Thread-133): 20:51:19  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:51:19.497884 (Thread-133): 20:51:19  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:51:19.503559 (Thread-133): 20:51:19  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f305c8991f0>]}
2022-04-22 20:51:19.589457 (Thread-134): handling status request
2022-04-22 20:51:19.589922 (Thread-134): 20:51:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f305c835f40>]}
2022-04-22 20:51:19.590919 (Thread-134): sending response (<Response 19139 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:19.833188 (Thread-135): handling status request
2022-04-22 20:51:19.833601 (Thread-135): 20:51:19  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f305c849730>]}
2022-04-22 20:51:19.834528 (Thread-135): sending response (<Response 19139 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:28.168324 (Thread-136): 20:51:28  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 20:51:28.168756 (Thread-136): 20:51:28  Partial parsing: added file: my_new_project://models/intermediate/int_user_type.sql
2022-04-22 20:51:28.168903 (Thread-136): 20:51:28  Partial parsing: deleted file: my_new_project://models/intermediate/user_type.sql
2022-04-22 20:51:28.172880 (Thread-136): 20:51:28  1699: static parser successfully parsed intermediate/int_user_type.sql
2022-04-22 20:51:28.207286 (Thread-136): 20:51:28  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:51:28.212629 (Thread-136): 20:51:28  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303416b520>]}
2022-04-22 20:51:28.864561 (Thread-137): handling status request
2022-04-22 20:51:28.864953 (Thread-137): 20:51:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303418de80>]}
2022-04-22 20:51:28.865451 (Thread-137): sending response (<Response 2344 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:28.874863 (Thread-138): handling status request
2022-04-22 20:51:28.875218 (Thread-138): 20:51:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303418dc10>]}
2022-04-22 20:51:28.875699 (Thread-138): sending response (<Response 2344 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:31.567008 (Thread-139): 20:51:31  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 20:51:31.567263 (Thread-139): 20:51:31  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 20:51:31.567801 (Thread-139): 20:51:31  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:51:31.573224 (Thread-139): 20:51:31  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034072e20>]}
2022-04-22 20:51:32.262726 (Thread-140): handling status request
2022-04-22 20:51:32.263133 (Thread-140): 20:51:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303414b850>]}
2022-04-22 20:51:32.263610 (Thread-140): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:32.327707 (Thread-141): handling status request
2022-04-22 20:51:32.328109 (Thread-141): 20:51:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303414b430>]}
2022-04-22 20:51:32.328594 (Thread-141): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:38.890276 (Thread-142): handling status request
2022-04-22 20:51:38.890688 (Thread-142): 20:51:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303414b250>]}
2022-04-22 20:51:38.891192 (Thread-142): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:39.205713 (Thread-143): handling status request
2022-04-22 20:51:39.206118 (Thread-143): 20:51:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303414b190>]}
2022-04-22 20:51:39.206598 (Thread-143): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:39.212204 (Thread-144): handling cli_args request
2022-04-22 20:51:39.212534 (Thread-144): 20:51:39  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034141ac0>]}
2022-04-22 20:51:41.855827 (Thread-144): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:41.903123 (MainThread): 20:51:41  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 20:51:41.903578 (MainThread): 20:51:41  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c2c41a460>]}
2022-04-22 20:51:41.937724 (MainThread): 20:51:41  Parsing macros/adapters.sql
2022-04-22 20:51:41.976016 (MainThread): 20:51:41  Parsing macros/catalog.sql
2022-04-22 20:51:41.977909 (MainThread): 20:51:41  Parsing macros/materializations/table.sql
2022-04-22 20:51:41.980871 (MainThread): 20:51:41  Parsing macros/materializations/seed.sql
2022-04-22 20:51:41.985963 (MainThread): 20:51:41  Parsing macros/materializations/incremental.sql
2022-04-22 20:51:41.994491 (MainThread): 20:51:41  Parsing macros/materializations/merge.sql
2022-04-22 20:51:41.998261 (MainThread): 20:51:41  Parsing macros/materializations/snapshot.sql
2022-04-22 20:51:41.999175 (MainThread): 20:51:41  Parsing macros/materializations/view.sql
2022-04-22 20:51:42.000434 (MainThread): 20:51:42  Parsing macros/adapters/metadata.sql
2022-04-22 20:51:42.007448 (MainThread): 20:51:42  Parsing macros/adapters/columns.sql
2022-04-22 20:51:42.017025 (MainThread): 20:51:42  Parsing macros/adapters/freshness.sql
2022-04-22 20:51:42.020004 (MainThread): 20:51:42  Parsing macros/adapters/persist_docs.sql
2022-04-22 20:51:42.024387 (MainThread): 20:51:42  Parsing macros/adapters/relation.sql
2022-04-22 20:51:42.033909 (MainThread): 20:51:42  Parsing macros/adapters/schema.sql
2022-04-22 20:51:42.036033 (MainThread): 20:51:42  Parsing macros/adapters/indexes.sql
2022-04-22 20:51:42.038765 (MainThread): 20:51:42  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 20:51:42.041140 (MainThread): 20:51:42  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 20:51:42.042580 (MainThread): 20:51:42  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 20:51:42.044207 (MainThread): 20:51:42  Parsing macros/etc/datetime.sql
2022-04-22 20:51:42.052572 (MainThread): 20:51:42  Parsing macros/etc/statement.sql
2022-04-22 20:51:42.056935 (MainThread): 20:51:42  Parsing macros/generic_test_sql/unique.sql
2022-04-22 20:51:42.057655 (MainThread): 20:51:42  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 20:51:42.058178 (MainThread): 20:51:42  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 20:51:42.059674 (MainThread): 20:51:42  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 20:51:42.060500 (MainThread): 20:51:42  Parsing macros/materializations/configs.sql
2022-04-22 20:51:42.062732 (MainThread): 20:51:42  Parsing macros/materializations/hooks.sql
2022-04-22 20:51:42.066560 (MainThread): 20:51:42  Parsing macros/materializations/models/table/table.sql
2022-04-22 20:51:42.073952 (MainThread): 20:51:42  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 20:51:42.076867 (MainThread): 20:51:42  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 20:51:42.079549 (MainThread): 20:51:42  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 20:51:42.080815 (MainThread): 20:51:42  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 20:51:42.083057 (MainThread): 20:51:42  Parsing macros/materializations/models/view/view.sql
2022-04-22 20:51:42.090203 (MainThread): 20:51:42  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 20:51:42.100151 (MainThread): 20:51:42  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 20:51:42.115611 (MainThread): 20:51:42  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 20:51:42.117117 (MainThread): 20:51:42  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 20:51:42.128251 (MainThread): 20:51:42  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 20:51:42.132684 (MainThread): 20:51:42  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 20:51:42.148914 (MainThread): 20:51:42  Parsing macros/materializations/seeds/seed.sql
2022-04-22 20:51:42.154928 (MainThread): 20:51:42  Parsing macros/materializations/tests/helpers.sql
2022-04-22 20:51:42.156791 (MainThread): 20:51:42  Parsing macros/materializations/tests/test.sql
2022-04-22 20:51:42.161096 (MainThread): 20:51:42  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 20:51:42.163038 (MainThread): 20:51:42  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 20:51:42.174090 (MainThread): 20:51:42  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 20:51:42.190899 (MainThread): 20:51:42  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 20:51:42.192547 (MainThread): 20:51:42  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 20:51:42.204476 (MainThread): 20:51:42  Parsing tests/generic/builtin.sql
2022-04-22 20:51:42.233636 (Thread-145): handling poll request
2022-04-22 20:51:42.234089 (Thread-145): 20:51:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303415e820>]}
2022-04-22 20:51:42.235433 (Thread-145): sending response (<Response 14786 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:42.396971 (MainThread): 20:51:42  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:51:42.408482 (MainThread): 20:51:42  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 20:51:42.410659 (MainThread): 20:51:42  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-22 20:51:42.412559 (MainThread): 20:51:42  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 20:51:42.414650 (MainThread): 20:51:42  1603: static parser failed on staging/stg_payments.sql
2022-04-22 20:51:42.418482 (MainThread): 20:51:42  1602: parser fallback to jinja rendering on staging/stg_payments.sql
2022-04-22 20:51:42.419613 (MainThread): 20:51:42  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 20:51:42.421482 (MainThread): 20:51:42  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 20:51:42.423385 (MainThread): 20:51:42  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 20:51:42.425561 (MainThread): 20:51:42  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 20:51:42.427607 (MainThread): 20:51:42  1699: static parser successfully parsed intermediate/int_user_type.sql
2022-04-22 20:51:42.429990 (MainThread): 20:51:42  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:51:42.497110 (MainThread): 20:51:42  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:51:42.502150 (MainThread): 20:51:42  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c2c0c08e0>]}
2022-04-22 20:51:42.529667 (MainThread): 20:51:42  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c2c32f670>]}
2022-04-22 20:51:42.530023 (MainThread): 20:51:42  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:51:42.531697 (MainThread): 20:51:42  
2022-04-22 20:51:42.532054 (MainThread): 20:51:42  Acquiring new snowflake connection "master"
2022-04-22 20:51:42.533336 (ThreadPoolExecutor-0_0): 20:51:42  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 20:51:42.545996 (ThreadPoolExecutor-0_0): 20:51:42  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 20:51:42.546132 (ThreadPoolExecutor-0_0): 20:51:42  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 20:51:42.546222 (ThreadPoolExecutor-0_0): 20:51:42  Opening a new connection, currently in state init
2022-04-22 20:51:43.570446 (Thread-146): handling poll request
2022-04-22 20:51:43.570855 (Thread-146): 20:51:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034072ee0>]}
2022-04-22 20:51:43.571568 (Thread-146): sending response (<Response 7683 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:43.584404 (ThreadPoolExecutor-0_0): 20:51:43  SQL status: SUCCESS 4 in 1.04 seconds
2022-04-22 20:51:43.586532 (ThreadPoolExecutor-0_0): 20:51:43  On list_PE_ALEXANDER_B: Close
2022-04-22 20:51:43.780372 (ThreadPoolExecutor-2_0): 20:51:43  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 20:51:43.788010 (ThreadPoolExecutor-2_0): 20:51:43  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 20:51:43.788179 (ThreadPoolExecutor-2_0): 20:51:43  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 20:51:43.788287 (ThreadPoolExecutor-2_0): 20:51:43  Opening a new connection, currently in state closed
2022-04-22 20:51:44.781605 (ThreadPoolExecutor-2_0): 20:51:44  SQL status: SUCCESS 9 in 0.99 seconds
2022-04-22 20:51:44.783303 (ThreadPoolExecutor-2_0): 20:51:44  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 20:51:44.921541 (Thread-147): handling poll request
2022-04-22 20:51:44.921974 (Thread-147): 20:51:44  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30340732e0>]}
2022-04-22 20:51:44.922557 (Thread-147): sending response (<Response 2981 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:44.973826 (MainThread): 20:51:44  Concurrency: 4 threads (target='default')
2022-04-22 20:51:44.974020 (MainThread): 20:51:44  
2022-04-22 20:51:44.976880 (Thread-1): 20:51:44  Began running node model.my_new_project.orginal_query
2022-04-22 20:51:44.977214 (Thread-1): 20:51:44  1 of 11 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 20:51:44.977519 (Thread-1): 20:51:44  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 20:51:44.977654 (Thread-1): 20:51:44  Began compiling node model.my_new_project.orginal_query
2022-04-22 20:51:44.977781 (Thread-1): 20:51:44  Compiling model.my_new_project.orginal_query
2022-04-22 20:51:44.979544 (Thread-2): 20:51:44  Began running node model.my_new_project.stg_ctry_type
2022-04-22 20:51:44.979800 (Thread-2): 20:51:44  2 of 11 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 20:51:44.980096 (Thread-2): 20:51:44  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 20:51:44.980189 (Thread-2): 20:51:44  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 20:51:44.980272 (Thread-2): 20:51:44  Compiling model.my_new_project.stg_ctry_type
2022-04-22 20:51:44.982686 (Thread-2): 20:51:44  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 20:51:44.983141 (Thread-3): 20:51:44  Began running node model.my_new_project.stg_device_orders
2022-04-22 20:51:44.983378 (Thread-3): 20:51:44  3 of 11 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 20:51:44.983651 (Thread-3): 20:51:44  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 20:51:44.983742 (Thread-3): 20:51:44  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 20:51:44.983824 (Thread-3): 20:51:44  Compiling model.my_new_project.stg_device_orders
2022-04-22 20:51:44.985951 (Thread-3): 20:51:44  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 20:51:44.986365 (Thread-4): 20:51:44  Began running node model.my_new_project.stg_orders
2022-04-22 20:51:44.986604 (Thread-4): 20:51:44  4 of 11 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 20:51:44.986941 (Thread-4): 20:51:44  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 20:51:44.987038 (Thread-4): 20:51:44  Began compiling node model.my_new_project.stg_orders
2022-04-22 20:51:44.987119 (Thread-4): 20:51:44  Compiling model.my_new_project.stg_orders
2022-04-22 20:51:44.989123 (Thread-4): 20:51:44  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 20:51:45.070459 (Thread-1): 20:51:45  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 20:51:45.070649 (Thread-1): 20:51:45  finished collecting timing info
2022-04-22 20:51:45.070791 (Thread-1): 20:51:45  Began executing node model.my_new_project.orginal_query
2022-04-22 20:51:45.083902 (Thread-4): 20:51:45  finished collecting timing info
2022-04-22 20:51:45.084096 (Thread-4): 20:51:45  Began executing node model.my_new_project.stg_orders
2022-04-22 20:51:45.093685 (Thread-2): 20:51:45  finished collecting timing info
2022-04-22 20:51:45.093893 (Thread-2): 20:51:45  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 20:51:45.103290 (Thread-4): 20:51:45  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 20:51:45.106592 (Thread-2): 20:51:45  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 20:51:45.106852 (Thread-3): 20:51:45  finished collecting timing info
2022-04-22 20:51:45.107009 (Thread-3): 20:51:45  Began executing node model.my_new_project.stg_device_orders
2022-04-22 20:51:45.108980 (Thread-3): 20:51:45  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 20:51:45.113889 (Thread-1): 20:51:45  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 20:51:45.121478 (Thread-4): 20:51:45  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 20:51:45.121645 (Thread-4): 20:51:45  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
  );
2022-04-22 20:51:45.121742 (Thread-4): 20:51:45  Opening a new connection, currently in state init
2022-04-22 20:51:45.122667 (Thread-2): 20:51:45  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 20:51:45.122791 (Thread-2): 20:51:45  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 20:51:45.122879 (Thread-2): 20:51:45  Opening a new connection, currently in state init
2022-04-22 20:51:45.131213 (Thread-1): 20:51:45  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 20:51:45.131358 (Thread-1): 20:51:45  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    
  );
2022-04-22 20:51:45.131446 (Thread-1): 20:51:45  Opening a new connection, currently in state closed
2022-04-22 20:51:45.133319 (Thread-3): 20:51:45  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 20:51:45.133436 (Thread-3): 20:51:45  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 20:51:45.133520 (Thread-3): 20:51:45  Opening a new connection, currently in state init
2022-04-22 20:51:46.191992 (Thread-4): 20:51:46  SQL status: SUCCESS 1 in 1.07 seconds
2022-04-22 20:51:46.198957 (Thread-4): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.199161 (Thread-4): 20:51:46  On model.my_new_project.stg_orders: Close
2022-04-22 20:51:46.263525 (Thread-148): handling poll request
2022-04-22 20:51:46.263956 (Thread-148): 20:51:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30341237f0>]}
2022-04-22 20:51:46.265063 (Thread-148): sending response (<Response 23397 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:46.300750 (Thread-1): 20:51:46  Snowflake adapter: Snowflake query id: 01a3c8e3-0501-61f2-0004-7d83048c7e5a
2022-04-22 20:51:46.300927 (Thread-1): 20:51:46  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:51:46.301109 (Thread-1): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.301250 (Thread-1): 20:51:46  On model.my_new_project.orginal_query: Close
2022-04-22 20:51:46.391243 (Thread-4): 20:51:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c2c097520>]}
2022-04-22 20:51:46.391699 (Thread-4): 20:51:46  4 of 11 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 1.40s]
2022-04-22 20:51:46.391833 (Thread-4): 20:51:46  Finished running node model.my_new_project.stg_orders
2022-04-22 20:51:46.391982 (Thread-4): 20:51:46  Began running node model.my_new_project.stg_payments
2022-04-22 20:51:46.392173 (Thread-4): 20:51:46  5 of 11 START view model abrown_dbt_interview.stg_payments...................... [RUN]
2022-04-22 20:51:46.392429 (Thread-4): 20:51:46  Acquiring new snowflake connection "model.my_new_project.stg_payments"
2022-04-22 20:51:46.392521 (Thread-4): 20:51:46  Began compiling node model.my_new_project.stg_payments
2022-04-22 20:51:46.392611 (Thread-4): 20:51:46  Compiling model.my_new_project.stg_payments
2022-04-22 20:51:46.397024 (Thread-4): 20:51:46  Writing injected SQL for node "model.my_new_project.stg_payments"
2022-04-22 20:51:46.406283 (Thread-2): 20:51:46  SQL status: SUCCESS 1 in 1.28 seconds
2022-04-22 20:51:46.407768 (Thread-2): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.407942 (Thread-2): 20:51:46  On model.my_new_project.stg_ctry_type: Close
2022-04-22 20:51:46.409357 (Thread-3): 20:51:46  SQL status: SUCCESS 1 in 1.28 seconds
2022-04-22 20:51:46.410717 (Thread-3): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.410882 (Thread-3): 20:51:46  On model.my_new_project.stg_device_orders: Close
2022-04-22 20:51:46.442553 (Thread-4): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.442790 (Thread-4): 20:51:46  Began executing node model.my_new_project.stg_payments
2022-04-22 20:51:46.445329 (Thread-4): 20:51:46  Writing runtime SQL for node "model.my_new_project.stg_payments"
2022-04-22 20:51:46.456436 (Thread-4): 20:51:46  Using snowflake connection "model.my_new_project.stg_payments"
2022-04-22 20:51:46.456605 (Thread-4): 20:51:46  On model.my_new_project.stg_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_payments 
  
   as (
    

with
    p as (select * from raw.interview_sample_data.interview_payments),

    pa as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    )

select * from pa
  );
2022-04-22 20:51:46.456702 (Thread-4): 20:51:46  Opening a new connection, currently in state closed
2022-04-22 20:51:46.494134 (Thread-1): 20:51:46  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 20:51:46.494574 (Thread-1): 20:51:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c60a6be20>]}
2022-04-22 20:51:46.494954 (Thread-1): 20:51:46  1 of 11 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.52s]
2022-04-22 20:51:46.495082 (Thread-1): 20:51:46  Finished running node model.my_new_project.orginal_query
2022-04-22 20:51:46.495231 (Thread-1): 20:51:46  Began running node model.my_new_project.stg_query
2022-04-22 20:51:46.495418 (Thread-1): 20:51:46  6 of 11 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 20:51:46.495679 (Thread-1): 20:51:46  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 20:51:46.495773 (Thread-1): 20:51:46  Began compiling node model.my_new_project.stg_query
2022-04-22 20:51:46.495866 (Thread-1): 20:51:46  Compiling model.my_new_project.stg_query
2022-04-22 20:51:46.500128 (Thread-1): 20:51:46  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 20:51:46.527081 (Thread-1): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.527311 (Thread-1): 20:51:46  Began executing node model.my_new_project.stg_query
2022-04-22 20:51:46.531025 (Thread-1): 20:51:46  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 20:51:46.564151 (Thread-1): 20:51:46  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 20:51:46.564331 (Thread-1): 20:51:46  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents, -- minor change to name here
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 20:51:46.564429 (Thread-1): 20:51:46  Opening a new connection, currently in state closed
2022-04-22 20:51:46.598410 (Thread-3): 20:51:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c60ab03a0>]}
2022-04-22 20:51:46.598876 (Thread-3): 20:51:46  3 of 11 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 1.61s]
2022-04-22 20:51:46.599021 (Thread-3): 20:51:46  Finished running node model.my_new_project.stg_device_orders
2022-04-22 20:51:46.599190 (Thread-3): 20:51:46  Began running node model.my_new_project.test_conn
2022-04-22 20:51:46.599395 (Thread-3): 20:51:46  7 of 11 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 20:51:46.599661 (Thread-3): 20:51:46  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 20:51:46.599763 (Thread-3): 20:51:46  Began compiling node model.my_new_project.test_conn
2022-04-22 20:51:46.599862 (Thread-3): 20:51:46  Compiling model.my_new_project.test_conn
2022-04-22 20:51:46.601897 (Thread-3): 20:51:46  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 20:51:46.602034 (Thread-3): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.602152 (Thread-3): 20:51:46  Began executing node model.my_new_project.test_conn
2022-04-22 20:51:46.604587 (Thread-3): 20:51:46  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 20:51:46.618037 (Thread-3): 20:51:46  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 20:51:46.618231 (Thread-3): 20:51:46  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    
  );
2022-04-22 20:51:46.618330 (Thread-3): 20:51:46  Opening a new connection, currently in state closed
2022-04-22 20:51:46.641571 (Thread-2): 20:51:46  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c60a6bf40>]}
2022-04-22 20:51:46.642212 (Thread-2): 20:51:46  2 of 11 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 1.66s]
2022-04-22 20:51:46.642343 (Thread-2): 20:51:46  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 20:51:46.642492 (Thread-2): 20:51:46  Began running node model.my_new_project.test_loop
2022-04-22 20:51:46.642683 (Thread-2): 20:51:46  8 of 11 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 20:51:46.642966 (Thread-2): 20:51:46  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 20:51:46.643061 (Thread-2): 20:51:46  Began compiling node model.my_new_project.test_loop
2022-04-22 20:51:46.643152 (Thread-2): 20:51:46  Compiling model.my_new_project.test_loop
2022-04-22 20:51:46.645134 (Thread-2): 20:51:46  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 20:51:46.645256 (Thread-2): 20:51:46  finished collecting timing info
2022-04-22 20:51:46.645365 (Thread-2): 20:51:46  Began executing node model.my_new_project.test_loop
2022-04-22 20:51:46.647724 (Thread-2): 20:51:46  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 20:51:46.659192 (Thread-2): 20:51:46  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 20:51:46.659332 (Thread-2): 20:51:46  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    
  );
2022-04-22 20:51:46.659425 (Thread-2): 20:51:46  Opening a new connection, currently in state closed
2022-04-22 20:51:47.574070 (Thread-4): 20:51:47  SQL status: SUCCESS 1 in 1.12 seconds
2022-04-22 20:51:47.575626 (Thread-4): 20:51:47  finished collecting timing info
2022-04-22 20:51:47.575801 (Thread-4): 20:51:47  On model.my_new_project.stg_payments: Close
2022-04-22 20:51:47.593248 (Thread-149): handling poll request
2022-04-22 20:51:47.593649 (Thread-149): 20:51:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034127d30>]}
2022-04-22 20:51:47.594877 (Thread-149): sending response (<Response 36513 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:47.625014 (Thread-3): 20:51:47  Snowflake adapter: Snowflake query id: 01a3c8e3-0501-61f2-0004-7d83048c7e6a
2022-04-22 20:51:47.625184 (Thread-3): 20:51:47  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:51:47.625356 (Thread-3): 20:51:47  finished collecting timing info
2022-04-22 20:51:47.625493 (Thread-3): 20:51:47  On model.my_new_project.test_conn: Close
2022-04-22 20:51:47.637629 (Thread-2): 20:51:47  Snowflake adapter: Snowflake query id: 01a3c8e3-0501-616b-0004-7d83048c8bce
2022-04-22 20:51:47.637789 (Thread-2): 20:51:47  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:51:47.637958 (Thread-2): 20:51:47  finished collecting timing info
2022-04-22 20:51:47.638096 (Thread-2): 20:51:47  On model.my_new_project.test_loop: Close
2022-04-22 20:51:47.760452 (Thread-1): 20:51:47  SQL status: SUCCESS 1 in 1.2 seconds
2022-04-22 20:51:47.762002 (Thread-1): 20:51:47  finished collecting timing info
2022-04-22 20:51:47.762171 (Thread-1): 20:51:47  On model.my_new_project.stg_query: Close
2022-04-22 20:51:47.826336 (Thread-4): 20:51:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c60a1a9a0>]}
2022-04-22 20:51:47.826768 (Thread-4): 20:51:47  5 of 11 OK created view model abrown_dbt_interview.stg_payments................. [SUCCESS 1 in 1.43s]
2022-04-22 20:51:47.826915 (Thread-4): 20:51:47  Finished running node model.my_new_project.stg_payments
2022-04-22 20:51:47.827061 (Thread-4): 20:51:47  Began running node model.my_new_project.stg_first_order
2022-04-22 20:51:47.827249 (Thread-4): 20:51:47  9 of 11 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 20:51:47.827505 (Thread-4): 20:51:47  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 20:51:47.827596 (Thread-4): 20:51:47  Began compiling node model.my_new_project.stg_first_order
2022-04-22 20:51:47.827689 (Thread-4): 20:51:47  Compiling model.my_new_project.stg_first_order
2022-04-22 20:51:47.830111 (Thread-4): 20:51:47  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 20:51:47.832522 (Thread-2): 20:51:47  Database Error in model test_loop (models/_archive/test_loop.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_loop.sql
2022-04-22 20:51:47.832808 (Thread-2): 20:51:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c60a1e340>]}
2022-04-22 20:51:47.833129 (Thread-2): 20:51:47  8 of 11 ERROR creating view model abrown_dbt_interview.test_loop................ [ERROR in 1.19s]
2022-04-22 20:51:47.833248 (Thread-2): 20:51:47  Finished running node model.my_new_project.test_loop
2022-04-22 20:51:47.839251 (Thread-3): 20:51:47  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 20:51:47.839482 (Thread-3): 20:51:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c60a14880>]}
2022-04-22 20:51:47.839870 (Thread-3): 20:51:47  7 of 11 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 1.24s]
2022-04-22 20:51:47.839987 (Thread-3): 20:51:47  Finished running node model.my_new_project.test_conn
2022-04-22 20:51:47.841059 (Thread-4): 20:51:47  finished collecting timing info
2022-04-22 20:51:47.841219 (Thread-4): 20:51:47  Began executing node model.my_new_project.stg_first_order
2022-04-22 20:51:47.844071 (Thread-4): 20:51:47  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 20:51:47.856010 (Thread-4): 20:51:47  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 20:51:47.856210 (Thread-4): 20:51:47  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 20:51:47.856309 (Thread-4): 20:51:47  Opening a new connection, currently in state closed
2022-04-22 20:51:47.963268 (Thread-1): 20:51:47  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c609e0730>]}
2022-04-22 20:51:47.963697 (Thread-1): 20:51:47  6 of 11 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.47s]
2022-04-22 20:51:47.963822 (Thread-1): 20:51:47  Finished running node model.my_new_project.stg_query
2022-04-22 20:51:48.613863 (Thread-4): 20:51:48  SQL status: SUCCESS 1 in 0.76 seconds
2022-04-22 20:51:48.615360 (Thread-4): 20:51:48  finished collecting timing info
2022-04-22 20:51:48.615523 (Thread-4): 20:51:48  On model.my_new_project.stg_first_order: Close
2022-04-22 20:51:48.832555 (Thread-4): 20:51:48  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c609db790>]}
2022-04-22 20:51:48.832998 (Thread-4): 20:51:48  9 of 11 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 1.01s]
2022-04-22 20:51:48.833127 (Thread-4): 20:51:48  Finished running node model.my_new_project.stg_first_order
2022-04-22 20:51:48.834311 (Thread-2): 20:51:48  Began running node model.my_new_project.fct_final
2022-04-22 20:51:48.834577 (Thread-2): 20:51:48  10 of 11 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 20:51:48.834874 (Thread-2): 20:51:48  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 20:51:48.834974 (Thread-2): 20:51:48  Began compiling node model.my_new_project.fct_final
2022-04-22 20:51:48.835064 (Thread-2): 20:51:48  Compiling model.my_new_project.fct_final
2022-04-22 20:51:48.838365 (Thread-2): 20:51:48  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 20:51:48.838670 (Thread-3): 20:51:48  Began running node model.my_new_project.int_user_type
2022-04-22 20:51:48.838942 (Thread-3): 20:51:48  11 of 11 START view model abrown_dbt_interview.int_user_type.................... [RUN]
2022-04-22 20:51:48.839224 (Thread-3): 20:51:48  Acquiring new snowflake connection "model.my_new_project.int_user_type"
2022-04-22 20:51:48.839320 (Thread-3): 20:51:48  Began compiling node model.my_new_project.int_user_type
2022-04-22 20:51:48.839408 (Thread-3): 20:51:48  Compiling model.my_new_project.int_user_type
2022-04-22 20:51:48.843178 (Thread-3): 20:51:48  Writing injected SQL for node "model.my_new_project.int_user_type"
2022-04-22 20:51:48.852047 (Thread-2): 20:51:48  finished collecting timing info
2022-04-22 20:51:48.852260 (Thread-2): 20:51:48  Began executing node model.my_new_project.fct_final
2022-04-22 20:51:48.854606 (Thread-2): 20:51:48  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 20:51:48.854874 (Thread-3): 20:51:48  finished collecting timing info
2022-04-22 20:51:48.855036 (Thread-3): 20:51:48  Began executing node model.my_new_project.int_user_type
2022-04-22 20:51:48.857057 (Thread-3): 20:51:48  Writing runtime SQL for node "model.my_new_project.int_user_type"
2022-04-22 20:51:48.865226 (Thread-3): 20:51:48  Using snowflake connection "model.my_new_project.int_user_type"
2022-04-22 20:51:48.865399 (Thread-3): 20:51:48  On model.my_new_project.int_user_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_user_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.int_user_type 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),
    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
    ut as (
        select
            o.order_id,
            case
                when fo.first_order_id = o.order_id then 'new'
                else 'repeat'
            end as user_type
        from o
        left join fo
            on o.user_id = fo.user_id

    )

select * from ut
  );
2022-04-22 20:51:48.865518 (Thread-3): 20:51:48  Opening a new connection, currently in state closed
2022-04-22 20:51:48.869490 (Thread-2): 20:51:48  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 20:51:48.869669 (Thread-2): 20:51:48  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 20:51:48.869768 (Thread-2): 20:51:48  Opening a new connection, currently in state closed
2022-04-22 20:51:48.930584 (Thread-150): handling poll request
2022-04-22 20:51:48.931000 (Thread-150): 20:51:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303407e880>]}
2022-04-22 20:51:48.957154 (Thread-150): sending response (<Response 31399 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:49.838289 (Thread-3): 20:51:49  SQL status: SUCCESS 1 in 0.97 seconds
2022-04-22 20:51:49.839787 (Thread-3): 20:51:49  finished collecting timing info
2022-04-22 20:51:49.839958 (Thread-3): 20:51:49  On model.my_new_project.int_user_type: Close
2022-04-22 20:51:49.842851 (Thread-2): 20:51:49  Snowflake adapter: Snowflake query id: 01a3c8e3-0501-616b-0004-7d83048c8bd2
2022-04-22 20:51:49.842976 (Thread-2): 20:51:49  Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.UT' does not exist or not authorized.
2022-04-22 20:51:49.843135 (Thread-2): 20:51:49  finished collecting timing info
2022-04-22 20:51:49.843260 (Thread-2): 20:51:49  On model.my_new_project.fct_final: Close
2022-04-22 20:51:50.032423 (Thread-2): 20:51:50  Database Error in model fct_final (models/marts/fct_final.sql)
  002003 (42S02): SQL compilation error:
  Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.UT' does not exist or not authorized.
  compiled SQL at target/run/my_new_project/models/marts/fct_final.sql
2022-04-22 20:51:50.032710 (Thread-2): 20:51:50  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c5a111f40>]}
2022-04-22 20:51:50.033070 (Thread-2): 20:51:50  10 of 11 ERROR creating view model abrown_dbt_interview.fct_final............... [ERROR in 1.20s]
2022-04-22 20:51:50.033194 (Thread-2): 20:51:50  Finished running node model.my_new_project.fct_final
2022-04-22 20:51:50.056089 (Thread-3): 20:51:50  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8bff89-4105-4f84-b143-725bec81092e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c620170d0>]}
2022-04-22 20:51:50.056511 (Thread-3): 20:51:50  11 of 11 OK created view model abrown_dbt_interview.int_user_type............... [SUCCESS 1 in 1.22s]
2022-04-22 20:51:50.056638 (Thread-3): 20:51:50  Finished running node model.my_new_project.int_user_type
2022-04-22 20:51:50.058305 (MainThread): 20:51:50  Acquiring new snowflake connection "master"
2022-04-22 20:51:50.058647 (MainThread): 20:51:50  
2022-04-22 20:51:50.058752 (MainThread): 20:51:50  Finished running 11 view models in 7.53s.
2022-04-22 20:51:50.058850 (MainThread): 20:51:50  Connection 'master' was properly closed.
2022-04-22 20:51:50.058918 (MainThread): 20:51:50  Connection 'model.my_new_project.stg_query' was properly closed.
2022-04-22 20:51:50.058985 (MainThread): 20:51:50  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 20:51:50.059048 (MainThread): 20:51:50  Connection 'model.my_new_project.int_user_type' was properly closed.
2022-04-22 20:51:50.059110 (MainThread): 20:51:50  Connection 'model.my_new_project.stg_first_order' was properly closed.
2022-04-22 20:51:50.114935 (MainThread): 20:51:50  
2022-04-22 20:51:50.115167 (MainThread): 20:51:50  Completed with 4 errors and 0 warnings:
2022-04-22 20:51:50.115267 (MainThread): 20:51:50  
2022-04-22 20:51:50.115364 (MainThread): 20:51:50  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 20:51:50.115443 (MainThread): 20:51:50    001003 (42000): SQL compilation error:
2022-04-22 20:51:50.115515 (MainThread): 20:51:50    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:51:50.115586 (MainThread): 20:51:50    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 20:51:50.115659 (MainThread): 20:51:50  
2022-04-22 20:51:50.115738 (MainThread): 20:51:50  Database Error in model test_loop (models/_archive/test_loop.sql)
2022-04-22 20:51:50.115808 (MainThread): 20:51:50    001003 (42000): SQL compilation error:
2022-04-22 20:51:50.115877 (MainThread): 20:51:50    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:51:50.115943 (MainThread): 20:51:50    compiled SQL at target/run/my_new_project/models/_archive/test_loop.sql
2022-04-22 20:51:50.116012 (MainThread): 20:51:50  
2022-04-22 20:51:50.116087 (MainThread): 20:51:50  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 20:51:50.116156 (MainThread): 20:51:50    001003 (42000): SQL compilation error:
2022-04-22 20:51:50.116221 (MainThread): 20:51:50    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 20:51:50.116286 (MainThread): 20:51:50    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 20:51:50.116354 (MainThread): 20:51:50  
2022-04-22 20:51:50.116430 (MainThread): 20:51:50  Database Error in model fct_final (models/marts/fct_final.sql)
2022-04-22 20:51:50.116498 (MainThread): 20:51:50    002003 (42S02): SQL compilation error:
2022-04-22 20:51:50.116562 (MainThread): 20:51:50    Object 'PE_ALEXANDER_B.ABROWN_DBT_INTERVIEW.UT' does not exist or not authorized.
2022-04-22 20:51:50.116626 (MainThread): 20:51:50    compiled SQL at target/run/my_new_project/models/marts/fct_final.sql
2022-04-22 20:51:50.116709 (MainThread): 20:51:50  
2022-04-22 20:51:50.116794 (MainThread): 20:51:50  Done. PASS=7 WARN=0 ERROR=4 SKIP=0 TOTAL=11
2022-04-22 20:51:50.311968 (Thread-151): handling poll request
2022-04-22 20:51:50.312369 (Thread-151): 20:51:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303412a790>]}
2022-04-22 20:51:50.313372 (Thread-151): sending response (<Response 19292 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:51.638168 (Thread-152): handling poll request
2022-04-22 20:51:51.638580 (Thread-152): 20:51:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303416b310>]}
2022-04-22 20:51:51.640193 (Thread-152): sending response (<Response 46873 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:52.459272 (Thread-153): handling status request
2022-04-22 20:51:52.459713 (Thread-153): 20:51:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303408d0d0>]}
2022-04-22 20:51:52.460229 (Thread-153): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:51:52.472282 (Thread-154): handling status request
2022-04-22 20:51:52.472623 (Thread-154): 20:51:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303412a7f0>]}
2022-04-22 20:51:52.473075 (Thread-154): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:18.295327 (Thread-155): handling status request
2022-04-22 20:52:18.295724 (Thread-155): 20:52:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303412ac40>]}
2022-04-22 20:52:18.296199 (Thread-155): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:18.598086 (Thread-156): handling run_sql request
2022-04-22 20:52:18.598462 (Thread-156): 20:52:18  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f305c884ee0>]}
2022-04-22 20:52:21.203194 (Thread-156): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:21.230967 (MainThread): 20:52:21  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ccb80d91-f0f1-407e-8bd8-fe511621ca25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbadb4adeb0>]}
2022-04-22 20:52:21.231595 (MainThread): 20:52:21  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:52:21.232217 (Thread-1): 20:52:21  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:52:21.232354 (Thread-1): 20:52:21  Began compiling node rpc.my_new_project.request
2022-04-22 20:52:21.232449 (Thread-1): 20:52:21  Compiling rpc.my_new_project.request
2022-04-22 20:52:21.235947 (Thread-1): 20:52:21  finished collecting timing info
2022-04-22 20:52:21.236092 (Thread-1): 20:52:21  Began executing node rpc.my_new_project.request
2022-04-22 20:52:21.238359 (Thread-1): 20:52:21  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:52:21.238467 (Thread-1): 20:52:21  On rpc.my_new_project.request: with
  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),
  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type)

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.user_id = ut.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:52:21.238553 (Thread-1): 20:52:21  Opening a new connection, currently in state init
2022-04-22 20:52:21.536478 (Thread-157): handling poll request
2022-04-22 20:52:21.536932 (Thread-157): 20:52:21  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30341b8d60>]}
2022-04-22 20:52:21.537892 (Thread-157): sending response (<Response 5525 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:22.234274 (Thread-1): 20:52:22  Snowflake adapter: Snowflake query id: 01a3c8e4-0501-61f2-0004-7d83048c7e76
2022-04-22 20:52:22.234509 (Thread-1): 20:52:22  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 2 unexpected 'final'.
2022-04-22 20:52:22.234698 (Thread-1): 20:52:22  finished collecting timing info
2022-04-22 20:52:22.234920 (Thread-1): 20:52:22  On rpc.my_new_project.request: Close
2022-04-22 20:52:22.550741 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 2 unexpected 'final'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 11 at position 2 unexpected 'final'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 2 unexpected 'final'.
2022-04-22 20:52:22.551803 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 11 at position 2 unexpected 'final'.", 'raw_sql': "with\r\n  o  as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n  ut as ( select * from {{ ref('int_user_type')}})\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.user_id = ut.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type)\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.user_id = ut.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 11 at position 2 unexpected 'final'.", 'raw_sql': "with\r\n  o  as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n  ut as ( select * from {{ ref('int_user_type')}})\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.user_id = ut.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type)\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.user_id = ut.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 20:52:22.868224 (Thread-158): handling poll request
2022-04-22 20:52:22.868624 (Thread-158): 20:52:22  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303418d310>]}
2022-04-22 20:52:22.869310 (Thread-158): sending response (<Response 22871 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:26.337539 (Thread-159): handling status request
2022-04-22 20:52:26.337978 (Thread-159): 20:52:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30341416d0>]}
2022-04-22 20:52:26.338511 (Thread-159): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:26.630895 (Thread-160): handling run_sql request
2022-04-22 20:52:26.631295 (Thread-160): 20:52:26  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034141250>]}
2022-04-22 20:52:29.256964 (Thread-160): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:29.284550 (MainThread): 20:52:29  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '610e3cc4-bf8f-4b80-8813-b13e02671c75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec28867f0>]}
2022-04-22 20:52:29.285145 (MainThread): 20:52:29  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:52:29.285790 (Thread-1): 20:52:29  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:52:29.285927 (Thread-1): 20:52:29  Began compiling node rpc.my_new_project.request
2022-04-22 20:52:29.286032 (Thread-1): 20:52:29  Compiling rpc.my_new_project.request
2022-04-22 20:52:29.289375 (Thread-1): 20:52:29  finished collecting timing info
2022-04-22 20:52:29.289512 (Thread-1): 20:52:29  Began executing node rpc.my_new_project.request
2022-04-22 20:52:29.291772 (Thread-1): 20:52:29  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:52:29.291873 (Thread-1): 20:52:29  On rpc.my_new_project.request: with
  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),
  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.user_id = ut.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:52:29.291957 (Thread-1): 20:52:29  Opening a new connection, currently in state init
2022-04-22 20:52:29.586349 (Thread-161): handling poll request
2022-04-22 20:52:29.586823 (Thread-161): 20:52:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30340a02e0>]}
2022-04-22 20:52:29.587748 (Thread-161): sending response (<Response 5526 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:52:30.153257 (Thread-1): 20:52:30  Snowflake adapter: Snowflake query id: 01a3c8e4-0501-616b-0004-7d83048c8bda
2022-04-22 20:52:30.153493 (Thread-1): 20:52:30  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 42 at position 23
invalid identifier 'UT.USER_ID'
2022-04-22 20:52:30.153745 (Thread-1): 20:52:30  finished collecting timing info
2022-04-22 20:52:30.153971 (Thread-1): 20:52:30  On rpc.my_new_project.request: Close
2022-04-22 20:52:30.353489 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 42 at position 23
  invalid identifier 'UT.USER_ID'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 42 at position 23
invalid identifier 'UT.USER_ID'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 42 at position 23
  invalid identifier 'UT.USER_ID'
2022-04-22 20:52:30.354617 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 42 at position 23\n  invalid identifier 'UT.USER_ID'", 'raw_sql': "with\r\n  o  as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n  ut as ( select * from {{ ref('int_user_type')}}),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.user_id = ut.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.user_id = ut.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 42 at position 23\n  invalid identifier 'UT.USER_ID'", 'raw_sql': "with\r\n  o  as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n  ut as ( select * from {{ ref('int_user_type')}}),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.user_id = ut.user_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.user_id = ut.user_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 20:52:30.913140 (Thread-162): handling poll request
2022-04-22 20:52:30.913622 (Thread-162): 20:52:30  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034092fa0>]}
2022-04-22 20:52:30.914354 (Thread-162): sending response (<Response 22920 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:11.434818 (Thread-163): handling status request
2022-04-22 20:53:11.435209 (Thread-163): 20:53:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30340a0a60>]}
2022-04-22 20:53:11.435741 (Thread-163): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:11.755809 (Thread-164): handling run_sql request
2022-04-22 20:53:11.756230 (Thread-164): 20:53:11  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034092ee0>]}
2022-04-22 20:53:14.500853 (Thread-164): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:14.529222 (MainThread): 20:53:14  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6a8cd8c7-f2d1-47df-a5a8-59edd934b728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc55edf2eb0>]}
2022-04-22 20:53:14.529848 (MainThread): 20:53:14  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:53:14.530480 (Thread-1): 20:53:14  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:53:14.530618 (Thread-1): 20:53:14  Began compiling node rpc.my_new_project.request
2022-04-22 20:53:14.530710 (Thread-1): 20:53:14  Compiling rpc.my_new_project.request
2022-04-22 20:53:14.534195 (Thread-1): 20:53:14  finished collecting timing info
2022-04-22 20:53:14.534339 (Thread-1): 20:53:14  Began executing node rpc.my_new_project.request
2022-04-22 20:53:14.536602 (Thread-1): 20:53:14  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:53:14.536702 (Thread-1): 20:53:14  On rpc.my_new_project.request: with
  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),
  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.order_id = ut.order_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:53:14.536784 (Thread-1): 20:53:14  Opening a new connection, currently in state init
2022-04-22 20:53:14.868927 (Thread-165): handling poll request
2022-04-22 20:53:14.869391 (Thread-165): 20:53:14  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0de99a0>]}
2022-04-22 20:53:14.870404 (Thread-165): sending response (<Response 5528 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:15.677822 (Thread-1): 20:53:15  Snowflake adapter: Snowflake query id: 01a3c8e5-0501-616b-0004-7d83048c8bde
2022-04-22 20:53:15.678058 (Thread-1): 20:53:15  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 61 at position 2
invalid identifier 'GROSS_SHIPPING_AMOUNT_CENTS'
2022-04-22 20:53:15.678248 (Thread-1): 20:53:15  finished collecting timing info
2022-04-22 20:53:15.678452 (Thread-1): 20:53:15  On rpc.my_new_project.request: Close
2022-04-22 20:53:15.859450 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 61 at position 2
  invalid identifier 'GROSS_SHIPPING_AMOUNT_CENTS'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 61 at position 2
invalid identifier 'GROSS_SHIPPING_AMOUNT_CENTS'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 61 at position 2
  invalid identifier 'GROSS_SHIPPING_AMOUNT_CENTS'
2022-04-22 20:53:15.860502 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 61 at position 2\n  invalid identifier 'GROSS_SHIPPING_AMOUNT_CENTS'", 'raw_sql': "with\r\n  o  as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n  ut as ( select * from {{ ref('int_user_type')}}),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.order_id = ut.order_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.order_id = ut.order_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 61 at position 2\n  invalid identifier 'GROSS_SHIPPING_AMOUNT_CENTS'", 'raw_sql': "with\r\n  o  as ( select * from {{ ref('stg_orders') }} ),\r\n  do as ( select * from {{ ref('stg_device_orders') }} ),\r\n  fo as ( select * from {{ ref('stg_first_order') }} ),\r\n  pa as ( select * from {{ ref('stg_payments') }} ),\r\n  ct as ( select * from {{ ref('stg_ctry_type') }} ),\r\n  ut as ( select * from {{ ref('int_user_type')}}),\r\n\r\n  -- final cte's\r\n\r\n  final as (\r\n\r\n    select\r\n        o.order_id,\r\n        o.user_id,\r\n        o.created_at,\r\n        o.updated_at,\r\n        o.shipped_at,\r\n        o.currency,\r\n        o.order_status,\r\n        o.order_status_category,\r\n        ct.country_type,\r\n        o.shipping_method,\r\n        do.purchase_device_type,\r\n        do.device as purchase_device,\r\n        ut.user_type,\r\n        o.amount_total_cents,\r\n        pa.gross_total_amount_cents,\r\n        case\r\n          when o.currency = 'usd' then o.amount_total_cents\r\n          else pa.gross_total_amount_cents\r\n        end as total_amount_cents,\r\n        pa.gross_tax_amount_cents,\r\n        pa.gross_amount_cents,\r\n        pa.gross_amount_shipping_cents\r\n      from o\r\n\r\n      left join do\r\n        on do.order_id = o.order_id\r\n\r\n      left join ut\r\n        on o.order_id = ut.order_id\r\n\r\n      left join ct \r\n        on ct.order_id = o.order_id\r\n\r\n      left join pa\r\n        on pa.order_id = o.order_id\r\n  )\r\n\r\n-- select statement\r\n\r\n\r\nselect\r\n  *,\r\n  amount_total_cents / 100 as amount_total,\r\n  gross_total_amount_cents/ 100 as gross_total_amount,\r\n  total_amount_cents/ 100 as total_amount,\r\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\r\n  gross_amount_cents/ 100 as gross_amount,\r\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\r\n\r\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "with\n  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),\n  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),\n  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),\n  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),\n  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),\n\n  -- final cte's\n\n  final as (\n\n    select\n        o.order_id,\n        o.user_id,\n        o.created_at,\n        o.updated_at,\n        o.shipped_at,\n        o.currency,\n        o.order_status,\n        o.order_status_category,\n        ct.country_type,\n        o.shipping_method,\n        do.purchase_device_type,\n        do.device as purchase_device,\n        ut.user_type,\n        o.amount_total_cents,\n        pa.gross_total_amount_cents,\n        case\n          when o.currency = 'usd' then o.amount_total_cents\n          else pa.gross_total_amount_cents\n        end as total_amount_cents,\n        pa.gross_tax_amount_cents,\n        pa.gross_amount_cents,\n        pa.gross_amount_shipping_cents\n      from o\n\n      left join do\n        on do.order_id = o.order_id\n\n      left join ut\n        on o.order_id = ut.order_id\n\n      left join ct \n        on ct.order_id = o.order_id\n\n      left join pa\n        on pa.order_id = o.order_id\n  )\n\n-- select statement\n\n\nselect\n  *,\n  amount_total_cents / 100 as amount_total,\n  gross_total_amount_cents/ 100 as gross_total_amount,\n  total_amount_cents/ 100 as total_amount,\n  gross_tax_amount_cents/ 100 as gross_tax_amount,\n  gross_amount_cents/ 100 as gross_amount,\n  gross_shipping_amount_cents/ 100 as gross_shipping_amount\n\nfrom final\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 20:53:16.209403 (Thread-166): handling poll request
2022-04-22 20:53:16.209825 (Thread-166): 20:53:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0d821f0>]}
2022-04-22 20:53:16.210523 (Thread-166): sending response (<Response 23046 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:40.238273 (Thread-167): 20:53:40  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 20:53:40.238611 (Thread-167): 20:53:40  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3034073f70>]}
2022-04-22 20:53:40.279440 (Thread-167): 20:53:40  Parsing macros/adapters.sql
2022-04-22 20:53:40.316685 (Thread-167): 20:53:40  Parsing macros/catalog.sql
2022-04-22 20:53:40.318625 (Thread-167): 20:53:40  Parsing macros/materializations/table.sql
2022-04-22 20:53:40.321684 (Thread-167): 20:53:40  Parsing macros/materializations/seed.sql
2022-04-22 20:53:40.327049 (Thread-167): 20:53:40  Parsing macros/materializations/incremental.sql
2022-04-22 20:53:40.335782 (Thread-167): 20:53:40  Parsing macros/materializations/merge.sql
2022-04-22 20:53:40.339502 (Thread-167): 20:53:40  Parsing macros/materializations/snapshot.sql
2022-04-22 20:53:40.340510 (Thread-167): 20:53:40  Parsing macros/materializations/view.sql
2022-04-22 20:53:40.341895 (Thread-167): 20:53:40  Parsing macros/adapters/metadata.sql
2022-04-22 20:53:40.349047 (Thread-167): 20:53:40  Parsing macros/adapters/columns.sql
2022-04-22 20:53:40.358699 (Thread-167): 20:53:40  Parsing macros/adapters/freshness.sql
2022-04-22 20:53:40.361476 (Thread-167): 20:53:40  Parsing macros/adapters/persist_docs.sql
2022-04-22 20:53:40.365714 (Thread-167): 20:53:40  Parsing macros/adapters/relation.sql
2022-04-22 20:53:40.374891 (Thread-167): 20:53:40  Parsing macros/adapters/schema.sql
2022-04-22 20:53:40.376976 (Thread-167): 20:53:40  Parsing macros/adapters/indexes.sql
2022-04-22 20:53:40.379573 (Thread-167): 20:53:40  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 20:53:40.381951 (Thread-167): 20:53:40  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 20:53:40.383407 (Thread-167): 20:53:40  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 20:53:40.384937 (Thread-167): 20:53:40  Parsing macros/etc/datetime.sql
2022-04-22 20:53:40.393012 (Thread-167): 20:53:40  Parsing macros/etc/statement.sql
2022-04-22 20:53:40.397288 (Thread-167): 20:53:40  Parsing macros/generic_test_sql/unique.sql
2022-04-22 20:53:40.398028 (Thread-167): 20:53:40  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 20:53:40.398592 (Thread-167): 20:53:40  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 20:53:40.399925 (Thread-167): 20:53:40  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 20:53:40.400787 (Thread-167): 20:53:40  Parsing macros/materializations/configs.sql
2022-04-22 20:53:40.403064 (Thread-167): 20:53:40  Parsing macros/materializations/hooks.sql
2022-04-22 20:53:40.406755 (Thread-167): 20:53:40  Parsing macros/materializations/models/table/table.sql
2022-04-22 20:53:40.414022 (Thread-167): 20:53:40  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 20:53:40.416762 (Thread-167): 20:53:40  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 20:53:40.419366 (Thread-167): 20:53:40  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 20:53:40.420642 (Thread-167): 20:53:40  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 20:53:40.422881 (Thread-167): 20:53:40  Parsing macros/materializations/models/view/view.sql
2022-04-22 20:53:40.429772 (Thread-167): 20:53:40  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 20:53:40.439324 (Thread-167): 20:53:40  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 20:53:40.454215 (Thread-167): 20:53:40  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 20:53:40.455727 (Thread-167): 20:53:40  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 20:53:40.466606 (Thread-167): 20:53:40  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 20:53:40.470913 (Thread-167): 20:53:40  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 20:53:40.486652 (Thread-167): 20:53:40  Parsing macros/materializations/seeds/seed.sql
2022-04-22 20:53:40.492475 (Thread-167): 20:53:40  Parsing macros/materializations/tests/helpers.sql
2022-04-22 20:53:40.494246 (Thread-167): 20:53:40  Parsing macros/materializations/tests/test.sql
2022-04-22 20:53:40.498503 (Thread-167): 20:53:40  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 20:53:40.500275 (Thread-167): 20:53:40  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 20:53:40.511239 (Thread-167): 20:53:40  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 20:53:40.527459 (Thread-167): 20:53:40  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 20:53:40.535824 (Thread-167): 20:53:40  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 20:53:40.555240 (Thread-167): 20:53:40  Parsing tests/generic/builtin.sql
2022-04-22 20:53:40.744020 (Thread-167): 20:53:40  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 20:53:40.747512 (Thread-167): 20:53:40  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 20:53:40.749679 (Thread-167): 20:53:40  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-22 20:53:40.751717 (Thread-167): 20:53:40  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 20:53:40.754366 (Thread-167): 20:53:40  1603: static parser failed on staging/stg_payments.sql
2022-04-22 20:53:40.759043 (Thread-167): 20:53:40  1602: parser fallback to jinja rendering on staging/stg_payments.sql
2022-04-22 20:53:40.760608 (Thread-167): 20:53:40  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 20:53:40.763674 (Thread-167): 20:53:40  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 20:53:40.766725 (Thread-167): 20:53:40  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 20:53:40.769817 (Thread-167): 20:53:40  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 20:53:40.773017 (Thread-167): 20:53:40  1699: static parser successfully parsed intermediate/int_user_type.sql
2022-04-22 20:53:40.775711 (Thread-167): 20:53:40  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:53:40.840030 (Thread-167): 20:53:40  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 20:53:40.845460 (Thread-167): 20:53:40  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5c09a0>]}
2022-04-22 20:53:41.053830 (Thread-168): handling status request
2022-04-22 20:53:41.060508 (Thread-168): 20:53:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e515190>]}
2022-04-22 20:53:41.061565 (Thread-168): sending response (<Response 19143 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:41.092081 (Thread-169): handling status request
2022-04-22 20:53:41.092428 (Thread-169): 20:53:41  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e5158e0>]}
2022-04-22 20:53:41.093391 (Thread-169): sending response (<Response 19143 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:42.787964 (Thread-170): handling status request
2022-04-22 20:53:42.788383 (Thread-170): 20:53:42  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e63b460>]}
2022-04-22 20:53:42.789376 (Thread-170): sending response (<Response 19143 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:43.064369 (Thread-171): handling run_sql request
2022-04-22 20:53:43.064758 (Thread-171): 20:53:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309e515d60>]}
2022-04-22 20:53:45.567192 (Thread-171): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:45.593725 (MainThread): 20:53:45  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f21180cb-3993-4a10-9be7-ab7dafcadb20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4176b9ee0>]}
2022-04-22 20:53:45.594264 (MainThread): 20:53:45  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 20:53:45.594857 (Thread-1): 20:53:45  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 20:53:45.594989 (Thread-1): 20:53:45  Began compiling node rpc.my_new_project.request
2022-04-22 20:53:45.595080 (Thread-1): 20:53:45  Compiling rpc.my_new_project.request
2022-04-22 20:53:45.598271 (Thread-1): 20:53:45  finished collecting timing info
2022-04-22 20:53:45.598403 (Thread-1): 20:53:45  Began executing node rpc.my_new_project.request
2022-04-22 20:53:45.600508 (Thread-1): 20:53:45  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 20:53:45.600602 (Thread-1): 20:53:45  On rpc.my_new_project.request: with
  o  as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
  do as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders ),
  fo as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order ),
  pa as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_payments ),
  ct as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type ),
  ut as ( select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.order_id = ut.order_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_amount_shipping_cents/ 100 as gross_shipping_amount

from final
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 20:53:45.600682 (Thread-1): 20:53:45  Opening a new connection, currently in state init
2022-04-22 20:53:45.913171 (Thread-172): handling poll request
2022-04-22 20:53:45.913639 (Thread-172): 20:53:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0d6cf70>]}
2022-04-22 20:53:45.914587 (Thread-172): sending response (<Response 5527 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:47.289181 (Thread-173): handling poll request
2022-04-22 20:53:47.289550 (Thread-173): 20:53:47  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0d6cbb0>]}
2022-04-22 20:53:47.290065 (Thread-173): sending response (<Response 388 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:48.648767 (Thread-174): handling poll request
2022-04-22 20:53:48.649181 (Thread-174): 20:53:48  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0d6c970>]}
2022-04-22 20:53:48.649703 (Thread-174): sending response (<Response 388 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:53:48.647782 (Thread-1): 20:53:48  SQL status: SUCCESS 500 in 3.05 seconds
2022-04-22 20:53:49.176421 (Thread-1): 20:53:49  finished collecting timing info
2022-04-22 20:53:49.176703 (Thread-1): 20:53:49  On rpc.my_new_project.request: Close
2022-04-22 20:53:49.988272 (Thread-175): handling poll request
2022-04-22 20:53:49.988660 (Thread-175): 20:53:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30a0de0c70>]}
2022-04-22 20:53:49.998390 (Thread-175): sending response (<Response 143872 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:54:52.211163 (Thread-176): 20:54:52  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 20:54:52.211602 (Thread-176): 20:54:52  Partial parsing: added file: my_new_project://models/intermediate/int_payments.sql
2022-04-22 20:54:52.211829 (Thread-176): 20:54:52  Partial parsing: deleted file: my_new_project://models/staging/stg_payments.sql
2022-04-22 20:54:52.217215 (Thread-176): 20:54:52  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 20:54:52.222002 (Thread-176): 20:54:52  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 20:54:52.223827 (Thread-176): 20:54:52  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:54:52.943021 (Thread-177): handling status request
2022-04-22 20:54:52.943437 (Thread-177): 20:54:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bd87f70>]}
2022-04-22 20:54:52.943987 (Thread-177): sending response (<Response 2262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:54:52.950088 (Thread-178): handling status request
2022-04-22 20:54:52.950499 (Thread-178): 20:54:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f309bd878b0>]}
2022-04-22 20:54:52.951049 (Thread-178): sending response (<Response 2262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:54:59.934909 (Thread-179): 20:54:59  Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
2022-04-22 20:54:59.935311 (Thread-179): 20:54:59  Partial parsing: added file: my_new_project://models/intermediate/int_payments.sql
2022-04-22 20:54:59.935529 (Thread-179): 20:54:59  Partial parsing: deleted file: my_new_project://models/staging/stg_payments.sql
2022-04-22 20:54:59.940332 (Thread-179): 20:54:59  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 20:54:59.944857 (Thread-179): 20:54:59  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 20:54:59.946760 (Thread-179): 20:54:59  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 20:55:00.670067 (Thread-180): handling status request
2022-04-22 20:55:00.670472 (Thread-180): 20:55:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303406eeb0>]}
2022-04-22 20:55:00.671002 (Thread-180): sending response (<Response 2262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 20:55:00.723635 (Thread-181): handling status request
2022-04-22 20:55:00.724012 (Thread-181): 20:55:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f303406ed60>]}
2022-04-22 20:55:00.745718 (Thread-181): sending response (<Response 2262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:00:52.181278 (Thread-182): 21:00:52  Partial parsing enabled: 1 files deleted, 1 files added, 1 files changed.
2022-04-22 21:00:52.182074 (Thread-182): 21:00:52  Partial parsing: added file: my_new_project://models/intermediate/int_payments.sql
2022-04-22 21:00:52.182318 (Thread-182): 21:00:52  Partial parsing: deleted file: my_new_project://models/staging/stg_payments.sql
2022-04-22 21:00:52.182498 (Thread-182): 21:00:52  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 21:00:52.187517 (Thread-182): 21:00:52  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 21:00:52.191956 (Thread-182): 21:00:52  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 21:00:52.193668 (Thread-182): 21:00:52  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 21:00:53.050746 (Thread-183): handling status request
2022-04-22 21:00:53.051182 (Thread-183): 21:00:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb310a90>]}
2022-04-22 21:00:53.051712 (Thread-183): sending response (<Response 2578 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:00:53.121448 (Thread-184): handling status request
2022-04-22 21:00:53.121895 (Thread-184): 21:00:53  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb3108e0>]}
2022-04-22 21:00:53.122421 (Thread-184): sending response (<Response 2578 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:01:13.037853 (Thread-185): 21:01:13  Partial parsing enabled: 1 files deleted, 1 files added, 1 files changed.
2022-04-22 21:01:13.038250 (Thread-185): 21:01:13  Partial parsing: added file: my_new_project://models/intermediate/int_payments.sql
2022-04-22 21:01:13.038459 (Thread-185): 21:01:13  Partial parsing: deleted file: my_new_project://models/staging/stg_payments.sql
2022-04-22 21:01:13.038629 (Thread-185): 21:01:13  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 21:01:13.043374 (Thread-185): 21:01:13  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 21:01:13.047637 (Thread-185): 21:01:13  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 21:01:13.049275 (Thread-185): 21:01:13  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 21:01:13.086457 (Thread-185): 21:01:13  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:01:13.092239 (Thread-185): 21:01:13  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b66d0>]}
2022-04-22 21:01:13.797357 (Thread-186): handling status request
2022-04-22 21:01:13.797803 (Thread-186): 21:01:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb298f70>]}
2022-04-22 21:01:13.798357 (Thread-186): sending response (<Response 3262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:01:13.845811 (Thread-187): handling status request
2022-04-22 21:01:13.846211 (Thread-187): 21:01:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb298e20>]}
2022-04-22 21:01:13.846753 (Thread-187): sending response (<Response 3262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:23.880179 (Thread-188): handling status request
2022-04-22 21:04:23.880931 (Thread-188): 21:04:23  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb298d60>]}
2022-04-22 21:04:23.881467 (Thread-188): sending response (<Response 3262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:24.213009 (Thread-189): handling run_sql request
2022-04-22 21:04:24.213398 (Thread-189): 21:04:24  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb317190>]}
2022-04-22 21:04:26.836732 (Thread-189): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:26.864005 (MainThread): 21:04:26  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5095c16a-3e3c-43ba-820c-197c7a022400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb6cd36cc40>]}
2022-04-22 21:04:26.864589 (MainThread): 21:04:26  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 21:04:26.865222 (Thread-1): 21:04:26  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 21:04:26.865354 (Thread-1): 21:04:26  Began compiling node rpc.my_new_project.request
2022-04-22 21:04:26.865445 (Thread-1): 21:04:26  Compiling rpc.my_new_project.request
2022-04-22 21:04:26.868953 (Thread-1): 21:04:26  finished collecting timing info
2022-04-22 21:04:26.869088 (Thread-1): 21:04:26  Began executing node rpc.my_new_project.request
2022-04-22 21:04:26.870653 (Thread-1): 21:04:26  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 21:04:26.870752 (Thread-1): 21:04:26  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_payments),
    p as (select * from raw.interview_sample_data.interview_payments),

    p1 as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    ),

    pa as (

        select
            p1.*,
            case
                when o.currency = 'usd' then o.amount_total_cents
                else pa.gross_total_amount_cents
            end as total_amount_cents
        from o
        left join p1
        on o.order_id = p1.order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 21:04:26.870833 (Thread-1): 21:04:26  Opening a new connection, currently in state init
2022-04-22 21:04:27.201995 (Thread-190): handling poll request
2022-04-22 21:04:27.202480 (Thread-190): 21:04:27  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb32cd60>]}
2022-04-22 21:04:27.203471 (Thread-190): sending response (<Response 4811 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:28.039899 (Thread-1): 21:04:28  Snowflake adapter: Snowflake query id: 01a3c8f0-0501-616b-0004-7d83048ca752
2022-04-22 21:04:28.040141 (Thread-1): 21:04:28  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 21
invalid identifier 'O.CURRENCY'
2022-04-22 21:04:28.040339 (Thread-1): 21:04:28  finished collecting timing info
2022-04-22 21:04:28.040554 (Thread-1): 21:04:28  On rpc.my_new_project.request: Close
2022-04-22 21:04:28.261770 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 25 at position 21
  invalid identifier 'O.CURRENCY'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 25 at position 21
invalid identifier 'O.CURRENCY'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 25 at position 21
  invalid identifier 'O.CURRENCY'
2022-04-22 21:04:28.262820 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 25 at position 21\n  invalid identifier 'O.CURRENCY'", 'raw_sql': "{% set cols = ['tax_amount_cents', 'amount_cents', 'amount_shipping_cents'] %}\r\n\r\nwith\r\n    o as (select * from {{ source('interview_sample_data', 'interview_payments') }}),\r\n    p as (select * from {{ source('interview_sample_data', 'interview_payments') }}),\r\n\r\n    p1 as (\r\n    select\r\n        order_id,\r\n\r\n        {%- for c in cols %}\r\n            sum(case when status = 'completed' then {{c}} else 0 end) as gross_{{c}},\r\n        {%- endfor %}\r\n\r\n        sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n            end\r\n            ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    ),\r\n\r\n    pa as (\r\n\r\n        select\r\n            p1.*,\r\n            case\r\n                when o.currency = 'usd' then o.amount_total_cents\r\n                else pa.gross_total_amount_cents\r\n            end as total_amount_cents\r\n        from o\r\n        left join p1\r\n        on o.order_id = p1.order_id\r\n    )\r\n\r\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "\n\nwith\n    o as (select * from raw.interview_sample_data.interview_payments),\n    p as (select * from raw.interview_sample_data.interview_payments),\n\n    p1 as (\n    select\n        order_id,\n            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,\n            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,\n            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,\n\n        sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n            end\n            ) as gross_total_amount_cents\n    from p\n    group by order_id\n    ),\n\n    pa as (\n\n        select\n            p1.*,\n            case\n                when o.currency = 'usd' then o.amount_total_cents\n                else pa.gross_total_amount_cents\n            end as total_amount_cents\n        from o\n        left join p1\n        on o.order_id = p1.order_id\n    )\n\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 25 at position 21\n  invalid identifier 'O.CURRENCY'", 'raw_sql': "{% set cols = ['tax_amount_cents', 'amount_cents', 'amount_shipping_cents'] %}\r\n\r\nwith\r\n    o as (select * from {{ source('interview_sample_data', 'interview_payments') }}),\r\n    p as (select * from {{ source('interview_sample_data', 'interview_payments') }}),\r\n\r\n    p1 as (\r\n    select\r\n        order_id,\r\n\r\n        {%- for c in cols %}\r\n            sum(case when status = 'completed' then {{c}} else 0 end) as gross_{{c}},\r\n        {%- endfor %}\r\n\r\n        sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n            end\r\n            ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    ),\r\n\r\n    pa as (\r\n\r\n        select\r\n            p1.*,\r\n            case\r\n                when o.currency = 'usd' then o.amount_total_cents\r\n                else pa.gross_total_amount_cents\r\n            end as total_amount_cents\r\n        from o\r\n        left join p1\r\n        on o.order_id = p1.order_id\r\n    )\r\n\r\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "\n\nwith\n    o as (select * from raw.interview_sample_data.interview_payments),\n    p as (select * from raw.interview_sample_data.interview_payments),\n\n    p1 as (\n    select\n        order_id,\n            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,\n            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,\n            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,\n\n        sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n            end\n            ) as gross_total_amount_cents\n    from p\n    group by order_id\n    ),\n\n    pa as (\n\n        select\n            p1.*,\n            case\n                when o.currency = 'usd' then o.amount_total_cents\n                else pa.gross_total_amount_cents\n            end as total_amount_cents\n        from o\n        left join p1\n        on o.order_id = p1.order_id\n    )\n\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 21:04:28.544248 (Thread-191): handling poll request
2022-04-22 21:04:28.544642 (Thread-191): 21:04:28  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b6d90>]}
2022-04-22 21:04:28.545270 (Thread-191): sending response (<Response 11101 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:29.880454 (Thread-192): handling poll request
2022-04-22 21:04:29.880845 (Thread-192): 21:04:29  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b6f40>]}
2022-04-22 21:04:29.881549 (Thread-192): sending response (<Response 17733 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:55.557315 (Thread-193): handling status request
2022-04-22 21:04:55.557735 (Thread-193): 21:04:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b6460>]}
2022-04-22 21:04:55.558329 (Thread-193): sending response (<Response 3262 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:55.889731 (Thread-194): handling run_sql request
2022-04-22 21:04:55.890141 (Thread-194): 21:04:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b6970>]}
2022-04-22 21:04:58.421830 (Thread-194): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:04:58.446809 (MainThread): 21:04:58  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92713e89-ef07-431b-b0ec-e2f9462ac9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e360f8b80>]}
2022-04-22 21:04:58.447391 (MainThread): 21:04:58  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 21:04:58.447995 (Thread-1): 21:04:58  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 21:04:58.448128 (Thread-1): 21:04:58  Began compiling node rpc.my_new_project.request
2022-04-22 21:04:58.448220 (Thread-1): 21:04:58  Compiling rpc.my_new_project.request
2022-04-22 21:04:58.450451 (Thread-1): 21:04:58  finished collecting timing info
2022-04-22 21:04:58.450582 (Thread-1): 21:04:58  Began executing node rpc.my_new_project.request
2022-04-22 21:04:58.451334 (Thread-1): 21:04:58  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 21:04:58.451423 (Thread-1): 21:04:58  On rpc.my_new_project.request: with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 21:04:58.451502 (Thread-1): 21:04:58  Opening a new connection, currently in state init
2022-04-22 21:04:58.747438 (Thread-195): handling poll request
2022-04-22 21:04:58.747891 (Thread-195): 21:04:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2ac070>]}
2022-04-22 21:04:58.748835 (Thread-195): sending response (<Response 4061 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:00.100880 (Thread-196): handling poll request
2022-04-22 21:05:00.101270 (Thread-196): 21:05:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2ac250>]}
2022-04-22 21:05:00.101825 (Thread-196): sending response (<Response 391 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:00.304870 (Thread-1): 21:05:00  SQL status: SUCCESS 500 in 1.85 seconds
2022-04-22 21:05:00.320065 (Thread-1): 21:05:00  finished collecting timing info
2022-04-22 21:05:00.320332 (Thread-1): 21:05:00  On rpc.my_new_project.request: Close
2022-04-22 21:05:01.434081 (Thread-197): handling poll request
2022-04-22 21:05:01.434472 (Thread-197): 21:05:01  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb298f10>]}
2022-04-22 21:05:01.437821 (Thread-197): sending response (<Response 76541 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:38.165342 (Thread-198): 21:05:38  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 21:05:38.165917 (Thread-198): 21:05:38  Partial parsing: updated file: my_new_project://models/intermediate/int_payments.sql
2022-04-22 21:05:38.170387 (Thread-198): 21:05:38  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 21:05:38.175604 (Thread-198): 21:05:38  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 21:05:38.209954 (Thread-198): 21:05:38  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:05:38.215610 (Thread-198): 21:05:38  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb177eb0>]}
2022-04-22 21:05:38.880815 (Thread-199): handling status request
2022-04-22 21:05:38.881227 (Thread-199): 21:05:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb3a4d30>]}
2022-04-22 21:05:38.881810 (Thread-199): sending response (<Response 2326 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:38.969601 (Thread-200): handling status request
2022-04-22 21:05:38.969990 (Thread-200): 21:05:38  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b67f0>]}
2022-04-22 21:05:38.970484 (Thread-200): sending response (<Response 2326 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:45.910668 (Thread-201): handling status request
2022-04-22 21:05:45.911064 (Thread-201): 21:05:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2b67c0>]}
2022-04-22 21:05:45.911574 (Thread-201): sending response (<Response 2326 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:46.237126 (Thread-202): handling run_sql request
2022-04-22 21:05:46.237524 (Thread-202): 21:05:46  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb1c5520>]}
2022-04-22 21:05:48.836407 (Thread-202): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:48.863284 (MainThread): 21:05:48  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c67b2a5-9584-4b06-9978-7c408de15a85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed66032fa0>]}
2022-04-22 21:05:48.863874 (MainThread): 21:05:48  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 21:05:48.864496 (Thread-1): 21:05:48  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 21:05:48.864631 (Thread-1): 21:05:48  Began compiling node rpc.my_new_project.request
2022-04-22 21:05:48.864727 (Thread-1): 21:05:48  Compiling rpc.my_new_project.request
2022-04-22 21:05:48.868014 (Thread-1): 21:05:48  finished collecting timing info
2022-04-22 21:05:48.868170 (Thread-1): 21:05:48  Began executing node rpc.my_new_project.request
2022-04-22 21:05:48.869685 (Thread-1): 21:05:48  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 21:05:48.869783 (Thread-1): 21:05:48  On rpc.my_new_project.request: with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
    p as (select * from raw.interview_sample_data.interview_payments),

    p1 as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    ),

    pa as (

        select
            p1.*,
            case
                when o.currency = 'usd' then o.amount_total_cents
                else pa.gross_total_amount_cents
            end as total_amount_cents
        from o
        left join p1
        on o.order_id = p1.order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 21:05:48.869866 (Thread-1): 21:05:48  Opening a new connection, currently in state init
2022-04-22 21:05:49.159591 (Thread-203): handling poll request
2022-04-22 21:05:49.160027 (Thread-203): 21:05:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb177b50>]}
2022-04-22 21:05:49.160988 (Thread-203): sending response (<Response 4814 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:49.974208 (Thread-1): 21:05:49  Snowflake adapter: Snowflake query id: 01a3c8f1-0501-61f2-0004-7d83048c9a3e
2022-04-22 21:05:49.974438 (Thread-1): 21:05:49  Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 21
invalid identifier 'PA.GROSS_TOTAL_AMOUNT_CENTS'
2022-04-22 21:05:49.974625 (Thread-1): 21:05:49  finished collecting timing info
2022-04-22 21:05:49.974820 (Thread-1): 21:05:49  On rpc.my_new_project.request: Close
2022-04-22 21:05:50.205919 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 26 at position 21
  invalid identifier 'PA.GROSS_TOTAL_AMOUNT_CENTS'
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 206, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 74, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/cursor.py", line 789, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/usr/local/lib/python3.8/dist-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 26 at position 21
invalid identifier 'PA.GROSS_TOTAL_AMOUNT_CENTS'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 361, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 314, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 403, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 90, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 225, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 127, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 433, in add_query
    connection, cursor = super().add_query(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 83, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/snowflake/connections.py", line 223, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 26 at position 21
  invalid identifier 'PA.GROSS_TOTAL_AMOUNT_CENTS'
2022-04-22 21:05:50.206947 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 26 at position 21\n  invalid identifier 'PA.GROSS_TOTAL_AMOUNT_CENTS'", 'raw_sql': "{% set cols = ['tax_amount_cents', 'amount_cents', 'amount_shipping_cents'] %}\r\n\r\nwith\r\n    o as (select * from {{ ref('stg_orders') }} ),\r\n    p as (select * from {{ source('interview_sample_data', 'interview_payments') }}),\r\n\r\n    p1 as (\r\n    select\r\n        order_id,\r\n\r\n        {%- for c in cols %}\r\n            sum(case when status = 'completed' then {{c}} else 0 end) as gross_{{c}},\r\n        {%- endfor %}\r\n\r\n        sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n            end\r\n            ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    ),\r\n\r\n    pa as (\r\n\r\n        select\r\n            p1.*,\r\n            case\r\n                when o.currency = 'usd' then o.amount_total_cents\r\n                else pa.gross_total_amount_cents\r\n            end as total_amount_cents\r\n        from o\r\n        left join p1\r\n        on o.order_id = p1.order_id\r\n    )\r\n\r\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "\n\nwith\n    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n    p as (select * from raw.interview_sample_data.interview_payments),\n\n    p1 as (\n    select\n        order_id,\n            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,\n            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,\n            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,\n\n        sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n            end\n            ) as gross_total_amount_cents\n    from p\n    group by order_id\n    ),\n\n    pa as (\n\n        select\n            p1.*,\n            case\n                when o.currency = 'usd' then o.amount_total_cents\n                else pa.gross_total_amount_cents\n            end as total_amount_cents\n        from o\n        left join p1\n        on o.order_id = p1.order_id\n    )\n\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/task/sql_commands.py", line 147, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 377, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt_rpc/rpc/node_runners.py", line 56, in error_result
    raise error
dbt_rpc.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 26 at position 21\n  invalid identifier 'PA.GROSS_TOTAL_AMOUNT_CENTS'", 'raw_sql': "{% set cols = ['tax_amount_cents', 'amount_cents', 'amount_shipping_cents'] %}\r\n\r\nwith\r\n    o as (select * from {{ ref('stg_orders') }} ),\r\n    p as (select * from {{ source('interview_sample_data', 'interview_payments') }}),\r\n\r\n    p1 as (\r\n    select\r\n        order_id,\r\n\r\n        {%- for c in cols %}\r\n            sum(case when status = 'completed' then {{c}} else 0 end) as gross_{{c}},\r\n        {%- endfor %}\r\n\r\n        sum(case\r\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\r\n            end\r\n            ) as gross_total_amount_cents\r\n    from p\r\n    group by order_id\r\n    ),\r\n\r\n    pa as (\r\n\r\n        select\r\n            p1.*,\r\n            case\r\n                when o.currency = 'usd' then o.amount_total_cents\r\n                else pa.gross_total_amount_cents\r\n            end as total_amount_cents\r\n        from o\r\n        left join p1\r\n        on o.order_id = p1.order_id\r\n    )\r\n\r\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "\n\nwith\n    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),\n    p as (select * from raw.interview_sample_data.interview_payments),\n\n    p1 as (\n    select\n        order_id,\n            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,\n            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,\n            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,\n\n        sum(case\n            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0\n            end\n            ) as gross_total_amount_cents\n    from p\n    group by order_id\n    ),\n\n    pa as (\n\n        select\n            p1.*,\n            case\n                when o.currency = 'usd' then o.amount_total_cents\n                else pa.gross_total_amount_cents\n            end as total_amount_cents\n        from o\n        left join p1\n        on o.order_id = p1.order_id\n    )\n\nselect * from pa\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-04-22 21:05:50.479500 (Thread-204): handling poll request
2022-04-22 21:05:50.479890 (Thread-204): 21:05:50  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb150700>]}
2022-04-22 21:05:50.480529 (Thread-204): sending response (<Response 11139 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:05:51.799561 (Thread-205): handling poll request
2022-04-22 21:05:51.799959 (Thread-205): 21:05:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb150c10>]}
2022-04-22 21:05:51.800675 (Thread-205): sending response (<Response 17759 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:10.647342 (Thread-206): handling status request
2022-04-22 21:06:10.647761 (Thread-206): 21:06:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb150d00>]}
2022-04-22 21:06:10.648349 (Thread-206): sending response (<Response 2326 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:10.949322 (Thread-207): handling run_sql request
2022-04-22 21:06:10.949770 (Thread-207): 21:06:10  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb150970>]}
2022-04-22 21:06:13.521455 (Thread-207): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:13.548546 (MainThread): 21:06:13  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dad39aed-4576-4d15-aff3-893cd89d60e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f157671dbb0>]}
2022-04-22 21:06:13.549138 (MainThread): 21:06:13  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 21:06:13.549787 (Thread-1): 21:06:13  Acquiring new snowflake connection "rpc.my_new_project.request"
2022-04-22 21:06:13.549929 (Thread-1): 21:06:13  Began compiling node rpc.my_new_project.request
2022-04-22 21:06:13.550029 (Thread-1): 21:06:13  Compiling rpc.my_new_project.request
2022-04-22 21:06:13.553469 (Thread-1): 21:06:13  finished collecting timing info
2022-04-22 21:06:13.553645 (Thread-1): 21:06:13  Began executing node rpc.my_new_project.request
2022-04-22 21:06:13.555196 (Thread-1): 21:06:13  Using snowflake connection "rpc.my_new_project.request"
2022-04-22 21:06:13.555296 (Thread-1): 21:06:13  On rpc.my_new_project.request: with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
    p as (select * from raw.interview_sample_data.interview_payments),

    p1 as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    ),

    pa as (

        select
            p1.*,
            case
                when o.currency = 'usd' then o.amount_total_cents
                else p1.gross_total_amount_cents
            end as total_amount_cents
        from o
        left join p1
        on o.order_id = p1.order_id
    )

select * from pa
limit 500
/* limit added automatically by dbt cloud */
2022-04-22 21:06:13.555379 (Thread-1): 21:06:13  Opening a new connection, currently in state init
2022-04-22 21:06:13.869320 (Thread-208): handling poll request
2022-04-22 21:06:13.869806 (Thread-208): 21:06:13  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb170b80>]}
2022-04-22 21:06:13.870726 (Thread-208): sending response (<Response 4814 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:15.107227 (Thread-1): 21:06:15  SQL status: SUCCESS 500 in 1.55 seconds
2022-04-22 21:06:15.123645 (Thread-1): 21:06:15  finished collecting timing info
2022-04-22 21:06:15.123934 (Thread-1): 21:06:15  On rpc.my_new_project.request: Close
2022-04-22 21:06:15.193104 (Thread-209): handling poll request
2022-04-22 21:06:15.193485 (Thread-209): 21:06:15  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb170d30>]}
2022-04-22 21:06:15.194077 (Thread-209): sending response (<Response 1378 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:16.546881 (Thread-210): handling poll request
2022-04-22 21:06:16.547306 (Thread-210): 21:06:16  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30800e41f0>]}
2022-04-22 21:06:16.551317 (Thread-210): sending response (<Response 28902 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:31.994154 (Thread-211): 21:06:31  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 21:06:31.994667 (Thread-211): 21:06:31  Partial parsing: updated file: my_new_project://models/intermediate/int_payments.sql
2022-04-22 21:06:31.998989 (Thread-211): 21:06:31  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 21:06:32.004593 (Thread-211): 21:06:32  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 21:06:32.034712 (Thread-211): 21:06:32  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:06:32.040269 (Thread-211): 21:06:32  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb079f70>]}
2022-04-22 21:06:32.847380 (Thread-212): handling status request
2022-04-22 21:06:32.847788 (Thread-212): 21:06:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb055df0>]}
2022-04-22 21:06:32.872369 (Thread-212): sending response (<Response 2326 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:06:32.886004 (Thread-213): handling status request
2022-04-22 21:06:32.886304 (Thread-213): 21:06:32  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb055f70>]}
2022-04-22 21:06:32.886725 (Thread-213): sending response (<Response 2326 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:45.112999 (Thread-214): 21:07:45  Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
2022-04-22 21:07:45.114031 (Thread-214): 21:07:45  Partial parsing: updated file: my_new_project://models/marts/fct_final.sql
2022-04-22 21:07:45.118926 (Thread-214): 21:07:45  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 21:07:45.151863 (Thread-214): 21:07:45  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:07:45.157409 (Thread-214): 21:07:45  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feafba760>]}
2022-04-22 21:07:45.891403 (Thread-215): handling status request
2022-04-22 21:07:45.891804 (Thread-215): 21:07:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf98fa0>]}
2022-04-22 21:07:45.892310 (Thread-215): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:45.906027 (Thread-216): handling status request
2022-04-22 21:07:45.906362 (Thread-216): 21:07:45  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf98dc0>]}
2022-04-22 21:07:45.906821 (Thread-216): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:49.631938 (Thread-217): handling status request
2022-04-22 21:07:49.632326 (Thread-217): 21:07:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf98cd0>]}
2022-04-22 21:07:49.632805 (Thread-217): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:49.918898 (Thread-218): handling status request
2022-04-22 21:07:49.919285 (Thread-218): 21:07:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb1b6f70>]}
2022-04-22 21:07:49.919780 (Thread-218): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:49.983475 (Thread-219): handling cli_args request
2022-04-22 21:07:49.983853 (Thread-219): 21:07:49  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feb2a59a0>]}
2022-04-22 21:07:52.616369 (Thread-219): sending response (<Response 138 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:52.665048 (MainThread): 21:07:52  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 21:07:52.665514 (MainThread): 21:07:52  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc244a1b460>]}
2022-04-22 21:07:52.702935 (MainThread): 21:07:52  Parsing macros/adapters.sql
2022-04-22 21:07:52.741219 (MainThread): 21:07:52  Parsing macros/catalog.sql
2022-04-22 21:07:52.743143 (MainThread): 21:07:52  Parsing macros/materializations/table.sql
2022-04-22 21:07:52.746288 (MainThread): 21:07:52  Parsing macros/materializations/seed.sql
2022-04-22 21:07:52.751516 (MainThread): 21:07:52  Parsing macros/materializations/incremental.sql
2022-04-22 21:07:52.760283 (MainThread): 21:07:52  Parsing macros/materializations/merge.sql
2022-04-22 21:07:52.764238 (MainThread): 21:07:52  Parsing macros/materializations/snapshot.sql
2022-04-22 21:07:52.765205 (MainThread): 21:07:52  Parsing macros/materializations/view.sql
2022-04-22 21:07:52.766579 (MainThread): 21:07:52  Parsing macros/adapters/metadata.sql
2022-04-22 21:07:52.773793 (MainThread): 21:07:52  Parsing macros/adapters/columns.sql
2022-04-22 21:07:52.783608 (MainThread): 21:07:52  Parsing macros/adapters/freshness.sql
2022-04-22 21:07:52.786450 (MainThread): 21:07:52  Parsing macros/adapters/persist_docs.sql
2022-04-22 21:07:52.790789 (MainThread): 21:07:52  Parsing macros/adapters/relation.sql
2022-04-22 21:07:52.800226 (MainThread): 21:07:52  Parsing macros/adapters/schema.sql
2022-04-22 21:07:52.802374 (MainThread): 21:07:52  Parsing macros/adapters/indexes.sql
2022-04-22 21:07:52.805066 (MainThread): 21:07:52  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 21:07:52.807449 (MainThread): 21:07:52  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 21:07:52.808979 (MainThread): 21:07:52  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 21:07:52.810616 (MainThread): 21:07:52  Parsing macros/etc/datetime.sql
2022-04-22 21:07:52.819210 (MainThread): 21:07:52  Parsing macros/etc/statement.sql
2022-04-22 21:07:52.823851 (MainThread): 21:07:52  Parsing macros/generic_test_sql/unique.sql
2022-04-22 21:07:52.824770 (MainThread): 21:07:52  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 21:07:52.825313 (MainThread): 21:07:52  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 21:07:52.826659 (MainThread): 21:07:52  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 21:07:52.827501 (MainThread): 21:07:52  Parsing macros/materializations/configs.sql
2022-04-22 21:07:52.829914 (MainThread): 21:07:52  Parsing macros/materializations/hooks.sql
2022-04-22 21:07:52.833659 (MainThread): 21:07:52  Parsing macros/materializations/models/table/table.sql
2022-04-22 21:07:52.841212 (MainThread): 21:07:52  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 21:07:52.844074 (MainThread): 21:07:52  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 21:07:52.846813 (MainThread): 21:07:52  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 21:07:52.848099 (MainThread): 21:07:52  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 21:07:52.850427 (MainThread): 21:07:52  Parsing macros/materializations/models/view/view.sql
2022-04-22 21:07:52.857502 (MainThread): 21:07:52  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 21:07:52.867582 (MainThread): 21:07:52  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 21:07:52.883278 (MainThread): 21:07:52  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 21:07:52.884794 (MainThread): 21:07:52  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 21:07:52.895970 (MainThread): 21:07:52  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 21:07:52.900375 (MainThread): 21:07:52  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 21:07:52.916526 (MainThread): 21:07:52  Parsing macros/materializations/seeds/seed.sql
2022-04-22 21:07:52.922726 (MainThread): 21:07:52  Parsing macros/materializations/tests/helpers.sql
2022-04-22 21:07:52.924500 (MainThread): 21:07:52  Parsing macros/materializations/tests/test.sql
2022-04-22 21:07:52.950778 (Thread-220): handling poll request
2022-04-22 21:07:52.951225 (Thread-220): 21:07:52  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feafb60d0>]}
2022-04-22 21:07:52.952458 (Thread-220): sending response (<Response 13010 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:52.928970 (MainThread): 21:07:52  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 21:07:52.930764 (MainThread): 21:07:52  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 21:07:52.941886 (MainThread): 21:07:52  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 21:07:52.959424 (MainThread): 21:07:52  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 21:07:52.961068 (MainThread): 21:07:52  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 21:07:52.972732 (MainThread): 21:07:52  Parsing tests/generic/builtin.sql
2022-04-22 21:07:53.168295 (MainThread): 21:07:53  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 21:07:53.180067 (MainThread): 21:07:53  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 21:07:53.182299 (MainThread): 21:07:53  1699: static parser successfully parsed _archive/test_loop.sql
2022-04-22 21:07:53.184242 (MainThread): 21:07:53  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 21:07:53.186319 (MainThread): 21:07:53  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 21:07:53.188233 (MainThread): 21:07:53  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 21:07:53.190334 (MainThread): 21:07:53  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 21:07:53.192315 (MainThread): 21:07:53  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 21:07:53.194390 (MainThread): 21:07:53  1699: static parser successfully parsed intermediate/int_user_type.sql
2022-04-22 21:07:53.196699 (MainThread): 21:07:53  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 21:07:53.201175 (MainThread): 21:07:53  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 21:07:53.202738 (MainThread): 21:07:53  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 21:07:53.260539 (MainThread): 21:07:53  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:07:53.265526 (MainThread): 21:07:53  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2440c4850>]}
2022-04-22 21:07:53.293749 (MainThread): 21:07:53  Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc244a086d0>]}
2022-04-22 21:07:53.294099 (MainThread): 21:07:53  Found 11 models, 0 tests, 0 snapshots, 0 analyses, 179 macros, 0 operations, 0 seed files, 4 sources, 0 exposures, 0 metrics
2022-04-22 21:07:53.296412 (MainThread): 21:07:53  
2022-04-22 21:07:53.296741 (MainThread): 21:07:53  Acquiring new snowflake connection "master"
2022-04-22 21:07:53.298089 (ThreadPoolExecutor-0_0): 21:07:53  Acquiring new snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 21:07:53.311043 (ThreadPoolExecutor-0_0): 21:07:53  Using snowflake connection "list_PE_ALEXANDER_B"
2022-04-22 21:07:53.311194 (ThreadPoolExecutor-0_0): 21:07:53  On list_PE_ALEXANDER_B: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B"} */

    show terse schemas in database PE_ALEXANDER_B
    limit 10000
2022-04-22 21:07:53.311287 (ThreadPoolExecutor-0_0): 21:07:53  Opening a new connection, currently in state init
2022-04-22 21:07:54.301396 (Thread-221): handling poll request
2022-04-22 21:07:54.301841 (Thread-221): 21:07:54  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feafafee0>]}
2022-04-22 21:07:54.302564 (Thread-221): sending response (<Response 9469 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:54.537523 (ThreadPoolExecutor-0_0): 21:07:54  SQL status: SUCCESS 4 in 1.23 seconds
2022-04-22 21:07:54.539680 (ThreadPoolExecutor-0_0): 21:07:54  On list_PE_ALEXANDER_B: Close
2022-04-22 21:07:54.762823 (ThreadPoolExecutor-2_0): 21:07:54  Acquiring new snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 21:07:54.770133 (ThreadPoolExecutor-2_0): 21:07:54  Using snowflake connection "list_PE_ALEXANDER_B_abrown_dbt_interview"
2022-04-22 21:07:54.770286 (ThreadPoolExecutor-2_0): 21:07:54  On list_PE_ALEXANDER_B_abrown_dbt_interview: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "connection_name": "list_PE_ALEXANDER_B_abrown_dbt_interview"} */

    show terse objects in PE_ALEXANDER_B.abrown_dbt_interview
2022-04-22 21:07:54.770391 (ThreadPoolExecutor-2_0): 21:07:54  Opening a new connection, currently in state closed
2022-04-22 21:07:55.621213 (Thread-222): handling poll request
2022-04-22 21:07:55.621637 (Thread-222): 21:07:55  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf422b0>]}
2022-04-22 21:07:55.622204 (Thread-222): sending response (<Response 2380 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:55.784295 (ThreadPoolExecutor-2_0): 21:07:55  SQL status: SUCCESS 10 in 1.01 seconds
2022-04-22 21:07:55.785949 (ThreadPoolExecutor-2_0): 21:07:55  On list_PE_ALEXANDER_B_abrown_dbt_interview: Close
2022-04-22 21:07:55.988137 (MainThread): 21:07:55  Concurrency: 4 threads (target='default')
2022-04-22 21:07:55.988324 (MainThread): 21:07:55  
2022-04-22 21:07:55.991196 (Thread-1): 21:07:55  Began running node model.my_new_project.orginal_query
2022-04-22 21:07:55.991539 (Thread-1): 21:07:55  1 of 11 START view model abrown_dbt_interview.orginal_query..................... [RUN]
2022-04-22 21:07:55.991815 (Thread-1): 21:07:55  Acquiring new snowflake connection "model.my_new_project.orginal_query"
2022-04-22 21:07:55.991924 (Thread-1): 21:07:55  Began compiling node model.my_new_project.orginal_query
2022-04-22 21:07:55.992035 (Thread-1): 21:07:55  Compiling model.my_new_project.orginal_query
2022-04-22 21:07:55.992699 (Thread-2): 21:07:55  Began running node model.my_new_project.stg_ctry_type
2022-04-22 21:07:55.992930 (Thread-2): 21:07:55  2 of 11 START view model abrown_dbt_interview.stg_ctry_type..................... [RUN]
2022-04-22 21:07:55.993206 (Thread-2): 21:07:55  Acquiring new snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 21:07:55.993292 (Thread-2): 21:07:55  Began compiling node model.my_new_project.stg_ctry_type
2022-04-22 21:07:55.993375 (Thread-2): 21:07:55  Compiling model.my_new_project.stg_ctry_type
2022-04-22 21:07:55.995709 (Thread-2): 21:07:55  Writing injected SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 21:07:55.996559 (Thread-3): 21:07:55  Began running node model.my_new_project.stg_device_orders
2022-04-22 21:07:55.996778 (Thread-3): 21:07:55  3 of 11 START view model abrown_dbt_interview.stg_device_orders................. [RUN]
2022-04-22 21:07:55.997031 (Thread-3): 21:07:55  Acquiring new snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 21:07:55.997119 (Thread-3): 21:07:55  Began compiling node model.my_new_project.stg_device_orders
2022-04-22 21:07:55.997201 (Thread-3): 21:07:55  Compiling model.my_new_project.stg_device_orders
2022-04-22 21:07:55.999296 (Thread-3): 21:07:55  Writing injected SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 21:07:55.999597 (Thread-4): 21:07:55  Began running node model.my_new_project.stg_orders
2022-04-22 21:07:55.999832 (Thread-4): 21:07:55  4 of 11 START view model abrown_dbt_interview.stg_orders........................ [RUN]
2022-04-22 21:07:56.000083 (Thread-4): 21:07:56  Acquiring new snowflake connection "model.my_new_project.stg_orders"
2022-04-22 21:07:56.000170 (Thread-4): 21:07:56  Began compiling node model.my_new_project.stg_orders
2022-04-22 21:07:56.000251 (Thread-4): 21:07:56  Compiling model.my_new_project.stg_orders
2022-04-22 21:07:56.002178 (Thread-4): 21:07:56  Writing injected SQL for node "model.my_new_project.stg_orders"
2022-04-22 21:07:56.004111 (Thread-1): 21:07:56  Writing injected SQL for node "model.my_new_project.orginal_query"
2022-04-22 21:07:56.004246 (Thread-1): 21:07:56  finished collecting timing info
2022-04-22 21:07:56.004360 (Thread-1): 21:07:56  Began executing node model.my_new_project.orginal_query
2022-04-22 21:07:56.024400 (Thread-2): 21:07:56  finished collecting timing info
2022-04-22 21:07:56.024562 (Thread-2): 21:07:56  Began executing node model.my_new_project.stg_ctry_type
2022-04-22 21:07:56.030850 (Thread-2): 21:07:56  Writing runtime SQL for node "model.my_new_project.stg_ctry_type"
2022-04-22 21:07:56.031084 (Thread-3): 21:07:56  finished collecting timing info
2022-04-22 21:07:56.031239 (Thread-3): 21:07:56  Began executing node model.my_new_project.stg_device_orders
2022-04-22 21:07:56.033117 (Thread-3): 21:07:56  Writing runtime SQL for node "model.my_new_project.stg_device_orders"
2022-04-22 21:07:56.034386 (Thread-1): 21:07:56  Writing runtime SQL for node "model.my_new_project.orginal_query"
2022-04-22 21:07:56.038091 (Thread-4): 21:07:56  finished collecting timing info
2022-04-22 21:07:56.038246 (Thread-4): 21:07:56  Began executing node model.my_new_project.stg_orders
2022-04-22 21:07:56.040124 (Thread-4): 21:07:56  Writing runtime SQL for node "model.my_new_project.stg_orders"
2022-04-22 21:07:56.045934 (Thread-3): 21:07:56  Using snowflake connection "model.my_new_project.stg_device_orders"
2022-04-22 21:07:56.046061 (Thread-3): 21:07:56  On model.my_new_project.stg_device_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_device_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders 
  
   as (
    with
    d as (select * from raw.interview_sample_data.interview_devices),

    do as (
    select distinct
        cast(d.type_id as float) as order_id,
        first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
            when d.device = 'web' then 'desktop'
            when d.device in ('ios-app', 'android-app') then 'mobile-app'
            when d.device in ('mobile', 'tablet') then 'mobile-web'
            when nullif(d.device, '') is null then 'unknown'
            else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
    )

select * from do
  );
2022-04-22 21:07:56.046151 (Thread-3): 21:07:56  Opening a new connection, currently in state init
2022-04-22 21:07:56.047565 (Thread-2): 21:07:56  Using snowflake connection "model.my_new_project.stg_ctry_type"
2022-04-22 21:07:56.047673 (Thread-2): 21:07:56  On model.my_new_project.stg_ctry_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_ctry_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type 
  
   as (
    with
    a as (select * from raw.interview_sample_data.interview_addresses),

 ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  )

select * from ct
  );
2022-04-22 21:07:56.047756 (Thread-2): 21:07:56  Opening a new connection, currently in state init
2022-04-22 21:07:56.048728 (Thread-1): 21:07:56  Using snowflake connection "model.my_new_project.orginal_query"
2022-04-22 21:07:56.048833 (Thread-1): 21:07:56  On model.my_new_project.orginal_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.orginal_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.orginal_query 
  
   as (
    
  );
2022-04-22 21:07:56.048914 (Thread-1): 21:07:56  Opening a new connection, currently in state closed
2022-04-22 21:07:56.056218 (Thread-4): 21:07:56  Using snowflake connection "model.my_new_project.stg_orders"
2022-04-22 21:07:56.056382 (Thread-4): 21:07:56  On model.my_new_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_orders"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_orders 
  
   as (
    with
    o as (select * from raw.interview_sample_data.interview_orders)

select
    *,
    o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category
 from o
  );
2022-04-22 21:07:56.056474 (Thread-4): 21:07:56  Opening a new connection, currently in state init
2022-04-22 21:07:56.944297 (Thread-223): handling poll request
2022-04-22 21:07:56.944684 (Thread-223): 21:07:56  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf567f0>]}
2022-04-22 21:07:56.945746 (Thread-223): sending response (<Response 22874 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:57.214396 (Thread-1): 21:07:57  Snowflake adapter: Snowflake query id: 01a3c8f3-0501-5f4a-0004-7d83048c46ca
2022-04-22 21:07:57.214636 (Thread-1): 21:07:57  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 21:07:57.214902 (Thread-1): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.215148 (Thread-1): 21:07:57  On model.my_new_project.orginal_query: Close
2022-04-22 21:07:57.231045 (Thread-4): 21:07:57  SQL status: SUCCESS 1 in 1.17 seconds
2022-04-22 21:07:57.237617 (Thread-4): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.237802 (Thread-4): 21:07:57  On model.my_new_project.stg_orders: Close
2022-04-22 21:07:57.268625 (Thread-2): 21:07:57  SQL status: SUCCESS 1 in 1.22 seconds
2022-04-22 21:07:57.270268 (Thread-2): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.270476 (Thread-2): 21:07:57  On model.my_new_project.stg_ctry_type: Close
2022-04-22 21:07:57.417699 (Thread-4): 21:07:57  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc27906cf10>]}
2022-04-22 21:07:57.418267 (Thread-4): 21:07:57  4 of 11 OK created view model abrown_dbt_interview.stg_orders................... [SUCCESS 1 in 1.42s]
2022-04-22 21:07:57.418409 (Thread-4): 21:07:57  Finished running node model.my_new_project.stg_orders
2022-04-22 21:07:57.418563 (Thread-4): 21:07:57  Began running node model.my_new_project.stg_query
2022-04-22 21:07:57.418748 (Thread-4): 21:07:57  5 of 11 START view model abrown_dbt_interview.stg_query......................... [RUN]
2022-04-22 21:07:57.419008 (Thread-4): 21:07:57  Acquiring new snowflake connection "model.my_new_project.stg_query"
2022-04-22 21:07:57.419150 (Thread-4): 21:07:57  Began compiling node model.my_new_project.stg_query
2022-04-22 21:07:57.419307 (Thread-4): 21:07:57  Compiling model.my_new_project.stg_query
2022-04-22 21:07:57.424593 (Thread-4): 21:07:57  Writing injected SQL for node "model.my_new_project.stg_query"
2022-04-22 21:07:57.449375 (Thread-1): 21:07:57  Database Error in model orginal_query (models/_archive/orginal_query.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 21:07:57.449858 (Thread-1): 21:07:57  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc27906cc40>]}
2022-04-22 21:07:57.450291 (Thread-1): 21:07:57  1 of 11 ERROR creating view model abrown_dbt_interview.orginal_query............ [ERROR in 1.46s]
2022-04-22 21:07:57.450421 (Thread-1): 21:07:57  Finished running node model.my_new_project.orginal_query
2022-04-22 21:07:57.450567 (Thread-1): 21:07:57  Began running node model.my_new_project.test_conn
2022-04-22 21:07:57.450754 (Thread-1): 21:07:57  6 of 11 START view model abrown_dbt_interview.test_conn......................... [RUN]
2022-04-22 21:07:57.451026 (Thread-1): 21:07:57  Acquiring new snowflake connection "model.my_new_project.test_conn"
2022-04-22 21:07:57.451132 (Thread-1): 21:07:57  Began compiling node model.my_new_project.test_conn
2022-04-22 21:07:57.451236 (Thread-1): 21:07:57  Compiling model.my_new_project.test_conn
2022-04-22 21:07:57.453079 (Thread-1): 21:07:57  Writing injected SQL for node "model.my_new_project.test_conn"
2022-04-22 21:07:57.453224 (Thread-1): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.453342 (Thread-1): 21:07:57  Began executing node model.my_new_project.test_conn
2022-04-22 21:07:57.455303 (Thread-4): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.455442 (Thread-4): 21:07:57  Began executing node model.my_new_project.stg_query
2022-04-22 21:07:57.456925 (Thread-1): 21:07:57  Writing runtime SQL for node "model.my_new_project.test_conn"
2022-04-22 21:07:57.460247 (Thread-4): 21:07:57  Writing runtime SQL for node "model.my_new_project.stg_query"
2022-04-22 21:07:57.461716 (Thread-2): 21:07:57  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc27a4bcbe0>]}
2022-04-22 21:07:57.462089 (Thread-2): 21:07:57  2 of 11 OK created view model abrown_dbt_interview.stg_ctry_type................ [SUCCESS 1 in 1.47s]
2022-04-22 21:07:57.462212 (Thread-2): 21:07:57  Finished running node model.my_new_project.stg_ctry_type
2022-04-22 21:07:57.462367 (Thread-2): 21:07:57  Began running node model.my_new_project.test_loop
2022-04-22 21:07:57.462548 (Thread-2): 21:07:57  7 of 11 START view model abrown_dbt_interview.test_loop......................... [RUN]
2022-04-22 21:07:57.462807 (Thread-2): 21:07:57  Acquiring new snowflake connection "model.my_new_project.test_loop"
2022-04-22 21:07:57.462901 (Thread-2): 21:07:57  Began compiling node model.my_new_project.test_loop
2022-04-22 21:07:57.462989 (Thread-2): 21:07:57  Compiling model.my_new_project.test_loop
2022-04-22 21:07:57.464897 (Thread-2): 21:07:57  Writing injected SQL for node "model.my_new_project.test_loop"
2022-04-22 21:07:57.465016 (Thread-2): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.465124 (Thread-2): 21:07:57  Began executing node model.my_new_project.test_loop
2022-04-22 21:07:57.467356 (Thread-2): 21:07:57  Writing runtime SQL for node "model.my_new_project.test_loop"
2022-04-22 21:07:57.471779 (Thread-1): 21:07:57  Using snowflake connection "model.my_new_project.test_conn"
2022-04-22 21:07:57.471909 (Thread-1): 21:07:57  On model.my_new_project.test_conn: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_conn"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_conn 
  
   as (
    
  );
2022-04-22 21:07:57.472000 (Thread-1): 21:07:57  Opening a new connection, currently in state closed
2022-04-22 21:07:57.479128 (Thread-2): 21:07:57  Using snowflake connection "model.my_new_project.test_loop"
2022-04-22 21:07:57.479273 (Thread-2): 21:07:57  On model.my_new_project.test_loop: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.test_loop"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.test_loop 
  
   as (
    
  );
2022-04-22 21:07:57.479364 (Thread-2): 21:07:57  Opening a new connection, currently in state closed
2022-04-22 21:07:57.486194 (Thread-4): 21:07:57  Using snowflake connection "model.my_new_project.stg_query"
2022-04-22 21:07:57.486331 (Thread-4): 21:07:57  On model.my_new_project.stg_query: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_query"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_query 
  
   as (
    -- import cte's

/*

step notes:

pull out source tables into cte's
create a _source.yml file in order to source those tables (which makes a pretty, more inuitive dag)
extract cte's we found in query:
    `dbt-public.interview_task.orders` o
    `dbt-public.interview_task.devices` d
    `dbt-public.interview_task.orders` as fo -- potentially redunant -- first order
    `dbt-public.interview_task.addresses` oa 
    `dbt-public.interview_task.payments`

a couple of errors that were resolved in the set up:
  data type `int64` to `float`
  rename raw source tables from `dbt-public.interview_` to: `raw.interview_sample_data.interview_`
  transform to lower case (using command pallet -- F1)
  changed `oa` to `a` for standarization
    
*/

with

  o as (select * from raw.interview_sample_data.interview_orders),
  d as (select * from raw.interview_sample_data.interview_devices),
  a as (select * from raw.interview_sample_data.interview_addresses),
  p as (select * from raw.interview_sample_data.interview_payments),

  -- logical cte's

  /*

  there are a lot of left join sub-queries, here is where we will try to simplify those
  renamed `d` to `do` for standarization
  added case statements into marts

  */

  do as (
    select distinct
      cast(d.type_id as float) as order_id,
      first_value(d.device) over (
        partition by d.type_id
        order by
        d.created_at rows between unbounded preceding
        and unbounded following
        ) as device,
        case
          when d.device = 'web' then 'desktop'
          when d.device in ('ios-app', 'android-app') then 'mobile-app'
          when d.device in ('mobile', 'tablet') then 'mobile-web'
          when nullif(d.device, '') is null then 'unknown'
          else 'error'
        end as purchase_device_type
    from d
    where d.type = 'order'
  ),

  fo as (
    select
      fo.user_id,
      min(fo.order_id) as first_order_id
    from o as fo
    where fo.status != 'cancelled'
    group by fo.user_id
  ),

  pa as (
    select
      order_id,
    sum(case
          when status = 'completed' then tax_amount_cents else 0
        end
      ) as gross_tax_amount_cents,
    sum(case
          when status = 'completed' then amount_cents else 0
        end
      ) as gross_amount_cents,
    sum(case
          when status = 'completed' then amount_shipping_cents else 0
        end
      ) as gross_shipping_amount_cents, -- minor change to name here
    sum(case
          when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
        end
      ) as gross_total_amount_cents
    from p
    group by order_id
  ),

  -- marts
  
  ct as (
    select
      a.order_id,
      case
        when a.country_code is null then 'null country'
        when a.country_code = 'us' then 'us'
        when a.country_code != 'us' then 'international'
      end as country_type
    from a
  ),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.status as order_status,
        case
          when o.status in (
            'paid',
            'completed',
            'shipped'
          ) then 'completed'
          else o.status
        end as order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        case
          when fo.first_order_id = o.order_id then 'new'
          else 'repeat'
        end as user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        case
          when o.currency = 'usd' then o.amount_total_cents
          else pa.gross_total_amount_cents
        end as total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_shipping_amount_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join fo
        on o.user_id = fo.user_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_shipping_amount_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 21:07:57.486420 (Thread-4): 21:07:57  Opening a new connection, currently in state closed
2022-04-22 21:07:57.654425 (Thread-3): 21:07:57  SQL status: SUCCESS 1 in 1.61 seconds
2022-04-22 21:07:57.656493 (Thread-3): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.656713 (Thread-3): 21:07:57  On model.my_new_project.stg_device_orders: Close
2022-04-22 21:07:57.954473 (Thread-3): 21:07:57  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc27a4bc6d0>]}
2022-04-22 21:07:57.954933 (Thread-3): 21:07:57  3 of 11 OK created view model abrown_dbt_interview.stg_device_orders............ [SUCCESS 1 in 1.96s]
2022-04-22 21:07:57.955062 (Thread-3): 21:07:57  Finished running node model.my_new_project.stg_device_orders
2022-04-22 21:07:57.955219 (Thread-3): 21:07:57  Began running node model.my_new_project.int_payments
2022-04-22 21:07:57.955404 (Thread-3): 21:07:57  8 of 11 START view model abrown_dbt_interview.int_payments...................... [RUN]
2022-04-22 21:07:57.955691 (Thread-3): 21:07:57  Acquiring new snowflake connection "model.my_new_project.int_payments"
2022-04-22 21:07:57.955788 (Thread-3): 21:07:57  Began compiling node model.my_new_project.int_payments
2022-04-22 21:07:57.955880 (Thread-3): 21:07:57  Compiling model.my_new_project.int_payments
2022-04-22 21:07:57.964610 (Thread-3): 21:07:57  Writing injected SQL for node "model.my_new_project.int_payments"
2022-04-22 21:07:57.991710 (Thread-3): 21:07:57  finished collecting timing info
2022-04-22 21:07:57.991902 (Thread-3): 21:07:57  Began executing node model.my_new_project.int_payments
2022-04-22 21:07:57.994335 (Thread-3): 21:07:57  Writing runtime SQL for node "model.my_new_project.int_payments"
2022-04-22 21:07:58.023157 (Thread-3): 21:07:58  Using snowflake connection "model.my_new_project.int_payments"
2022-04-22 21:07:58.023330 (Thread-3): 21:07:58  On model.my_new_project.int_payments: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_payments"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.int_payments 
  
   as (
    

with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders ),
    p as (select * from raw.interview_sample_data.interview_payments),

    p1 as (
    select
        order_id,
            sum(case when status = 'completed' then tax_amount_cents else 0 end) as gross_tax_amount_cents,
            sum(case when status = 'completed' then amount_cents else 0 end) as gross_amount_cents,
            sum(case when status = 'completed' then amount_shipping_cents else 0 end) as gross_amount_shipping_cents,

        sum(case
            when status = 'completed' then tax_amount_cents + amount_cents + amount_shipping_cents else 0
            end
            ) as gross_total_amount_cents
    from p
    group by order_id
    ),

    pa as (

        select
            p1.*,
            case
                when o.currency = 'usd' then o.amount_total_cents
                else p1.gross_total_amount_cents
            end as total_amount_cents
        from o
        left join p1
        on o.order_id = p1.order_id
    )

select * from pa
  );
2022-04-22 21:07:58.023425 (Thread-3): 21:07:58  Opening a new connection, currently in state closed
2022-04-22 21:07:58.273373 (Thread-224): handling poll request
2022-04-22 21:07:58.273795 (Thread-224): 21:07:58  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf67c40>]}
2022-04-22 21:07:58.275065 (Thread-224): sending response (<Response 36929 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:58.483435 (Thread-1): 21:07:58  Snowflake adapter: Snowflake query id: 01a3c8f3-0501-616b-0004-7d83048ca882
2022-04-22 21:07:58.483603 (Thread-1): 21:07:58  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 21:07:58.483774 (Thread-1): 21:07:58  finished collecting timing info
2022-04-22 21:07:58.483919 (Thread-1): 21:07:58  On model.my_new_project.test_conn: Close
2022-04-22 21:07:58.582660 (Thread-2): 21:07:58  Snowflake adapter: Snowflake query id: 01a3c8f3-0501-615d-0004-7d83048cb016
2022-04-22 21:07:58.582835 (Thread-2): 21:07:58  Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 5 at position 2 unexpected ')'.
2022-04-22 21:07:58.583007 (Thread-2): 21:07:58  finished collecting timing info
2022-04-22 21:07:58.583149 (Thread-2): 21:07:58  On model.my_new_project.test_loop: Close
2022-04-22 21:07:58.671458 (Thread-1): 21:07:58  Database Error in model test_conn (models/_archive/test_conn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 21:07:58.671735 (Thread-1): 21:07:58  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc27902b820>]}
2022-04-22 21:07:58.672208 (Thread-1): 21:07:58  6 of 11 ERROR creating view model abrown_dbt_interview.test_conn................ [ERROR in 1.22s]
2022-04-22 21:07:58.672335 (Thread-1): 21:07:58  Finished running node model.my_new_project.test_conn
2022-04-22 21:07:58.672484 (Thread-1): 21:07:58  Began running node model.my_new_project.stg_first_order
2022-04-22 21:07:58.672670 (Thread-1): 21:07:58  9 of 11 START view model abrown_dbt_interview.stg_first_order................... [RUN]
2022-04-22 21:07:58.672917 (Thread-1): 21:07:58  Acquiring new snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 21:07:58.673006 (Thread-1): 21:07:58  Began compiling node model.my_new_project.stg_first_order
2022-04-22 21:07:58.673099 (Thread-1): 21:07:58  Compiling model.my_new_project.stg_first_order
2022-04-22 21:07:58.675363 (Thread-1): 21:07:58  Writing injected SQL for node "model.my_new_project.stg_first_order"
2022-04-22 21:07:58.687597 (Thread-1): 21:07:58  finished collecting timing info
2022-04-22 21:07:58.687762 (Thread-1): 21:07:58  Began executing node model.my_new_project.stg_first_order
2022-04-22 21:07:58.690265 (Thread-1): 21:07:58  Writing runtime SQL for node "model.my_new_project.stg_first_order"
2022-04-22 21:07:58.702346 (Thread-1): 21:07:58  Using snowflake connection "model.my_new_project.stg_first_order"
2022-04-22 21:07:58.702476 (Thread-1): 21:07:58  On model.my_new_project.stg_first_order: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.stg_first_order"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),

    fo as (
        select
            fo.user_id,
            min(fo.order_id) as first_order_id
        from o as fo
        where fo.status != 'cancelled'
        group by fo.user_id
    )

select * from fo
  );
2022-04-22 21:07:58.702565 (Thread-1): 21:07:58  Opening a new connection, currently in state closed
2022-04-22 21:07:58.739242 (Thread-4): 21:07:58  SQL status: SUCCESS 1 in 1.25 seconds
2022-04-22 21:07:58.740957 (Thread-4): 21:07:58  finished collecting timing info
2022-04-22 21:07:58.741120 (Thread-4): 21:07:58  On model.my_new_project.stg_query: Close
2022-04-22 21:07:58.800346 (Thread-2): 21:07:58  Database Error in model test_loop (models/_archive/test_loop.sql)
  001003 (42000): SQL compilation error:
  syntax error line 5 at position 2 unexpected ')'.
  compiled SQL at target/run/my_new_project/models/_archive/test_loop.sql
2022-04-22 21:07:58.800633 (Thread-2): 21:07:58  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc278fda6a0>]}
2022-04-22 21:07:58.801090 (Thread-2): 21:07:58  7 of 11 ERROR creating view model abrown_dbt_interview.test_loop................ [ERROR in 1.34s]
2022-04-22 21:07:58.801215 (Thread-2): 21:07:58  Finished running node model.my_new_project.test_loop
2022-04-22 21:07:58.885339 (Thread-3): 21:07:58  SQL status: SUCCESS 1 in 0.86 seconds
2022-04-22 21:07:58.886837 (Thread-3): 21:07:58  finished collecting timing info
2022-04-22 21:07:58.887010 (Thread-3): 21:07:58  On model.my_new_project.int_payments: Close
2022-04-22 21:07:58.961717 (Thread-4): 21:07:58  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc244993df0>]}
2022-04-22 21:07:58.962164 (Thread-4): 21:07:58  5 of 11 OK created view model abrown_dbt_interview.stg_query.................... [SUCCESS 1 in 1.54s]
2022-04-22 21:07:58.962297 (Thread-4): 21:07:58  Finished running node model.my_new_project.stg_query
2022-04-22 21:07:59.145870 (Thread-3): 21:07:59  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2790747c0>]}
2022-04-22 21:07:59.146308 (Thread-3): 21:07:59  8 of 11 OK created view model abrown_dbt_interview.int_payments................. [SUCCESS 1 in 1.19s]
2022-04-22 21:07:59.146438 (Thread-3): 21:07:59  Finished running node model.my_new_project.int_payments
2022-04-22 21:07:59.484601 (Thread-1): 21:07:59  SQL status: SUCCESS 1 in 0.78 seconds
2022-04-22 21:07:59.486121 (Thread-1): 21:07:59  finished collecting timing info
2022-04-22 21:07:59.486287 (Thread-1): 21:07:59  On model.my_new_project.stg_first_order: Close
2022-04-22 21:07:59.597914 (Thread-225): handling poll request
2022-04-22 21:07:59.598357 (Thread-225): 21:07:59  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf71e20>]}
2022-04-22 21:07:59.599382 (Thread-225): sending response (<Response 18965 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:07:59.715842 (Thread-1): 21:07:59  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc278ff7670>]}
2022-04-22 21:07:59.716251 (Thread-1): 21:07:59  9 of 11 OK created view model abrown_dbt_interview.stg_first_order.............. [SUCCESS 1 in 1.04s]
2022-04-22 21:07:59.716377 (Thread-1): 21:07:59  Finished running node model.my_new_project.stg_first_order
2022-04-22 21:07:59.717391 (Thread-2): 21:07:59  Began running node model.my_new_project.int_user_type
2022-04-22 21:07:59.717740 (Thread-2): 21:07:59  10 of 11 START view model abrown_dbt_interview.int_user_type.................... [RUN]
2022-04-22 21:07:59.718031 (Thread-2): 21:07:59  Acquiring new snowflake connection "model.my_new_project.int_user_type"
2022-04-22 21:07:59.718130 (Thread-2): 21:07:59  Began compiling node model.my_new_project.int_user_type
2022-04-22 21:07:59.718224 (Thread-2): 21:07:59  Compiling model.my_new_project.int_user_type
2022-04-22 21:07:59.720708 (Thread-2): 21:07:59  Writing injected SQL for node "model.my_new_project.int_user_type"
2022-04-22 21:07:59.733086 (Thread-2): 21:07:59  finished collecting timing info
2022-04-22 21:07:59.733283 (Thread-2): 21:07:59  Began executing node model.my_new_project.int_user_type
2022-04-22 21:07:59.736061 (Thread-2): 21:07:59  Writing runtime SQL for node "model.my_new_project.int_user_type"
2022-04-22 21:07:59.748966 (Thread-2): 21:07:59  Using snowflake connection "model.my_new_project.int_user_type"
2022-04-22 21:07:59.749121 (Thread-2): 21:07:59  On model.my_new_project.int_user_type: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.int_user_type"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.int_user_type 
  
   as (
    with
    o as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),
    fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
    ut as (
        select
            o.order_id,
            case
                when fo.first_order_id = o.order_id then 'new'
                else 'repeat'
            end as user_type
        from o
        left join fo
            on o.user_id = fo.user_id

    )

select * from ut
  );
2022-04-22 21:07:59.749213 (Thread-2): 21:07:59  Opening a new connection, currently in state closed
2022-04-22 21:08:00.482687 (Thread-2): 21:08:00  SQL status: SUCCESS 1 in 0.73 seconds
2022-04-22 21:08:00.484256 (Thread-2): 21:08:00  finished collecting timing info
2022-04-22 21:08:00.484432 (Thread-2): 21:08:00  On model.my_new_project.int_user_type: Close
2022-04-22 21:08:00.661444 (Thread-2): 21:08:00  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc278f8b430>]}
2022-04-22 21:08:00.661933 (Thread-2): 21:08:00  10 of 11 OK created view model abrown_dbt_interview.int_user_type............... [SUCCESS 1 in 0.94s]
2022-04-22 21:08:00.662072 (Thread-2): 21:08:00  Finished running node model.my_new_project.int_user_type
2022-04-22 21:08:00.662866 (Thread-3): 21:08:00  Began running node model.my_new_project.fct_final
2022-04-22 21:08:00.663126 (Thread-3): 21:08:00  11 of 11 START view model abrown_dbt_interview.fct_final........................ [RUN]
2022-04-22 21:08:00.663414 (Thread-3): 21:08:00  Acquiring new snowflake connection "model.my_new_project.fct_final"
2022-04-22 21:08:00.663511 (Thread-3): 21:08:00  Began compiling node model.my_new_project.fct_final
2022-04-22 21:08:00.663606 (Thread-3): 21:08:00  Compiling model.my_new_project.fct_final
2022-04-22 21:08:00.667197 (Thread-3): 21:08:00  Writing injected SQL for node "model.my_new_project.fct_final"
2022-04-22 21:08:00.679497 (Thread-3): 21:08:00  finished collecting timing info
2022-04-22 21:08:00.679676 (Thread-3): 21:08:00  Began executing node model.my_new_project.fct_final
2022-04-22 21:08:00.682985 (Thread-3): 21:08:00  Writing runtime SQL for node "model.my_new_project.fct_final"
2022-04-22 21:08:00.696673 (Thread-3): 21:08:00  Using snowflake connection "model.my_new_project.fct_final"
2022-04-22 21:08:00.696822 (Thread-3): 21:08:00  On model.my_new_project.fct_final: /* {"app": "dbt", "dbt_version": "1.0.5", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.fct_final"} */

  create or replace  view PE_ALEXANDER_B.abrown_dbt_interview.fct_final 
  
   as (
    with
  o  as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_orders),
  do as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_device_orders),
  fo as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_first_order),
  ct as (select * from PE_ALEXANDER_B.abrown_dbt_interview.stg_ctry_type),
  pa as (select * from PE_ALEXANDER_B.abrown_dbt_interview.int_payments),
  ut as (select * from PE_ALEXANDER_B.abrown_dbt_interview.int_user_type),

  -- final cte's

  final as (

    select
        o.order_id,
        o.user_id,
        o.created_at,
        o.updated_at,
        o.shipped_at,
        o.currency,
        o.order_status,
        o.order_status_category,
        ct.country_type,
        o.shipping_method,
        do.purchase_device_type,
        do.device as purchase_device,
        ut.user_type,
        o.amount_total_cents,
        pa.gross_total_amount_cents,
        pa.total_amount_cents,
        pa.gross_tax_amount_cents,
        pa.gross_amount_cents,
        pa.gross_amount_shipping_cents
      from o

      left join do
        on do.order_id = o.order_id

      left join ut
        on o.order_id = ut.order_id

      left join ct 
        on ct.order_id = o.order_id

      left join pa
        on pa.order_id = o.order_id
  )

-- select statement


select
  *,
  amount_total_cents / 100 as amount_total,
  gross_total_amount_cents/ 100 as gross_total_amount,
  total_amount_cents/ 100 as total_amount,
  gross_tax_amount_cents/ 100 as gross_tax_amount,
  gross_amount_cents/ 100 as gross_amount,
  gross_amount_shipping_cents/ 100 as gross_shipping_amount

from final
  );
2022-04-22 21:08:00.696915 (Thread-3): 21:08:00  Opening a new connection, currently in state closed
2022-04-22 21:08:00.926782 (Thread-226): handling poll request
2022-04-22 21:08:00.927167 (Thread-226): 21:08:00  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf02c70>]}
2022-04-22 21:08:00.927995 (Thread-226): sending response (<Response 16304 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:08:01.578612 (Thread-3): 21:08:01  SQL status: SUCCESS 1 in 0.88 seconds
2022-04-22 21:08:01.580158 (Thread-3): 21:08:01  finished collecting timing info
2022-04-22 21:08:01.580332 (Thread-3): 21:08:01  On model.my_new_project.fct_final: Close
2022-04-22 21:08:01.769488 (Thread-3): 21:08:01  Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c2c217-5e3e-4367-aace-bb91d3a2d889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc272621700>]}
2022-04-22 21:08:01.769951 (Thread-3): 21:08:01  11 of 11 OK created view model abrown_dbt_interview.fct_final................... [SUCCESS 1 in 1.11s]
2022-04-22 21:08:01.770084 (Thread-3): 21:08:01  Finished running node model.my_new_project.fct_final
2022-04-22 21:08:01.771739 (MainThread): 21:08:01  Acquiring new snowflake connection "master"
2022-04-22 21:08:01.772109 (MainThread): 21:08:01  
2022-04-22 21:08:01.772219 (MainThread): 21:08:01  Finished running 11 view models in 8.48s.
2022-04-22 21:08:01.772304 (MainThread): 21:08:01  Connection 'master' was properly closed.
2022-04-22 21:08:01.772375 (MainThread): 21:08:01  Connection 'model.my_new_project.stg_first_order' was properly closed.
2022-04-22 21:08:01.772443 (MainThread): 21:08:01  Connection 'model.my_new_project.int_user_type' was properly closed.
2022-04-22 21:08:01.772506 (MainThread): 21:08:01  Connection 'model.my_new_project.fct_final' was properly closed.
2022-04-22 21:08:01.772567 (MainThread): 21:08:01  Connection 'model.my_new_project.stg_query' was properly closed.
2022-04-22 21:08:01.829054 (MainThread): 21:08:01  
2022-04-22 21:08:01.829277 (MainThread): 21:08:01  Completed with 3 errors and 0 warnings:
2022-04-22 21:08:01.829374 (MainThread): 21:08:01  
2022-04-22 21:08:01.829470 (MainThread): 21:08:01  Database Error in model orginal_query (models/_archive/orginal_query.sql)
2022-04-22 21:08:01.829549 (MainThread): 21:08:01    001003 (42000): SQL compilation error:
2022-04-22 21:08:01.829655 (MainThread): 21:08:01    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 21:08:01.829726 (MainThread): 21:08:01    compiled SQL at target/run/my_new_project/models/_archive/orginal_query.sql
2022-04-22 21:08:01.829799 (MainThread): 21:08:01  
2022-04-22 21:08:01.829877 (MainThread): 21:08:01  Database Error in model test_conn (models/_archive/test_conn.sql)
2022-04-22 21:08:01.829946 (MainThread): 21:08:01    001003 (42000): SQL compilation error:
2022-04-22 21:08:01.830010 (MainThread): 21:08:01    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 21:08:01.830074 (MainThread): 21:08:01    compiled SQL at target/run/my_new_project/models/_archive/test_conn.sql
2022-04-22 21:08:01.830142 (MainThread): 21:08:01  
2022-04-22 21:08:01.830215 (MainThread): 21:08:01  Database Error in model test_loop (models/_archive/test_loop.sql)
2022-04-22 21:08:01.830283 (MainThread): 21:08:01    001003 (42000): SQL compilation error:
2022-04-22 21:08:01.830347 (MainThread): 21:08:01    syntax error line 5 at position 2 unexpected ')'.
2022-04-22 21:08:01.830409 (MainThread): 21:08:01    compiled SQL at target/run/my_new_project/models/_archive/test_loop.sql
2022-04-22 21:08:01.830496 (MainThread): 21:08:01  
2022-04-22 21:08:01.830579 (MainThread): 21:08:01  Done. PASS=8 WARN=0 ERROR=3 SKIP=0 TOTAL=11
2022-04-22 21:08:02.258593 (Thread-227): handling poll request
2022-04-22 21:08:02.258989 (Thread-227): 21:08:02  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf19370>]}
2022-04-22 21:08:02.261111 (Thread-227): sending response (<Response 60729 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:08:03.014442 (Thread-228): handling status request
2022-04-22 21:08:03.014906 (Thread-228): 21:08:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf19ee0>]}
2022-04-22 21:08:03.015620 (Thread-228): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:08:03.105538 (Thread-229): handling status request
2022-04-22 21:08:03.105979 (Thread-229): 21:08:03  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf28040>]}
2022-04-22 21:08:03.106515 (Thread-229): sending response (<Response 2001 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:10:50.231099 (Thread-230): 21:10:50  Unable to do partial parsing because config vars, config profile, or config target have changed
2022-04-22 21:10:50.231882 (Thread-230): 21:10:50  Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feaf71c70>]}
2022-04-22 21:10:50.272452 (Thread-230): 21:10:50  Parsing macros/adapters.sql
2022-04-22 21:10:50.309844 (Thread-230): 21:10:50  Parsing macros/catalog.sql
2022-04-22 21:10:50.311760 (Thread-230): 21:10:50  Parsing macros/materializations/table.sql
2022-04-22 21:10:50.314776 (Thread-230): 21:10:50  Parsing macros/materializations/seed.sql
2022-04-22 21:10:50.319723 (Thread-230): 21:10:50  Parsing macros/materializations/incremental.sql
2022-04-22 21:10:50.327902 (Thread-230): 21:10:50  Parsing macros/materializations/merge.sql
2022-04-22 21:10:50.331558 (Thread-230): 21:10:50  Parsing macros/materializations/snapshot.sql
2022-04-22 21:10:50.332491 (Thread-230): 21:10:50  Parsing macros/materializations/view.sql
2022-04-22 21:10:50.333841 (Thread-230): 21:10:50  Parsing macros/adapters/metadata.sql
2022-04-22 21:10:50.340609 (Thread-230): 21:10:50  Parsing macros/adapters/columns.sql
2022-04-22 21:10:50.350110 (Thread-230): 21:10:50  Parsing macros/adapters/freshness.sql
2022-04-22 21:10:50.352944 (Thread-230): 21:10:50  Parsing macros/adapters/persist_docs.sql
2022-04-22 21:10:50.357166 (Thread-230): 21:10:50  Parsing macros/adapters/relation.sql
2022-04-22 21:10:50.366361 (Thread-230): 21:10:50  Parsing macros/adapters/schema.sql
2022-04-22 21:10:50.368531 (Thread-230): 21:10:50  Parsing macros/adapters/indexes.sql
2022-04-22 21:10:50.371170 (Thread-230): 21:10:50  Parsing macros/get_custom_name/get_custom_schema.sql
2022-04-22 21:10:50.373560 (Thread-230): 21:10:50  Parsing macros/get_custom_name/get_custom_alias.sql
2022-04-22 21:10:50.375024 (Thread-230): 21:10:50  Parsing macros/get_custom_name/get_custom_database.sql
2022-04-22 21:10:50.376574 (Thread-230): 21:10:50  Parsing macros/etc/datetime.sql
2022-04-22 21:10:50.384588 (Thread-230): 21:10:50  Parsing macros/etc/statement.sql
2022-04-22 21:10:50.388843 (Thread-230): 21:10:50  Parsing macros/generic_test_sql/unique.sql
2022-04-22 21:10:50.389592 (Thread-230): 21:10:50  Parsing macros/generic_test_sql/not_null.sql
2022-04-22 21:10:50.390159 (Thread-230): 21:10:50  Parsing macros/generic_test_sql/accepted_values.sql
2022-04-22 21:10:50.391490 (Thread-230): 21:10:50  Parsing macros/generic_test_sql/relationships.sql
2022-04-22 21:10:50.392348 (Thread-230): 21:10:50  Parsing macros/materializations/configs.sql
2022-04-22 21:10:50.394570 (Thread-230): 21:10:50  Parsing macros/materializations/hooks.sql
2022-04-22 21:10:50.398259 (Thread-230): 21:10:50  Parsing macros/materializations/models/table/table.sql
2022-04-22 21:10:50.405810 (Thread-230): 21:10:50  Parsing macros/materializations/models/table/create_table_as.sql
2022-04-22 21:10:50.408585 (Thread-230): 21:10:50  Parsing macros/materializations/models/view/create_or_replace_view.sql
2022-04-22 21:10:50.411178 (Thread-230): 21:10:50  Parsing macros/materializations/models/view/helpers.sql
2022-04-22 21:10:50.412457 (Thread-230): 21:10:50  Parsing macros/materializations/models/view/create_view_as.sql
2022-04-22 21:10:50.414662 (Thread-230): 21:10:50  Parsing macros/materializations/models/view/view.sql
2022-04-22 21:10:50.421533 (Thread-230): 21:10:50  Parsing macros/materializations/models/incremental/incremental.sql
2022-04-22 21:10:50.431194 (Thread-230): 21:10:50  Parsing macros/materializations/models/incremental/on_schema_change.sql
2022-04-22 21:10:50.446217 (Thread-230): 21:10:50  Parsing macros/materializations/models/incremental/is_incremental.sql
2022-04-22 21:10:50.447741 (Thread-230): 21:10:50  Parsing macros/materializations/models/incremental/merge.sql
2022-04-22 21:10:50.458530 (Thread-230): 21:10:50  Parsing macros/materializations/models/incremental/column_helpers.sql
2022-04-22 21:10:50.462806 (Thread-230): 21:10:50  Parsing macros/materializations/seeds/helpers.sql
2022-04-22 21:10:50.478395 (Thread-230): 21:10:50  Parsing macros/materializations/seeds/seed.sql
2022-04-22 21:10:50.484176 (Thread-230): 21:10:50  Parsing macros/materializations/tests/helpers.sql
2022-04-22 21:10:50.485949 (Thread-230): 21:10:50  Parsing macros/materializations/tests/test.sql
2022-04-22 21:10:50.490208 (Thread-230): 21:10:50  Parsing macros/materializations/tests/where_subquery.sql
2022-04-22 21:10:50.492026 (Thread-230): 21:10:50  Parsing macros/materializations/snapshots/helpers.sql
2022-04-22 21:10:50.503042 (Thread-230): 21:10:50  Parsing macros/materializations/snapshots/strategies.sql
2022-04-22 21:10:50.519104 (Thread-230): 21:10:50  Parsing macros/materializations/snapshots/snapshot_merge.sql
2022-04-22 21:10:50.520775 (Thread-230): 21:10:50  Parsing macros/materializations/snapshots/snapshot.sql
2022-04-22 21:10:50.532085 (Thread-230): 21:10:50  Parsing tests/generic/builtin.sql
2022-04-22 21:10:50.717809 (Thread-230): 21:10:50  1699: static parser successfully parsed _archive/stg_query.sql
2022-04-22 21:10:50.721040 (Thread-230): 21:10:50  1699: static parser successfully parsed _archive/test_conn.sql
2022-04-22 21:10:50.723598 (Thread-230): 21:10:50  1699: static parser successfully parsed _archive/orginal_query.sql
2022-04-22 21:10:50.726062 (Thread-230): 21:10:50  1699: static parser successfully parsed staging/stg_orders.sql
2022-04-22 21:10:50.728181 (Thread-230): 21:10:50  1699: static parser successfully parsed staging/stg_first_order.sql
2022-04-22 21:10:50.730160 (Thread-230): 21:10:50  1699: static parser successfully parsed staging/stg_ctry_type.sql
2022-04-22 21:10:50.732084 (Thread-230): 21:10:50  1699: static parser successfully parsed staging/stg_device_orders.sql
2022-04-22 21:10:50.734146 (Thread-230): 21:10:50  1699: static parser successfully parsed intermediate/int_user_type.sql
2022-04-22 21:10:50.736117 (Thread-230): 21:10:50  1603: static parser failed on intermediate/int_payments.sql
2022-04-22 21:10:50.740905 (Thread-230): 21:10:50  1602: parser fallback to jinja rendering on intermediate/int_payments.sql
2022-04-22 21:10:50.742581 (Thread-230): 21:10:50  1699: static parser successfully parsed marts/fct_final.sql
2022-04-22 21:10:50.798390 (Thread-230): 21:10:50  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:10:50.806251 (Thread-230): 21:10:50  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feae47250>]}
2022-04-22 21:10:51.080212 (Thread-231): handling status request
2022-04-22 21:10:51.080598 (Thread-231): 21:10:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feae9a370>]}
2022-04-22 21:10:51.081571 (Thread-231): sending response (<Response 18849 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:10:51.106824 (Thread-232): handling status request
2022-04-22 21:10:51.107221 (Thread-232): 21:10:51  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feae9a100>]}
2022-04-22 21:10:51.108248 (Thread-232): sending response (<Response 18849 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:11:30.439519 (Thread-233): 21:11:30  Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
2022-04-22 21:11:30.439763 (Thread-233): 21:11:30  Partial parsing enabled, no changes found, skipping parsing
2022-04-22 21:11:30.440296 (Thread-233): 21:11:30  [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.my_new_project.example

2022-04-22 21:11:30.445687 (Thread-233): 21:11:30  Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feadc8f10>]}
2022-04-22 21:11:31.314033 (Thread-234): handling status request
2022-04-22 21:11:31.314419 (Thread-234): 21:11:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feae63880>]}
2022-04-22 21:11:31.314887 (Thread-234): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:11:31.348080 (Thread-235): handling status request
2022-04-22 21:11:31.348394 (Thread-235): 21:11:31  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feae63730>]}
2022-04-22 21:11:31.348825 (Thread-235): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
2022-04-22 21:12:43.649286 (Thread-236): handling status request
2022-04-22 21:12:43.650639 (Thread-236): 21:12:43  Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aea8c735-4b46-4b0f-b5ea-82801e109fdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2feae63520>]}
2022-04-22 21:12:43.651139 (Thread-236): sending response (<Response 1685 bytes [200 OK]>) to 10.0.12.113
